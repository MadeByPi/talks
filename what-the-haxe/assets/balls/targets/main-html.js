/** Cooked with Flambe, https://getflambe.com */
'use strict';(function(){function t(a,b){function c(){}c.prototype=a;var d=new c,e;for(e in b)d[e]=b[e];b.toString!==Object.prototype.toString&&(d.toString=b.toString);return d}function zh(a){return a instanceof Array?function(){return F.iter(a)}:"function"==typeof a.iterator?n(a,a.iterator):a.iterator}function n(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=Ih++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,
arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c}var h={},l=function(){return O.__string_rec(this,"")},ya=function(a,b){b=b.split("u").join("");this.r=RegExp(a,b)};h.EReg=ya;ya.__name__=!0;ya.prototype={match:function(a){this.r.global&&(this.r.lastIndex=0);this.r.m=this.r.exec(a);this.r.s=a;return null!=this.r.m},__class__:ya};var F=function(){};h.HxOverrides=F;F.__name__=!0;F.cca=function(a,b){var c=a.charCodeAt(b);return c!=c?void 0:c};F.substr=function(a,b,c){if(null!=b&&
0!=b&&null!=c&&0>c)return"";null==c&&(c=a.length);0>b?(b=a.length+b,0>b&&(b=0)):0>c&&(c=a.length+c-b);return a.substr(b,c)};F.remove=function(a,b){var c=a.indexOf(b);if(-1==c)return!1;a.splice(c,1);return!0};F.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var ld=function(){};h.Lambda=ld;ld.__name__=!0;ld.array=function(a){for(var b=[],a=zh(a)();a.hasNext();){var c=a.next();b.push(c)}return b};ld.count=function(a,
b){var c=0;if(null==b)for(var d=zh(a)();d.hasNext();)d.next(),c++;else for(d=zh(a)();d.hasNext();){var e=d.next();b(e)&&c++}return c};var Mf=function(){this.length=0};h.List=Mf;Mf.__name__=!0;Mf.prototype={push:function(a){this.h=a=[a,this.h];null==this.q&&(this.q=a);this.length++},pop:function(){if(null==this.h)return null;var a=this.h[0];this.h=this.h[1];null==this.h&&(this.q=null);this.length--;return a},clear:function(){this.q=this.h=null;this.length=0},iterator:function(){return{h:this.h,hasNext:function(){return null!=
this.h},next:function(){if(null==this.h)return null;var a=this.h[0];this.h=this.h[1];return a}}},__class__:Mf};var Nf=function(){};h.IMap=Nf;Nf.__name__=!0;Math.__name__=!0;var ha=function(){};h.Reflect=ha;ha.__name__=!0;ha.field=function(a,b){try{return a[b]}catch(c){return null}};ha.callMethod=function(a,b,c){return b.apply(a,c)};ha.compare=function(a,b){return a==b?0:a>b?1:-1};ha.isEnumValue=function(a){return null!=a&&null!=a.__enum__};var y=function(){};h.Std=y;y.__name__=!0;y.is=function(a,
b){return O.__instanceof(a,b)};y.string=function(a){return O.__string_rec(a,"")};y["int"]=function(a){return a|0};y.parseInt=function(a){var b=parseInt(a,10);if(0==b&&(120==F.cca(a,1)||88==F.cca(a,1)))b=parseInt(a);return isNaN(b)?null:b};y.parseFloat=function(a){return parseFloat(a)};var oe=function(){this.b=""};h.StringBuf=oe;oe.__name__=!0;oe.prototype={add:function(a){this.b+=y.string(a)},addSub:function(a,b,c){this.b=null==c?this.b+F.substr(a,b,null):this.b+F.substr(a,b,c)},__class__:oe};var Rd=
function(){};h.StringTools=Rd;Rd.__name__=!0;Rd.startsWith=function(a,b){return a.length>=b.length&&F.substr(a,0,b.length)==b};Rd.fastCodeAt=function(a,b){return a.charCodeAt(b)};var Yc=function(){};h.Type=Yc;Yc.__name__=!0;Yc.resolveClass=function(a){a=h[a];return null==a||!a.__name__?null:a};Yc.resolveEnum=function(a){a=h[a];return null==a||!a.__ename__?null:a};Yc.createInstance=function(a,b){switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],
b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6]);case 8:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);default:throw"Too many arguments";}};Yc.allEnums=function(a){return a.__empty_constructs__};(h.XmlType={__ename__:!0,__constructs__:[]}).__empty_constructs__=[];var D=function(){};h.Xml=D;D.__name__=!0;D.parse=function(a){return Kc.parse(a)};
D.createElement=function(a){var b=new D;b.nodeType=D.Element;b._children=[];b._attributes=new Fb;b.set_nodeName(a);return b};D.createPCData=function(a){var b=new D;b.nodeType=D.PCData;b.set_nodeValue(a);return b};D.createCData=function(a){var b=new D;b.nodeType=D.CData;b.set_nodeValue(a);return b};D.createComment=function(a){var b=new D;b.nodeType=D.Comment;b.set_nodeValue(a);return b};D.createDocType=function(a){var b=new D;b.nodeType=D.DocType;b.set_nodeValue(a);return b};D.createProcessingInstruction=
function(a){var b=new D;b.nodeType=D.ProcessingInstruction;b.set_nodeValue(a);return b};D.createDocument=function(){var a=new D;a.nodeType=D.Document;a._children=[];return a};D.prototype={get_nodeName:function(){if(this.nodeType!=D.Element)throw"bad nodeType";return this._nodeName},set_nodeName:function(a){if(this.nodeType!=D.Element)throw"bad nodeType";return this._nodeName=a},set_nodeValue:function(a){if(this.nodeType==D.Element||this.nodeType==D.Document)throw"bad nodeType";return this._nodeValue=
a},get:function(a){if(this.nodeType!=D.Element)throw"bad nodeType";return this._attributes.get(a)},set:function(a,b){if(this.nodeType!=D.Element)throw"bad nodeType";this._attributes.set(a,b)},exists:function(a){if(this.nodeType!=D.Element)throw"bad nodeType";return this._attributes.exists(a)},elements:function(){if(null==this._children)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){for(var a=this.cur,b=this.x.length;a<b&&!(this.x[a].nodeType==D.Element);)a+=1;this.cur=a;return a<
b},next:function(){for(var a=this.cur,b=this.x.length;a<b;){var c=this.x[a],a=a+1;if(c.nodeType==D.Element)return this.cur=a,c}return null}}},elementsNamed:function(a){if(null==this._children)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){for(var b=this.cur,c=this.x.length;b<c;){var d=this.x[b];if(d.nodeType==D.Element&&d._nodeName==a)break;b++}this.cur=b;return b<c},next:function(){for(var b=this.cur,c=this.x.length;b<c;){var d=this.x[b];b++;if(d.nodeType==D.Element&&d._nodeName==
a)return this.cur=b,d}return null}}},firstElement:function(){if(null==this._children)throw"bad nodetype";for(var a=0,b=this._children.length;a<b;){var c=this._children[a];if(c.nodeType==D.Element)return c;a++}return null},addChild:function(a){if(null==this._children)throw"bad nodetype";null!=a._parent&&F.remove(a._parent._children,a);a._parent=this;this._children.push(a)},__class__:D};var Zb=function(){};h["flambe.util.Disposable"]=Zb;Zb.__name__=!0;Zb.prototype={__class__:Zb};var E=function(){this._flags=
0;this.owner=this.next=null};h["flambe.Component"]=E;E.__name__=!0;E.__interfaces__=[Zb];E.prototype={onAdded:function(){},onRemoved:function(){},onStart:function(){},onStop:function(){},onUpdate:function(){},dispose:function(){null!=this.owner&&this.owner.remove(this)},get_name:function(){return null},__class__:E};var W=function(){this.parent=this.firstChild=this.next=this.firstComponent=null;this._compMap={}};h["flambe.Entity"]=W;W.__name__=!0;W.__interfaces__=[Zb];W.prototype={add:function(a){null!=
a.owner&&a.owner.remove(a);var b=a.get_name(),c=this._compMap[b];null!=c&&this.remove(c);this._compMap[b]=a;b=null;for(c=this.firstComponent;null!=c;)b=c,c=c.next;null!=b?b.next=a:this.firstComponent=a;a.owner=this;a.next=null;a.onAdded();return this},remove:function(a){for(var b=null,c=this.firstComponent;null!=c;){var d=c.next;if(c==a)return null==b?this.firstComponent=d:(b.owner=this,b.next=d),delete this._compMap[c.get_name()],0!=(c._flags&1)&&(c.onStop(),c._flags&=-2),c.onRemoved(),c.owner=null,
c.next=null,!0;b=c;c=d}return!1},addChild:function(a,b){null==b&&(b=!0);null!=a.parent&&a.parent.removeChild(a);a.parent=this;if(b){for(var c=null,d=this.firstChild;null!=d;)c=d,d=d.next;null!=c?c.next=a:this.firstChild=a}else a.next=this.firstChild,this.firstChild=a;return this},removeChild:function(a){for(var b=null,c=this.firstChild;null!=c;){var d=c.next;if(c==a){null==b?this.firstChild=d:b.next=d;c.parent=null;c.next=null;break}b=c;c=d}},disposeChildren:function(){for(;null!=this.firstChild;)this.firstChild.dispose()},
dispose:function(){for(null!=this.parent&&this.parent.removeChild(this);null!=this.firstComponent;)this.firstComponent.dispose();this.disposeChildren()},toString:function(){return this.toStringImpl("")},toStringImpl:function(a){for(var b="",c=this.firstComponent;null!=c;)b+=c.get_name(),null!=c.next&&(b+=", "),c=c.next;for(var b=b+"\n",c=String.fromCharCode(9492),d=String.fromCharCode(9500),e=String.fromCharCode(9472),v=String.fromCharCode(9474),f=this.firstChild;null!=f;)var j=null==f.next,b=b+(a+
(j?c:d)+e+e+" "),b=b+f.toStringImpl(a+(j?" ":v)+"   "),f=f.next;return b},__class__:W};var Lg=function(){};h["flambe.util.PackageLog"]=Lg;Lg.__name__=!0;var Of=function(){};h["flambe.platform.Platform"]=Of;Of.__name__=!0;Of.prototype={__class__:Of};var lc=function(){};h["flambe.platform.html.HtmlPlatform"]=lc;lc.__name__=!0;lc.__interfaces__=[Of];lc.prototype={init:function(){var a=this;J.fixAndroidMath();var b=null;try{b=window.flambe.canvas}catch(c){}b.setAttribute("tabindex","0");b.style.outlineStyle=
"none";b.style.webkitTapHighlightColor="transparent";b.setAttribute("moz-opaque","true");this._stage=new mc(b);this._pointer=new za;this._mouse=new pe(this._pointer,b);this._renderer=this.createRenderer(b);this.mainLoop=new Lc;this.musicPlaying=!1;this._canvas=b;this._container=b.parentElement;this._container.style.overflow="hidden";this._container.style.position="relative";this._container.style.msTouchAction="none";var d=0,e=function(c){if(!(1E3>c.timeStamp-d)){var e=b.getBoundingClientRect(),v=
a.getX(c,e),e=a.getY(c,e);switch(c.type){case "mousedown":c.target==b&&(c.preventDefault(),a._mouse.submitDown(v,e,c.button),b.focus());break;case "mousemove":a._mouse.submitMove(v,e);break;case "mouseup":a._mouse.submitUp(v,e,c.button);break;case "mousewheel":case "DOMMouseScroll":a._mouse.submitScroll(v,e,"mousewheel"==c.type?c.wheelDelta/40:-c.detail)&&c.preventDefault()}}};window.addEventListener("mousedown",e,!1);window.addEventListener("mousemove",e,!1);window.addEventListener("mouseup",e,!1);
b.addEventListener("mousewheel",e,!1);b.addEventListener("DOMMouseScroll",e,!1);b.addEventListener("contextmenu",function(a){a.preventDefault()},!1);var v="undefined"!=typeof window.ontouchstart,e="msMaxTouchPoints"in window.navigator&&1<window.navigator.msMaxTouchPoints;if(v||e){var f=new qe(this._pointer,v?4:window.navigator.msMaxTouchPoints);this._touch=f;e=function(b){var c;c=v?b.changedTouches:[b];var e=b.target.getBoundingClientRect();d=b.timeStamp;switch(b.type){case "touchstart":case "MSPointerDown":case "pointerdown":b.preventDefault();
J.SHOULD_HIDE_MOBILE_BROWSER&&J.hideMobileBrowser();for(b=0;b<c.length;){var j=c[b];++b;var g=a.getX(j,e),i=a.getY(j,e);f.submitDown((v?j.identifier:j.pointerId)|0,g,i)}break;case "touchmove":case "MSPointerMove":case "pointermove":b.preventDefault();for(b=0;b<c.length;)j=c[b],++b,g=a.getX(j,e),i=a.getY(j,e),f.submitMove((v?j.identifier:j.pointerId)|0,g,i);break;case "touchend":case "touchcancel":case "MSPointerUp":case "pointerup":for(b=0;b<c.length;)j=c[b],++b,g=a.getX(j,e),i=a.getY(j,e),f.submitUp((v?
j.identifier:j.pointerId)|0,g,i)}};v?(b.addEventListener("touchstart",e,!1),b.addEventListener("touchmove",e,!1),b.addEventListener("touchend",e,!1),b.addEventListener("touchcancel",e,!1)):(b.addEventListener("MSPointerDown",e,!1),b.addEventListener("MSPointerMove",e,!1),b.addEventListener("MSPointerUp",e,!1))}else this._touch=new ve;var j=window.onerror;window.onerror=function(a,b,c){s.uncaughtError.emit(a);return null!=j?j(a,b,c):!1};var g=J.loadExtension("hidden",window.document);null!=g.value?
(e=function(){s.hidden.set__(ha.field(window.document,g.field))},e(null),window.document.addEventListener(g.prefix+"visibilitychange",e,!1)):(e=function(a){s.hidden.set__("pagehide"==a.type)},window.addEventListener("pageshow",e,!1),window.addEventListener("pagehide",e,!1));s.hidden.get_changed().connect(function(b){b||(a._skipFrame=!0)});this._skipFrame=!1;this._lastUpdate=Date.now();var h=J.loadExtension("requestAnimationFrame").value;if(null!=h){var k=window.performance,o=null!=k&&J.polyfill("now",
k);o?this._lastUpdate=k.now():null;var m=null,m=function(c){a.update(o?k.now():c);h(m,b)};h(m,b)}else window.setInterval(function(){a.update(Date.now())},16);Zc.info("Initialized HTML platform",["renderer",this._renderer.get_type()])},loadAssetPack:function(a){return(new P(this,a)).promise},getStage:function(){return this._stage},createLogHandler:function(){return null},update:function(a){var b=(a-this._lastUpdate)/1E3;this._lastUpdate=a;s.hidden._value||(this._skipFrame?this._skipFrame=!1:(this.mainLoop.update(b),
this.mainLoop.render(this._renderer)))},getPointer:function(){return this._pointer},getMouse:function(){return this._mouse},getTouch:function(){return this._touch},getKeyboard:function(){var a=this;if(null==this._keyboard){this._keyboard=new ob;var b=function(b){switch(b.type){case "keydown":a._keyboard.submitDown(b.keyCode)&&b.preventDefault();break;case "keyup":a._keyboard.submitUp(b.keyCode)}};this._canvas.addEventListener("keydown",b,!1);this._canvas.addEventListener("keyup",b,!1)}return this._keyboard},
getRenderer:function(){return this._renderer},getX:function(a,b){return(a.clientX-b.left)*this._stage.get_width()/b.width},getY:function(a,b){return(a.clientY-b.top)*this._stage.get_height()/b.height},createRenderer:function(a){try{var b=Mg.getContextWebGL(a,{alpha:!1,depth:!1,failIfMajorPerformanceCaveat:!0});if(null!=b)if(J.detectSlowDriver(b))null;else return new we(this._stage,b)}catch(c){}return new $b(a)},__class__:lc};var Aa=function(a,b){this._value=a;this._changed=null!=b?new Sd(b):null};
h["flambe.util.Value"]=Aa;Aa.__name__=!0;Aa.prototype={watch:function(a){a(this._value,this._value);return this.get_changed().connect(a)},get__:function(){return this._value},set__:function(a){var b=this._value;a!=b&&(this._value=a,null!=this._changed&&this._changed.emit(a,b));return a},get_changed:function(){null==this._changed&&(this._changed=new Sd);return this._changed},__class__:Aa};var md=function(a,b){this._next=null;this._signal=a;this._listener=b;this.stayInList=!0};h["flambe.util.SignalConnection"]=
md;md.__name__=!0;md.__interfaces__=[Zb];md.prototype={once:function(){this.stayInList=!1;return this},dispose:function(){null!=this._signal&&(this._signal.disconnect(this),this._signal=null)},__class__:md};var X=function(a){this._head=null!=a?new md(this,a):null;this._deferredTasks=null};h["flambe.util.SignalBase"]=X;X.__name__=!0;X.prototype={connectImpl:function(a,b){var c=this,d=new md(this,a);this._head==X.DISPATCHING_SENTINEL?this.defer(function(){c.listAdd(d,b)}):this.listAdd(d,b);return d},
disconnect:function(a){var b=this;this._head==X.DISPATCHING_SENTINEL?this.defer(function(){b.listRemove(a)}):this.listRemove(a)},defer:function(a){for(var b=null,c=this._deferredTasks;null!=c;)b=c,c=c.next;a=new Pf(a);null!=b?b.next=a:this._deferredTasks=a},willEmit:function(){var a=this._head;this._head=X.DISPATCHING_SENTINEL;return a},didEmit:function(a){this._head=a;a=this._deferredTasks;for(this._deferredTasks=null;null!=a;)a.fn(),a=a.next},listAdd:function(a,b){if(b)a._next=this._head,this._head=
a;else{for(var c=null,d=this._head;null!=d;)c=d,d=d._next;null!=c?c._next=a:this._head=a}},listRemove:function(a){for(var b=null,c=this._head;null!=c;){if(c==a){a=c._next;null==b?this._head=a:b._next=a;break}b=c;c=c._next}},__class__:X};var Sd=function(a){X.call(this,a)};h["flambe.util.Signal2"]=Sd;Sd.__name__=!0;Sd.__super__=X;Sd.prototype=t(X.prototype,{connect:function(a,b){null==b&&(b=!1);return this.connectImpl(a,b)},emit:function(a,b){var c=this;this._head==X.DISPATCHING_SENTINEL?this.defer(function(){c.emitImpl(a,
b)}):this.emitImpl(a,b)},emitImpl:function(a,b){for(var c=this.willEmit(),d=c;null!=d;)d._listener(a,b),d.stayInList||d.dispose(),d=d._next;this.didEmit(c)},__class__:Sd});var ca=function(a){X.call(this,a)};h["flambe.util.Signal1"]=ca;ca.__name__=!0;ca.__super__=X;ca.prototype=t(X.prototype,{connect:function(a,b){null==b&&(b=!1);return this.connectImpl(a,b)},emit:function(a){var b=this;this._head==X.DISPATCHING_SENTINEL?this.defer(function(){b.emitImpl(a)}):this.emitImpl(a)},emitImpl:function(a){for(var b=
this.willEmit(),c=b;null!=c;)c._listener(a),c.stayInList||c.dispose(),c=c._next;this.didEmit(b)},__class__:ca});var z=function(a,b){this._behavior=null;Aa.call(this,a,b)};h["flambe.animation.AnimatedFloat"]=z;z.__name__=!0;z.__super__=Aa;z.prototype=t(Aa.prototype,{set__:function(a){this._behavior=null;return Aa.prototype.set__.call(this,a)},update:function(a){null!=this._behavior&&(Aa.prototype.set__.call(this,this._behavior.update(a)),this._behavior.isComplete()&&(this._behavior=null))},animateTo:function(a,
b,c){this.set_behavior(new nd(this._value,a,b,c))},animateBy:function(a,b,c){this.set_behavior(new nd(this._value,this._value+a,b,c))},set_behavior:function(a){this._behavior=a;this.update(0);return a},__class__:z});var s=function(){};h["flambe.System"]=s;s.__name__=!0;s.init=function(){s._calledInit||(s._platform.init(),s._calledInit=!0)};s.loadAssetPack=function(a){return s._platform.loadAssetPack(a)};var Qf=function(a){this._handler=a};h["flambe.util.Logger"]=Qf;Qf.__name__=!0;Qf.prototype={__class__:Qf};
var Zc=function(){};h["flambe.Log"]=Zc;Zc.__name__=!0;Zc.info=function(){null};Zc.__super__=Lg;Zc.prototype=t(Lg.prototype,{__class__:Zc});var Rf=function(){this._realDt=0};h["flambe.SpeedAdjuster"]=Rf;Rf.__name__=!0;Rf.__super__=E;Rf.prototype=t(E.prototype,{get_name:function(){return"SpeedAdjuster_17"},onUpdate:function(a){0<this._realDt&&(a=this._realDt,this._realDt=0);this.scale.update(a)},__class__:Rf});var Sf=function(){};h["flambe.animation.Behavior"]=Sf;Sf.__name__=!0;Sf.prototype={__class__:Sf};
var Ba=function(){};h["flambe.animation.Ease"]=Ba;Ba.__name__=!0;Ba.linear=function(a){return a};Ba.quadIn=function(a){return a*a};Ba.quadOut=function(a){return a*(2-a)};Ba.sineInOut=function(a){return 0.5-Math.cos(3.141592653589793*a)/2};var nd=function(a,b,c,d){this._from=a;this._to=b;this._duration=c;this.elapsed=0;this._easing=null!=d?d:Ba.linear};h["flambe.animation.Tween"]=nd;nd.__name__=!0;nd.__interfaces__=[Sf];nd.prototype={update:function(a){this.elapsed+=a;return this.elapsed>=this._duration?
this._to:this._from+(this._to-this._from)*this._easing(this.elapsed/this._duration)},isComplete:function(){return this.elapsed>=this._duration},__class__:nd};var od=function(){};h["flambe.asset.Asset"]=od;od.__name__=!0;od.__interfaces__=[Zb];od.prototype={__class__:od};var p=h["flambe.asset.AssetFormat"]={__ename__:!0,__constructs__:"WEBP,JXR,PNG,JPG,GIF,DDS,PVR,PKM,MP3,M4A,OPUS,OGG,WAV,Data".split(",")};p.WEBP=["WEBP",0];p.WEBP.toString=l;p.WEBP.__enum__=p;p.JXR=["JXR",1];p.JXR.toString=l;p.JXR.__enum__=
p;p.PNG=["PNG",2];p.PNG.toString=l;p.PNG.__enum__=p;p.JPG=["JPG",3];p.JPG.toString=l;p.JPG.__enum__=p;p.GIF=["GIF",4];p.GIF.toString=l;p.GIF.__enum__=p;p.DDS=["DDS",5];p.DDS.toString=l;p.DDS.__enum__=p;p.PVR=["PVR",6];p.PVR.toString=l;p.PVR.__enum__=p;p.PKM=["PKM",7];p.PKM.toString=l;p.PKM.__enum__=p;p.MP3=["MP3",8];p.MP3.toString=l;p.MP3.__enum__=p;p.M4A=["M4A",9];p.M4A.toString=l;p.M4A.__enum__=p;p.OPUS=["OPUS",10];p.OPUS.toString=l;p.OPUS.__enum__=p;p.OGG=["OGG",11];p.OGG.toString=l;p.OGG.__enum__=
p;p.WAV=["WAV",12];p.WAV.toString=l;p.WAV.__enum__=p;p.Data=["Data",13];p.Data.toString=l;p.Data.__enum__=p;p.__empty_constructs__=[p.WEBP,p.JXR,p.PNG,p.JPG,p.GIF,p.DDS,p.PVR,p.PKM,p.MP3,p.M4A,p.OPUS,p.OGG,p.WAV,p.Data];var Tf=function(a,b,c,d){this.name=a;this.url=b;this.format=c;this.bytes=d};h["flambe.asset.AssetEntry"]=Tf;Tf.__name__=!0;Tf.prototype={__class__:Tf};var xe=function(){};h["flambe.asset.AssetPack"]=xe;xe.__name__=!0;xe.__interfaces__=[Zb];xe.prototype={__class__:xe};var ye=function(){};
h["flambe.asset.File"]=ye;ye.__name__=!0;ye.__interfaces__=[od];ye.prototype={__class__:ye};var tb=function(){this._localBase=this._remoteBase=null;this._entries=[]};h["flambe.asset.Manifest"]=tb;tb.__name__=!0;tb.fromAssets=function(a,b){null==b&&(b=!0);var c=ha.field(Ng.getType(tb).assets[0],a);if(null==c){if(b)throw fb.withFields("Missing asset pack",["name",a]);return null}var d=new tb;d.set_localBase("assets");for(var e=0;e<c.length;){var v=c[e];++e;var f=v.name,j=a+"/"+f+"?v="+y.string(v.md5),
g=tb.inferFormat(f);g!=p.Data&&(f=fb.removeFileExtension(f));d.add(f,j,v.bytes,g)}return d};tb.inferFormat=function(a){a=fb.getUrlExtension(a);if(null!=a)switch(a.toLowerCase()){case "gif":return p.GIF;case "jpg":case "jpeg":return p.JPG;case "jxr":case "wdp":return p.JXR;case "png":return p.PNG;case "webp":return p.WEBP;case "dds":return p.DDS;case "pvr":return p.PVR;case "pkm":return p.PKM;case "m4a":return p.M4A;case "mp3":return p.MP3;case "ogg":return p.OGG;case "opus":return p.OPUS;case "wav":return p.WAV}else null;
return p.Data};tb.prototype={add:function(a,b,c,d){null==c&&(c=0);null==d&&(d=tb.inferFormat(b));a=new Tf(a,b,d,c);this._entries.push(a);return a},iterator:function(){return F.iter(this._entries)},getFullURL:function(a){var b;b=null!=this.get_remoteBase()&&tb._supportsCrossOrigin?this.get_remoteBase():this.get_localBase();return null!=b?fb.joinPath(b,a.url):a.url},get_localBase:function(){return this._localBase},set_localBase:function(a){null!=a&&Og.that(!Rd.startsWith(a,"http://")&&!Rd.startsWith(a,
"https://"),"localBase must be a path on the same domain, NOT starting with http(s)://",null);return this._localBase=a},get_remoteBase:function(){return this._remoteBase},__class__:tb};var ze=function(a){E.call(this);this.container=a;this.behaviours=[];this.change=new nc;this.visibleBounds=new Dd;this._rotation=this._panY=this._panX=this._targetY=this._targetX=0;this._zoom=1;this.invalidated=!0};h["flambe.camera.Camera"]=ze;ze.__name__=!0;ze.__super__=E;ze.prototype=t(E.prototype,{get_name:function(){return"Camera_14"},
onAdded:function(){this.container=this.owner;this.rootSprite=this.container._compMap.Sprite_9;if(null==this.rootSprite)throw"Uh-oh! No Sprite found in the container Entity "+y.string(this.container);this.owner.add(this.controller=new Ae(this));this.stageResized=s._platform.getStage().resize.connect(n(this,this.onStageResized),!0);this.onStageResized()},onRemoved:function(){this.reset();for(var a=0,b=this.behaviours;a<b.length;){var c=b[a];++a;c.dispose()}this.behaviours=null;null!=this.controller&&
(this.controller.dispose(),this.controller=null);null!=this.stageResized&&(this.stageResized.dispose(),this.stageResized=null);this.container=this.rootSprite=null},onUpdate:function(a){for(var b=this.stageCentreX,c=this.stageCentreY,d=0,e=this.behaviours;d<e.length;){var v=e[d];++d;v.update(a)}if(this.invalidated){this.rootSprite.anchorX.set__(this._targetX-this._panX);this.rootSprite.anchorY.set__(this._targetY-this._panY);this.rootSprite.rotation.set__(this._rotation);this.rootSprite.setScale(this._zoom);
this.rootSprite.x.set__(b);this.rootSprite.y.set__(c);this.visibleBounds.set(this.rootSprite.anchorX._value-b/this._zoom,this.rootSprite.anchorY._value-c/this._zoom,this.stageWidth/this._zoom,this.stageHeight/this._zoom);a=0;for(b=this.behaviours;a<b.length;)c=b[a],++a,c.postUpdate();this.invalidated=!1;this.change.emit()}},onStageResized:function(){this.stageWidth=s._platform.getStage().get_width();this.stageHeight=s._platform.getStage().get_height();this.stageCentreX=this.stageWidth/2;this.stageCentreY=
this.stageHeight/2;this.invalidated=!0},screenPointToWorld:function(a,b,c){c=null==c?new pd(a,b):c;if(null==this.rootSprite)return c;var d=this.rootSprite,e=d.scaleX._value;c.set((a-(d.x._value-d.anchorX._value*e))/e,(b-(d.y._value-d.anchorY._value*e))/e);return c},reset:function(){this.invalidated=this.invalidated||1!=this._zoom;this._zoom=1;this.invalidated=this.invalidated||0!=this._targetX;this._targetX=0;this.invalidated=this.invalidated||0!=this._targetY;this._targetY=0;this.set_panX(this.set_panY(function(a){a.invalidated=
a.invalidated||0!=a._rotation;return a._rotation=0}(this)));this.invalidated=!0;this.controller.setToCurrent();return this},set_zoom:function(a){this.invalidated=this.invalidated||a!=this._zoom;return this._zoom=a},set_rotation:function(a){this.invalidated=this.invalidated||a!=this._rotation;return this._rotation=a},set_targetX:function(a){this.invalidated=this.invalidated||a!=this._targetX;return this._targetX=a},set_targetY:function(a){this.invalidated=this.invalidated||a!=this._targetY;return this._targetY=
a},set_panX:function(a){this.invalidated=this.invalidated||a!=this._panX;return this._panX=a},set_panY:function(a){this.invalidated=this.invalidated||a!=this._panY;return this._panY=a},__class__:ze});var Ae=function(a){this.camera=null;E.call(this);this.camera=a};h["flambe.camera.CameraController"]=Ae;Ae.__name__=!0;Ae.__super__=E;Ae.prototype=t(E.prototype,{get_name:function(){return"CameraController_13"},onAdded:function(){this.panX=new z(this.camera._panX);this.panY=new z(this.camera._panY);this.targetX=
new z(this.camera._targetX);this.targetY=new z(this.camera._targetY);this.zoom=new z(this.camera._zoom);this.rotation=new z(this.camera._rotation)},onUpdate:function(a){this.panX.update(a);this.panY.update(a);this.targetX.update(a);this.targetY.update(a);this.zoom.update(a);this.rotation.update(a);this.camera.set_panX(this.panX._value);this.camera.set_panY(this.panY._value);this.camera.set_targetX(this.targetX._value);this.camera.set_targetY(this.targetY._value);this.camera.set_zoom(this.zoom._value);
this.camera.set_rotation(this.rotation._value)},onRemoved:function(){this.rotation=this.zoom=this.targetY=this.targetX=this.panY=this.panX=this.camera=null},setToCurrent:function(){this.panX.set__(this.camera._panX);this.panY.set__(this.camera._panY);this.targetX.set__(this.camera._targetX);this.targetY.set__(this.camera._targetY);this.zoom.set__(this.camera._zoom);this.rotation.set__(this.camera._rotation)},__class__:Ae});var Td=function(a){this._enabled=!1;this.camera=a;this.controller=a.controller};
h["flambe.camera.behaviours.CameraControlBehaviour"]=Td;Td.__name__=!0;Td.prototype={update:function(){},postUpdate:function(){},dispose:function(){this.set_enabled(!1);this.camera=this.controller=null},set_enabled:function(a){return this._enabled=a},__class__:Td};var Be=function(a,b){this.scrollZoom=!0;this.mouseMoved=!1;this.lastX=this.lastY=this.x=this.y=0;this.bounds=b;Td.call(this,a)};h["flambe.camera.behaviours.MouseControlBehaviour"]=Be;Be.__name__=!0;Be.__super__=Td;Be.prototype=t(Td.prototype,
{validatePanX:function(a){if(this._enabled&&null!=this.bounds)if(0>a){if(0<this.camera.visibleBounds.get_right()-this.bounds.get_right())return 0}else if(0<a&&0>this.camera.visibleBounds.x-this.bounds.x)return 0;return a},validatePanY:function(a){if(this._enabled&&null!=this.bounds)if(0>a){if(0<this.camera.visibleBounds.get_bottom()-this.bounds.get_bottom())return 0}else if(0<a&&0>this.camera.visibleBounds.y-this.bounds.y)return 0;return a},update:function(){if(this.mouseMoved){this.mouseMoved=!1;
var a=this.controller,b=a.zoom._value,c=(this.x-this.lastX)/b,b=(this.y-this.lastY)/b;this.lastX=this.x;this.lastY=this.y;var d=a.panX;d.set__(d._value+this.validatePanX(c));a=a.panY;a.set__(a._value+this.validatePanY(b))}},onMouseDown:function(a){if(this._enabled){var b=s._platform.getMouse();if(a.button==Y.Right||a.button==Y.Left&&s._platform.getKeyboard().isDown(g.Space))this.lastX=a.viewX,this.lastY=a.viewY,this.mouseDownConnection.dispose(),this.mouseDownConnection=null,this.mouseMoveConnection=
b.move.connect(n(this,this.onMouseMove)),this.mouseUpConnection=b.up.connect(n(this,this.onMouseUp))}},onMouseUp:function(){this.mouseUpConnection.dispose();this.mouseUpConnection=null;this.mouseMoveConnection.dispose();this.mouseMoveConnection=null;this._enabled&&(this.mouseDownConnection=s._platform.getMouse().down.connect(n(this,this.onMouseDown)))},onMouseMove:function(a){this._enabled&&(this.mouseMoved=!0,this.x=a.viewX,this.y=a.viewY)},onMouseScroll:function(a){if(this._enabled&&this.scrollZoom){var b=
this.controller;s._platform.getKeyboard().isDown(g.Shift)?b.rotation.animateBy(0<a?-22.5:22.5,0.25,Ba.quadOut):(a=b.zoom._value*(0<a?1.2:0.8),a!=b.zoom._value&&b.zoom.animateTo(a,0.25,Ba.quadOut))}},setupControl:function(){var a=s._platform.getMouse();this.mouseDownConnection=a.down.connect(n(this,this.onMouseDown));this.mouseScrollConnection=a.scroll.connect(n(this,this.onMouseScroll))},removeControl:function(){null!=this.mouseMoveConnection&&(this.mouseMoveConnection.dispose(),this.mouseMoveConnection=
null);null!=this.mouseScrollConnection&&(this.mouseScrollConnection.dispose(),this.mouseScrollConnection=null);null!=this.mouseDownConnection&&(this.mouseDownConnection.dispose(),this.mouseDownConnection=null);null!=this.mouseUpConnection&&(this.mouseUpConnection.dispose(),this.mouseUpConnection=null)},set_enabled:function(a){!a&&this._enabled?(this.removeControl(),this._enabled=!1):s._platform.getMouse().get_supported()&&a&&!this._enabled&&(this.setupControl(),this._enabled=!0);return this._enabled},
__class__:Be});var Q=h["flambe.display.BlendMode"]={__ename__:!0,__constructs__:"Normal,Add,Multiply,Screen,Mask,Copy".split(",")};Q.Normal=["Normal",0];Q.Normal.toString=l;Q.Normal.__enum__=Q;Q.Add=["Add",1];Q.Add.toString=l;Q.Add.__enum__=Q;Q.Multiply=["Multiply",2];Q.Multiply.toString=l;Q.Multiply.__enum__=Q;Q.Screen=["Screen",3];Q.Screen.toString=l;Q.Screen.__enum__=Q;Q.Mask=["Mask",4];Q.Mask.toString=l;Q.Mask.__enum__=Q;Q.Copy=["Copy",5];Q.Copy.toString=l;Q.Copy.__enum__=Q;Q.__empty_constructs__=
[Q.Normal,Q.Add,Q.Multiply,Q.Screen,Q.Mask,Q.Copy];var Va=h["flambe.display.EmitterType"]={__ename__:!0,__constructs__:["Gravity","Radial"]};Va.Gravity=["Gravity",0];Va.Gravity.toString=l;Va.Gravity.__enum__=Va;Va.Radial=["Radial",1];Va.Radial.toString=l;Va.Radial.__enum__=Va;Va.__empty_constructs__=[Va.Gravity,Va.Radial];var H=function(a,b){this._file=a.getFile(b+".pex");for(var c=D.parse(this._file.toString()),d=0,e=0,v=b.lastIndexOf("/"),v=0<=v?F.substr(b,0,v+1):"",c=c.firstElement().elements();c.hasNext();){var f=
c.next();switch(f.get_nodeName().toLowerCase()){case "texture":this.texture=a.getTexture(v+fb.removeFileExtension(f.get("name")));break;case "angle":this.angle=H.getFloat(f,"value");break;case "anglevariance":this.angleVariance=H.getFloat(f,"value");break;case "blendfuncdestination":e=y["int"](H.getFloat(f,"value"));break;case "blendfuncsource":d=y["int"](H.getFloat(f,"value"));break;case "duration":this.duration=H.getFloat(f,"value");break;case "emittertype":this.type=0==y["int"](H.getFloat(f,"value"))?
Va.Gravity:Va.Radial;break;case "finishcolor":this.alphaEnd=H.getFloat(f,"alpha");break;case "finishcolorvariance":this.alphaEndVariance=H.getFloat(f,"alpha");break;case "finishparticlesize":this.sizeEnd=H.getFloat(f,"value");break;case "finishparticlesizevariance":this.sizeEndVariance=H.getFloat(f,"value");break;case "gravity":this.gravityX=H.getFloat(f,"x");this.gravityY=H.getFloat(f,"y");break;case "maxparticles":this.maxParticles=y["int"](H.getFloat(f,"value"));break;case "maxradius":this.maxRadius=
H.getFloat(f,"value");break;case "maxradiusvariance":this.maxRadiusVariance=H.getFloat(f,"value");break;case "minradius":this.minRadius=H.getFloat(f,"value");break;case "particlelifespan":this.lifespan=H.getFloat(f,"value");break;case "particlelifespanvariance":this.lifespanVariance=H.getFloat(f,"value");break;case "radialaccelvariance":this.radialAccelVariance=H.getFloat(f,"value");break;case "radialacceleration":this.radialAccel=H.getFloat(f,"value");break;case "rotatepersecond":this.rotatePerSecond=
H.getFloat(f,"value");break;case "rotatepersecondvariance":this.rotatePerSecondVariance=H.getFloat(f,"value");break;case "rotationend":this.rotationEnd=H.getFloat(f,"value");break;case "rotationendvariance":this.rotationEndVariance=H.getFloat(f,"value");break;case "rotationstart":this.rotationStart=H.getFloat(f,"value");break;case "rotationstartvariance":this.rotationStartVariance=H.getFloat(f,"value");break;case "sourcepositionvariance":this.emitXVariance=H.getFloat(f,"x");this.emitYVariance=H.getFloat(f,
"y");break;case "speed":this.speed=H.getFloat(f,"value");break;case "speedvariance":this.speedVariance=H.getFloat(f,"value");break;case "startcolor":this.alphaStart=H.getFloat(f,"alpha");break;case "startcolorvariance":this.alphaStartVariance=H.getFloat(f,"alpha");break;case "startparticlesize":this.sizeStart=H.getFloat(f,"value");break;case "startparticlesizevariance":this.sizeStartVariance=H.getFloat(f,"value");break;case "tangentialaccelvariance":this.tangentialAccelVariance=H.getFloat(f,"value");
break;case "tangentialacceleration":this.tangentialAccel=H.getFloat(f,"value")}}0>=this.lifespan&&(this.lifespan=this.duration);1==d&&1==e?this.blendMode=Q.Add:1==d&&771==e?this.blendMode=null:(0!=d||0!=e)&&null};h["flambe.display.EmitterMold"]=H;H.__name__=!0;H.getFloat=function(a,b){return y.parseFloat(a.get(b))};H.prototype={createEmitter:function(){return new ra(this)},__class__:H};var pd=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b};h["flambe.math.Point"]=pd;pd.__name__=!0;pd.prototype=
{set:function(a,b){this.x=a;this.y=b},__class__:pd};var N=function(){this._viewMatrixUpdateCount=this._parentViewMatrixUpdateCount=0;this.blendMode=this.scissor=this._viewMatrix=null;var a=this;E.call(this);this._flags|=54;this._localMatrix=new Pa;var b=function(){a._flags|=24};this.x=new z(0,b);this.y=new z(0,b);this.rotation=new z(0,b);this.scaleX=new z(1,b);this.scaleY=new z(1,b);this.anchorX=new z(0,b);this.anchorY=new z(0,b);this.alpha=new z(1)};h["flambe.display.Sprite"]=N;N.__name__=!0;N.hitTest=
function(a,b,c){var d=a._compMap.Sprite_9;if(null!=d){if(6!=(d._flags&6))return null;d.getLocalMatrix().inverseTransform(b,c,N._scratchPoint)&&(b=N._scratchPoint.x,c=N._scratchPoint.y);var e=d.scissor;if(null!=e&&!e.contains(b,c))return null}a=N.hitTestBackwards(a.firstChild,b,c);return null!=a?a:null!=d&&d.containsLocal(b,c)?d:null};N.render=function(a,b){var c=a._compMap.Sprite_9;if(null!=c){var d=c.alpha._value;if(0==(c._flags&2)||0>=d)return;b.save();1>d&&b.multiplyAlpha(d);null!=c.blendMode&&
b.setBlendMode(c.blendMode);var d=c.getLocalMatrix(),e=d.m02,v=d.m12;0!=(c._flags&32)&&(e=Math.round(e),v=Math.round(v));b.transform(d.m00,d.m10,d.m01,d.m11,e,v);d=c.scissor;null!=d&&b.applyScissor(d.x,d.y,d.width,d.height);c.draw(b)}d=a._compMap.Director_15;if(null!=d){d=d.occludedScenes;for(e=0;e<d.length;)v=d[e],++e,N.render(v,b)}for(d=a.firstChild;null!=d;)e=d.next,N.render(d,b),d=e;null!=c&&b.restore()};N.hitTestBackwards=function(a,b,c){if(null!=a){var d=N.hitTestBackwards(a.next,b,c);return null!=
d?d:N.hitTest(a,b,c)}return null};N.__super__=E;N.prototype=t(E.prototype,{get_name:function(){return"Sprite_9"},getNaturalWidth:function(){return 0},getNaturalHeight:function(){return 0},contains:function(a,b){return this.getViewMatrix().inverseTransform(a,b,N._scratchPoint)&&this.containsLocal(N._scratchPoint.x,N._scratchPoint.y)},containsLocal:function(a,b){return 0<=a&&a<this.getNaturalWidth()&&0<=b&&b<this.getNaturalHeight()},getLocalMatrix:function(){0!=(this._flags&8)&&(this._flags&=-9,this._localMatrix.compose(this.x._value,
this.y._value,this.scaleX._value,this.scaleY._value,3.141592653589793*this.rotation._value/180),this._localMatrix.translate(-this.anchorX._value,-this.anchorY._value));return this._localMatrix},getViewMatrix:function(){if(this.isViewMatrixDirty()){var a=this.getParentSprite();this._viewMatrix=null!=a?Pa.multiply(a.getViewMatrix(),this.getLocalMatrix(),this._viewMatrix):this.getLocalMatrix().clone(this._viewMatrix);this._flags&=-17;null!=a&&(this._parentViewMatrixUpdateCount=a._viewMatrixUpdateCount);
++this._viewMatrixUpdateCount}return this._viewMatrix},setAnchor:function(a,b){this.anchorX.set__(a);this.anchorY.set__(b);return this},centerAnchor:function(){this.anchorX.set__(this.getNaturalWidth()/2);this.anchorY.set__(this.getNaturalHeight()/2);return this},setXY:function(a,b){this.x.set__(a);this.y.set__(b);return this},setRotation:function(a){this.rotation.set__(a);return this},setScale:function(a){this.scaleX.set__(a);this.scaleY.set__(a);return this},onAdded:function(){0!=(this._flags&64)&&
this.connectHover()},onRemoved:function(){null!=this._hoverConnection&&(this._hoverConnection.dispose(),this._hoverConnection=null)},onUpdate:function(a){this.x.update(a);this.y.update(a);this.rotation.update(a);this.scaleX.update(a);this.scaleY.update(a);this.alpha.update(a);this.anchorX.update(a);this.anchorY.update(a)},draw:function(){},isViewMatrixDirty:function(){if(0!=(this._flags&16))return!0;var a=this.getParentSprite();return null==a?!1:this._parentViewMatrixUpdateCount!=a._viewMatrixUpdateCount||
a.isViewMatrixDirty()},getParentSprite:function(){if(null==this.owner)return null;for(var a=this.owner.parent;null!=a;){var b=a._compMap.Sprite_9;if(null!=b)return b;a=a.parent}return null},connectHover:function(){var a=this;null==this._hoverConnection&&(this._hoverConnection=s._platform.getPointer().move.connect(function(b){for(var c=b.hit;null!=c;){if(c==a)return;c=c.getParentSprite()}null!=a._pointerOut&&0!=(a._flags&64)&&a._pointerOut.emit(b);a._flags&=-65;a._hoverConnection.dispose();a._hoverConnection=
null}))},onPointerDown:function(a){this.onHover(a);null!=this._pointerDown&&this._pointerDown.emit(a)},onPointerMove:function(a){this.onHover(a);null!=this._pointerMove&&this._pointerMove.emit(a)},onHover:function(a){if(0==(this._flags&64)&&(this._flags|=64,null!=this._pointerIn||null!=this._pointerOut))null!=this._pointerIn&&this._pointerIn.emit(a),this.connectHover()},onPointerUp:function(a){switch(a.source[1]){case 1:null!=this._pointerOut&&0!=(this._flags&64)&&this._pointerOut.emit(a),this._flags&=
-65,null!=this._hoverConnection&&(this._hoverConnection.dispose(),this._hoverConnection=null)}null!=this._pointerUp&&this._pointerUp.emit(a)},__class__:N});var ra=function(a){this._emitElapsed=this._totalElapsed=0;this.enabled=!0;this.numParticles=0;N.call(this);this.texture=a.texture;this.blendMode=a.blendMode;this.type=a.type;this.alphaEnd=new z(a.alphaEnd);this.alphaEndVariance=new z(a.alphaEndVariance);this.alphaStart=new z(a.alphaStart);this.alphaStartVariance=new z(a.alphaStartVariance);this.angle=
new z(a.angle);this.angleVariance=new z(a.angleVariance);this.duration=a.duration;this.emitXVariance=new z(a.emitXVariance);this.emitYVariance=new z(a.emitYVariance);this.gravityX=new z(a.gravityX);this.gravityY=new z(a.gravityY);this.maxRadius=new z(a.maxRadius);this.maxRadiusVariance=new z(a.maxRadiusVariance);this.minRadius=new z(a.minRadius);this.lifespan=new z(a.lifespan);this.lifespanVariance=new z(a.lifespanVariance);this.radialAccel=new z(a.radialAccel);this.radialAccelVariance=new z(a.radialAccelVariance);
this.rotatePerSecond=new z(a.rotatePerSecond);this.rotatePerSecondVariance=new z(a.rotatePerSecondVariance);this.rotationEnd=new z(a.rotationEnd);this.rotationEndVariance=new z(a.rotationEndVariance);this.rotationStart=new z(a.rotationStart);this.rotationStartVariance=new z(a.rotationStartVariance);this.sizeEnd=new z(a.sizeEnd);this.sizeEndVariance=new z(a.sizeEndVariance);this.sizeStart=new z(a.sizeStart);this.sizeStartVariance=new z(a.sizeStartVariance);this.speed=new z(a.speed);this.speedVariance=
new z(a.speedVariance);this.tangentialAccel=new z(a.tangentialAccel);this.tangentialAccelVariance=new z(a.tangentialAccelVariance);this.emitX=new z(0);this.emitY=new z(0);this._particles=Array(a.maxParticles);for(var a=0,b=this._particles.length;a<b;)this._particles[a]=new Uf,++a};h["flambe.display.EmitterSprite"]=ra;ra.__name__=!0;ra.random=function(a,b){0!=b&&(a+=b*(2*Math.random()-1));return a};ra.__super__=N;ra.prototype=t(N.prototype,{restart:function(){this.enabled=!0;this._totalElapsed=0},
onUpdate:function(a){N.prototype.onUpdate.call(this,a);this.alphaEnd.update(a);this.alphaStart.update(a);this.angle.update(a);this.angleVariance.update(a);this.emitX.update(a);this.emitXVariance.update(a);this.emitY.update(a);this.emitYVariance.update(a);this.gravityX.update(a);this.gravityY.update(a);this.lifespan.update(a);this.lifespanVariance.update(a);this.maxRadius.update(a);this.maxRadiusVariance.update(a);this.minRadius.update(a);this.radialAccel.update(a);this.radialAccelVariance.update(a);
this.rotatePerSecond.update(a);this.rotatePerSecondVariance.update(a);this.rotationEnd.update(a);this.rotationEndVariance.update(a);this.rotationStart.update(a);this.rotationStartVariance.update(a);this.sizeEnd.update(a);this.sizeEndVariance.update(a);this.sizeStart.update(a);this.sizeStartVariance.update(a);this.speed.update(a);this.speedVariance.update(a);this.tangentialAccel.update(a);this.tangentialAccelVariance.update(a);for(var b=this.type==Va.Gravity,c=0;c<this.numParticles;){var d=this._particles[c];
if(d.life>a){if(b){d.x+=d.velX*a;d.y+=d.velY*a;var e=this.gravityX._value,v=-this.gravityY._value;if(0!=d.radialAccel||0!=d.tangentialAccel)var f=d.x-d.emitX,j=d.y-d.emitY,g=Math.sqrt(f*f+j*j),f=f/g,j=j/g,e=e+f*d.radialAccel,v=v+j*d.radialAccel,g=f,e=e+-j*d.tangentialAccel,v=v+g*d.tangentialAccel;d.velX+=e*a;d.velY+=v*a}else d.radialRotation+=d.velRadialRotation*a,d.radialRadius+=d.velRadialRadius*a,e=d.radialRadius,d.x=this.emitX._value-Math.cos(d.radialRotation)*e,d.y=this.emitY._value-Math.sin(d.radialRotation)*
e,e<this.minRadius._value&&(d.life=0);d.scale+=d.velScale*a;d.rotation+=d.velRotation*a;d.alpha+=d.velAlpha*a;d.life-=a;++c}else--this.numParticles,c!=this.numParticles&&(this._particles[c]=this._particles[this.numParticles],this._particles[this.numParticles]=d)}if(this.enabled){if(0<this.duration&&(this._totalElapsed+=a,this._totalElapsed>=this.duration)){this.enabled=!1;return}b=this.lifespan._value/this._particles.length;for(this._emitElapsed+=a;this._emitElapsed>=b;)this.numParticles<this._particles.length&&
this.initParticle(this._particles[this.numParticles])&&++this.numParticles,this._emitElapsed-=b}},draw:function(a){for(var b=-this.texture.get_width()/2,c=0,d=this.numParticles;c<d;){var e=this._particles[c];a.save();a.translate(e.x,e.y);1>e.alpha&&a.multiplyAlpha(e.alpha);0!=e.rotation&&a.rotate(e.rotation);1!=e.scale&&a.scale(e.scale,e.scale);a.drawTexture(this.texture,b,b);a.restore();++c}},initParticle:function(a){a.life=ra.random(this.lifespan._value,this.lifespanVariance._value);if(0>=a.life)return!1;
a.emitX=this.emitX._value;a.emitY=this.emitY._value;var b=-na.toRadians(ra.random(this.angle._value,this.angleVariance._value)),c=ra.random(this.speed._value,this.speedVariance._value);a.velX=c*Math.cos(b);a.velY=c*Math.sin(b);a.radialAccel=ra.random(this.radialAccel._value,this.radialAccelVariance._value);a.tangentialAccel=ra.random(this.tangentialAccel._value,this.tangentialAccelVariance._value);a.radialRadius=ra.random(this.maxRadius._value,this.maxRadiusVariance._value);a.velRadialRadius=-a.radialRadius/
a.life;a.radialRotation=b;a.velRadialRotation=na.toRadians(ra.random(this.rotatePerSecond._value,this.rotatePerSecondVariance._value));this.type==Va.Gravity?(a.x=ra.random(this.emitX._value,this.emitXVariance._value),a.y=ra.random(this.emitY._value,this.emitYVariance._value)):(b=a.radialRadius,a.x=this.emitX._value-Math.cos(a.radialRotation)*b,a.y=this.emitY._value-Math.sin(a.radialRotation)*b);c=this.texture.get_width();b=ra.random(this.sizeStart._value,this.sizeStartVariance._value)/c;c=ra.random(this.sizeEnd._value,
this.sizeEndVariance._value)/c;a.scale=b;a.velScale=(c-b)/a.life;b=ra.random(this.rotationStart._value,this.rotationStartVariance._value);c=ra.random(this.rotationEnd._value,this.rotationEndVariance._value);a.rotation=b;a.velRotation=(c-b)/a.life;b=ra.random(this.alphaStart._value,this.alphaStartVariance._value);c=ra.random(this.alphaEnd._value,this.alphaEndVariance._value);a.alpha=b;a.velAlpha=(c-b)/a.life;return!0},__class__:ra});var Uf=function(){this.emitX=this.emitY=this.x=this.velX=this.y=this.velY=
this.radialRadius=this.velRadialRadius=this.radialRotation=this.velRadialRotation=this.radialAccel=this.tangentialAccel=this.scale=this.velScale=this.rotation=this.velRotation=this.alpha=this.velAlpha=this.life=0};h["flambe.display._EmitterSprite.Particle"]=Uf;Uf.__name__=!0;Uf.prototype={__class__:Uf};var Gb=function(a,b,c){N.call(this);this.color=a;this.width=new z(b);this.height=new z(c)};h["flambe.display.FillSprite"]=Gb;Gb.__name__=!0;Gb.__super__=N;Gb.prototype=t(N.prototype,{draw:function(a){a.fillRect(this.color,
0,0,this.width._value,this.height._value)},getNaturalWidth:function(){return this.width._value},getNaturalHeight:function(){return this.height._value},onUpdate:function(a){N.prototype.onUpdate.call(this,a);this.width.update(a);this.height.update(a)},__class__:Gb});var Vf=function(){};h["flambe.display.Graphics"]=Vf;Vf.__name__=!0;Vf.prototype={__class__:Vf};var aa=function(a){N.call(this);this.texture=a};h["flambe.display.ImageSprite"]=aa;aa.__name__=!0;aa.__super__=N;aa.prototype=t(N.prototype,{draw:function(a){null!=
this.texture&&a.drawTexture(this.texture,0,0)},getNaturalWidth:function(){return null!=this.texture?this.texture.get_width():0},getNaturalHeight:function(){return null!=this.texture?this.texture.get_height():0},__class__:aa});var Wa=h["flambe.display.Orientation"]={__ename__:!0,__constructs__:["Portrait","Landscape"]};Wa.Portrait=["Portrait",0];Wa.Portrait.toString=l;Wa.Portrait.__enum__=Wa;Wa.Landscape=["Landscape",1];Wa.Landscape.toString=l;Wa.Landscape.__enum__=Wa;Wa.__empty_constructs__=[Wa.Portrait,
Wa.Landscape];var Pg=function(){};h["flambe.display.StarlingSpriteSheet"]=Pg;Pg.__name__=!0;Pg.parse=function(a,b){for(var c=new Fb,d=a.elements();d.hasNext();){var e=d.next();if("TextureAtlas"==e.get_nodeName())for(e=e.elementsNamed("SubTexture");e.hasNext();){var v=e.next(),f=v.get("name"),v=b.subTexture(y.parseInt(v.get("x")),y.parseInt(v.get("y")),y.parseInt(v.get("width")),y.parseInt(v.get("height")));c.set(f,v)}}return c};var Ce=function(){};h["flambe.display.Texture"]=Ce;Ce.__name__=!0;Ce.__interfaces__=
[od];Ce.prototype={__class__:Ce};var Qg=function(){};h["flambe.display.SubTexture"]=Qg;Qg.__name__=!0;Qg.__interfaces__=[Ce];var G=h["flambe.input.GestureType"]={__ename__:!0,__constructs__:"GESTURE_TAP,GESTURE_LONG_PRESS,GESTURE_PAN,GESTURE_SWIPE,GESTURE_BEGIN,GESTURE_END,GESTURE_PINCH,GESTURE_ROTATION".split(",")};G.GESTURE_TAP=["GESTURE_TAP",0];G.GESTURE_TAP.toString=l;G.GESTURE_TAP.__enum__=G;G.GESTURE_LONG_PRESS=["GESTURE_LONG_PRESS",1];G.GESTURE_LONG_PRESS.toString=l;G.GESTURE_LONG_PRESS.__enum__=
G;G.GESTURE_PAN=["GESTURE_PAN",2];G.GESTURE_PAN.toString=l;G.GESTURE_PAN.__enum__=G;G.GESTURE_SWIPE=["GESTURE_SWIPE",3];G.GESTURE_SWIPE.toString=l;G.GESTURE_SWIPE.__enum__=G;G.GESTURE_BEGIN=["GESTURE_BEGIN",4];G.GESTURE_BEGIN.toString=l;G.GESTURE_BEGIN.__enum__=G;G.GESTURE_END=["GESTURE_END",5];G.GESTURE_END.toString=l;G.GESTURE_END.__enum__=G;G.GESTURE_PINCH=["GESTURE_PINCH",6];G.GESTURE_PINCH.toString=l;G.GESTURE_PINCH.__enum__=G;G.GESTURE_ROTATION=["GESTURE_ROTATION",7];G.GESTURE_ROTATION.toString=
l;G.GESTURE_ROTATION.__enum__=G;G.__empty_constructs__=[G.GESTURE_TAP,G.GESTURE_LONG_PRESS,G.GESTURE_PAN,G.GESTURE_SWIPE,G.GESTURE_BEGIN,G.GESTURE_END,G.GESTURE_PINCH,G.GESTURE_ROTATION];var Wf=function(a,b,c,d){this.type=a;this.x=b;this.y=c;this.extra=d};h["flambe.input.Gesture"]=Wf;Wf.__name__=!0;Wf.prototype={setTo:function(a,b,c){this.x=a;this.y=b;this.extra=c;return this},__class__:Wf};var ba=h["flambe.input.TouchType"]={__ename__:!0,__constructs__:["TOUCH_BEGIN","TOUCH_MOVE","TOUCH_END"]};ba.TOUCH_BEGIN=
["TOUCH_BEGIN",0];ba.TOUCH_BEGIN.toString=l;ba.TOUCH_BEGIN.__enum__=ba;ba.TOUCH_MOVE=["TOUCH_MOVE",1];ba.TOUCH_MOVE.toString=l;ba.TOUCH_MOVE.__enum__=ba;ba.TOUCH_END=["TOUCH_END",2];ba.TOUCH_END.toString=l;ba.TOUCH_END.__enum__=ba;ba.__empty_constructs__=[ba.TOUCH_BEGIN,ba.TOUCH_MOVE,ba.TOUCH_END];var Z=h["flambe.input.GestureState"]={__ename__:!0,__constructs__:["READY","BEGIN","TWO_FINGER_MOVE","MOVE"]};Z.READY=["READY",0];Z.READY.toString=l;Z.READY.__enum__=Z;Z.BEGIN=["BEGIN",1];Z.BEGIN.toString=
l;Z.BEGIN.__enum__=Z;Z.TWO_FINGER_MOVE=["TWO_FINGER_MOVE",2];Z.TWO_FINGER_MOVE.toString=l;Z.TWO_FINGER_MOVE.__enum__=Z;Z.MOVE=["MOVE",3];Z.MOVE.toString=l;Z.MOVE.__enum__=Z;Z.__empty_constructs__=[Z.READY,Z.BEGIN,Z.TWO_FINGER_MOVE,Z.MOVE];var Xa=function(){this.preferPointer=!0;this.swipeTimeout=0.25;this.longPressDelay=1;E.call(this);this.tempPoint=new pd;this.gesture=new ca;this.touchList=new Mf;this.touchTimes=new oc;this.gestures=this.createGestures()};h["flambe.input.GestureControl"]=Xa;Xa.__name__=
!0;Xa.polar=function(a,b,c){a.set(b*Math.cos(c),b*Math.sin(c))};Xa.lerp=function(a,b,c){return b+c*(a-b)};Xa.__super__=E;Xa.prototype=t(E.prototype,{get_name:function(){return"GestureControl_12"},onAdded:function(){if(s._platform.getTouch().get_supported()&&1<s._platform.getTouch().get_maxPoints()&&s._platform.getMouse().get_supported()&&this.preferPointer||!(s._platform.getTouch().get_supported()&&1<s._platform.getTouch().get_maxPoints())&&s._platform.getPointer().get_supported())s._platform.getPointer().down.connect(n(this,
this.onPointerDown)).once();else if(s._platform.getTouch().get_supported()&&1<s._platform.getTouch().get_maxPoints())this.upConn=s._platform.getTouch().up.connect(n(this,this.onTouchUp)),this.downConn=s._platform.getTouch().down.connect(n(this,this.onTouchDown)),this.moveConn=s._platform.getTouch().move.connect(n(this,this.onTouchMove));else throw"No Pointer or (multi)Touch inputs available?";this.resizeConn=s._platform.getStage().resize.connect(n(this,this.stageResized));this.stageResized();this.setReady()},
onPointerDown:function(a){null!=this.upConn&&this.upConn.dispose();this.upConn=s._platform.getPointer().up.connect(n(this,this.onPointerUp));null!=this.moveConn&&this.moveConn.dispose();this.moveConn=s._platform.getPointer().move.connect(n(this,this.onPointerMove));this.onTouch(ba.TOUCH_BEGIN,-1,a.viewX,a.viewY)},onPointerMove:function(a){this.onTouch(ba.TOUCH_MOVE,-1,a.viewX,a.viewY)},onPointerUp:function(a){this.moveConn.dispose();this.moveConn=null;this.upConn.dispose();this.upConn=null;this.onTouch(ba.TOUCH_END,
-1,a.viewX,a.viewY);s._platform.getPointer().down.connect(n(this,this.onPointerDown)).once()},onTouchDown:function(a){this.onTouch(ba.TOUCH_BEGIN,a.id,a.viewX,a.viewY)},onTouchMove:function(a){this.onTouch(ba.TOUCH_MOVE,a.id,a.viewX,a.viewY)},onTouchUp:function(a){this.onTouch(ba.TOUCH_END,a.id,a.viewX,a.viewY)},stageResized:function(){var a=s._platform.getStage();Xa.moveToleSqr=0.0080*Math.sqrt(a.get_width()*a.get_width()+a.get_height()*a.get_height());Xa.moveToleSqr*=Xa.moveToleSqr},onRemoved:function(){null!=
this.resizeConn&&this.resizeConn.dispose();null!=this.upConn&&this.upConn.dispose();null!=this.downConn&&this.downConn.dispose();null!=this.moveConn&&this.moveConn.dispose();this.setReady()},setReady:function(){this.state=Z.READY;this.touch0=this.touch1=null;this.touchList.clear();null!=this.longPressTimer&&(this.longPressTimer.stop(),this.longPressTimer=null)},onTouch:function(a,b,c,d){var e=null==this.touch0||this.touch0.id==b;(e||null!=this.touch1&&this.touch1.id==b||null!=this.touch0&&null==this.touch1&&
this.touch0.id!=b)&&this.handleTouch(a,{time:Mc.stamp(),id:b,x:c,y:d},e)},handleTouch:function(a,b,c){var d=b.time,e=b.x,v=b.y,f;f=c?this.touch0:this.touch1;if(a==ba.TOUCH_MOVE&&null!=f&&this.distSqr(b,f)<Xa.moveToleSqr)return!1;var j=!0;switch(this.state[1]){case 0:c&&a==ba.TOUCH_BEGIN?(this.state=Z.BEGIN,this.touch0=b,this.touchTimes.set(b.id,d),this.longPressTimer=Mc.delay(function(a,b){return function(){return a(b)}}(n(this,this.sendLongPress),b),1E3*this.longPressDelay|0),this.gesture.emit(this.gestures.get(G.GESTURE_BEGIN).setTo(e,
v,null))):j=!1;break;case 1:c&&a==ba.TOUCH_END?(this.gesture.emit(this.gestures.get(G.GESTURE_TAP).setTo(e,v,null)),this.gesture.emit(this.gestures.get(G.GESTURE_END).setTo(e,v,null)),this.setReady()):c&&a==ba.TOUCH_MOVE?(this.tempPoint.set(e-this.touch0.x,v-this.touch0.y),this.gesture.emit(this.gestures.get(G.GESTURE_PAN).setTo(e,v,this.tempPoint)),this.state=Z.MOVE,null!=this.touch0&&this.touchList.push(this.touch0),this.touch0=b,null!=this.longPressTimer&&(this.longPressTimer.stop(),this.longPressTimer=
null)):!c&&a==ba.TOUCH_BEGIN?(this.state=Z.TWO_FINGER_MOVE,this.touch1=b,null!=this.longPressTimer&&(this.longPressTimer.stop(),this.longPressTimer=null)):j=!1;break;case 3:if(c&&a==ba.TOUCH_MOVE)this.tempPoint.set(e-this.touch0.x,v-this.touch0.y),this.gesture.emit(this.gestures.get(G.GESTURE_PAN).setTo(e,v,this.tempPoint)),this.state=Z.MOVE,null!=this.touch0&&this.touchList.push(this.touch0),this.touch0=b,null!=this.longPressTimer&&(this.longPressTimer.stop(),this.longPressTimer=null);else if(c&&
a==ba.TOUCH_END){b=d-this.touchTimes.get(this.touch0.id);if(0>=this.swipeTimeout||b<this.swipeTimeout)a=this.touchList.pop(),this.touchTimes.get(a.id),this.touchTimes.remove(a.id),c=a.x-f.x,a=a.y-f.y,f=Math.atan2(a,c),c=Math.sqrt(c*c+a*a),Xa.polar(this.tempPoint,c/-b,f),this.gesture.emit(this.gestures.get(G.GESTURE_SWIPE).setTo(e,v,this.tempPoint));this.gesture.emit(this.gestures.get(G.GESTURE_END).setTo(e,v,null));this.setReady()}else!c&&a==ba.TOUCH_BEGIN?(this.gesture.emit(this.gestures.get(G.GESTURE_BEGIN).setTo(e,
v,null)),this.state=Z.TWO_FINGER_MOVE,this.touch1=b,null!=this.longPressTimer&&(this.longPressTimer.stop(),this.longPressTimer=null)):j=!1;break;case 2:a==ba.TOUCH_END?(this.gesture.emit(this.gestures.get(G.GESTURE_END).setTo(e,v,null)),this.setReady()):a==ba.TOUCH_MOVE?(a=c?this.touch1:this.touch0,d=c?this.touch0:this.touch1,f=this.distSqr(b,a)/this.distSqr(d,a),e=Math.atan2(v-a.y,e-a.x)-Math.atan2(d.y-a.y,d.x-a.x),v=Xa.lerp(a.x,d.x,0.5),a=Xa.lerp(a.y,d.y,0.5),1!=f&&this.gesture.emit(this.gestures.get(G.GESTURE_PINCH).setTo(v,
a,f)),0!=e&&this.gesture.emit(this.gestures.get(G.GESTURE_ROTATION).setTo(v,a,e)),c?this.touch0=b:this.touch1=b):j=!1}return j},sendLongPress:function(a){this.gesture.emit(this.gestures.get(G.GESTURE_LONG_PRESS).setTo(a.x,a.y,null));this.gesture.emit(this.gestures.get(G.GESTURE_END).setTo(a.x,a.y,null));this.setReady()},distSqr:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},createGestures:function(a){null==a&&(a=Yc.allEnums(G));for(var b=new Ud,c=0;c<a.length;){var d=a[c];++c;var e=new Wf(d,
Math.NaN,Math.NaN);b.set(d,e)}return b},__class__:Xa});var g=h["flambe.input.Key"]={__ename__:!0,__constructs__:"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Number0,Number1,Number2,Number3,Number4,Number5,Number6,Number7,Number8,Number9,Numpad0,Numpad1,Numpad2,Numpad3,Numpad4,Numpad5,Numpad6,Numpad7,Numpad8,Numpad9,NumpadAdd,NumpadDecimal,NumpadDivide,NumpadEnter,NumpadMultiply,NumpadSubtract,F1,F2,F3,F4,F5,F6,F7,F8,F9,F10,F11,F12,F13,F14,F15,Left,Up,Right,Down,Alt,Backquote,Backslash,Backspace,CapsLock,Comma,Command,Control,Delete,End,Enter,Equals,Escape,Home,Insert,LeftBracket,Minus,PageDown,PageUp,Period,Quote,RightBracket,Semicolon,Shift,Slash,Space,Tab,Menu,Search,Unknown".split(",")};
g.A=["A",0];g.A.toString=l;g.A.__enum__=g;g.B=["B",1];g.B.toString=l;g.B.__enum__=g;g.C=["C",2];g.C.toString=l;g.C.__enum__=g;g.D=["D",3];g.D.toString=l;g.D.__enum__=g;g.E=["E",4];g.E.toString=l;g.E.__enum__=g;g.F=["F",5];g.F.toString=l;g.F.__enum__=g;g.G=["G",6];g.G.toString=l;g.G.__enum__=g;g.H=["H",7];g.H.toString=l;g.H.__enum__=g;g.I=["I",8];g.I.toString=l;g.I.__enum__=g;g.J=["J",9];g.J.toString=l;g.J.__enum__=g;g.K=["K",10];g.K.toString=l;g.K.__enum__=g;g.L=["L",11];g.L.toString=l;g.L.__enum__=
g;g.M=["M",12];g.M.toString=l;g.M.__enum__=g;g.N=["N",13];g.N.toString=l;g.N.__enum__=g;g.O=["O",14];g.O.toString=l;g.O.__enum__=g;g.P=["P",15];g.P.toString=l;g.P.__enum__=g;g.Q=["Q",16];g.Q.toString=l;g.Q.__enum__=g;g.R=["R",17];g.R.toString=l;g.R.__enum__=g;g.S=["S",18];g.S.toString=l;g.S.__enum__=g;g.T=["T",19];g.T.toString=l;g.T.__enum__=g;g.U=["U",20];g.U.toString=l;g.U.__enum__=g;g.V=["V",21];g.V.toString=l;g.V.__enum__=g;g.W=["W",22];g.W.toString=l;g.W.__enum__=g;g.X=["X",23];g.X.toString=
l;g.X.__enum__=g;g.Y=["Y",24];g.Y.toString=l;g.Y.__enum__=g;g.Z=["Z",25];g.Z.toString=l;g.Z.__enum__=g;g.Number0=["Number0",26];g.Number0.toString=l;g.Number0.__enum__=g;g.Number1=["Number1",27];g.Number1.toString=l;g.Number1.__enum__=g;g.Number2=["Number2",28];g.Number2.toString=l;g.Number2.__enum__=g;g.Number3=["Number3",29];g.Number3.toString=l;g.Number3.__enum__=g;g.Number4=["Number4",30];g.Number4.toString=l;g.Number4.__enum__=g;g.Number5=["Number5",31];g.Number5.toString=l;g.Number5.__enum__=
g;g.Number6=["Number6",32];g.Number6.toString=l;g.Number6.__enum__=g;g.Number7=["Number7",33];g.Number7.toString=l;g.Number7.__enum__=g;g.Number8=["Number8",34];g.Number8.toString=l;g.Number8.__enum__=g;g.Number9=["Number9",35];g.Number9.toString=l;g.Number9.__enum__=g;g.Numpad0=["Numpad0",36];g.Numpad0.toString=l;g.Numpad0.__enum__=g;g.Numpad1=["Numpad1",37];g.Numpad1.toString=l;g.Numpad1.__enum__=g;g.Numpad2=["Numpad2",38];g.Numpad2.toString=l;g.Numpad2.__enum__=g;g.Numpad3=["Numpad3",39];g.Numpad3.toString=
l;g.Numpad3.__enum__=g;g.Numpad4=["Numpad4",40];g.Numpad4.toString=l;g.Numpad4.__enum__=g;g.Numpad5=["Numpad5",41];g.Numpad5.toString=l;g.Numpad5.__enum__=g;g.Numpad6=["Numpad6",42];g.Numpad6.toString=l;g.Numpad6.__enum__=g;g.Numpad7=["Numpad7",43];g.Numpad7.toString=l;g.Numpad7.__enum__=g;g.Numpad8=["Numpad8",44];g.Numpad8.toString=l;g.Numpad8.__enum__=g;g.Numpad9=["Numpad9",45];g.Numpad9.toString=l;g.Numpad9.__enum__=g;g.NumpadAdd=["NumpadAdd",46];g.NumpadAdd.toString=l;g.NumpadAdd.__enum__=g;g.NumpadDecimal=
["NumpadDecimal",47];g.NumpadDecimal.toString=l;g.NumpadDecimal.__enum__=g;g.NumpadDivide=["NumpadDivide",48];g.NumpadDivide.toString=l;g.NumpadDivide.__enum__=g;g.NumpadEnter=["NumpadEnter",49];g.NumpadEnter.toString=l;g.NumpadEnter.__enum__=g;g.NumpadMultiply=["NumpadMultiply",50];g.NumpadMultiply.toString=l;g.NumpadMultiply.__enum__=g;g.NumpadSubtract=["NumpadSubtract",51];g.NumpadSubtract.toString=l;g.NumpadSubtract.__enum__=g;g.F1=["F1",52];g.F1.toString=l;g.F1.__enum__=g;g.F2=["F2",53];g.F2.toString=
l;g.F2.__enum__=g;g.F3=["F3",54];g.F3.toString=l;g.F3.__enum__=g;g.F4=["F4",55];g.F4.toString=l;g.F4.__enum__=g;g.F5=["F5",56];g.F5.toString=l;g.F5.__enum__=g;g.F6=["F6",57];g.F6.toString=l;g.F6.__enum__=g;g.F7=["F7",58];g.F7.toString=l;g.F7.__enum__=g;g.F8=["F8",59];g.F8.toString=l;g.F8.__enum__=g;g.F9=["F9",60];g.F9.toString=l;g.F9.__enum__=g;g.F10=["F10",61];g.F10.toString=l;g.F10.__enum__=g;g.F11=["F11",62];g.F11.toString=l;g.F11.__enum__=g;g.F12=["F12",63];g.F12.toString=l;g.F12.__enum__=g;g.F13=
["F13",64];g.F13.toString=l;g.F13.__enum__=g;g.F14=["F14",65];g.F14.toString=l;g.F14.__enum__=g;g.F15=["F15",66];g.F15.toString=l;g.F15.__enum__=g;g.Left=["Left",67];g.Left.toString=l;g.Left.__enum__=g;g.Up=["Up",68];g.Up.toString=l;g.Up.__enum__=g;g.Right=["Right",69];g.Right.toString=l;g.Right.__enum__=g;g.Down=["Down",70];g.Down.toString=l;g.Down.__enum__=g;g.Alt=["Alt",71];g.Alt.toString=l;g.Alt.__enum__=g;g.Backquote=["Backquote",72];g.Backquote.toString=l;g.Backquote.__enum__=g;g.Backslash=
["Backslash",73];g.Backslash.toString=l;g.Backslash.__enum__=g;g.Backspace=["Backspace",74];g.Backspace.toString=l;g.Backspace.__enum__=g;g.CapsLock=["CapsLock",75];g.CapsLock.toString=l;g.CapsLock.__enum__=g;g.Comma=["Comma",76];g.Comma.toString=l;g.Comma.__enum__=g;g.Command=["Command",77];g.Command.toString=l;g.Command.__enum__=g;g.Control=["Control",78];g.Control.toString=l;g.Control.__enum__=g;g.Delete=["Delete",79];g.Delete.toString=l;g.Delete.__enum__=g;g.End=["End",80];g.End.toString=l;g.End.__enum__=
g;g.Enter=["Enter",81];g.Enter.toString=l;g.Enter.__enum__=g;g.Equals=["Equals",82];g.Equals.toString=l;g.Equals.__enum__=g;g.Escape=["Escape",83];g.Escape.toString=l;g.Escape.__enum__=g;g.Home=["Home",84];g.Home.toString=l;g.Home.__enum__=g;g.Insert=["Insert",85];g.Insert.toString=l;g.Insert.__enum__=g;g.LeftBracket=["LeftBracket",86];g.LeftBracket.toString=l;g.LeftBracket.__enum__=g;g.Minus=["Minus",87];g.Minus.toString=l;g.Minus.__enum__=g;g.PageDown=["PageDown",88];g.PageDown.toString=l;g.PageDown.__enum__=
g;g.PageUp=["PageUp",89];g.PageUp.toString=l;g.PageUp.__enum__=g;g.Period=["Period",90];g.Period.toString=l;g.Period.__enum__=g;g.Quote=["Quote",91];g.Quote.toString=l;g.Quote.__enum__=g;g.RightBracket=["RightBracket",92];g.RightBracket.toString=l;g.RightBracket.__enum__=g;g.Semicolon=["Semicolon",93];g.Semicolon.toString=l;g.Semicolon.__enum__=g;g.Shift=["Shift",94];g.Shift.toString=l;g.Shift.__enum__=g;g.Slash=["Slash",95];g.Slash.toString=l;g.Slash.__enum__=g;g.Space=["Space",96];g.Space.toString=
l;g.Space.__enum__=g;g.Tab=["Tab",97];g.Tab.toString=l;g.Tab.__enum__=g;g.Menu=["Menu",98];g.Menu.toString=l;g.Menu.__enum__=g;g.Search=["Search",99];g.Search.toString=l;g.Search.__enum__=g;g.Unknown=function(a){a=["Unknown",100,a];a.__enum__=g;a.toString=l;return a};g.__empty_constructs__=[g.A,g.B,g.C,g.D,g.E,g.F,g.G,g.H,g.I,g.J,g.K,g.L,g.M,g.N,g.O,g.P,g.Q,g.R,g.S,g.T,g.U,g.V,g.W,g.X,g.Y,g.Z,g.Number0,g.Number1,g.Number2,g.Number3,g.Number4,g.Number5,g.Number6,g.Number7,g.Number8,g.Number9,g.Numpad0,
g.Numpad1,g.Numpad2,g.Numpad3,g.Numpad4,g.Numpad5,g.Numpad6,g.Numpad7,g.Numpad8,g.Numpad9,g.NumpadAdd,g.NumpadDecimal,g.NumpadDivide,g.NumpadEnter,g.NumpadMultiply,g.NumpadSubtract,g.F1,g.F2,g.F3,g.F4,g.F5,g.F6,g.F7,g.F8,g.F9,g.F10,g.F11,g.F12,g.F13,g.F14,g.F15,g.Left,g.Up,g.Right,g.Down,g.Alt,g.Backquote,g.Backslash,g.Backspace,g.CapsLock,g.Comma,g.Command,g.Control,g.Delete,g.End,g.Enter,g.Equals,g.Escape,g.Home,g.Insert,g.LeftBracket,g.Minus,g.PageDown,g.PageUp,g.Period,g.Quote,g.RightBracket,
g.Semicolon,g.Shift,g.Slash,g.Space,g.Tab,g.Menu,g.Search];var Xf=function(){this.init(0,null)};h["flambe.input.KeyboardEvent"]=Xf;Xf.__name__=!0;Xf.prototype={init:function(a,b){this.id=a;this.key=b},__class__:Xf};var Y=h["flambe.input.MouseButton"]={__ename__:!0,__constructs__:["Left","Middle","Right","Unknown"]};Y.Left=["Left",0];Y.Left.toString=l;Y.Left.__enum__=Y;Y.Middle=["Middle",1];Y.Middle.toString=l;Y.Middle.__enum__=Y;Y.Right=["Right",2];Y.Right.toString=l;Y.Right.__enum__=Y;Y.Unknown=
function(a){a=["Unknown",3,a];a.__enum__=Y;a.toString=l;return a};Y.__empty_constructs__=[Y.Left,Y.Middle,Y.Right];var oa=h["flambe.input.MouseCursor"]={__ename__:!0,__constructs__:["Default","Button","None"]};oa.Default=["Default",0];oa.Default.toString=l;oa.Default.__enum__=oa;oa.Button=["Button",1];oa.Button.toString=l;oa.Button.__enum__=oa;oa.None=["None",2];oa.None.toString=l;oa.None.__enum__=oa;oa.__empty_constructs__=[oa.Default,oa.Button,oa.None];var Yf=function(){this.init(0,0,0,null)};h["flambe.input.MouseEvent"]=
Yf;Yf.__name__=!0;Yf.prototype={init:function(a,b,c,d){this.id=a;this.viewX=b;this.viewY=c;this.button=d},__class__:Yf};var qd=h["flambe.input.EventSource"]={__ename__:!0,__constructs__:["Mouse","Touch"]};qd.Mouse=function(a){a=["Mouse",0,a];a.__enum__=qd;a.toString=l;return a};qd.Touch=function(a){a=["Touch",1,a];a.__enum__=qd;a.toString=l;return a};qd.__empty_constructs__=[];var Zf=function(){this.init(0,0,0,null,null)};h["flambe.input.PointerEvent"]=Zf;Zf.__name__=!0;Zf.prototype={init:function(a,
b,c,d,e){this.id=a;this.viewX=b;this.viewY=c;this.hit=d;this.source=e;this._stopped=!1},__class__:Zf};var $f=function(a){this.id=a;this._source=qd.Touch(this)};h["flambe.input.TouchPoint"]=$f;$f.__name__=!0;$f.prototype={init:function(a,b){this.viewX=a;this.viewY=b},__class__:$f};var na=function(){};h["flambe.math.FMath"]=na;na.__name__=!0;na.toRadians=function(a){return 3.141592653589793*a/180};na.max=function(a,b){return a>b?a:b};na.min=function(a,b){return a<b?a:b};na.clamp=function(a,b,c){return a<
b?b:a>c?c:a};var Pa=function(){this.identity()};h["flambe.math.Matrix"]=Pa;Pa.__name__=!0;Pa.multiply=function(a,b,c){null==c&&(c=new Pa);var d=a.m00*b.m00+a.m01*b.m10,e=a.m00*b.m01+a.m01*b.m11,v=a.m00*b.m02+a.m01*b.m12+a.m02;c.m00=d;c.m01=e;c.m02=v;d=a.m10*b.m00+a.m11*b.m10;e=a.m10*b.m01+a.m11*b.m11;v=a.m10*b.m02+a.m11*b.m12+a.m12;c.m10=d;c.m11=e;c.m12=v;return c};Pa.prototype={set:function(a,b,c,d,e,v){this.m00=a;this.m01=c;this.m02=e;this.m10=b;this.m11=d;this.m12=v},identity:function(){this.set(1,
0,0,1,0,0)},compose:function(a,b,c,d,e){var v=Math.sin(e),e=Math.cos(e);this.set(e*c,v*c,-v*d,e*d,a,b)},translate:function(a,b){this.m02+=this.m00*a+this.m01*b;this.m12+=this.m11*b+this.m10*a},invert:function(){var a=this.determinant();if(0==a)return!1;this.set(this.m11/a,-this.m01/a,-this.m10/a,this.m00/a,(this.m01*this.m12-this.m11*this.m02)/a,(this.m10*this.m02-this.m00*this.m12)/a);return!0},transformArray:function(a,b,c){for(var d=0;d<b;){var e=a[d],v=a[d+1];c[d++]=e*this.m00+v*this.m01+this.m02;
c[d++]=e*this.m10+v*this.m11+this.m12}},determinant:function(){return this.m00*this.m11-this.m01*this.m10},inverseTransform:function(a,b,c){var d=this.determinant();if(0==d)return!1;a-=this.m02;b-=this.m12;c.x=(a*this.m11-b*this.m01)/d;c.y=(b*this.m00-a*this.m10)/d;return!0},clone:function(a){null==a&&(a=new Pa);a.set(this.m00,this.m10,this.m01,this.m11,this.m02,this.m12);return a},__class__:Pa};var Dd=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.set(a,b,c,d)};
h["flambe.math.Rectangle"]=Dd;Dd.__name__=!0;Dd.prototype={set:function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d},contains:function(a,b){a-=this.x;if(0<=this.width){if(0>a||a>this.width)return!1}else if(0<a||a<this.width)return!1;b-=this.y;if(0<=this.height){if(0>b||b>this.height)return!1}else if(0<b||b<this.height)return!1;return!0},clone:function(a){null==a&&(a=new Dd);a.set(this.x,this.y,this.width,this.height);return a},equals:function(a){return this.x==a.x&&this.y==a.y&&this.width==
a.width&&this.height==a.height},get_right:function(){return this.x+this.width},get_bottom:function(){return this.y+this.height},__class__:Dd};var pc=function(a,b,c){this.scaleX=this.scaleY=1;E.call(this);this.world=a;this.body=b;this.bounds=c};h["flambe.nape.BodyComponent"]=pc;pc.__name__=!0;pc.__super__=E;pc.prototype=t(E.prototype,{get_name:function(){return"BodyComponent_8"},setTargetSprite:function(a){this.sprite=a},onStart:function(){this.space=this.world._compMap.SpaceComponent_2.napeSpace;
this.sprite=this.owner._compMap.Sprite_9;this.body.set_space(this.space)},setScale:function(a,b){this.body.scaleShapes(1/this.scaleX,1/this.scaleY);this.sprite.scaleX.set__(this.scaleX=a);this.sprite.scaleY.set__(this.scaleY=b);this.body.scaleShapes(a,b)},onUpdate:function(){var a=this.body.get_position(),b;if(b=null!=this.bounds)if(a.zpp_inner.validate(),!(b=a.zpp_inner.x<this.bounds.zpp_inner.getmin().get_x()))if(a.zpp_inner.validate(),!(b=a.zpp_inner.y<this.bounds.zpp_inner.getmin().get_y()))if(a.zpp_inner.validate(),
!(b=a.zpp_inner.x>this.bounds.zpp_inner.getmax().get_x()))a.zpp_inner.validate(),b=a.zpp_inner.y>this.bounds.zpp_inner.getmax().get_y();b?this.owner.dispose():(this.sprite.x.set__(function(){a.zpp_inner.validate();return a.zpp_inner.x}(this)),this.sprite.y.set__(function(){a.zpp_inner.validate();return a.zpp_inner.y}(this)),this.sprite.rotation.set__(180*this.body.zpp_inner.rot/3.141592653589793))},onRemoved:function(){this.body.set_space(null)},__class__:pc});var De=function(a,b,c){null==a&&(a=4E3);
E.call(this);null!=this.handJoint&&this.handJoint.set_maxForce(a);this._maxForce=a;this.spaceComponent=b;this.rootSprite=c;this.mousePoint=new pd};h["flambe.nape.MouseDragComponent"]=De;De.__name__=!0;De.__super__=E;De.prototype=t(E.prototype,{get_name:function(){return"MouseDragComponent_11"},onAdded:function(){null==this.spaceComponent&&(this.spaceComponent=this.owner._compMap.SpaceComponent_2);null==this.space&&(this.space=this.spaceComponent.napeSpace);null==this.rootSprite&&(this.rootSprite=
this.owner._compMap.Sprite_9);this.camera=null==this.rootSprite?null:this.rootSprite.owner._compMap.Camera_14;s._platform.getPointer().get_supported()&&(this.setupJoint(),this.downConnection=s._platform.getPointer().down.connect(n(this,this.onPointerDown)),this.upConnection=s._platform.getPointer().up.connect(n(this,this.onPointerUp)))},setupJoint:function(){this.handJoint=new Ed(this.space.zpp_inner.__static,null,x.get(0,0,!0),x.get(0,0,!0));this.handJoint.set_space(this.space);this.handJoint.set_active(!1);
this.handJoint.set_stiff(!1);this.handJoint.set_maxForce(this._maxForce);this.handJoint.set_damping(10);this.handJoint.set_frequency(10)},onPointerDown:function(a){this.camera.screenPointToWorld(a.viewX,a.viewY,this.mousePoint);for(var a=x.get(this.mousePoint.x,this.mousePoint.y,null),b=this.space.bodiesUnderPoint(a).iterator();b.hasNext();){var c;b.zpp_critical=!1;c=b.zpp_inner.at(b.zpp_i++);if(c.zpp_inner.type==f.id_BodyType_DYNAMIC){this.handJoint.set_body2(c);this.handJoint.get_anchor2().set(c.worldPointToLocal(a,
!0));this.handJoint.set_active(!0);break}}a.dispose()},onPointerUp:function(){this.handJoint.set_active(!1)},onUpdate:function(){this.handJoint.zpp_inner.active&&(this.camera.screenPointToWorld(s._platform.getPointer().get_x(),s._platform.getPointer().get_y(),this.mousePoint),this.handJoint.get_anchor1().setxy(this.mousePoint.x,this.mousePoint.y))},onRemoved:function(){this.upConnection.dispose();this.downConnection.dispose();this.handJoint.set_space(null);this.handJoint=null},__class__:De});var qc=
function(a){this.worldBounds=a};h["flambe.nape.NapeMain"]=qc;qc.__name__=!0;qc.prototype={onSuccess:function(a){var b=this;this.assets=a;this.stageWidth=s._platform.getStage().get_width();this.stageHeight=s._platform.getStage().get_height();s.root.addChild(this.world=new W);s.root.addChild(this.ui=new W);this.ui.add(this.uiContainer=new N);this.stageWidth=s._platform.getStage().get_width();this.stageHeight=s._platform.getStage().get_height();this.worldContainer=new N;this.camera=new ze;this.worldSceneryLayer=
new W;this.worldNapeLayer=new W;this.worldUILayer=new W;this.world.add(this.worldContainer).add(this.camera).addChild(this.worldSceneryLayer).addChild(this.worldNapeLayer).addChild(this.worldUILayer);this.setupScenery();this.setupNapeWorld();this.setupCamera();this.setupUI();this.onResize();s._platform.getStage().resize.connect(n(this,this.onResize));s._platform.getStage().orientation.get_changed().connect(function(a,d){if(a!=d)b.onResize()});this.world.add(this.gestureControl=new Xa);this.gestureControl.gesture.connect(n(this,
this.firstUserInteraction)).once();this.gestureControl.gesture.connect(n(this,this.onGesture));s._platform.getKeyboard().get_supported()&&s._platform.getKeyboard().down.connect(n(this,this.onKey))},setupScenery:function(){},setupNapeWorld:function(){this.worldNapeLayer.add(this.spaceComponent=new ja(this.assets,this.worldBounds)).add(this.mouseDrag=new De(28E4,this.spaceComponent,this.worldContainer))},setupCamera:function(){},setupUI:function(){},onResize:function(){this.stageWidth=s._platform.getStage().get_width();
this.stageHeight=s._platform.getStage().get_height()},firstUserInteraction:function(){},onGesture:function(){},onKey:function(a){switch(a.key[1]){case 83:s._platform.getStage().requestFullscreen(!1);break;case 5:case 62:s._platform.getStage().requestFullscreen();break;case 46:this.camera.controller.zoom.animateBy(0.2,0.25,Ba.quadOut);break;case 51:this.camera.controller.zoom.animateBy(-0.2,0.25,Ba.quadOut);break;case 17:s._platform.getKeyboard().isDown(g.Control)&&window.document.location.reload();
break;default:null}},__class__:qc};var ja=function(a,b,c){E.call(this);this.assetPack=a;this.napeSpace=null==c?new ag(x.get(0,0,null)):c;this.bounds=b;this.cumalativeDt=0};h["flambe.nape.SpaceComponent"]=ja;ja.__name__=!0;ja.__super__=E;ja.prototype=t(E.prototype,{get_name:function(){return"SpaceComponent_2"},onAdded:function(){this.createPhisicalBounds()},onUpdate:function(a){for(this.cumalativeDt+=a;this.cumalativeDt>=ja.FixedTimeStep;)this.napeSpace.step(ja.FixedTimeStep,ja.VelocityIterationsPerTimeStep,
ja.PositionIterationsPerTimeStep),this.cumalativeDt-=a},createPhisicalBounds:function(){if(null!=this.bounds){var a=new Ee,b=function(b,d,e,v,f){b=new qb(b,x.get(d,e,!0));b.zpp_inner.wrap_shapes.add(new Qa(Qa.rect(0,0,v,f)));if((null==b.zpp_inner.compound?null:b.zpp_inner.compound.outer)!=a){if(null!=(null==b.zpp_inner.compound?null:b.zpp_inner.compound.outer))(null==b.zpp_inner.compound?null:b.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(b);null!=a&&a.zpp_inner.wrap_bodies.add(b)}null==
b.zpp_inner.compound?null:b.zpp_inner.compound.outer;return b};null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);b(f.BodyType_STATIC,this.bounds.x-8,this.bounds.y,8,this.bounds.height);null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);b(f.BodyType_STATIC,this.bounds.get_right(),this.bounds.y,8,this.bounds.height);null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);b(f.BodyType_STATIC,this.bounds.x,this.bounds.y-
4,this.bounds.width,8);null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);b(f.BodyType_STATIC,this.bounds.x,this.bounds.get_bottom()+4,this.bounds.width,8);a.set_space(this.napeSpace)}},createBodySpriteEntity:function(a,b,c,d,e){e=null==e?new W:e;if(null!=b){null==a.zpp_inner_i.userData&&(a.zpp_inner_i.userData={});var v=a.zpp_inner_i.userData.graphicOffset;null!=v&&b.setAnchor(-function(){v.zpp_inner.validate();return v.zpp_inner.x}(this),-function(){v.zpp_inner.validate();
return v.zpp_inner.y}(this));e.add(b)}null==c?(c=pc,d=[this.owner,a]):null!=d?(d.unshift(a),d.unshift(this.owner)):d=[this.owner,a];e.add(Yc.createInstance(c,d));return e},__class__:ja});var bg=function(){};h["flambe.nape.util.SerialiseBodyUtil"]=bg;bg.__name__=!0;bg.deserialiseToBody=function(a){for(var b=a.polys,c=new qb,d=0;d<b.length;){var e=b[d];++d;for(var v=[],f=0;f<e.length;){var j=e[f];++f;v.push(x.get(j[0],j[1],null))}c.zpp_inner.wrap_shapes.add(new Qa(v))}null==a.graphicOffset?(null==c.zpp_inner_i.userData&&
(c.zpp_inner_i.userData={}),c.zpp_inner_i.userData.graphicOffset=x.get(null,null,null)):(null==c.zpp_inner_i.userData&&(c.zpp_inner_i.userData={}),c.zpp_inner_i.userData.graphicOffset=x.get(a.graphicOffset[0],a.graphicOffset[1],null));return c};var Fa=function(){this._disposed=!1};h["flambe.platform.BasicAsset"]=Fa;Fa.__name__=!0;Fa.__interfaces__=[od];Fa.prototype={dispose:function(){this._disposed||(this._disposed=!0,this.onDisposed())},onDisposed:function(){null},__class__:Fa};var $c=function(a,
b){var c=this;this.manifest=b;this._platform=a;this.promise=new Fe;this._bytesLoaded=new Fb;this._pack=new Ge(b,this);var d=ld.array(b);if(0==d.length)this.handleSuccess();else{for(var e=new Fb,v=0;v<d.length;){var f=d[v];++v;var j=e.get(f.name);null==j&&(j=[],e.set(f.name,j));j.push(f)}this._assetsRemaining=ld.count(e);for(d=e.iterator();d.hasNext();)e=[d.next()],this.pickBestEntry(e[0],function(a){return function(d){if(null!=d){var e=b.getFullURL(d);try{c.loadEntry(e,d)}catch(v){c.handleError(d,
"Unexpected error: "+y.string(v))}e=c.promise;e.set_total(e._total+d.bytes)}else d=a[0][0],$c.isAudio(d.format)?c.handleLoad(d,M.getInstance()):c.handleError(d,"Could not find a supported format to load")}}(e))}};h["flambe.platform.BasicAssetPackLoader"]=$c;$c.__name__=!0;$c.isAudio=function(a){switch(a[1]){case 8:case 9:case 10:case 11:case 12:return!0;default:return!1}};$c.prototype={onDisposed:function(){},pickBestEntry:function(a,b){this.getAssetFormats(function(c){for(var d=0;d<c.length;){var e=
c[d];++d;for(var v=0;v<a.length;){var f=a[v];++v;if(f.format==e){b(f);return}}}b(null)})},loadEntry:function(){null},getAssetFormats:function(){null},handleLoad:function(a,b){if(!this._pack.disposed){this.handleProgress(a,a.bytes);var c;switch(a.format[1]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c=this._pack.textures;break;case 8:case 9:case 10:case 11:case 12:c=this._pack.sounds;break;case 13:c=this._pack.files}c.set(a.name,b);this._assetsRemaining-=1;0==this._assetsRemaining&&this.handleSuccess()}},
handleProgress:function(a,b){this._bytesLoaded.set(a.name,b);for(var c=0,d=this._bytesLoaded.iterator();d.hasNext();)var e=d.next(),c=c+e;this.promise.set_progress(c)},handleSuccess:function(){this.promise.set_result(this._pack)},handleError:function(a,b){this.promise.error.emit(fb.withFields(b,["url",a.url]))},handleTextureError:function(a){this.handleError(a,"Failed to create texture. Is the GPU context unavailable?")},__class__:$c};var Ge=function(a,b){this.disposed=!1;this._manifest=a;this.loader=
b;this.textures=new Fb;this.sounds=new Fb;this.files=new Fb};h["flambe.platform._BasicAssetPackLoader.BasicAssetPack"]=Ge;Ge.__name__=!0;Ge.__interfaces__=[xe];Ge.prototype={getTexture:function(a,b){null==b&&(b=!0);var c=this.textures.get(a);if(null==c&&b)throw fb.withFields("Missing texture",["name",a]);return c},getSound:function(a,b){null==b&&(b=!0);var c=this.sounds.get(a);if(null==c&&b)throw fb.withFields("Missing sound",["name",a]);return c},getFile:function(a,b){null==b&&(b=!0);var c=this.files.get(a);
if(null==c&&b)throw fb.withFields("Missing file",["name",a]);return c},dispose:function(){if(!this.disposed){this.disposed=!0;for(var a=this.textures.iterator();a.hasNext();)a.next().dispose();this.textures=null;for(a=this.sounds.iterator();a.hasNext();)a.next().dispose();this.sounds=null;for(a=this.files.iterator();a.hasNext();)a.next().dispose();this.files=null;this.loader.onDisposed()}},__class__:Ge};var rd=function(a){this._disposed=!1;this._content=a};h["flambe.platform.BasicFile"]=rd;rd.__name__=
!0;rd.__interfaces__=[ye];rd.__super__=Fa;rd.prototype=t(Fa.prototype,{toString:function(){return this._content},onDisposed:function(){this._content=null},__class__:rd});var cg=function(){};h["flambe.subsystem.KeyboardSystem"]=cg;cg.__name__=!0;cg.prototype={__class__:cg};var ob=function(){this.down=new ca;this.up=new ca;this.backButton=new nc;this._keyStates=new oc};h["flambe.platform.BasicKeyboard"]=ob;ob.__name__=!0;ob.__interfaces__=[cg];ob.prototype={get_supported:function(){return!0},isDown:function(a){return this.isCodeDown(Vd.toKeyCode(a))},
isCodeDown:function(a){return this._keyStates.exists(a)},submitDown:function(a){if(16777238==a)return null!=this.backButton._head?(this.backButton.emit(),!0):!1;this._keyStates.exists(a)||(this._keyStates.set(a,!0),ob._sharedEvent.init(ob._sharedEvent.id+1,Vd.toKey(a)),this.down.emit(ob._sharedEvent));return!0},submitUp:function(a){this._keyStates.exists(a)&&(this._keyStates.remove(a),ob._sharedEvent.init(ob._sharedEvent.id+1,Vd.toKey(a)),this.up.emit(ob._sharedEvent))},__class__:ob};var dg=function(){};
h["flambe.subsystem.MouseSystem"]=dg;dg.__name__=!0;dg.prototype={__class__:dg};var Ka=function(a){this._pointer=a;this._source=qd.Mouse(Ka._sharedEvent);this.down=new ca;this.move=new ca;this.up=new ca;this.scroll=new ca;this._y=this._x=0;this._cursor=oa.Default;this._buttonStates=new oc};h["flambe.platform.BasicMouse"]=Ka;Ka.__name__=!0;Ka.__interfaces__=[dg];Ka.prototype={get_supported:function(){return!0},submitDown:function(a,b,c){this._buttonStates.exists(c)||(this._buttonStates.set(c,!0),this.prepare(a,
b,eg.toButton(c)),this._pointer.submitDown(a,b,this._source),this.down.emit(Ka._sharedEvent))},submitMove:function(a,b){this.prepare(a,b,null);this._pointer.submitMove(a,b,this._source);this.move.emit(Ka._sharedEvent)},submitUp:function(a,b,c){this._buttonStates.exists(c)&&(this._buttonStates.remove(c),this.prepare(a,b,eg.toButton(c)),this._pointer.submitUp(a,b,this._source),this.up.emit(Ka._sharedEvent))},submitScroll:function(a,b,c){this._x=a;this._y=b;if(null==this.scroll._head)return!1;this.scroll.emit(c);
return!0},prepare:function(a,b,c){this._x=a;this._y=b;Ka._sharedEvent.init(Ka._sharedEvent.id+1,a,b,c)},__class__:Ka};var fg=function(){};h["flambe.subsystem.PointerSystem"]=fg;fg.__name__=!0;fg.prototype={__class__:fg};var za=function(a,b,c){null==c&&(c=!1);null==b&&(b=0);null==a&&(a=0);this.down=new ca;this.move=new ca;this.up=new ca;this._x=a;this._y=b;this._isDown=c};h["flambe.platform.BasicPointer"]=za;za.__name__=!0;za.__interfaces__=[fg];za.prototype={get_supported:function(){return!0},get_x:function(){return this._x},
get_y:function(){return this._y},submitDown:function(a,b,c){if(!this._isDown){this.submitMove(a,b,c);this._isDown=!0;var d=[],e=N.hitTest(s.root,a,b);if(null!=e){var v=e.owner;do{var f=v._compMap.Sprite_9;null!=f&&d.push(f);v=v.parent}while(null!=v)}this.prepare(a,b,e,c);for(a=0;a<d.length;)if(b=d[a],++a,b.onPointerDown(za._sharedEvent),za._sharedEvent._stopped)return;this.down.emit(za._sharedEvent)}},submitMove:function(a,b,c){if(!(a==this._x&&b==this._y)){var d=[],e=N.hitTest(s.root,a,b);if(null!=
e){var f=e.owner;do{var q=f._compMap.Sprite_9;null!=q&&d.push(q);f=f.parent}while(null!=f)}this.prepare(a,b,e,c);for(a=0;a<d.length;)if(b=d[a],++a,b.onPointerMove(za._sharedEvent),za._sharedEvent._stopped)return;this.move.emit(za._sharedEvent)}},submitUp:function(a,b,c){if(this._isDown){this.submitMove(a,b,c);this._isDown=!1;var d=[],e=N.hitTest(s.root,a,b);if(null!=e){var f=e.owner;do{var q=f._compMap.Sprite_9;null!=q&&d.push(q);f=f.parent}while(null!=f)}this.prepare(a,b,e,c);for(a=0;a<d.length;)if(b=
d[a],++a,b.onPointerUp(za._sharedEvent),za._sharedEvent._stopped)return;this.up.emit(za._sharedEvent)}},prepare:function(a,b,c,d){this._x=a;this._y=b;za._sharedEvent.init(za._sharedEvent.id+1,a,b,c,d)},__class__:za};var Nc=function(a,b,c){this._x=this._y=0;this._parent=null;this.rootX=this.rootY=0;this._disposed=!1;this.root=a;this._width=b;this._height=c};h["flambe.platform.BasicTexture"]=Nc;Nc.__name__=!0;Nc.__interfaces__=[Qg];Nc.__super__=Fa;Nc.prototype=t(Fa.prototype,{subTexture:function(a,
b,c,d){c=this.root.createTexture(c,d);c._parent=this;c._x=a;c._y=b;c.rootX=this.rootX+a;c.rootY=this.rootY+b;return c},onDisposed:function(){null==this._parent&&this.root.dispose()},get_width:function(){return this._width},get_height:function(){return this._height},__class__:Nc});var He=function(){};h["flambe.subsystem.TouchSystem"]=He;He.__name__=!0;He.prototype={__class__:He};var qe=function(a,b){null==b&&(b=4);this._pointer=a;this._maxPoints=b;this._pointMap=new oc;this._points=[];this.down=new ca;
this.move=new ca;this.up=new ca};h["flambe.platform.BasicTouch"]=qe;qe.__name__=!0;qe.__interfaces__=[He];qe.prototype={get_supported:function(){return!0},get_maxPoints:function(){return this._maxPoints},submitDown:function(a,b,c){if(!this._pointMap.exists(a)){var d=new $f(a);d.init(b,c);this._pointMap.set(a,d);this._points.push(d);null==this._pointerTouch&&(this._pointerTouch=d,this._pointer.submitDown(b,c,d._source));this.down.emit(d)}},submitMove:function(a,b,c){a=this._pointMap.get(a);null!=a&&
(a.init(b,c),this._pointerTouch==a&&this._pointer.submitMove(b,c,a._source),this.move.emit(a))},submitUp:function(a,b,c){var d=this._pointMap.get(a);null!=d&&(d.init(b,c),this._pointMap.remove(a),F.remove(this._points,d),this._pointerTouch==d&&(this._pointerTouch=null,this._pointer.submitUp(b,c,d._source)),this.up.emit(d))},__class__:qe};var ad=function(){};h["flambe.sound.Sound"]=ad;ad.__name__=!0;ad.__interfaces__=[od];ad.prototype={__class__:ad};var M=function(){this._disposed=!1;this._playback=
new Wd(this)};h["flambe.platform.DummySound"]=M;M.__name__=!0;M.__interfaces__=[ad];M.getInstance=function(){null==M._instance&&(M._instance=new M);return M._instance};M.__super__=Fa;M.prototype=t(Fa.prototype,{play:function(){return this._playback},loop:function(){return this._playback},onDisposed:function(){},__class__:M});var Fd=function(){};h["flambe.sound.Playback"]=Fd;Fd.__name__=!0;Fd.__interfaces__=[Zb];Fd.prototype={__class__:Fd};var Wd=function(a){this._sound=a;this.volume=new z(0);this._complete=
new Aa(!0)};h["flambe.platform.DummyPlayback"]=Wd;Wd.__name__=!0;Wd.__interfaces__=[Fd];Wd.prototype={get_complete:function(){return this._complete},dispose:function(){},__class__:Wd};var ve=function(){this.down=new ca;this.move=new ca;this.up=new ca};h["flambe.platform.DummyTouch"]=ve;ve.__name__=!0;ve.__interfaces__=[He];ve.prototype={get_supported:function(){return!1},get_maxPoints:function(){return 0},__class__:ve};var Xd=function(){this._entries=[]};h["flambe.platform.EventGroup"]=Xd;Xd.__name__=
!0;Xd.__interfaces__=[Zb];Xd.prototype={addListener:function(a,b,c){a.addEventListener(b,c,!1);this._entries.push(new gg(a,b,c))},addDisposingListener:function(a,b,c){var d=this;this.addListener(a,b,function(a){d.dispose();c(a)})},dispose:function(){for(var a=0,b=this._entries;a<b.length;){var c=b[a];++a;c.dispatcher.removeEventListener(c.type,c.listener,!1)}this._entries=[]},__class__:Xd};var gg=function(a,b,c){this.dispatcher=a;this.type=b;this.listener=c};h["flambe.platform._EventGroup.Entry"]=
gg;gg.__name__=!0;gg.prototype={__class__:gg};var re=function(){};h["flambe.platform.InternalGraphics"]=re;re.__name__=!0;re.__interfaces__=[Vf];re.prototype={__class__:re};var hg=function(){};h["flambe.subsystem.RendererSystem"]=hg;hg.__name__=!0;hg.prototype={__class__:hg};var Gd=function(){};h["flambe.platform.InternalRenderer"]=Gd;Gd.__name__=!0;Gd.__interfaces__=[hg];Gd.prototype={__class__:Gd};var Vd=function(){};h["flambe.platform.KeyCodes"]=Vd;Vd.__name__=!0;Vd.toKey=function(a){switch(a){case 65:return g.A;
case 66:return g.B;case 67:return g.C;case 68:return g.D;case 69:return g.E;case 70:return g.F;case 71:return g.G;case 72:return g.H;case 73:return g.I;case 74:return g.J;case 75:return g.K;case 76:return g.L;case 77:return g.M;case 78:return g.N;case 79:return g.O;case 80:return g.P;case 81:return g.Q;case 82:return g.R;case 83:return g.S;case 84:return g.T;case 85:return g.U;case 86:return g.V;case 87:return g.W;case 88:return g.X;case 89:return g.Y;case 90:return g.Z;case 48:return g.Number0;case 49:return g.Number1;
case 50:return g.Number2;case 51:return g.Number3;case 52:return g.Number4;case 53:return g.Number5;case 54:return g.Number6;case 55:return g.Number7;case 56:return g.Number8;case 57:return g.Number9;case 96:return g.Numpad0;case 97:return g.Numpad1;case 98:return g.Numpad2;case 99:return g.Numpad3;case 100:return g.Numpad4;case 101:return g.Numpad5;case 102:return g.Numpad6;case 103:return g.Numpad7;case 104:return g.Numpad8;case 105:return g.Numpad9;case 107:return g.NumpadAdd;case 110:return g.NumpadDecimal;
case 111:return g.NumpadDivide;case 108:return g.NumpadEnter;case 106:return g.NumpadMultiply;case 109:return g.NumpadSubtract;case 112:return g.F1;case 113:return g.F2;case 114:return g.F3;case 115:return g.F4;case 116:return g.F5;case 117:return g.F6;case 118:return g.F7;case 119:return g.F8;case 120:return g.F9;case 121:return g.F10;case 122:return g.F11;case 123:return g.F12;case 37:return g.Left;case 38:return g.Up;case 39:return g.Right;case 40:return g.Down;case 18:return g.Alt;case 192:return g.Backquote;
case 220:return g.Backslash;case 8:return g.Backspace;case 20:return g.CapsLock;case 188:return g.Comma;case 15:return g.Command;case 17:return g.Control;case 46:return g.Delete;case 35:return g.End;case 13:return g.Enter;case 187:return g.Equals;case 27:return g.Escape;case 36:return g.Home;case 45:return g.Insert;case 219:return g.LeftBracket;case 189:return g.Minus;case 34:return g.PageDown;case 33:return g.PageUp;case 190:return g.Period;case 222:return g.Quote;case 221:return g.RightBracket;
case 186:return g.Semicolon;case 16:return g.Shift;case 191:return g.Slash;case 32:return g.Space;case 9:return g.Tab;case 16777234:return g.Menu;case 16777247:return g.Search}return g.Unknown(a)};Vd.toKeyCode=function(a){switch(a[1]){case 0:return 65;case 1:return 66;case 2:return 67;case 3:return 68;case 4:return 69;case 5:return 70;case 6:return 71;case 7:return 72;case 8:return 73;case 9:return 74;case 10:return 75;case 11:return 76;case 12:return 77;case 13:return 78;case 14:return 79;case 15:return 80;
case 16:return 81;case 17:return 82;case 18:return 83;case 19:return 84;case 20:return 85;case 21:return 86;case 22:return 87;case 23:return 88;case 24:return 89;case 25:return 90;case 26:return 48;case 27:return 49;case 28:return 50;case 29:return 51;case 30:return 52;case 31:return 53;case 32:return 54;case 33:return 55;case 34:return 56;case 35:return 57;case 36:return 96;case 37:return 97;case 38:return 98;case 39:return 99;case 40:return 100;case 41:return 101;case 42:return 102;case 43:return 103;
case 44:return 104;case 45:return 105;case 46:return 107;case 47:return 110;case 48:return 111;case 49:return 108;case 50:return 106;case 51:return 109;case 52:return 112;case 53:return 113;case 54:return 114;case 55:return 115;case 56:return 116;case 57:return 117;case 58:return 118;case 59:return 119;case 60:return 120;case 61:return 121;case 62:return 122;case 63:return 123;case 64:return 124;case 65:return 125;case 66:return 126;case 67:return 37;case 68:return 38;case 69:return 39;case 70:return 40;
case 71:return 18;case 72:return 192;case 73:return 220;case 74:return 8;case 75:return 20;case 76:return 188;case 77:return 15;case 78:return 17;case 79:return 46;case 80:return 35;case 81:return 13;case 82:return 187;case 83:return 27;case 84:return 36;case 85:return 45;case 86:return 219;case 87:return 189;case 88:return 34;case 89:return 33;case 90:return 190;case 91:return 222;case 92:return 221;case 93:return 186;case 94:return 16;case 95:return 191;case 96:return 32;case 97:return 9;case 98:return 16777234;
case 99:return 16777247;case 100:return a[2]}};var Lc=function(){this._tickables=[]};h["flambe.platform.MainLoop"]=Lc;Lc.__name__=!0;Lc.updateEntity=function(a,b){var c=a._compMap.SpeedAdjuster_17;if(null!=c&&(c._realDt=b,b*=c.scale._value,0>=b)){c.onUpdate(b);return}for(c=a.firstComponent;null!=c;){var d=c.next;0==(c._flags&1)&&(c._flags|=1,c.onStart());c.onUpdate(b);c=d}for(c=a.firstChild;null!=c;)d=c.next,Lc.updateEntity(c,b),c=d};Lc.prototype={update:function(a){if(!(0>=a)){1<a&&(a=1);for(var b=
0;b<this._tickables.length;){var c=this._tickables[b];null==c||c.update(a)?this._tickables.splice(b,1):++b}s.volume.update(a);Lc.updateEntity(s.root,a)}},render:function(a){var b=a.graphics;null!=b&&(a.willRender(),N.render(s.root,b),a.didRender())},addTickable:function(a){this._tickables.push(a)},removeTickable:function(a){a=this._tickables.indexOf(a);0<=a&&(this._tickables[a]=null)},__class__:Lc};var ig=function(){};h["flambe.platform.MathUtil"]=ig;ig.__name__=!0;ig.nextPowerOfTwo=function(a){for(var b=
1;b<a;)b<<=1;return b};var eg=function(){};h["flambe.platform.MouseCodes"]=eg;eg.__name__=!0;eg.toButton=function(a){switch(a){case 0:return Y.Left;case 1:return Y.Middle;case 2:return Y.Right}return Y.Unknown(a)};var Ie=function(){};h["flambe.platform.TextureRoot"]=Ie;Ie.__name__=!0;Ie.prototype={__class__:Ie};var Je=function(){};h["flambe.platform.Tickable"]=Je;Je.__name__=!0;Je.prototype={__class__:Je};var Ke=function(a,b){this._firstDraw=!1;this._canvasCtx=a.getContext("2d",{alpha:b})};h["flambe.platform.html.CanvasGraphics"]=
Ke;Ke.__name__=!0;Ke.__interfaces__=[re];Ke.prototype={save:function(){this._canvasCtx.save()},translate:function(a,b){this._canvasCtx.translate(a|0,b|0)},scale:function(a,b){this._canvasCtx.scale(a,b)},rotate:function(a){this._canvasCtx.rotate(3.141592653589793*a/180)},transform:function(a,b,c,d,e,f){this._canvasCtx.transform(a,b,c,d,e,f)},restore:function(){this._canvasCtx.restore()},drawTexture:function(a,b,c){this.drawSubTexture(a,b,c,0,0,a.get_width(),a.get_height())},drawSubTexture:function(a,
b,c,d,e,f,q){this._firstDraw?(this._firstDraw=!1,this._canvasCtx.globalCompositeOperation="copy",this.drawSubTexture(a,b,c,d,e,f,q),this._canvasCtx.globalCompositeOperation="source-over"):this._canvasCtx.drawImage(a.root.image,a.rootX+d|0,a.rootY+e|0,f|0,q|0,b|0,c|0,f|0,q|0)},fillRect:function(a,b,c,d,e){if(this._firstDraw)this._firstDraw=!1,this._canvasCtx.globalCompositeOperation="copy",this.fillRect(a,b,c,d,e),this._canvasCtx.globalCompositeOperation="source-over";else{for(a=(16777215&a).toString(16);6>
a.length;)a="0"+y.string(a);this._canvasCtx.fillStyle="#"+y.string(a);this._canvasCtx.fillRect(b|0,c|0,d|0,e|0)}},multiplyAlpha:function(a){this._canvasCtx.globalAlpha*=a},setBlendMode:function(a){var b;switch(a[1]){case 0:b="source-over";break;case 1:b="lighter";break;case 2:b="multiply";break;case 3:b="screen";break;case 4:b="destination-in";break;case 5:b="copy"}this._canvasCtx.globalCompositeOperation=b},applyScissor:function(a,b,c,d){this._canvasCtx.beginPath();this._canvasCtx.rect(a|0,b|0,c|
0,d|0);this._canvasCtx.clip()},willRender:function(){this._firstDraw=!0},didRender:function(){},onResize:function(){},__class__:Ke};var $b=function(a){this.graphics=new Ke(a,!1);this._hasGPU=new Aa(!0)};h["flambe.platform.html.CanvasRenderer"]=$b;$b.__name__=!0;$b.__interfaces__=[Gd];$b.prototype={get_type:function(){return Ra.Canvas},createTextureFromImage:function(a){a=new Yd($b.CANVAS_TEXTURES?J.createCanvas(a):a);return a.createTexture(a.width,a.height)},getCompressedTextureFormats:function(){return[]},
createCompressedTexture:function(){return null},willRender:function(){this.graphics.willRender()},didRender:function(){this.graphics.didRender()},__class__:$b};var Le=function(a,b,c){Nc.call(this,a,b,c)};h["flambe.platform.html.CanvasTexture"]=Le;Le.__name__=!0;Le.__super__=Nc;Le.prototype=t(Nc.prototype,{__class__:Le});var Yd=function(a){this._graphics=null;this._disposed=!1;this.image=a;this.width=a.width;this.height=a.height};h["flambe.platform.html.CanvasTextureRoot"]=Yd;Yd.__name__=!0;Yd.__interfaces__=
[Ie];Yd.__super__=Fa;Yd.prototype=t(Fa.prototype,{createTexture:function(a,b){return new Le(this,a,b)},onDisposed:function(){this._graphics=this.image=null},__class__:Yd});var P=function(a,b){$c.call(this,a,b)};h["flambe.platform.html.HtmlAssetPackLoader"]=P;P.__name__=!0;P.detectImageFormats=function(a){var b=[p.PNG,p.JPG,p.GIF],c=2,d;d=window.document.createElement("img");d.onload=d.onerror=function(){1==d.width&&b.unshift(p.WEBP);--c;0==c&&a(b)};d.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==";
var e;e=window.document.createElement("img");e.onload=e.onerror=function(){1==e.width&&b.unshift(p.JXR);--c;0==c&&a(b)};e.src="data:image/vnd.ms-photo;base64,SUm8AQgAAAAFAAG8AQAQAAAASgAAAIC8BAABAAAAAQAAAIG8BAABAAAAAQAAAMC8BAABAAAAWgAAAMG8BAABAAAAHwAAAAAAAAAkw91vA07+S7GFPXd2jckNV01QSE9UTwAZAYBxAAAAABP/gAAEb/8AAQAAAQAAAA=="};P.detectAudioFormats=function(){var a;a=window.document.createElement("audio");if(null==a||null==n(a,a.canPlayType))return[];var b=new ya("\\b(iPhone|iPod|iPad|Android|Windows Phone)\\b",
""),c=window.navigator.userAgent;if(!ea.get_supported()&&b.match(c))return[];for(var b=[{format:p.M4A,mimeType:"audio/mp4; codecs=mp4a"},{format:p.MP3,mimeType:"audio/mpeg"},{format:p.OPUS,mimeType:"audio/ogg; codecs=opus"},{format:p.OGG,mimeType:"audio/ogg; codecs=vorbis"},{format:p.WAV,mimeType:"audio/wav"}],c=[],d=0;d<b.length;){var e=b[d];++d;var f="";try{f=a.canPlayType(e.mimeType)}catch(q){}""!=f&&c.push(e.format)}return c};P.supportsBlob=function(){if(P._detectBlobSupport){P._detectBlobSupport=
!1;if((new ya("\\bSilk\\b","")).match(window.navigator.userAgent)||null==window.Blob)return!1;var a=new XMLHttpRequest;a.open("GET",".",!0);if(""!=a.responseType)return!1;a.responseType="blob";if("blob"!=a.responseType)return!1;P._URL=J.loadExtension("URL").value}return null!=P._URL&&null!=P._URL.createObjectURL};P.__super__=$c;P.prototype=t($c.prototype,{loadEntry:function(a,b){var c=this;switch(b.format[1]){case 0:case 1:case 2:case 3:case 4:var d;d=window.document.createElement("img");var e=new Xd;
e.addDisposingListener(d,"load",function(){P.supportsBlob()&&P._URL.revokeObjectURL(d.src);var a=c._platform.getRenderer().createTextureFromImage(d);null!=a?c.handleLoad(b,a):c.handleTextureError(b)});e.addDisposingListener(d,"error",function(){c.handleError(b,"Failed to load image")});P.supportsBlob()?this.download(a,b,"blob",function(a){d.src=P._URL.createObjectURL(a)}):d.src=a;break;case 5:case 6:case 7:this.download(a,b,"arraybuffer",function(){var a=c._platform.getRenderer().createCompressedTexture(b.format,
null);null!=a?c.handleLoad(b,a):c.handleTextureError(b)});break;case 8:case 9:case 10:case 11:case 12:if(ea.get_supported())this.download(a,b,"arraybuffer",function(a){ea.ctx.decodeAudioData(a,function(a){c.handleLoad(b,new ea(a));return!0},function(){c.handleLoad(b,M.getInstance());return!1})});else{var f;f=window.document.createElement("audio");f.preload="auto";var q=++P._mediaRefCount;null==P._mediaElements&&(P._mediaElements=new oc);P._mediaElements.set(q,f);e=new Xd;e.addDisposingListener(f,
"canplaythrough",function(){P._mediaElements.remove(q);c.handleLoad(b,new Zd(f))});e.addDisposingListener(f,"error",function(){P._mediaElements.remove(q);var a=f.error.code;3==a||4==a?c.handleLoad(b,M.getInstance()):c.handleError(b,"Failed to load audio: "+f.error.code)});e.addListener(f,"progress",function(){if(0<f.buffered.length&&0<f.duration){var a=f.buffered.end(0)/f.duration;c.handleProgress(b,a*b.bytes|0)}});f.src=a;f.load()}break;case 13:this.download(a,b,"text",function(a){c.handleLoad(b,
new rd(a))})}},getAssetFormats:function(a){var b=this;null==P._supportedFormats&&(P._supportedFormats=new Fe,P.detectImageFormats(function(a){P._supportedFormats.set_result(b._platform.getRenderer().getCompressedTextureFormats().concat(a).concat(P.detectAudioFormats()).concat([p.Data]))}));P._supportedFormats.get(a)},download:function(a,b,c,d){var e=this,f=null,q=null,g=0,i=!1,h=function(){i&&(i=!1,window.clearInterval(g))},k=3,o=function(){--k;return 0<=k?(q(),!0):!1},q=function(){h();null!=f&&f.abort();
f=new XMLHttpRequest;f.open("GET",a,!0);f.responseType=c;var q=0;f.onprogress=function(a){i||(i=!0,g=window.setInterval(function(){4!=f.readyState&&5E3<Date.now()-q&&!o()&&(h(),e.handleError(b,"Download stalled"))},1E3));q=Date.now();e.handleProgress(b,a.loaded)};f.onerror=function(){if(0!=f.status||!o())h(),e.handleError(b,"HTTP error "+f.status)};f.onload=function(){var a=f.response;null==a&&(a=f.responseText);h();d(a)};f.send()};q()},__class__:P});var pe=function(a,b){Ka.call(this,a);this._canvas=
b};h["flambe.platform.html.HtmlMouse"]=pe;pe.__name__=!0;pe.__super__=Ka;pe.prototype=t(Ka.prototype,{__class__:pe});var Zd=function(a){this._disposed=!1;this.audioElement=a};h["flambe.platform.html.HtmlSound"]=Zd;Zd.__name__=!0;Zd.__interfaces__=[ad];Zd.__super__=Fa;Zd.prototype=t(Fa.prototype,{play:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=1);return new sd(this,a,!1,b,c)},loop:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=1);return new sd(this,a,!0,b,c)},get_duration:function(){return this.audioElement.duration},
onDisposed:function(){this.audioElement=null},__class__:Zd});var sd=function(a,b,c,d,e){null==e&&(e=0);null==d&&(d=0);this._waitingToSeek=!1;this._playOffset=this._playDuration=0;this._loop=!1;var f=this;this._sound=a;this._loop=c;this._playOffset=na.clamp(d,0,a.get_duration());this._playDuration=na.max(0,na.min(e,a.get_duration()));0==this._playDuration&&!this._loop&&(this._playDuration=a.get_duration()-this._playOffset);this._waitingToSeek=0<this._playOffset;this._tickableAdded=!1;this._clonedElement=
window.document.createElement("audio");this._clonedElement.loop=this._loop&&0==d&&0==e;this._clonedElement.src=a.audioElement.src;this.volume=new z(b,function(){f.updateVolume()});this.updateVolume();this._complete=new Aa(!1);this.playAudio();s.hidden._value&&this.set_paused(!0)};h["flambe.platform.html._HtmlSound.HtmlPlayback"]=sd;sd.__name__=!0;sd.__interfaces__=[Je,Fd];sd.prototype={set_paused:function(a){this._clonedElement.paused!=a&&(a?this._clonedElement.pause():this.playAudio());return a},
get_complete:function(){return this._complete},update:function(a){this.volume.update(a);this._complete.set__(this._clonedElement.ended);if(this._waitingToSeek)if(this.canSeekToOffset())this._waitingToSeek=!1,this._clonedElement.currentTime=this._playOffset,this.set_paused(!1);else return!1;if(this._complete._value||this._clonedElement.paused)return this._tickableAdded=!1,this._volumeBinding.dispose(),this._hideBinding.dispose(),!0;var a=this._clonedElement.currentTime,b=this._playOffset+this._playDuration;
this._loop&&!this._clonedElement.loop?a>=b&&(this._clonedElement.currentTime=this._playOffset):!this._loop&&0<this._playDuration&&a>=b&&(this._complete.set__(!0),this.dispose());return!1},dispose:function(){lc.instance.mainLoop.removeTickable(this);this._tickableAdded=!1;this.set_paused(!0);this._waitingToSeek=!1;this._sound=this._clonedElement=this._complete=null;null!=this._volumeBinding&&(this._volumeBinding.dispose(),this._volumeBinding=null);null!=this._hideBinding&&(this._hideBinding.dispose(),
this._hideBinding=null)},playAudio:function(){var a=this;this._clonedElement.play();0<this._playOffset&&(this.canSeekToOffset()?(this._waitingToSeek=!1,this._clonedElement.currentTime=this._playOffset):(this._waitingToSeek=!0,this._clonedElement.paused||this.set_paused(!0)));this._tickableAdded||(lc.instance.mainLoop.addTickable(this),this._tickableAdded=!0,this._volumeBinding=s.volume.get_changed().connect(function(){a.updateVolume()}),this._hideBinding=s.hidden.get_changed().connect(function(b){b?
(a._wasPaused=a._clonedElement.paused,a.set_paused(!0)):a.set_paused(a._wasPaused)}))},canSeekToOffset:function(){if(1<=this._clonedElement.readyState)for(var a=this._clonedElement.seekable.length,b=this._clonedElement.seekable,c=0;c<a;){var d=c++,e=b.start(d),d=b.end(d);if(e<=this._playOffset&&this._playOffset<d)return!0}return!1},updateVolume:function(){this._clonedElement.volume=s.volume._value*this.volume._value},__class__:sd};var jg=function(){};h["flambe.subsystem.StageSystem"]=jg;jg.__name__=
!0;jg.prototype={__class__:jg};var mc=function(a){var b=this;this._canvas=a;this.resize=new nc;this.scaleFactor=mc.computeScaleFactor();1!=this.scaleFactor&&(J.setVendorStyle(this._canvas,"transform-origin","top left"),J.setVendorStyle(this._canvas,"transform","scale("+1/this.scaleFactor+")"));J.SHOULD_HIDE_MOBILE_BROWSER&&(window.addEventListener("orientationchange",function(){J.callLater(n(b,b.hideMobileBrowser),200)},!1),this.hideMobileBrowser());window.addEventListener("resize",n(this,this.onWindowResize),
!1);this.onWindowResize(null);this.orientation=new Aa(null);null!=window.orientation&&(window.addEventListener("orientationchange",n(this,this.onOrientationChange),!1),this.onOrientationChange(null));this.fullscreen=new Aa(!1);J.addVendorListener(window.document,"fullscreenchange",function(){b.updateFullscreen()},!1);this.updateFullscreen()};h["flambe.platform.html.HtmlStage"]=mc;mc.__name__=!0;mc.__interfaces__=[jg];mc.computeScaleFactor=function(){var a=window.devicePixelRatio;null==a&&(a=1);var b=
window.document.createElement("canvas").getContext("2d"),b=J.loadExtension("backingStorePixelRatio",b).value;null==b&&(b=1);a/=b;b=window.screen.height;return 1136<a*window.screen.width||1136<a*b?1:a};mc.prototype={get_width:function(){return this._canvas.width},get_height:function(){return this._canvas.height},requestFullscreen:function(a){null==a&&(a=!0);if(a){var a=window.document.documentElement,b=J.loadFirstExtension(["requestFullscreen","requestFullScreen"],a).value;null!=b&&b.apply(a,[])}else a=
J.loadFirstExtension(["cancelFullscreen","cancelFullScreen"],window.document).value,null!=a&&ha.callMethod(window.document,a,[])},onWindowResize:function(){var a=this._canvas.parentElement.getBoundingClientRect();this.resizeCanvas(a.width,a.height)},resizeCanvas:function(a,b){var c=this.scaleFactor*a,d=this.scaleFactor*b;if(this._canvas.width==c&&this._canvas.height==d)return!1;this._canvas.width=c|0;this._canvas.height=d|0;this.resize.emit();return!0},hideMobileBrowser:function(){var a=this,b=window.document.documentElement.style;
b.height=window.innerHeight+100+"px";b.width=window.innerWidth+"px";b.overflow="visible";J.callLater(function(){J.hideMobileBrowser();J.callLater(function(){b.height=window.innerHeight+"px";a.onWindowResize(null)},100)})},onOrientationChange:function(){this.orientation.set__(J.orientation(window.orientation))},updateFullscreen:function(){this.fullscreen.set__(!0==J.loadFirstExtension(["fullscreen","fullScreen","isFullScreen"],window.document).value)},__class__:mc};var J=function(){};h["flambe.platform.html.HtmlUtil"]=
J;J.__name__=!0;J.callLater=function(a,b){null==b&&(b=0);window.setTimeout(a,b)};J.hideMobileBrowser=function(){window.scrollTo(1,0)};J.loadExtension=function(a,b){null==b&&(b=window);var c=ha.field(b,a);if(null!=c)return{prefix:"",field:a,value:c};for(var c=a.charAt(0).toUpperCase()+F.substr(a,1,null),d=0,e=J.VENDOR_PREFIXES;d<e.length;){var f=e[d];++d;var q=f+c,g=ha.field(b,q);if(null!=g)return{prefix:f,field:q,value:g}}return{prefix:null,field:null,value:null}};J.loadFirstExtension=function(a,
b){for(var c=0;c<a.length;){var d=a[c];++c;d=J.loadExtension(d,b);if(null!=d.field)return d}return{prefix:null,field:null,value:null}};J.polyfill=function(a,b){null==b&&(b=window);var c=J.loadExtension(a,b).value;if(null==c)return!1;b[a]=c;return!0};J.setVendorStyle=function(a,b,c){for(var a=a.style,d=0,e=J.VENDOR_PREFIXES;d<e.length;){var f=e[d];++d;a.setProperty("-"+f+"-"+b,c)}a.setProperty(b,c)};J.addVendorListener=function(a,b,c,d){for(var e=0,f=J.VENDOR_PREFIXES;e<f.length;){var q=f[e];++e;a.addEventListener(q+
b,c,d)}a.addEventListener(b,c,d)};J.orientation=function(a){switch(a){case -90:case 90:return Wa.Landscape;default:return Wa.Portrait}};J.createEmptyCanvas=function(a,b){var c;c=window.document.createElement("canvas");c.width=a;c.height=b;return c};J.createCanvas=function(a){var b=J.createEmptyCanvas(a.width,a.height),c=b.getContext("2d");c.save();c.globalCompositeOperation="copy";c.drawImage(a,0,0);c.restore();return b};J.detectSlowDriver=function(a){if(0<=window.navigator.platform.indexOf("Win")&&
null!=window.chrome){for(var b=0,a=a.getSupportedExtensions();b<a.length;){var c=a[b];++b;if(0<=c.indexOf("WEBGL_compressed_texture"))return!1}return!0}return!1};J.fixAndroidMath=function(){if(0<=window.navigator.userAgent.indexOf("Linux; U; Android 4")){var a=Math.sin,b=Math.cos;Math.sin=function(b){return 0==b?0:a(b)};Math.cos=function(a){return 0==a?1:b(a)}}};var ea=function(a){this._disposed=!1;this.buffer=a};h["flambe.platform.html.WebAudioSound"]=ea;ea.__name__=!0;ea.__interfaces__=[ad];ea.get_supported=
function(){if(ea._detectSupport){ea._detectSupport=!1;var a=J.loadExtension("AudioContext").value;null!=a&&(ea.ctx=new a,ea.gain=ea.createGain(),ea.gain.connect(ea.ctx.destination),s.volume.watch(function(a){ea.gain.gain.value=a}))}return null!=ea.ctx};ea.createGain=function(){var a;try{a=ea.ctx.createGain()}catch(b){a="createGainNode".apply(ea.ctx,[])}return a};ea.start=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==a.start?a.noteOn(b,c,d):a.start(b,c,d)};ea.__super__=Fa;ea.prototype=t(Fa.prototype,
{play:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=1);return new bd(this,a,!1,b,c)},loop:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=1);return new bd(this,a,!0,b,c)},get_duration:function(){return this.buffer.duration},onDisposed:function(){this.buffer=null},__class__:ea});var bd=function(a,b,c,d,e){null==e&&(e=0);null==d&&(d=0);var f=this;this._sound=a;this._head=ea.gain;this._complete=new Aa(!1);this._sourceNode=ea.ctx.createBufferSource();this._sourceNode.buffer=a.buffer;
0>=d&&(d=0);0>=e&&(e=this._sourceNode.buffer.duration);if(this._sourceNode.loop=c)this._sourceNode.loopStart=d,this._sourceNode.loopEnd=Math.min(d+e,this._sourceNode.buffer.duration);this._sourceNode.onended=function(){f._complete.set__(!0);f.dispose()};ea.start(this._sourceNode,0,d,e);this.playAudio();this.volume=new z(b,function(a){f.setVolume(a)});1!=b&&this.setVolume(b);s.hidden._value&&this.set_paused(!0)};h["flambe.platform.html._WebAudioSound.WebAudioPlayback"]=bd;bd.__name__=!0;bd.__interfaces__=
[Je,Fd];bd.prototype={set_paused:function(a){a!=0<=this._pausedAt&&(a?(this._sourceNode.disconnect(),this._pausedAt=this.get_position()):this.playAudio());return a},get_complete:function(){return this._complete},get_position:function(){return this._complete._value?this._sound.get_duration():0<=this._pausedAt?this._pausedAt:(ea.ctx.currentTime-this._startedAt)%this._sound.get_duration()},update:function(a){this.volume.update(a);if(this._complete._value||0<=this._pausedAt)return this._tickableAdded=
!1,this._hideBinding.dispose(),!0;3==this._sourceNode.playbackState&&(this._complete.set__(!0),this.dispose());return!1},dispose:function(){this.set_paused(!0);this._tickableAdded&&(this._tickableAdded=!1,lc.instance.mainLoop.removeTickable(this));null!=this._hideBinding&&this._hideBinding.dispose();null!=this._gainNode&&this._gainNode.disconnect();this.volume=this._complete=this._gainNode=this._sourceNode=this._hideBinding=null},setVolume:function(a){null==this._gainNode&&(this._gainNode=ea.createGain(),
this.insertNode(this._gainNode));this._gainNode.gain.value=a},insertNode:function(a){0<=this._pausedAt||(this._sourceNode.disconnect(),this._sourceNode.connect(a));a.connect(this._head);this._head=a},playAudio:function(){var a=this;this._sourceNode.connect(this._head);this._startedAt=ea.ctx.currentTime;this._pausedAt=-1;this._tickableAdded||(lc.instance.mainLoop.addTickable(this),this._tickableAdded=!0,this._hideBinding=s.hidden.get_changed().connect(function(b){b?(a._wasPaused=0<=a._pausedAt,a.set_paused(!0)):
a.set_paused(a._wasPaused)}))},__class__:bd};var kg=function(a){this._quads=this._maxQuads=this._dataOffset=this._backbufferWidth=this._backbufferHeight=0;this._pendingSetScissor=!1;this._lastBlendMode=this._lastRenderTarget=this._lastShader=this._lastTexture=this._lastScissor=this._currentBlendMode=this._currentShader=this._currentTexture=this._currentRenderTarget=null;this._gl=a;a.clearColor(0,0,0,0);a.enable(3042);a.pixelStorei(37441,1);this._vertexBuffer=a.createBuffer();a.bindBuffer(34962,this._vertexBuffer);
this._quadIndexBuffer=a.createBuffer();a.bindBuffer(34963,this._quadIndexBuffer);this._drawTextureShader=new Me(a);this._drawPatternShader=new Ne(a);this._fillRectShader=new Oe(a);this.resize(16)};h["flambe.platform.html.WebGLBatcher"]=kg;kg.__name__=!0;kg.prototype={resizeBackbuffer:function(a,b){this._gl.viewport(0,0,a,b);this._backbufferWidth=a;this._backbufferHeight=b},willRender:function(){},didRender:function(){this.flush()},bindTexture:function(a){this.flush();this._currentTexture=this._lastTexture=
null;this._gl.bindTexture(3553,a)},deleteTexture:function(a){null!=this._lastTexture&&this._lastTexture.root==a&&(this.flush(),this._currentTexture=this._lastTexture=null);this._gl.deleteTexture(a.nativeTexture)},deleteFramebuffer:function(a){a==this._lastRenderTarget&&(this.flush(),this._currentRenderTarget=this._lastRenderTarget=null);this._gl.deleteFramebuffer(a.framebuffer)},prepareDrawTexture:function(a,b,c,d){d!=this._lastTexture&&(this.flush(),this._lastTexture=d);return this.prepareQuad(5,
a,b,c,this._drawTextureShader)},prepareFillRect:function(a,b,c){return this.prepareQuad(6,a,b,c,this._fillRectShader)},prepareQuad:function(a,b,c,d,e){b!=this._lastRenderTarget&&(this.flush(),this._lastRenderTarget=b);c!=this._lastBlendMode&&(this.flush(),this._lastBlendMode=c);e!=this._lastShader&&(this.flush(),this._lastShader=e);if(null!=d||null!=this._lastScissor)if(null==d||null==this._lastScissor||!this._lastScissor.equals(d))this.flush(),this._lastScissor=null!=d?d.clone(this._lastScissor):
null,this._pendingSetScissor=!0;this._quads>=this._maxQuads&&this.resize(this._maxQuads<<1);++this._quads;b=this._dataOffset;this._dataOffset+=a<<2;return b},flush:function(){if(!(1>this._quads)){this._lastRenderTarget!=this._currentRenderTarget&&this.bindRenderTarget(this._lastRenderTarget);if(this._lastBlendMode!=this._currentBlendMode){switch(this._lastBlendMode[1]){case 0:this._gl.blendFunc(1,771);break;case 1:this._gl.blendFunc(1,1);break;case 2:this._gl.blendFunc(774,771);break;case 3:this._gl.blendFunc(1,
769);break;case 4:this._gl.blendFunc(0,770);break;case 5:this._gl.blendFunc(1,0)}this._currentBlendMode=this._lastBlendMode}this._pendingSetScissor&&(null!=this._lastScissor?(this._gl.enable(3089),this._gl.scissor(this._lastScissor.x|0,this._lastScissor.y|0,this._lastScissor.width|0,this._lastScissor.height|0)):this._gl.disable(3089),this._pendingSetScissor=!1);this._lastTexture!=this._currentTexture&&(this._gl.bindTexture(3553,this._lastTexture.root.nativeTexture),this._currentTexture=this._lastTexture);
this._lastShader!=this._currentShader&&(this._lastShader.useProgram(),this._lastShader.prepare(),this._currentShader=this._lastShader);if(this._lastShader==this._drawPatternShader){var a=this._lastTexture,b=a.root;this._lastShader.setRegion(a.rootX/b.width,a.rootY/b.height,a._width/b.width,a._height/b.height)}this._gl.bufferData(34962,this.data.subarray(0,this._dataOffset),35040);this._gl.drawElements(4,6*this._quads,5123,0);this._dataOffset=this._quads=0}},resize:function(a){this.flush();if(!(1024<
a)){this._maxQuads=a;this.data=new Float32Array(6*(a<<2));this._gl.bufferData(34962,4*this.data.length,35040);for(var b=new Uint16Array(6*a),c=0;c<a;){var d=c++;b[6*d]=d<<2;b[6*d+1]=(d<<2)+1;b[6*d+2]=(d<<2)+2;b[6*d+3]=(d<<2)+2;b[6*d+4]=(d<<2)+3;b[6*d+5]=d<<2}this._gl.bufferData(34963,b,35044)}},bindRenderTarget:function(a){null!=a?(this._gl.bindFramebuffer(36160,a.framebuffer),this._gl.viewport(0,0,a.width,a.height)):(this._gl.bindFramebuffer(36160,null),this._gl.viewport(0,0,this._backbufferWidth,
this._backbufferHeight));this._lastRenderTarget=this._currentRenderTarget=a},__class__:kg};var ub=function(a,b){this._inverseProjection=this._stateList=null;null==ub._scratchQuadArray&&(ub._scratchQuadArray=new Float32Array(8));this._batcher=a;this._renderTarget=b};h["flambe.platform.html.WebGLGraphics"]=ub;ub.__name__=!0;ub.__interfaces__=[re];ub.prototype={save:function(){var a=this._stateList,b=this._stateList.next;null==b&&(b=new Pe,b.prev=a,a.next=b);a.matrix.clone(b.matrix);b.alpha=a.alpha;
b.blendMode=a.blendMode;b.scissor=null!=a.scissor?a.scissor.clone(b.scissor):null;this._stateList=b},translate:function(a,b){var c=this._stateList.matrix;c.m02+=c.m00*a+c.m01*b;c.m12+=c.m10*a+c.m11*b},scale:function(a,b){var c=this._stateList.matrix;c.m00*=a;c.m10*=a;c.m01*=b;c.m11*=b},rotate:function(a){var b=this._stateList.matrix,a=3.141592653589793*a/180,c=Math.sin(a),a=Math.cos(a),d=b.m00,e=b.m10,f=b.m01,q=b.m11;b.m00=d*a+f*c;b.m10=e*a+q*c;b.m01=f*a-d*c;b.m11=q*a-e*c},transform:function(a,b,
c,d,e,f){var q=this._stateList;ub._scratchMatrix.set(a,b,c,d,e,f);Pa.multiply(q.matrix,ub._scratchMatrix,q.matrix)},restore:function(){this._stateList=this._stateList.prev},drawTexture:function(a,b,c){this.drawSubTexture(a,b,c,0,0,a.get_width(),a.get_height())},drawSubTexture:function(a,b,c,d,e,f,q){var g=this._stateList,i=a.root,b=this.transformQuad(b,c,f,q),c=i.width,i=i.height,d=(a.rootX+d)/c,e=(a.rootY+e)/i,f=d+f/c,q=e+q/i,c=g.alpha,a=this._batcher.prepareDrawTexture(this._renderTarget,g.blendMode,
g.scissor,a),g=this._batcher.data;g[a]=b[0];g[++a]=b[1];g[++a]=d;g[++a]=e;g[++a]=c;g[++a]=b[2];g[++a]=b[3];g[++a]=f;g[++a]=e;g[++a]=c;g[++a]=b[4];g[++a]=b[5];g[++a]=f;g[++a]=q;g[++a]=c;g[++a]=b[6];g[++a]=b[7];g[++a]=d;g[++a]=q;g[++a]=c},fillRect:function(a,b,c,d,e){var f=this._stateList,b=this.transformQuad(b,c,d,e),c=(a&16711680)/16711680,d=(a&65280)/65280,a=(a&255)/255,e=f.alpha,f=this._batcher.prepareFillRect(this._renderTarget,f.blendMode,f.scissor),q=this._batcher.data;q[f]=b[0];q[++f]=b[1];
q[++f]=c;q[++f]=d;q[++f]=a;q[++f]=e;q[++f]=b[2];q[++f]=b[3];q[++f]=c;q[++f]=d;q[++f]=a;q[++f]=e;q[++f]=b[4];q[++f]=b[5];q[++f]=c;q[++f]=d;q[++f]=a;q[++f]=e;q[++f]=b[6];q[++f]=b[7];q[++f]=c;q[++f]=d;q[++f]=a;q[++f]=e},multiplyAlpha:function(a){this._stateList.alpha*=a},setBlendMode:function(a){this._stateList.blendMode=a},applyScissor:function(a,b,c,d){var e=this._stateList,f=ub._scratchQuadArray;f[0]=a;f[1]=b;f[2]=a+c;f[3]=b+d;e.matrix.transformArray(f,4,f);this._inverseProjection.transformArray(f,
4,f);a=f[0];b=f[1];c=f[2]-a;d=f[3]-b;0>c&&(a+=c,c=-c);0>d&&(b+=d,d=-d);e.applyScissor(a,b,c,d)},willRender:function(){this._batcher.willRender()},didRender:function(){this._batcher.didRender()},onResize:function(a,b){this._stateList=new Pe;var c;c=null!=this._renderTarget?-1:1;this._stateList.matrix.set(2/a,0,0,-2*c/b,-1,c);this._inverseProjection=new Pa;this._inverseProjection.set(2/a,0,0,2/b,-1,-1);this._inverseProjection.invert()},transformQuad:function(a,b,c,d){var c=a+c,d=b+d,e=ub._scratchQuadArray;
e[0]=a;e[1]=b;e[2]=c;e[3]=b;e[4]=c;e[5]=d;e[6]=a;e[7]=d;this._stateList.matrix.transformArray(e,8,e);return e},__class__:ub};var Pe=function(){this.scissor=this.prev=this.next=null;this.matrix=new Pa;this.alpha=1;this.blendMode=Q.Normal};h["flambe.platform.html._WebGLGraphics.DrawingState"]=Pe;Pe.__name__=!0;Pe.prototype={applyScissor:function(a,b,c,d){if(null!=this.scissor)var e=na.max(this.scissor.x,a),f=na.max(this.scissor.y,b),c=na.min(this.scissor.x+this.scissor.width,a+c),d=na.min(this.scissor.y+
this.scissor.height,b+d),a=e,b=f,c=c-e,d=d-f;else this.scissor=new Dd;this.scissor.set(Math.round(a),Math.round(b),Math.round(c),Math.round(d))},__class__:Pe};var we=function(a,b){var c=this;this._hasGPU=new Aa(!0);this.gl=b;b.canvas.addEventListener("webglcontextlost",function(a){a.preventDefault();c._hasGPU.set__(!1)},!1);b.canvas.addEventListener("webglcontextrestore",function(){c.init();c._hasGPU.set__(!0)},!1);a.resize.connect(n(this,this.onResize));this.init()};h["flambe.platform.html.WebGLRenderer"]=
we;we.__name__=!0;we.__interfaces__=[Gd];we.prototype={get_type:function(){return Ra.WebGL},createTextureFromImage:function(a){if(this.gl.isContextLost())return null;var b=new td(this,a.width,a.height);b.uploadImageData(a);return b.createTexture(a.width,a.height)},getCompressedTextureFormats:function(){return[]},createCompressedTexture:function(){this.gl.isContextLost();return null},willRender:function(){this.graphics.willRender()},didRender:function(){this.graphics.didRender()},onResize:function(){var a=
this.gl.canvas.width,b=this.gl.canvas.height;this.batcher.resizeBackbuffer(a,b);this.graphics.onResize(a,b)},init:function(){this.batcher=new kg(this.gl);this.graphics=new ub(this.batcher,null);this.onResize()},__class__:we};var Qe=function(a,b,c){Nc.call(this,a,b,c)};h["flambe.platform.html.WebGLTexture"]=Qe;Qe.__name__=!0;Qe.__super__=Nc;Qe.prototype=t(Nc.prototype,{__class__:Qe});var td=function(a,b,c){this.framebuffer=this._graphics=null;this._disposed=!1;this._renderer=a;this.width=na.max(2,
ig.nextPowerOfTwo(b));this.height=na.max(2,ig.nextPowerOfTwo(c));b=a.gl;this.nativeTexture=b.createTexture();a.batcher.bindTexture(this.nativeTexture);b.texParameteri(3553,10242,33071);b.texParameteri(3553,10243,33071);b.texParameteri(3553,10240,9729);b.texParameteri(3553,10241,9729)};h["flambe.platform.html.WebGLTextureRoot"]=td;td.__name__=!0;td.__interfaces__=[Ie];td.drawBorder=function(a,b,c){var d=a.getContext("2d");d.drawImage(a,b-1,0,1,c,b,0,1,c);d.drawImage(a,0,c-1,b,1,0,c,b,1)};td.__super__=
Fa;td.prototype=t(Fa.prototype,{createTexture:function(a,b){return new Qe(this,a,b)},uploadImageData:function(a){if(this.width!=a.width||this.height!=a.height){var b=J.createEmptyCanvas(this.width,this.height);b.getContext("2d").drawImage(a,0,0);td.drawBorder(b,a.width,a.height);a=b}this._renderer.batcher.bindTexture(this.nativeTexture);this._renderer.gl.texImage2D(3553,0,6408,6408,5121,a)},onDisposed:function(){var a=this._renderer.batcher;a.deleteTexture(this);null!=this.framebuffer&&a.deleteFramebuffer(this);
this._graphics=this.framebuffer=this.nativeTexture=null},__class__:td});var sa=function(a,b,c){c="#ifdef GL_ES\nprecision mediump float;\n#endif\n"+c;this._gl=a;this._program=a.createProgram();a.attachShader(this._program,sa.createShader(a,35633,b));a.attachShader(this._program,sa.createShader(a,35632,c));a.linkProgram(this._program);a.useProgram(this._program)};h["flambe.platform.shader.ShaderGL"]=sa;sa.__name__=!0;sa.createShader=function(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);
return b};sa.prototype={useProgram:function(){this._gl.useProgram(this._program)},prepare:function(){null},getAttribLocation:function(a){return this._gl.getAttribLocation(this._program,a)},getUniformLocation:function(a){return this._gl.getUniformLocation(this._program,a)},__class__:sa};var Ne=function(a){sa.call(this,a,"attribute highp vec2 a_pos;\nattribute mediump vec2 a_uv;\nattribute lowp float a_alpha;\nvarying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nvoid main (void) {\nv_uv = a_uv;\nv_alpha = a_alpha;\ngl_Position = vec4(a_pos, 0, 1);\n}",
"varying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nuniform lowp sampler2D u_texture;\nuniform mediump vec4 u_region;\nvoid main (void) {\ngl_FragColor = texture2D(u_texture, u_region.xy + mod(v_uv, u_region.zw)) * v_alpha;\n}");this.a_pos=this.getAttribLocation("a_pos");this.a_uv=this.getAttribLocation("a_uv");this.a_alpha=this.getAttribLocation("a_alpha");this.u_texture=this.getUniformLocation("u_texture");this.u_region=this.getUniformLocation("u_region");this.setTexture(0)};h["flambe.platform.shader.DrawPatternGL"]=
Ne;Ne.__name__=!0;Ne.__super__=sa;Ne.prototype=t(sa.prototype,{setTexture:function(a){this._gl.uniform1i(this.u_texture,a)},prepare:function(){this._gl.enableVertexAttribArray(this.a_pos);this._gl.enableVertexAttribArray(this.a_uv);this._gl.enableVertexAttribArray(this.a_alpha);this._gl.vertexAttribPointer(this.a_pos,2,5126,!1,20,0);this._gl.vertexAttribPointer(this.a_uv,2,5126,!1,20,8);this._gl.vertexAttribPointer(this.a_alpha,1,5126,!1,20,16)},__class__:Ne});var Me=function(a){sa.call(this,a,"attribute highp vec2 a_pos;\nattribute mediump vec2 a_uv;\nattribute lowp float a_alpha;\nvarying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nvoid main (void) {\nv_uv = a_uv;\nv_alpha = a_alpha;\ngl_Position = vec4(a_pos, 0, 1);\n}",
"varying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nuniform lowp sampler2D u_texture;\nvoid main (void) {\ngl_FragColor = texture2D(u_texture, v_uv) * v_alpha;\n}");this.a_pos=this.getAttribLocation("a_pos");this.a_uv=this.getAttribLocation("a_uv");this.a_alpha=this.getAttribLocation("a_alpha");this.u_texture=this.getUniformLocation("u_texture");this.setTexture(0)};h["flambe.platform.shader.DrawTextureGL"]=Me;Me.__name__=!0;Me.__super__=sa;Me.prototype=t(sa.prototype,{setTexture:function(a){this._gl.uniform1i(this.u_texture,
a)},prepare:function(){this._gl.enableVertexAttribArray(this.a_pos);this._gl.enableVertexAttribArray(this.a_uv);this._gl.enableVertexAttribArray(this.a_alpha);this._gl.vertexAttribPointer(this.a_pos,2,5126,!1,20,0);this._gl.vertexAttribPointer(this.a_uv,2,5126,!1,20,8);this._gl.vertexAttribPointer(this.a_alpha,1,5126,!1,20,16)},__class__:Me});var Oe=function(a){sa.call(this,a,"attribute highp vec2 a_pos;\nattribute lowp vec3 a_rgb;\nattribute lowp float a_alpha;\nvarying lowp vec4 v_color;\nvoid main (void) {\nv_color = vec4(a_rgb*a_alpha, a_alpha);\ngl_Position = vec4(a_pos, 0, 1);\n}",
"varying lowp vec4 v_color;\nvoid main (void) {\ngl_FragColor = v_color;\n}");this.a_pos=this.getAttribLocation("a_pos");this.a_rgb=this.getAttribLocation("a_rgb");this.a_alpha=this.getAttribLocation("a_alpha")};h["flambe.platform.shader.FillRectGL"]=Oe;Oe.__name__=!0;Oe.__super__=sa;Oe.prototype=t(sa.prototype,{prepare:function(){this._gl.enableVertexAttribArray(this.a_pos);this._gl.enableVertexAttribArray(this.a_rgb);this._gl.enableVertexAttribArray(this.a_alpha);this._gl.vertexAttribPointer(this.a_pos,
2,5126,!1,24,0);this._gl.vertexAttribPointer(this.a_rgb,3,5126,!1,24,8);this._gl.vertexAttribPointer(this.a_alpha,1,5126,!1,24,20)},__class__:Oe});var lg=function(){this._transitor=null};h["flambe.scene.Director"]=lg;lg.__name__=!0;lg.__super__=E;lg.prototype=t(E.prototype,{get_name:function(){return"Director_15"},onAdded:function(){this.owner.addChild(this._root)},onRemoved:function(){this.completeTransition();for(var a=0,b=this.scenes;a<b.length;){var c=b[a];++a;c.dispose()}this.scenes=[];this.occludedScenes=
[];this._root.dispose()},onUpdate:function(a){null!=this._transitor&&this._transitor.update(a)&&this.completeTransition()},get_topScene:function(){var a=this.scenes.length;return 0<a?this.scenes[a-1]:null},show:function(a){a=a._compMap.Scene_16;null!=a&&a.shown.emit()},invalidateVisibility:function(){for(var a=this.scenes.length;0<a;){var b=this.scenes[--a]._compMap.Scene_16;if(null==b||b.opaque)break}this.occludedScenes=0<this.scenes.length?this.scenes.slice(a,this.scenes.length-1):[];a=this.get_topScene();
null!=a&&this.show(a)},completeTransition:function(){null!=this._transitor&&(this._transitor.complete(),this._transitor=null,this.invalidateVisibility())},__class__:lg});var Rg=function(){};h["flambe.scene._Director.Transitor"]=Rg;Rg.__name__=!0;Rg.prototype={update:function(a){return this._transition.update(a)},complete:function(){this._transition.complete();this._onComplete()},__class__:Rg};var mg=function(){};h["flambe.scene.Scene"]=mg;mg.__name__=!0;mg.__super__=E;mg.prototype=t(E.prototype,{get_name:function(){return"Scene_16"},
__class__:mg});var Sg=function(){};h["flambe.scene.Transition"]=Sg;Sg.__name__=!0;Sg.prototype={update:function(){return!0},complete:function(){},__class__:Sg};var $d=function(){};h["flambe.script.Action"]=$d;$d.__name__=!0;$d.prototype={__class__:$d};var ae=function(a,b,c,d){this._value=a;this._to=b;this._seconds=c;this._easing=d};h["flambe.script.AnimateTo"]=ae;ae.__name__=!0;ae.__interfaces__=[$d];ae.prototype={update:function(a){null==this._tween&&(this._tween=new nd(this._value._value,this._to,
this._seconds,this._easing),this._value.set_behavior(this._tween),this._value.update(a));if(this._value._behavior!=this._tween){var b=this._tween.elapsed-this._seconds;this._tween=null;return 0<b?Math.max(0,a-b):0}return-1},__class__:ae};var Re=function(a,b){null==b&&(b=-1);this._action=a;this._remaining=this._count=b};h["flambe.script.Repeat"]=Re;Re.__name__=!0;Re.__interfaces__=[$d];Re.prototype={update:function(a,b){if(0==this._count)return 0;var c=this._action.update(a,b);return 0<this._count&&
0<=c&&0==--this._remaining?(this._remaining=this._count,c):-1},__class__:Re};var Se=function(){E.call(this);this.stopAll()};h["flambe.script.Script"]=Se;Se.__name__=!0;Se.__super__=E;Se.prototype=t(E.prototype,{get_name:function(){return"Script_0"},run:function(a){a=new Te(a);this._handles.push(a);return a},stopAll:function(){this._handles=[]},onUpdate:function(a){for(var b=0;b<this._handles.length;){var c=this._handles[b];c.removed||0<=c.action.update(a,this.owner)?this._handles.splice(b,1):++b}},
__class__:Se});var Te=function(a){this.removed=!1;this.action=a};h["flambe.script._Script.Handle"]=Te;Te.__name__=!0;Te.__interfaces__=[Zb];Te.prototype={dispose:function(){this.removed=!0;this.action=null},__class__:Te};var Ue=function(a){this._idx=0;this._runningActions=null!=a?a.slice():[]};h["flambe.script.Sequence"]=Ue;Ue.__name__=!0;Ue.__interfaces__=[$d];Ue.prototype={update:function(a,b){for(var c=0;;){var d=this._runningActions[this._idx];if(null!=d)if(d=d.update(a-c,b),0<=d)c+=d;else return-1;
++this._idx;if(this._idx>=this._runningActions.length){this._idx=0;break}else if(c>a)return-1}return c},__class__:Ue};var Ve=function(){E.call(this);this._sounds=[]};h["flambe.sound.Mixer"]=Ve;Ve.__name__=!0;Ve.__super__=E;Ve.prototype=t(E.prototype,{get_name:function(){return"Mixer_10"},stopAll:function(){for(var a=0,b=this._sounds;a<b.length;){var c=b[a];++a;c.dispose()}},onRemoved:function(){this.stopAll();this._sounds=[]},__class__:Ve});var ng=function(){};h["flambe.sound._Mixer.MixerSound"]=
ng;ng.__name__=!0;ng.__interfaces__=[Zb,ad];ng.prototype={play:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=1);return this.playOrLoop(a,!1,b,c)},loop:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=1);return this.playOrLoop(a,!0,b,c)},playOrLoop:function(a,b,c,d){var e=this,f=this.findOpenChannel();if(0>f)return new Wd(this);a=b?this._source.loop(a,c,d):this._source.play(a,c,d);this._playbacks[f]=a;a.get_complete().get_changed().connect(function(){e._playbacks[f]=null}).once();
return a},findOpenChannel:function(){for(var a=0,b=this._channels;a<b;){var c=a++,d=this._playbacks[c];if(null==d||d.get_complete().get__())return c}return-1},dispose:function(){for(var a=0,b=this._playbacks;a<b.length;){var c=b[a];++a;c.dispose()}this._playbacks=[]},__class__:ng};var Ra=h["flambe.subsystem.RendererType"]={__ename__:!0,__constructs__:["Stage3D","WebGL","Canvas"]};Ra.Stage3D=["Stage3D",0];Ra.Stage3D.toString=l;Ra.Stage3D.__enum__=Ra;Ra.WebGL=["WebGL",1];Ra.WebGL.toString=l;Ra.WebGL.__enum__=
Ra;Ra.Canvas=["Canvas",2];Ra.Canvas.toString=l;Ra.Canvas.__enum__=Ra;Ra.__empty_constructs__=[Ra.Stage3D,Ra.WebGL,Ra.Canvas];var Og=function(){};h["flambe.util.Assert"]=Og;Og.__name__=!0;Og.that=function(){};var Bh=function(){};h["flambe.util.LogHandler"]=Bh;Bh.__name__=!0;var Fe=function(){this.success=new ca;this.error=new ca;this.progressChanged=new nc;this.hasResult=!1;this._total=this._progress=0};h["flambe.util.Promise"]=Fe;Fe.__name__=!0;Fe.prototype={set_result:function(a){if(this.hasResult)throw"Promise result already assigned";
this._result=a;this.hasResult=!0;this.success.emit(a);return a},get:function(a){return this.hasResult?(a(this._result),null):this.success.connect(a).once()},set_progress:function(a){this._progress!=a&&(this._progress=a,this.progressChanged.emit());return a},set_total:function(a){this._total!=a&&(this._total=a,this.progressChanged.emit());return a},__class__:Fe};var nc=function(a){X.call(this,a)};h["flambe.util.Signal0"]=nc;nc.__name__=!0;nc.__super__=X;nc.prototype=t(X.prototype,{connect:function(a,
b){null==b&&(b=!1);return this.connectImpl(a,b)},emit:function(){var a=this;this._head==X.DISPATCHING_SENTINEL?this.defer(function(){a.emitImpl()}):this.emitImpl()},emitImpl:function(){for(var a=this.willEmit(),b=a;null!=b;)b._listener(),b.stayInList||b.dispose(),b=b._next;this.didEmit(a)},__class__:nc});var Pf=function(a){this.next=null;this.fn=a};h["flambe.util._SignalBase.Task"]=Pf;Pf.__name__=!0;Pf.prototype={__class__:Pf};var fb=function(){};h["flambe.util.Strings"]=fb;fb.__name__=!0;fb.getFileExtension=
function(a){var b=a.lastIndexOf(".");return 0<b?F.substr(a,b+1,null):null};fb.removeFileExtension=function(a){var b=a.lastIndexOf(".");return 0<b?F.substr(a,0,b):a};fb.getUrlExtension=function(a){var b=a.lastIndexOf("?");0<=b&&(a=F.substr(a,0,b));b=a.lastIndexOf("/");0<=b&&(a=F.substr(a,b+1,null));return fb.getFileExtension(a)};fb.joinPath=function(a,b){0<a.length&&47!=a.charCodeAt(a.length-1)&&(a+="/");return a+b};fb.withFields=function(a,b){var c=b.length;if(0<c){for(var a=0<a.length?a+" [":a+"[",
d=0;d<c;){0<d&&(a+=", ");var e=b[d],f=b[d+1];if(y.is(f,Error)){var q=f.stack;null!=q&&(f=q)}a+=e+"="+y.string(f);d+=2}a+="]"}return a};var Mc=function(a){var b=this;this.id=setInterval(function(){b.run()},a)};h["haxe.Timer"]=Mc;Mc.__name__=!0;Mc.delay=function(a,b){var c=new Mc(b);c.run=function(){c.stop();a()};return c};Mc.stamp=function(){return(new Date).getTime()/1E3};Mc.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:Mc};var We=function(){};
h["haxe.ds.BalancedTree"]=We;We.__name__=!0;We.prototype={set:function(a,b){this.root=this.setLoop(a,b,this.root)},get:function(a){for(var b=this.root;null!=b;){var c=this.compare(a,b.key);if(0==c)return b.value;b=0>c?b.left:b.right}return null},setLoop:function(a,b,c){if(null==c)return new ta(null,a,b,null);var d=this.compare(a,c.key);if(0==d)return new ta(c.left,a,b,c.right,null==c?0:c._height);if(0>d)return this.balance(this.setLoop(a,b,c.left),c.key,c.value,c.right);a=this.setLoop(a,b,c.right);
return this.balance(c.left,c.key,c.value,a)},balance:function(a,b,c,d){var e;e=null==a?0:a._height;var f;f=null==d?0:d._height;return e>f+2?function(){var b=a.left;return null==b?0:b._height}(this)>=function(){var b=a.right;return null==b?0:b._height}(this)?new ta(a.left,a.key,a.value,new ta(a.right,b,c,d)):new ta(new ta(a.left,a.key,a.value,a.right.left),a.right.key,a.right.value,new ta(a.right.right,b,c,d)):f>e+2?function(){var a=d.right;return null==a?0:a._height}(this)>function(){var a=d.left;
return null==a?0:a._height}(this)?new ta(new ta(a,b,c,d.left),d.key,d.value,d.right):new ta(new ta(a,b,c,d.left.left),d.left.key,d.left.value,new ta(d.left.right,d.key,d.value,d.right)):new ta(a,b,c,d,(e>f?e:f)+1)},compare:function(a,b){return ha.compare(a,b)},__class__:We};var ta=function(a,b,c,d,e){null==e&&(e=-1);this.left=a;this.key=b;this.value=c;this.right=d;this._height=-1==e?(function(a){a=a.left;return null==a?0:a._height}(this)>function(a){a=a.right;return null==a?0:a._height}(this)?function(a){a=
a.left;return null==a?0:a._height}(this):function(a){a=a.right;return null==a?0:a._height}(this))+1:e};h["haxe.ds.TreeNode"]=ta;ta.__name__=!0;ta.prototype={__class__:ta};var Ud=function(){};h["haxe.ds.EnumValueMap"]=Ud;Ud.__name__=!0;Ud.__interfaces__=[Nf];Ud.__super__=We;Ud.prototype=t(We.prototype,{compare:function(a,b){var c=a[1]-b[1];if(0!=c)return c;var c=a.slice(2),d=b.slice(2);return 0==c.length&&0==d.length?0:this.compareArgs(c,d)},compareArgs:function(a,b){var c=a.length-b.length;if(0!=
c)return c;for(var c=0,d=a.length;c<d;){var e=c++,e=this.compareArg(a[e],b[e]);if(0!=e)return e}return 0},compareArg:function(a,b){return ha.isEnumValue(a)&&ha.isEnumValue(b)?this.compare(a,b):a instanceof Array&&null==a.__enum__&&b instanceof Array&&null==b.__enum__?this.compareArgs(a,b):ha.compare(a,b)},__class__:Ud});var oc=function(){this.h={}};h["haxe.ds.IntMap"]=oc;oc.__name__=!0;oc.__interfaces__=[Nf];oc.prototype={set:function(a,b){this.h[a]=b},get:function(a){return this.h[a]},exists:function(a){return this.h.hasOwnProperty(a)},
remove:function(a){if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},__class__:oc};var Fb=function(){this.h={}};h["haxe.ds.StringMap"]=Fb;Fb.__name__=!0;Fb.__interfaces__=[Nf];Fb.prototype={set:function(a,b){this.h["$"+a]=b},get:function(a){return this.h["$"+a]},exists:function(a){return this.h.hasOwnProperty("$"+a)},keys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(b.substr(1));return F.iter(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},
next:function(){return this.ref["$"+this.it.next()]}}},__class__:Fb};var Ch=function(){};h["haxe.io.Bytes"]=Ch;Ch.__name__=!0;var Tg=function(){};h["haxe.io.Eof"]=Tg;Tg.__name__=!0;Tg.prototype={toString:function(){return"Eof"},__class__:Tg};var Ng=function(){};h["haxe.rtti.Meta"]=Ng;Ng.__name__=!0;Ng.getType=function(a){a=a.__meta__;return null==a||null==a.obj?{}:a.obj};var Kc=function(){};h["haxe.xml.Parser"]=Kc;Kc.__name__=!0;Kc.parse=function(a){var b=D.createDocument();Kc.doParse(a,0,b);return b};
Kc.doParse=function(a,b,c){null==b&&(b=0);for(var d=null,e=1,f=1,q=null,g=0,i=0,h=0,k=a.charCodeAt(b),o=new oe;k==k;){switch(e){case 0:switch(k){case 10:case 13:case 9:case 32:break;default:e=f;continue}break;case 1:switch(k){case 60:e=0;f=2;break;default:g=b;e=13;continue}break;case 13:60==k?(f=D.createPCData(o.b+F.substr(a,g,b-g)),o=new oe,c.addChild(f),i++,e=0,f=2):38==k&&(o.addSub(a,g,b-g),e=18,f=13,g=b+1);break;case 17:93==k&&93==a.charCodeAt(b+1)&&62==a.charCodeAt(b+2)&&(e=D.createCData(F.substr(a,
g,b-g)),c.addChild(e),i++,b+=2,e=1);break;case 2:switch(k){case 33:if(91==a.charCodeAt(b+1)){b+=2;if("CDATA["!=F.substr(a,b,6).toUpperCase())throw"Expected <![CDATA[";b+=5;e=17}else if(68==a.charCodeAt(b+1)||100==a.charCodeAt(b+1)){if("OCTYPE"!=F.substr(a,b+2,6).toUpperCase())throw"Expected <!DOCTYPE";b+=8;e=16}else{if(45!=a.charCodeAt(b+1)||45!=a.charCodeAt(b+2))throw"Expected <\!--";b+=2;e=15}g=b+1;break;case 63:e=14;g=b;break;case 47:if(null==c)throw"Expected node name";g=b+1;e=0;f=10;break;default:e=
3;g=b;continue}break;case 3:if(!(97<=k&&122>=k||65<=k&&90>=k||48<=k&&57>=k||58==k||46==k||95==k||45==k)){if(b==g)throw"Expected node name";d=D.createElement(F.substr(a,g,b-g));c.addChild(d);e=0;f=4;continue}break;case 4:switch(k){case 47:e=11;i++;break;case 62:e=9;i++;break;default:e=5;g=b;continue}break;case 5:if(!(97<=k&&122>=k||65<=k&&90>=k||48<=k&&57>=k||58==k||46==k||95==k||45==k)){if(g==b)throw"Expected attribute name";q=F.substr(a,g,b-g);if(d.exists(q))throw"Duplicate attribute";e=0;f=6;continue}break;
case 6:switch(k){case 61:e=0;f=7;break;default:throw"Expected =";}break;case 7:switch(k){case 34:case 39:e=8;g=b;break;default:throw'Expected "';}break;case 8:k==a.charCodeAt(g)&&(f=F.substr(a,g+1,b-g-1),d.set(q,f),e=0,f=4);break;case 9:g=b=Kc.doParse(a,b,d);e=1;break;case 11:switch(k){case 62:e=1;break;default:throw"Expected >";}break;case 12:switch(k){case 62:return 0==i&&c.addChild(D.createPCData("")),b;default:throw"Expected >";}case 10:if(!(97<=k&&122>=k||65<=k&&90>=k||48<=k&&57>=k||58==k||46==
k||95==k||45==k)){if(g==b)throw"Expected node name";if(F.substr(a,g,b-g)!=c.get_nodeName())throw"Expected </"+c.get_nodeName()+">";e=0;f=12;continue}break;case 15:45==k&&45==a.charCodeAt(b+1)&&62==a.charCodeAt(b+2)&&(c.addChild(D.createComment(F.substr(a,g,b-g))),b+=2,e=1);break;case 16:91==k?h++:93==k?h--:62==k&&0==h&&(c.addChild(D.createDocType(F.substr(a,g,b-g))),e=1);break;case 14:63==k&&62==a.charCodeAt(b+1)&&(b++,e=F.substr(a,g+1,b-g-2),c.addChild(D.createProcessingInstruction(e)),e=1);break;
case 18:59==k&&(g=F.substr(a,g,b-g),35==g.charCodeAt(0)?(g=120==g.charCodeAt(1)?y.parseInt("0"+F.substr(g,1,g.length-1)):y.parseInt(F.substr(g,1,g.length-1)),o.add(String.fromCharCode(g))):Kc.escapes.exists(g)?o.add(Kc.escapes.get(g)):o.b+=y.string("&"+g+";"),g=b+1,e=f)}k=Rd.fastCodeAt(a,++b)}1==e&&(g=b,e=13);if(13==e)return(b!=g||0==i)&&c.addChild(D.createPCData(o.b+F.substr(a,g,b-g))),b;throw"Unexpected end";};var O=function(){};h["js.Boot"]=O;O.__name__=!0;O.getClass=function(a){return a instanceof
Array&&null==a.__enum__?Array:a.__class__};O.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;if("function"==c&&(a.__name__||a.__ename__))c="object";switch(c){case "object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];for(var c=a[0]+"(",b=b+"\t",d=2,e=a.length;d<e;)var f=d++,c=2!=f?c+(","+O.__string_rec(a[f],b)):c+O.__string_rec(a[f],b);return c+")"}c=a.length;d="[";b+="\t";for(e=0;e<c;)f=e++,d+=(0<f?",":"")+O.__string_rec(a[f],b);
return d+"]"}try{d=a.toString}catch(g){return"???"}if(null!=d&&d!=Object.toString&&(c=a.toString(),"[object Object]"!=c))return c;c=null;d="{\n";b+="\t";e=null!=a.hasOwnProperty;for(c in a)if(!e||a.hasOwnProperty(c))"prototype"==c||"__class__"==c||"__super__"==c||"__interfaces__"==c||"__properties__"==c||(2!=d.length&&(d+=", \n"),d+=b+c+" : "+O.__string_rec(a[c],b));b=b.substring(1);return d+("\n"+b+"}");case "function":return"<function>";case "string":return a;default:return""+a}};O.__interfLoop=
function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var d=0,e=c.length;d<e;){var f=d++,f=c[f];if(f==b||O.__interfLoop(f,b))return!0}return O.__interfLoop(a.__super__,b)};O.__instanceof=function(a,b){if(null==b)return!1;switch(b){case Jh:return(a|0)===a;case Dh:return"number"==typeof a;case Eh:return"boolean"==typeof a;case String:return"string"==typeof a;case Array:return a instanceof Array&&null==a.__enum__;case Kh:return!0;default:if(null!=a){if("function"==
typeof b&&(a instanceof b||O.__interfLoop(O.getClass(a),b)))return!0}else return!1;return b==Lh&&null!=a.__name__||b==Mh&&null!=a.__ename__?!0:a.__enum__==b}};var Mg=function(){};h["js.html._CanvasElement.CanvasUtil"]=Mg;Mg.__name__=!0;Mg.getContextWebGL=function(a,b){for(var c=0,d=["webgl","experimental-webgl"];c<d.length;){var e=d[c];++c;e=a.getContext(e,b);if(null!=e)return e}return null};var ua=function(){};h["madebypi.BrowserInfo"]=ua;ua.__name__=!0;var rc=function(){this.worldBounds=new Dd(-512,
-1024,1024,2048)};h["madebypi.critterballs.Main"]=rc;rc.__name__=!0;rc.main=function(){s.init();rc.logger=new Qf(s._platform.createLogHandler("pinball"));rc.instance=new rc;Ug.init("bootstrap",(Xe=rc.instance,n(Xe,Xe.onSuccess)),16777215)};rc.__super__=qc;rc.prototype=t(qc.prototype,{onSuccess:function(a){var b=this;this.bodyShapesData=JSON.parse(a.getFile("body-shapes.json").toString());this.tapPosition=new pd;this.mixer=new Ve;for(var c=["blep","blooweep","boop","dangg"],d=[],e=0;e<c.length;){var f=
c[e];++e;d.push(a.getSound("audio/sfx/"+f))}this.allSounds=d;qc.prototype.onSuccess.call(this,a);Mc.delay(function(){b.ballExit.resetBall(b.ballBody);b.handleBallExit()},0)},setupNapeWorld:function(){this.worldNapeLayer.add(this.spaceComponent=new Ye(this.assets,this.worldBounds));this.spaceComponent.napeSpace.get_gravity().setxy(0,850);this.spriteSheet=Pg.parse(D.parse(this.assets.getFile("sprites.xml").toString()),this.assets.getTexture("sprites"));this.createTable();this.createBall();this.createBumpers();
this.createDoors();this.createFlippers();this.createLauncher()},setupCamera:function(){this.mouseControlBehaviour=new Be(this.camera,this.worldBounds);this.camera.behaviours.push(this.mouseControlBehaviour);this.mouseControlBehaviour.set_enabled(!0);this.mouseControlBehaviour.scrollZoom=!1;this.camera.controller.panY.set__(-40);this.camera.controller.zoom.set__(0.25)},setupUI:function(){this.launcherPowerStrip=new Ze(this.ui,new aa(this.spriteSheet.get("LauncherPowerStrip")))},firstUserInteraction:function(){ua.isMobile&&
(ua.isiOS&&this.playRandomSound(0),s._platform.getStage().requestFullscreen())},onGesture:function(a){switch(a.type[1]){case 4:this.handleTouch(this.camera.screenPointToWorld(a.x,a.y,this.tapPosition));break;case 0:this.launcherPowerStrip.handleTap(a.x,a.y);break;default:qc.prototype.onGesture.call(this,a)}},onResize:function(){qc.prototype.onResize.call(this);this.launcherPowerStrip.resize(this.stageWidth,this.stageHeight);var a=Math.min(1,this.stageHeight/980),b=Math.min(1,this.stageWidth/585);
this.camera.controller.zoom.animateTo(Math.min(a,b),0.4,Ba.quadOut)},onKey:function(a){switch(a.key[1]){case 67:case 0:this.flipPaddle(0);break;case 69:case 3:this.flipPaddle(1);break;default:qc.prototype.onKey.call(this,a)}},handleTouch:function(a){0>a.x?this.flipPaddle(0):0<a.x&&this.flipPaddle(1)},flipPaddle:function(a){this.launcherPowerStrip._active||((0==a?this.leftPaddle:this.rightPaddle).flip(),this.assets.getSound("audio/sfx/blesdfpk").play(0.2))},createTable:function(){var a=bg.deserialiseToBody(this.bodyShapesData.table);
a.set_type(function(){null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);return f.BodyType_STATIC}(this));a.setShapeMaterials(pa.wood());this.tableEnt=this.spaceComponent.createBodySpriteEntity(a,new aa(this.spriteSheet.get("table-static")));this.worldNapeLayer.addChild(this.tableEnt)},createBall:function(){var a=this.spaceComponent.napeSpace,b=x.get(242,90,null),c=x.get(17.5,455,null);this.ballEnt=sc.create(this.spaceComponent,this.spriteSheet,b);this.ballExit=Hd.box(470,
5.5,a,c,b);this.ballEnt.add(this.ballExit);this.worldNapeLayer.addChild(this.ballEnt);this.ballBody=this.ballEnt._compMap.BodyComponent_8.body;this.ballExit.exited.connect(n(this,this.handleBallExit));a=(new H(this.assets,"particle-test/particle")).createEmitter();a.centerAnchor();this.worldSceneryLayer.addChild((new W).add(a).add(new $e(this.ballBody,a)));a.restart()},handleBallExit:function(){var a=this;this.ballBody.set_space(null);this.launcherPowerStrip.set_active(!0);this.launcherPowerStrip.triggered.connect(function(b){a.ballBody.set_space(a.spaceComponent.napeSpace);
a.launcherPowerStrip.set_active(!1);a.launcher.reset(b);a.launcher.triggerAfter(1.25)}).once()},createBumpers:function(){var a=this.spriteSheet.get("circle"),b=this.spaceComponent.napeSpace;this.worldNapeLayer.addChild((new W).add(new aa(a)).add(new Hb(x.get(-16,-166,null),b,this.ballBody,-800,18,n(this,this.handleBump)))).addChild((new W).add(new aa(a)).add(new Hb(x.get(47,-182,null),b,this.ballBody,-800,18,n(this,this.handleBump)))).addChild((new W).add(new aa(a)).add(new Hb(x.get(107,-166,null),
b,this.ballBody,-800,18,n(this,this.handleBump)))).addChild((new W).add(new aa(a)).add(new Hb(x.get(47,-282,null),b,this.ballBody,-800,18,n(this,this.handleBump)))).addChild((new W).add(new aa(a)).add(new Hb(x.get(0,453,null),b,this.ballBody,-200,2.5,n(this,this.handleBump)))).addChild((new W).add(new aa(this.spriteSheet.get("triangle-left"))).add(new be(x.get(-130,327.5,null),b,this.ballBody,-400,this.bodyShapesData.triangleBumperL,1,0,n(this,this.handleBump)))).addChild((new W).add(new aa(this.spriteSheet.get("triangle-right"))).add(new be(x.get(130,
327.5,null),b,this.ballBody,-400,this.bodyShapesData.triangleBumperR,1,0,n(this,this.handleBump)))).addChild((new W).add(new Gb(16711935,4,16)).add(new ud(x.get(-164,140,null),b,this.ballBody,-800,4,16,n(this,this.handleBump)))).addChild((new W).add(new Gb(16711935,4,16)).add(new ud(x.get(-164,120,null),b,this.ballBody,-800,4,16,n(this,this.handleBump)))).addChild((new W).add(new Gb(16711935,4,16)).add(new ud(x.get(178,160,null),b,this.ballBody,-800,4,16,n(this,this.handleBump)))).addChild((new W).add(new Gb(16711935,
4,16)).add(new ud(x.get(178,140,null),b,this.ballBody,-800,4,16,n(this,this.handleBump))))},handleBump:function(){this.playRandomSound()},createDoors:function(){var a=this.spaceComponent.napeSpace;this.worldNapeLayer.addChild((new W).add(new Gb(16711935,22,8)).add(new af(a)))},createFlippers:function(){var a=this.spaceComponent.napeSpace,b=this.spriteSheet.get("flipper-left"),c=this.spriteSheet.get("flipper-right");this.worldNapeLayer.addChild((new W).add(new aa(b)).add(this.leftPaddle=new ce(-86,
417,new bf,a))).addChild((new W).add((new aa(c)).setAnchor(c.get_width(),0)).add(this.rightPaddle=new ce(86,417,new bf(-1),a)))},createLauncher:function(){this.worldNapeLayer.addChild((new W).add(new Gb(65535,19,8)).add(this.launcher=new cf(242,445,19,8,this.spaceComponent.napeSpace)))},playRandomSound:function(a){null==a&&(a=0.5);this.allSounds[y["int"](4*Math.random())].play(a)},__class__:rc});var Ug=function(){};h["madebypi.critterballs.PreloadMain"]=Ug;Ug.__name__=!0;Ug.init=function(a,b,c){null==
c&&(c=0);var d=new Gb(c,1,s._platform.getStage().get_height());s.root.add(d);var e=s.loadAssetPack(tb.fromAssets(a));e.progressChanged.connect(function(){d.width.animateTo(e._progress/e._total*s._platform.getStage().get_width(),0.25,Ba.quadOut);d.height.set__(s._platform.getStage().get_height())});e.success.connect(function(a){d.width.animateTo(s._platform.getStage().get_width(),0.25,Ba.quadOut);Mc.delay(function(){b(a);d.dispose()},250)}).once();e.error.connect(function(a){d.color=16711680;b(null);
throw a;})};var gb=function(){this.zpp_inner=null;this.zpp_inner=new ga;this.zpp_inner.outer=this};h["nape.callbacks.CbType"]=gb;gb.__name__=!0;gb.prototype={toString:function(){return this==ga.ANY_BODY?"ANY_BODY":this==ga.ANY_SHAPE?"ANY_SHAPE":this==ga.ANY_COMPOUND?"ANY_COMPOUND":this==ga.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},__class__:gb};var ga=function(){this.cbsets=this.listeners=this.bodylisteners=this.conlisteners=null;this.id=0;this.outer=null;this.id=Ga.CbType();this.listeners=
new Id;this.bodylisteners=new df;this.conlisteners=new ef;this.constraints=new tc;this.interactors=new ac;this.cbsets=new Jd};h["zpp_nape.callbacks.ZPP_CbType"]=ga;ga.__name__=!0;ga.prototype={addint:function(a){for(var b=null,c=this.listeners.head;null!=c;){var d=c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.listeners.inlined_insert(b,a);this.invalidateint()},invalidateint:function(){for(var a=this.cbsets.head;null!=a;){var b=a.elt;b.zip_listeners=
!0;b.invalidate_pairs();a=a.next}},addbody:function(a){for(var b=null,c=this.bodylisteners.head;null!=c;){var d=c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.bodylisteners.inlined_insert(b,a);this.invalidatebody()},invalidatebody:function(){for(var a=this.cbsets.head;null!=a;)a.elt.zip_bodylisteners=!0,a=a.next},addconstraint:function(a){for(var b=null,c=this.conlisteners.head;null!=c;){var d=c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&
a.id>d.id)break;b=c;c=c.next}this.conlisteners.inlined_insert(b,a);this.invalidateconstraint()},invalidateconstraint:function(){for(var a=this.cbsets.head;null!=a;)a.elt.zip_conlisteners=!0,a=a.next},__class__:ga};var Ga=function(){};h["zpp_nape.ZPP_ID"]=Ga;Ga.__name__=!0;Ga.Constraint=function(){return Ga._Constraint++};Ga.Interactor=function(){return Ga._Interactor++};Ga.CbType=function(){return Ga._CbType++};Ga.CbSet=function(){return Ga._CbSet++};Ga.Listener=function(){return Ga._Listener++};
var Id=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_InteractionListener"]=Id;Id.__name__=!0;Id.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==La.zpp_pool?b=new La:(b=La.zpp_pool,La.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_insert:function(a,b){var c;null==La.zpp_pool?c=new La:(c=La.zpp_pool,La.zpp_pool=c.next,c.next=null);
null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=La.zpp_pool;La.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=La.zpp_pool;La.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},__class__:Id};var df=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_BodyListener"]=
df;df.__name__=!0;df.prototype={inlined_insert:function(a,b){var c;null==Sa.zpp_pool?c=new Sa:(c=Sa.zpp_pool,Sa.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Sa.zpp_pool;Sa.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=
null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Sa.zpp_pool;Sa.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},__class__:df};var ef=function(){this.length=0;this.modified=
this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_ConstraintListener"]=ef;ef.__name__=!0;ef.prototype={inlined_insert:function(a,b){var c;null==ia.zpp_pool?c=new ia:(c=ia.zpp_pool,ia.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=ia.zpp_pool;ia.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=
!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=ia.zpp_pool;ia.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=
this.head;)this.inlined_pop();this.pushmod=!0},__class__:ef};var tc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Constraint"]=tc;tc.__name__=!0;tc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ya.zpp_pool?b=new Ya:(b=Ya.zpp_pool,Ya.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,
b){var c;null==Ya.zpp_pool?c=new Ya:(c=Ya.zpp_pool,Ya.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ya.zpp_pool;Ya.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},
inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ya.zpp_pool;Ya.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<
a--&&null!=b;)b=b.next;return b},__class__:tc};var ac=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Interactor"]=ac;ac.__name__=!0;ac.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ta.zpp_pool?b=new Ta:(b=Ta.zpp_pool,Ta.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;
this.head=a.next;a.elt=null;a.next=Ta.zpp_pool;Ta.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=
c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ta.zpp_pool;Ta.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},inlined_clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:ac};var Jd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CbSet"]=Jd;Jd.__name__=
!0;Jd.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ib.zpp_pool?b=new Ib:(b=Ib.zpp_pool,Ib.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ib.zpp_pool;Ib.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ib.zpp_pool;Ib.zpp_pool=a;this.modified=!0;this.length--;
this.pushmod=!0;return c},__class__:Jd};var sc=function(a,b,c){pc.call(this,a,b,c)};h["madebypi.critterballs.table.Ball"]=sc;sc.__name__=!0;sc.create=function(a,b,c){var d=qb;null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new da,f.internal=!1);d=new d(f.BodyType_DYNAMIC);d.zpp_inner.wrap_shapes.add(new Oc(10,x.get(0,0,!0),new pa(0.2,0.57,0.74,5.5,0.0010)));null==d.zpp_inner.wrap_pos&&d.zpp_inner.setupPosition();d.zpp_inner.wrap_pos.set(c);d.zpp_inner.bulletEnabled=!0;d.zpp_inner.bulletEnabled;
null==d.zpp_inner_i.wrap_cbTypes&&d.zpp_inner_i.setupcbTypes();d.zpp_inner_i.wrap_cbTypes.add(sc.BallType);b=b.get("ball-glow");b=(new aa(b)).centerAnchor();b.setScale(1);return a.createBodySpriteEntity(d,b,sc)};sc.__super__=pc;sc.prototype=t(pc.prototype,{onUpdate:function(){var a=this.body.get_velocity(),b;a.zpp_inner.validate();b=a.zpp_inner.x;a.zpp_inner.validate();b*=a.zpp_inner.x;var c;a.zpp_inner.validate();c=a.zpp_inner.y;a.zpp_inner.validate();4E6<b+c*a.zpp_inner.y&&this.body.get_velocity().muleq(0.98);
var d=this.body.get_position();this.sprite.x.set__(function(){d.zpp_inner.validate();return d.zpp_inner.x}(this));this.sprite.y.set__(function(){d.zpp_inner.validate();return d.zpp_inner.y}(this))},__class__:sc});var $e=function(a,b){E.call(this);this.target=a;this.emitter=b;b.enabled=!1};h["madebypi.critterballs.table.EmitBodyFollower"]=$e;$e.__name__=!0;$e.__super__=E;$e.prototype=t(E.prototype,{get_name:function(){return"EmitBodyFollower_7"},onUpdate:function(){var a=this.target.get_position();
if(null!=this.target.get_space()&&(this.emitter.enabled=!this.target.zpp_inner.component.sleeping))this.emitter.emitX.set__(function(){a.zpp_inner.validate();return a.zpp_inner.x}(this)),this.emitter.emitY.set__(function(){a.zpp_inner.validate();return a.zpp_inner.y}(this))},__class__:$e});var cf=function(a,b,c,d,e){this.willTriggerIn=0;E.call(this);this.space=e;this.width=c;this.height=d;this.posX=a;this.posY=b;this.bottom=b+40};h["madebypi.critterballs.table.Launcher"]=cf;cf.__name__=!0;cf.__super__=
E;cf.prototype=t(E.prototype,{get_name:function(){return"Launcher_4"},onStart:function(){this.sprite=this.owner._compMap.Sprite_9.centerAnchor();this.body=this.createBody();this.line=this.createLineJoint();this.mover=new Ed(this.space.zpp_inner.__static,this.body,x.get(null,null,null),this.body.get_localCOM());this.mover.set_stiff(!1);this.mover.set_damping(2);this.mover.set_maxForce(1E8);this.mover.set_frequency(72);this.mover.set_active(!1);this.line.set_space(this.space);this.mover.set_space(this.space);
this.toggle()},createBody:function(){var a=qb;null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new da,f.internal=!1);a=new a(f.BodyType_DYNAMIC,x.get(this.posX,this.posY,null));a.zpp_inner.wrap_shapes.add(new Qa(Qa.box(this.width,this.height)));a.setShapeMaterials(pa.steel());a.zpp_inner.immutable_midstep("Body::false");!1!=!a.zpp_inner.norotate&&(a.zpp_inner.norotate=!0,a.zpp_inner.invalidate_inertia());!a.zpp_inner.norotate;a.set_space(this.space);return a},createLineJoint:function(){var a=
new ff(this.space.zpp_inner.__static,this.body,this.space.zpp_inner.__static.worldPointToLocal(x.get(this.posX,this.posY,null)),this.body.worldPointToLocal(x.get(this.posX,this.bottom,null)),x.get(0,1,null),-1,1);!1!=a.zpp_inner.stiff&&(a.zpp_inner.stiff=!1,a.zpp_inner.wake());a.zpp_inner.stiff;0.25!=a.zpp_inner.damping&&(a.zpp_inner.damping=0.25,a.zpp_inner.stiff||a.zpp_inner.wake());a.zpp_inner.damping;9E7!=a.zpp_inner.maxForce&&(a.zpp_inner.maxForce=9E7,a.zpp_inner.wake());a.zpp_inner.maxForce;
48!=a.zpp_inner.frequency&&(a.zpp_inner.frequency=48,a.zpp_inner.stiff||a.zpp_inner.wake());a.zpp_inner.frequency;return a},onUpdate:function(a){this.body.get_velocity().set_x(0);this.sprite.x.set__(this.body.get_position().set_x(this.posX));this.sprite.y.set__(this.body.get_position().get_y());0<this.willTriggerIn&&(this.willTriggerIn-=a,0>=this.willTriggerIn&&this.trigger())},reset:function(a){this.mover.set_active(!0);this.mover.get_anchor1().setxy(this.posX,this.bottom-55+25*a)},trigger:function(){this.mover.set_active(!1)},
triggerAfter:function(a){this.willTriggerIn=a},toggle:function(){this.mover.get_anchor1().setxy(this.posX,this.bottom-40-10*Math.random());this.mover.set_active(!this.mover.zpp_inner.active)},onRemoved:function(){this.body.set_space(null);this.line.set_space(null);this.mover.set_space(null);this.space=null},__class__:cf});var vb=function(a){E.call(this);this.space=a;this.oneWay=new gb;null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new T,f.internal=!1);this.listener=
new gf(f.InteractionType_COLLISION,this.oneWay,ga.ANY_BODY,n(this,this.handler),0,!0)};h["madebypi.critterballs.table.OneWay"]=vb;vb.__name__=!0;vb.__super__=E;vb.prototype=t(E.prototype,{get_name:function(){return"OneWay_5"},onAdded:function(){this.space.zpp_inner.wrap_listeners.add(this.listener)},onRemoved:function(){this.space.zpp_inner.wrap_listeners.remove(this.listener)},handler:function(a){var b=a.zpp_inner.pre_arbiter.wrapper().get_collisionArbiter();null==b.zpp_inner.colarb.wrap_normal&&
b.zpp_inner.colarb.getnormal();if(0<b.zpp_inner.colarb.wrap_normal.get_y()!=a.zpp_inner.pre_swapped)return null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1),f.PreFlag_IGNORE;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);return f.PreFlag_ACCEPT},__class__:vb});var bf=function(a,b,c,d,e,f,g){null==g&&(g=32);null==f&&(f=0.3);null==e&&(e=-0.4);null==d&&(d=11.25);null==c&&(c=3);null==b&&(b=84);null==a&&(a=1);this.motorDuration=0.025;this.motorSpeed=
29;this.maxAngle=0.3;this.minAngle=-0.4;this.direction=1;this.midLength=-1;this.largeRadius=11.25;this.smallRadius=3;this.length=84;this.direction=a;this.length=b;this.smallRadius=c;this.largeRadius=d;this.minAngle=e;this.maxAngle=f;this.motorSpeed=g;this.midLength=b-d-c};h["madebypi.critterballs.table.PaddleProperties"]=bf;bf.__name__=!0;bf.prototype={__class__:bf};var ce=function(a,b,c,d){this.motorTime=0;E.call(this);this.x=a;this.y=b;this.properties=c;this.space=d};h["madebypi.critterballs.table.Paddle"]=
ce;ce.__name__=!0;ce.__super__=E;ce.prototype=t(E.prototype,{get_name:function(){return"Paddle_3"},flip:function(){this.motorTime=this.properties.motorDuration},onStart:function(){this.sprite=this.owner._compMap.Sprite_9;this.createBody();this.createJoint()},onUpdate:function(a){this.motor.set_active(0<this.motorTime)&&(this.motorTime-=a,0>=this.motorTime&&(this.motorTime=0));this.sprite.x.set__(this.body.get_position().get_x());this.sprite.y.set__(this.body.get_position().get_y());this.sprite.rotation.set__(180*
this.body.zpp_inner.rot/3.141592653589793)},onRemoved:function(){this.body.set_space(null);this.pivot.set_space(null);this.angle.set_space(null);this.motor.set_space(null);this.space=null},createBody:function(){var a=this.properties,b=qb;null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new da,f.internal=!1);this.body=new b(f.BodyType_DYNAMIC,x.get(this.x,this.y,null));this.body.zpp_inner.wrap_shapes.add(new Oc(a.largeRadius,x.get(a.direction*a.largeRadius,a.largeRadius,null),pa.steel()));
this.body.zpp_inner.wrap_shapes.add(new Oc(a.smallRadius,x.get(a.direction*(a.midLength+a.largeRadius-a.smallRadius),a.smallRadius,null),pa.steel()));this.body.zpp_inner.wrap_shapes.add(new Qa(this.getPoints(),pa.wood()));this.body.set_space(this.space)},createJoint:function(){var a=this.properties,b=this.space.zpp_inner.__static,c=x.get(a.direction*a.largeRadius,a.largeRadius,null);this.pivot=new Ed(b,this.body,this.body.get_position(),c);this.pivot.set_stiff(!0);this.pivot.set_damping(0.5);this.pivot.set_frequency(12*
Math.PI);this.pivot.set_space(this.space);this.angle=new hf(b,this.body,-1==a.direction?a.minAngle:-a.maxAngle,-1==a.direction?a.maxAngle:-a.minAngle);this.angle.set_stiff(!1);this.angle.set_space(this.space);this.motor=new jf(b,this.body,a.direction*-a.motorSpeed);this.motor.set_space(this.space);this.motor.set_maxForce(7E9);this.motor.set_active(!1)},getPoints:function(){var a=this.properties;return[x.get(a.direction*a.largeRadius,0,null),x.get(a.direction*(a.midLength+a.largeRadius-a.smallRadius),
0,null),x.get(a.direction*(a.midLength+a.largeRadius-a.smallRadius),a.smallRadius+a.smallRadius,null),x.get(a.direction*a.largeRadius,a.largeRadius+a.largeRadius,null)]},__class__:ce});var Ye=function(a,b,c){ja.call(this,a,b,c)};h["madebypi.critterballs.table.PinballSpace"]=Ye;Ye.__name__=!0;Ye.__super__=ja;Ye.prototype=t(ja.prototype,{onAdded:function(){this.speedAdjust=new z(0.1);ja.prototype.onAdded.call(this)},onStart:function(){this.speedAdjust.animateTo(1,1,Ba.quadOut)},onUpdate:function(a){this.speedAdjust.update(a);
var b=this.speedAdjust._value*ja.FixedTimeStep;for(this.cumalativeDt+=a;this.cumalativeDt>=ja.FixedTimeStep;)this.napeSpace.step(b,40,20),this.cumalativeDt-=a},__class__:Ye});var Ma=function(a,b,c,d,e){null==d&&(d=-2800);E.call(this);this.space=b;this.force=d;this.bumped=new ca;null!=e&&this.bumped.connect(e);this.bumperCollision=new gb;null==c.zpp_inner_i.wrap_cbTypes&&c.zpp_inner_i.setupcbTypes();c.zpp_inner_i.wrap_cbTypes.add(this.bumperCollision);this.body=this.createBody(a);this.body.get_cbTypes().add(this.bumperCollision);
a=cd;null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new va,f.internal=!1);b=f.CbEvent_BEGIN;null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new T,f.internal=!1);this.collisionHandler=new a(b,f.InteractionType_COLLISION,this.bumperCollision,this.bumperCollision,n(this,this.onBumper))};h["madebypi.critterballs.table.bumpers.Bumper"]=Ma;Ma.__name__=!0;Ma.applyForceFromPoint=function(a,b,c){var d=b.sub(function(){null==a.zpp_inner.wrap_pos&&a.zpp_inner.setupPosition();
return a.zpp_inner.wrap_pos}(this),!0);d.set_length(1);d.muleq(c);a.applyImpulse(d,b)};Ma.__super__=E;Ma.prototype=t(E.prototype,{get_name:function(){return"Bumper_6"},createBody:function(){throw"Missing Implementation";},onStart:function(){this.sprite=this.owner._compMap.Sprite_9.setXY(this.body.get_position().get_x(),this.body.get_position().get_y()).setRotation(180*this.body.zpp_inner.rot/3.141592653589793);this.body.get_userData().bumper=this;this.body.set_space(this.space);this.space.zpp_inner.wrap_listeners.add(this.collisionHandler)},
onRemoved:function(){this.space.zpp_inner.wrap_listeners.remove(this.collisionHandler);this.collisionHandler.set_space(null);this.collisionHandler=null;this.body.set_space(null);this.bumperCollision=this.space=this.sprite=null},onBumper:function(a){Ma.applyForceFromPoint(a.zpp_inner.int1.outer_i.get_castBody(),this.body.get_position(),this.force);this.sprite.alpha.set__(0.1);this.sprite.alpha.animateTo(1,0.5,Ba.quadOut);this.bumped.emit(this)},__class__:Ma});var ud=function(a,b,c,d,e,f,g){null==f&&
(f=16);null==e&&(e=16);null==d&&(d=3200);this.width=e;this.height=f;Ma.call(this,a,b,c,d,g)};h["madebypi.critterballs.table.bumpers.BoxBumper"]=ud;ud.__name__=!0;ud.__super__=Ma;ud.prototype=t(Ma.prototype,{createBody:function(a){var b=qb;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);a=new b(f.BodyType_STATIC,a);a.zpp_inner.wrap_shapes.add(new Qa(Qa.box(this.width,this.height),pa.rubber()));a.align();return a},onStart:function(){Ma.prototype.onStart.call(this);this.sprite.centerAnchor()},
__class__:ud});var Hb=function(a,b,c,d,e,f){null==d&&(d=-3200);this.radius=e;Ma.call(this,a,b,c,d,f)};h["madebypi.critterballs.table.bumpers.CircleBumper"]=Hb;Hb.__name__=!0;Hb.__super__=Ma;Hb.prototype=t(Ma.prototype,{createBody:function(a){var b=qb;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);a=new b(f.BodyType_STATIC,a);a.zpp_inner.wrap_shapes.add(new Oc(this.radius,null,new pa(0.85,0.8,1.2,2,0.01),null));a.align();return a},onStart:function(){Ma.prototype.onStart.call(this);
this.sprite.centerAnchor().setScale((this.radius+this.radius)/this.sprite.getNaturalWidth())},__class__:Hb});var be=function(a,b,c,d,e,f,g,j){null==g&&(g=0);null==f&&(f=1);null==d&&(d=-3200);this.bodyData=e;this.scaleAdjust=f;this.rotationAdjust=g;Ma.call(this,a,b,c,d,j)};h["madebypi.critterballs.table.bumpers.TriangleBumper"]=be;be.__name__=!0;be.__super__=Ma;be.prototype=t(Ma.prototype,{createBody:function(a){var b=bg.deserialiseToBody(this.bodyData);b.setShapeMaterials(pa.steel());null==b.zpp_inner.wrap_pos&&
b.zpp_inner.setupPosition();b.zpp_inner.wrap_pos.set(a);b.set_rotation(this.rotationAdjust);b.scaleShapes(this.scaleAdjust,this.scaleAdjust);b.set_type(function(){null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);return f.BodyType_STATIC}(this));return b},onStart:function(){var a=this.body.get_userData().graphicOffset;Ma.prototype.onStart.call(this);this.sprite.setAnchor(-function(){a.zpp_inner.validate();return a.zpp_inner.x}(this),-function(){a.zpp_inner.validate();
return a.zpp_inner.y}(this)).setRotation(180*this.body.zpp_inner.rot/3.141592653589793).setScale(this.scaleAdjust)},__class__:be});var Pc=function(a,b){vb.call(this,a);this.body=this.createBody(b)};h["madebypi.critterballs.table.doors.OneWayDoor"]=Pc;Pc.__name__=!0;Pc.__super__=vb;Pc.prototype=t(vb.prototype,{createBody:function(){throw"Missing Implementation";},onAdded:function(){vb.prototype.onAdded.call(this);this.body.get_cbTypes().add(this.oneWay);this.body.set_space(this.space)},onStart:function(){this.sprite=
this.owner._compMap.Sprite_9.setXY(this.body.get_position().get_x(),this.body.get_position().get_y()).setRotation(180*this.body.zpp_inner.rot/3.141592653589793)},onRemoved:function(){vb.prototype.onRemoved.call(this);this.body.get_cbTypes().remove(this.oneWay);this.body.set_space(null);this.sprite=null},__class__:Pc});var af=function(a){Pc.call(this,a,x.get(241,69.5,null))};h["madebypi.critterballs.table.doors.LauncherExit"]=af;af.__name__=!0;af.__super__=Pc;af.prototype=t(Pc.prototype,{createBody:function(a){var b=
qb;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);a=new b(f.BodyType_STATIC,a);a.zpp_inner.wrap_shapes.add(new Qa(Qa.box(22,8),pa.wood()));a.align();null==a.zpp_inner.wrap_svel&&a.zpp_inner.setupsvel();a.zpp_inner.wrap_svel.setxy(-400,200);return a},onStart:function(){Pc.prototype.onStart.call(this);this.sprite.centerAnchor()},__class__:af});var vd=function(a,b,c){E.call(this);this.body=a;this.space=b;for(b=a.zpp_inner.wrap_shapes.iterator();b.hasNext();){var d;b.zpp_critical=
!1;d=b.zpp_inner.at(b.zpp_i++);d.zpp_inner.filter.wrapper().set_collisionMask(0);d.zpp_inner.immutable_midstep("Shape::sensorEnabled");d.zpp_inner.sensorEnabled=!0;d.zpp_inner.wake();d.zpp_inner.sensorEnabled}this.sensor=new gb;null==a.zpp_inner_i.wrap_cbTypes&&a.zpp_inner_i.setupcbTypes();a.zpp_inner_i.wrap_cbTypes.add(this.sensor);null==c&&(c=ga.ANY_BODY);a=cd;null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new va,f.internal=!1);b=f.CbEvent_BEGIN;null==f.InteractionType_SENSOR&&(f.internal=
!0,f.InteractionType_SENSOR=new T,f.internal=!1);this.beginListener=new a(b,f.InteractionType_SENSOR,c,this.sensor,n(this,this.onSenseBegin));a=cd;null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new va,f.internal=!1);b=f.CbEvent_END;null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new T,f.internal=!1);this.endListener=new a(b,f.InteractionType_SENSOR,c,this.sensor,n(this,this.onSenseEnd))};h["madebypi.critterballs.table.sensors.TransitSensor"]=vd;vd.__name__=!0;vd.__super__=
E;vd.prototype=t(E.prototype,{get_name:function(){return"TransitSensor_1"},onSenseBegin:function(){null},onSenseEnd:function(){null},onAdded:function(){this.space.zpp_inner.wrap_listeners.add(this.beginListener);this.space.zpp_inner.wrap_listeners.add(this.endListener);this.body.set_space(this.space)},onRemoved:function(){this.space.zpp_inner.wrap_listeners.remove(this.beginListener);this.space.zpp_inner.wrap_listeners.remove(this.endListener);this.body.set_space(null)},__class__:vd});var Hd=function(a,
b,c,d){var e=qb;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);c=new e(f.BodyType_STATIC,c);c.zpp_inner.wrap_shapes.add(b);this.resetPosition=d;this.exited=new nc;vd.call(this,c,a,sc.BallType)};h["madebypi.critterballs.table.sensors.BallExit"]=Hd;Hd.__name__=!0;Hd.box=function(a,b,c,d,e){return new Hd(c,new Qa(Qa.box(a,b)),d,e)};Hd.__super__=vd;Hd.prototype=t(vd.prototype,{onSenseBegin:function(a){this.resetBall(a.zpp_inner.int1.outer_i.get_castBody());this.exited.emit()},
onSenseEnd:function(){},resetBall:function(a){null==a.zpp_inner.wrap_vel&&a.zpp_inner.setupVelocity();a.zpp_inner.wrap_vel.set_x(function(){null==a.zpp_inner.wrap_vel&&a.zpp_inner.setupVelocity();return a.zpp_inner.wrap_vel}(this).set_y(function(){0!=a.zpp_inner.angvel&&(a.zpp_inner.angvel=0,a.zpp_inner.wake());return a.zpp_inner.angvel}(this)));null==a.zpp_inner.wrap_pos&&a.zpp_inner.setupPosition();a.zpp_inner.wrap_pos.set(this.resetPosition)},__class__:Hd});var dd=function(a,b,c){null==c&&(c=0.8);
null==b&&(b=0);this.fadeOutTime=0.3;this.fadeInTime=0.4;a.addChild(this.container=new W);this.container.add(this.fadeDisplay=new Gb(b,8,8));this.alphaOn=c;this.fadeDisplay.alpha.set__(0);this._active=!1};h["madebypi.critterballs.table.ui.ModalFade"]=dd;dd.__name__=!0;dd.prototype={resize:function(a,b){this.fadeDisplay.width.set__(a);this.fadeDisplay.height.set__(b)},set_active:function(a){a!=this._active&&(a?(this.fadeDisplay.alpha.set__(0),this.fadeDisplay.alpha.animateTo(this.alphaOn,this.fadeInTime,
Ba.quadIn)):this.fadeDisplay.alpha.animateTo(0,this.fadeOutTime,Ba.quadOut));return this._active=a},__class__:dd};var Ze=function(a,b){dd.call(this,a,0,0.8);this.background=b;this.background.centerAnchor();this.indicator=new Gb(16777215,b.getNaturalWidth(),10);this.indicator.alpha.set__(0.6);this.indicatorAnimator=new Se;this.indicatorSequence=new Re(new Ue([new ae(this.indicator.y,b.getNaturalHeight()-10,1,Ba.sineInOut),new ae(this.indicator.y,0,1,Ba.sineInOut)]));this.triggered=new ca;this.container.addChild((new W).add(this.background).addChild((new W).add(this.indicator)))};
h["madebypi.critterballs.table.ui.LauncherPowerStrip"]=Ze;Ze.__name__=!0;Ze.__super__=dd;Ze.prototype=t(dd.prototype,{handleTap:function(a,b){return this.background.contains(a,b)?(this.triggered.emit(1-this.indicator.y._value/this.background.getNaturalHeight()),!0):!1},resize:function(a,b){dd.prototype.resize.call(this,a,b);this.background.setXY(a/2,b/2)},set_active:function(a){this._active!=a&&(a?(this.container.add(this.indicatorAnimator),this.indicatorAnimator.run(this.indicatorSequence)):(this.indicator.y.set_behavior(null),
this.indicatorAnimator.stopAll(),this.container.remove(this.indicatorAnimator)));return dd.prototype.set_active.call(this,a)},__class__:Ze});var m=function(){};h["nape.Config"]=m;m.__name__=!0;var Jb=function(){this.zpp_inner=null};h["nape.callbacks.Callback"]=Jb;Jb.__name__=!0;Jb.prototype={toString:function(){return""},__class__:Jb};var kf=function(){this.zpp_inner=null};h["nape.callbacks.BodyCallback"]=kf;kf.__name__=!0;kf.__super__=Jb;kf.prototype=t(Jb.prototype,{toString:function(){var a;a="Cb:"+
["WAKE","SLEEP"][this.zpp_inner.event-f.id_CbEvent_WAKE];a+=":"+this.zpp_inner.body.outer.toString();return a+=" : listener: "+y.string(this.zpp_inner.listener.outer)},__class__:kf});var Kb=function(){this.zpp_inner=null};h["nape.callbacks.Listener"]=Kb;Kb.__name__=!0;Kb.prototype={set_space:function(a){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=a)null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=a?a.zpp_inner.wrap_listeners.add(this):
this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},toString:function(){var a="BEGIN,END,WAKE,SLEEP,BREAK,PRE,ONGOING".split(",")[this.zpp_inner.event];if(this.zpp_inner.type==f.id_ListenerType_BODY)return"BodyListener{"+a+"::"+y.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}";if(this.zpp_inner.type==f.id_ListenerType_CONSTRAINT)return"ConstraintListener{"+a+"::"+y.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}";
var b=this.zpp_inner.interaction,c;switch(b.itype){case f.id_InteractionType_COLLISION:c="COLLISION";break;case f.id_InteractionType_SENSOR:c="SENSOR";break;case f.id_InteractionType_FLUID:c="FLUID";break;default:c="ALL"}return(this.zpp_inner.type==f.id_ListenerType_INTERACTION?"InteractionListener{"+a+"#"+c+"::"+y.string(b.outer_zni.zpp_inner_zn.options1.outer)+":"+y.string(b.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+c+"::"+y.string(b.outer_znp.zpp_inner_zn.options1.outer)+":"+y.string(b.outer_znp.zpp_inner_zn.options2.outer)+
"}")+" precedence="+this.zpp_inner.precedence},__class__:Kb};var og=function(){this.zpp_inner_zn=null};h["nape.callbacks.BodyListener"]=og;og.__name__=!0;og.__super__=Kb;og.prototype=t(Kb.prototype,{__class__:og});var va=function(){};h["nape.callbacks.CbEvent"]=va;va.__name__=!0;va.prototype={toString:function(){var a;null==f.CbEvent_PRE&&(f.internal=!0,f.CbEvent_PRE=new va,f.internal=!1);this==f.CbEvent_PRE?a="PRE":(null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new va,f.internal=!1),this==
f.CbEvent_BEGIN?a="BEGIN":(null==f.CbEvent_ONGOING&&(f.internal=!0,f.CbEvent_ONGOING=new va,f.internal=!1),this==f.CbEvent_ONGOING?a="ONGOING":(null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new va,f.internal=!1),this==f.CbEvent_END?a="END":(null==f.CbEvent_WAKE&&(f.internal=!0,f.CbEvent_WAKE=new va,f.internal=!1),this==f.CbEvent_WAKE?a="WAKE":(null==f.CbEvent_SLEEP&&(f.internal=!0,f.CbEvent_SLEEP=new va,f.internal=!1),this==f.CbEvent_SLEEP?a="SLEEP":(null==f.CbEvent_BREAK&&(f.internal=!0,f.CbEvent_BREAK=
new va,f.internal=!1),a=this==f.CbEvent_BREAK?"BREAK":""))))));return a},__class__:va};var bc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.callbacks.CbTypeIterator"]=bc;bc.__name__=!0;bc.get=function(a){var b;null==bc.zpp_pool?(Lb.internal=!0,b=new bc,Lb.internal=!1):(b=bc.zpp_pool,bc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};bc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();
this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=bc.zpp_pool;bc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:bc};var lf=function(){this.zpp_inner=null;this.zpp_inner=new Lb;this.zpp_inner.outer=this};h["nape.callbacks.CbTypeList"]=lf;lf.__name__=!0;lf.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);
return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=
null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();
this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?
this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=bc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);
b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:lf};var mf=function(){this.zpp_inner=null};h["nape.callbacks.ConstraintCallback"]=mf;mf.__name__=!0;mf.__super__=Jb;mf.prototype=t(Jb.prototype,{toString:function(){var a;a="Cb:"+["WAKE","SLEEP","BREAK"][this.zpp_inner.event-f.id_CbEvent_WAKE];a+=":"+this.zpp_inner.constraint.outer.toString();return a+=" : listener: "+y.string(this.zpp_inner.listener.outer)},__class__:mf});var pg=function(){this.zpp_inner_zn=null};h["nape.callbacks.ConstraintListener"]=
pg;pg.__name__=!0;pg.__super__=Kb;pg.prototype=t(Kb.prototype,{__class__:pg});var nf=function(){this.zpp_inner=null};h["nape.callbacks.InteractionCallback"]=nf;nf.__name__=!0;nf.__super__=Jb;nf.prototype=t(Jb.prototype,{toString:function(){var a;a="Cb:"+"BEGIN,END,,,,,ONGOING".split(",")[this.zpp_inner.event];a+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString();a+=" : "+this.zpp_inner.wrap_arbiters.toString();return a+=" : listener: "+y.string(this.zpp_inner.listener.outer)},
__class__:nf});var cd=function(a,b,c,d,e,v){null==v&&(v=0);this.zpp_inner=this.zpp_inner_zn=null;var g=-1;null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new va,f.internal=!1);a==f.CbEvent_BEGIN?g=f.id_CbEvent_BEGIN:(null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new va,f.internal=!1),a==f.CbEvent_END?g=f.id_CbEvent_END:(null==f.CbEvent_ONGOING&&(f.internal=!0,f.CbEvent_ONGOING=new va,f.internal=!1),a==f.CbEvent_ONGOING&&(g=f.id_CbEvent_ONGOING)));this.zpp_inner=this.zpp_inner_zn=new R(Qc.argument(c),
Qc.argument(d),g,f.id_ListenerType_INTERACTION);this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zni=this;this.zpp_inner.precedence=v;this.zpp_inner_zn.handleri=e;this.set_interactionType(b)};h["nape.callbacks.InteractionListener"]=cd;cd.__name__=!0;cd.__super__=Kb;cd.prototype=t(Kb.prototype,{get_interactionType:function(){var a=this.zpp_inner_zn.itype;if(a==f.id_InteractionType_COLLISION)return null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new T,f.internal=!1),f.InteractionType_COLLISION;
if(a==f.id_InteractionType_SENSOR)return null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new T,f.internal=!1),f.InteractionType_SENSOR;if(a==f.id_InteractionType_FLUID)return null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new T,f.internal=!1),f.InteractionType_FLUID;return a==f.id_InteractionType_ANY?(null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new T,f.internal=!1),f.InteractionType_ANY):null},set_interactionType:function(a){if(this.get_interactionType()!=
a){var b=this.zpp_inner_zn;null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new T,f.internal=!1);a==f.InteractionType_COLLISION?a=f.id_InteractionType_COLLISION:(null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new T,f.internal=!1),a==f.InteractionType_SENSOR?a=f.id_InteractionType_SENSOR:(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new T,f.internal=!1),a=a==f.InteractionType_FLUID?f.id_InteractionType_FLUID:f.id_InteractionType_ANY));
b.itype=a}return this.get_interactionType()},__class__:cd});var T=function(){};h["nape.callbacks.InteractionType"]=T;T.__name__=!0;T.prototype={toString:function(){var a;null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new T,f.internal=!1);this==f.InteractionType_COLLISION?a="COLLISION":(null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new T,f.internal=!1),this==f.InteractionType_SENSOR?a="SENSOR":(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=
new T,f.internal=!1),this==f.InteractionType_FLUID?a="FLUID":(null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new T,f.internal=!1),a=this==f.InteractionType_ANY?"ANY":"")));return a},__class__:T};var Mb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.callbacks.ListenerIterator"]=Mb;Mb.__name__=!0;Mb.get=function(a){var b;null==Mb.zpp_pool?(Rc.internal=!0,b=new Mb,Rc.internal=!1):(b=Mb.zpp_pool,Mb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=
a;b.zpp_critical=!1;return b};Mb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Mb.zpp_pool;Mb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Mb};var qg=function(){this.zpp_inner=null;this.zpp_inner=new Rc;this.zpp_inner.outer=this};h["nape.callbacks.ListenerList"]=qg;qg.__name__=!0;qg.prototype={get_length:function(){this.zpp_inner.valmod();
this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},
push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&
this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),
null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a=
"[",b=!0,c;this.zpp_inner.valmod();for(c=Mb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:qg};var cc=function(){};h["nape.callbacks.ListenerType"]=cc;cc.__name__=!0;cc.prototype={toString:function(){var a;null==f.ListenerType_BODY&&(f.internal=!0,f.ListenerType_BODY=new cc,f.internal=!1);this==f.ListenerType_BODY?a="BODY":(null==f.ListenerType_CONSTRAINT&&(f.internal=!0,f.ListenerType_CONSTRAINT=
new cc,f.internal=!1),this==f.ListenerType_CONSTRAINT?a="CONSTRAINT":(null==f.ListenerType_INTERACTION&&(f.internal=!0,f.ListenerType_INTERACTION=new cc,f.internal=!1),this==f.ListenerType_INTERACTION?a="INTERACTION":(null==f.ListenerType_PRE&&(f.internal=!0,f.ListenerType_PRE=new cc,f.internal=!1),a=this==f.ListenerType_PRE?"PRE":"")));return a},__class__:cc};var wd=function(a,b){this.zpp_inner=null;this.zpp_inner=new Qc;this.zpp_inner.outer=this;null!=a&&this.including(a);null!=b&&this.excluding(b)};
h["nape.callbacks.OptionType"]=wd;wd.__name__=!0;wd.prototype={including:function(a){this.zpp_inner.append(this.zpp_inner.includes,a);return this},excluding:function(a){this.zpp_inner.append(this.zpp_inner.excludes,a);return this},toString:function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var a=this.zpp_inner.wrap_includes.toString();null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes();return"@{"+a+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},
__class__:wd};var of=function(){this.zpp_inner=null};h["nape.callbacks.PreCallback"]=of;of.__name__=!0;of.__super__=Jb;of.prototype=t(Jb.prototype,{toString:function(){var a;a="Cb:PRE:"+(":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString());a+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString();return a+=" : listnener: "+y.string(this.zpp_inner.listener.outer)},__class__:of});var Ca=function(){};h["nape.callbacks.PreFlag"]=Ca;Ca.__name__=!0;Ca.prototype={toString:function(){var a;
null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);this==f.PreFlag_ACCEPT?a="ACCEPT":(null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1),this==f.PreFlag_IGNORE?a="IGNORE":(null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1),this==f.PreFlag_ACCEPT_ONCE?a="ACCEPT_ONCE":(null==f.PreFlag_IGNORE_ONCE&&(f.internal=!0,f.PreFlag_IGNORE_ONCE=new Ca,f.internal=!1),a=this==f.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")));return a},
__class__:Ca};var gf=function(a,b,c,d,e,v){null==v&&(v=!1);null==e&&(e=0);this.zpp_inner=this.zpp_inner_zn=null;this.zpp_inner=this.zpp_inner_zn=new R(Qc.argument(b),Qc.argument(c),f.id_CbEvent_PRE,f.id_ListenerType_PRE);this.zpp_inner.outer=this;this.zpp_inner_zn.outer_znp=this;this.zpp_inner.precedence=e;this.zpp_inner_zn.pure=v;this.zpp_inner_zn.handlerp=d;this.set_interactionType(a)};h["nape.callbacks.PreListener"]=gf;gf.__name__=!0;gf.__super__=Kb;gf.prototype=t(Kb.prototype,{get_interactionType:function(){var a=
this.zpp_inner_zn.itype;if(a==f.id_InteractionType_COLLISION)return null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new T,f.internal=!1),f.InteractionType_COLLISION;if(a==f.id_InteractionType_SENSOR)return null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new T,f.internal=!1),f.InteractionType_SENSOR;if(a==f.id_InteractionType_FLUID)return null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new T,f.internal=!1),f.InteractionType_FLUID;
return a==f.id_InteractionType_ANY?(null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new T,f.internal=!1),f.InteractionType_ANY):null},set_interactionType:function(a){if(this.get_interactionType()!=a){var b=this.zpp_inner_zn;null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new T,f.internal=!1);a==f.InteractionType_COLLISION?a=f.id_InteractionType_COLLISION:(null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new T,f.internal=!1),a==
f.InteractionType_SENSOR?a=f.id_InteractionType_SENSOR:(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new T,f.internal=!1),a=a==f.InteractionType_FLUID?f.id_InteractionType_FLUID:f.id_InteractionType_ANY));b.itype=a}return this.get_interactionType()},__class__:gf});var Za=function(){this.zpp_inner.insert_cbtype(ga.ANY_CONSTRAINT.zpp_inner)};h["nape.constraint.Constraint"]=Za;Za.__name__=!0;Za.prototype={set_space:function(a){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=
a)null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=a?a.zpp_inner.wrap_constraints.add(this):this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_active:function(a){this.zpp_inner.active!=a&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),a?(this.zpp_inner.active=
a,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=a,this.zpp_inner.deactivate()));return this.zpp_inner.active},set_stiff:function(a){this.zpp_inner.stiff!=a&&(this.zpp_inner.stiff=a,this.zpp_inner.wake());return this.zpp_inner.stiff},
set_frequency:function(a){this.zpp_inner.frequency!=a&&(this.zpp_inner.frequency=a,this.zpp_inner.stiff||this.zpp_inner.wake());return this.zpp_inner.frequency},set_damping:function(a){this.zpp_inner.damping!=a&&(this.zpp_inner.damping=a,this.zpp_inner.stiff||this.zpp_inner.wake());return this.zpp_inner.damping},set_maxForce:function(a){this.zpp_inner.maxForce!=a&&(this.zpp_inner.maxForce=a,this.zpp_inner.wake());return this.zpp_inner.maxForce},toString:function(){return"{Constraint}"},__class__:Za};
var hf=function(a,b,c,d,e){null==e&&(e=1);this.zpp_inner_zn=null;this.zpp_inner=this.zpp_inner_zn=new pf;this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zn=this;Za.call(this);this.set_body1(a);this.set_body2(b);this.zpp_inner.immutable_midstep("AngleJoint::jointMin");this.zpp_inner_zn.jointMin!=c&&(this.zpp_inner_zn.jointMin=c,this.zpp_inner.wake());this.zpp_inner_zn.jointMin;this.zpp_inner.immutable_midstep("AngleJoint::jointMax");this.zpp_inner_zn.jointMax!=d&&(this.zpp_inner_zn.jointMax=d,this.zpp_inner.wake());
this.zpp_inner_zn.jointMax;this.zpp_inner.immutable_midstep("AngleJoint::ratio");this.zpp_inner_zn.ratio!=e&&(this.zpp_inner_zn.ratio=e,this.zpp_inner.wake());this.zpp_inner_zn.ratio};h["nape.constraint.AngleJoint"]=hf;hf.__name__=!0;hf.__super__=Za;hf.prototype=t(Za.prototype,{set_body1:function(a){this.zpp_inner.immutable_midstep("Constraint::body1");a=null==a?null:a.zpp_inner;if(a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&
this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),
null!=a&&a.wake();return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body2:function(a){this.zpp_inner.immutable_midstep("Constraint::body2");a=null==a?null:a.zpp_inner;if(a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:
this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),null!=a&&a.wake();return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},__class__:hf});var pb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=
0;this.zpp_inner=null};h["nape.constraint.ConstraintIterator"]=pb;pb.__name__=!0;pb.get=function(a){var b;null==pb.zpp_pool?(Nb.internal=!0,b=new pb,Nb.internal=!1):(b=pb.zpp_pool,pb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};pb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=pb.zpp_pool;pb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=
!1;return this.zpp_inner.at(this.zpp_i++)},__class__:pb};var rg=function(){this.zpp_inner=null;this.zpp_inner=new Nb;this.zpp_inner.outer=this};h["nape.constraint.ConstraintList"]=rg;rg.__name__=!0;rg.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<
this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&
(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&
(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;
b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=pb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:rg};var ff=function(a,
b,c,d,e,f,g){this.zpp_inner_zn=null;this.zpp_inner=this.zpp_inner_zn=new qf;this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zn=this;Za.call(this);this.set_body1(a);this.set_body2(b);null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1.set(c);null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1;null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();this.zpp_inner_zn.wrap_a2.set(d);null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();
this.zpp_inner_zn.wrap_a2;null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();this.zpp_inner_zn.wrap_n.set(e);null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();this.zpp_inner_zn.wrap_n;this.zpp_inner.immutable_midstep("LineJoint::jointMin");this.zpp_inner_zn.jointMin!=f&&(this.zpp_inner_zn.jointMin=f,this.zpp_inner.wake());this.zpp_inner_zn.jointMin;this.zpp_inner.immutable_midstep("LineJoint::jointMax");this.zpp_inner_zn.jointMax!=g&&(this.zpp_inner_zn.jointMax=g,this.zpp_inner.wake());
this.zpp_inner_zn.jointMax};h["nape.constraint.LineJoint"]=ff;ff.__name__=!0;ff.__super__=Za;ff.prototype=t(Za.prototype,{set_body1:function(a){this.zpp_inner.immutable_midstep("Constraint::body1");a=null==a?null:a.zpp_inner;if(a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&
null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),null!=a&&a.wake();return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body2:function(a){this.zpp_inner.immutable_midstep("Constraint::body2");
a=null==a?null:a.zpp_inner;if(a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&
this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),null!=a&&a.wake();return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},__class__:ff});var jf=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);this.zpp_inner_zn=null;this.zpp_inner=this.zpp_inner_zn=new rf;this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zn=this;Za.call(this);this.set_body1(a);this.set_body2(b);
this.zpp_inner.immutable_midstep("MotorJoint::rate");this.zpp_inner_zn.rate!=c&&(this.zpp_inner_zn.rate=c,this.zpp_inner.wake());this.zpp_inner_zn.rate;this.zpp_inner.immutable_midstep("MotorJoint::ratio");this.zpp_inner_zn.ratio!=d&&(this.zpp_inner_zn.ratio=d,this.zpp_inner.wake());this.zpp_inner_zn.ratio};h["nape.constraint.MotorJoint"]=jf;jf.__name__=!0;jf.__super__=Za;jf.prototype=t(Za.prototype,{set_body1:function(a){this.zpp_inner.immutable_midstep("Constraint::body1");a=null==a?null:a.zpp_inner;
if(a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=
a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),null!=a&&a.wake();return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body2:function(a){this.zpp_inner.immutable_midstep("Constraint::body2");a=null==a?null:a.zpp_inner;if(a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&
null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),null!=a&&a.wake();
return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},__class__:jf});var Ed=function(a,b,c,d){this.zpp_inner_zn=null;this.zpp_inner=this.zpp_inner_zn=new sf;this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zn=this;Za.call(this);this.set_body1(a);this.set_body2(b);null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1.set(c);null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1;null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();
this.zpp_inner_zn.wrap_a2.set(d);null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();this.zpp_inner_zn.wrap_a2};h["nape.constraint.PivotJoint"]=Ed;Ed.__name__=!0;Ed.__super__=Za;Ed.prototype=t(Za.prototype,{set_body1:function(a){this.zpp_inner.immutable_midstep("Constraint::body1");a=null==a?null:a.zpp_inner;if(a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&
this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),null!=a&&a.wake();return null==this.zpp_inner_zn.b1?
null:this.zpp_inner_zn.b1.outer},set_body2:function(a){this.zpp_inner.immutable_midstep("Constraint::body2");a=null==a?null:a.zpp_inner;if(a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),
this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)))this.zpp_inner.wake(),null!=a&&a.wake();return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();return this.zpp_inner_zn.wrap_a1},get_anchor2:function(){null==
this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();return this.zpp_inner_zn.wrap_a2},__class__:Ed});var Sc=function(){this.zpp_inner=null};h["nape.dynamics.Arbiter"]=Sc;Sc.__name__=!0;Sc.prototype={get_collisionArbiter:function(){return this.zpp_inner.type==C.COL?this.zpp_inner.colarb.outer_zn:null},get_state:function(){var a=this.zpp_inner.immState;if(a==(f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS))return null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1),f.PreFlag_ACCEPT;
switch(a){case f.id_ImmState_ACCEPT:return null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1),f.PreFlag_ACCEPT_ONCE;default:if(a==(f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS))return null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1),f.PreFlag_IGNORE;null==f.PreFlag_IGNORE_ONCE&&(f.internal=!0,f.PreFlag_IGNORE_ONCE=new Ca,f.internal=!1);return f.PreFlag_IGNORE_ONCE}},toString:function(){var a;a=this.zpp_inner.type==C.COL?"CollisionArbiter":
this.zpp_inner.type==C.FLUID?"FluidArbiter":"SensorArbiter";return this.zpp_inner.cleared?a+"(object-pooled)":a+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).toString()+"|"+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).toString()+")"+(this.zpp_inner.type==C.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"")+"<-"+this.get_state().toString()},__class__:Sc};var uc=function(){this.zpp_next=
null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.dynamics.ArbiterIterator"]=uc;uc.__name__=!0;uc.get=function(a){var b;null==uc.zpp_pool?(ed.internal=!0,b=new uc,ed.internal=!1):(b=uc.zpp_pool,uc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};uc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.zpp_gl();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=uc.zpp_pool;uc.zpp_pool=this;this.zpp_inner=null;return!1},
next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:uc};var sg=function(){this.zpp_inner=null;this.zpp_inner=new ed;this.zpp_inner.outer=this};h["nape.dynamics.ArbiterList"]=sg;sg.__name__=!0;sg.prototype={zpp_gl:function(){this.zpp_inner.valmod();if(this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1;this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.head;null!=a;)a.elt.active&&this.zpp_inner.user_length++,a=a.next}return this.zpp_inner.user_length},
zpp_vm:function(){this.zpp_inner.valmod()},at:function(a){this.zpp_vm();this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite){this.zpp_inner.at_index=0;for(this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=a;){this.zpp_inner.at_index++;for(this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=
this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.elt.wrapper()},iterator:function(){this.zpp_vm();return uc.get(this)},toString:function(){for(var a="[",b=!0,c=this.iterator();c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:sg};var xd=function(){};h["nape.dynamics.ArbiterType"]=xd;xd.__name__=!0;xd.prototype={toString:function(){var a;null==f.ArbiterType_COLLISION&&(f.internal=!0,f.ArbiterType_COLLISION=
new xd,f.internal=!1);this==f.ArbiterType_COLLISION?a="COLLISION":(null==f.ArbiterType_SENSOR&&(f.internal=!0,f.ArbiterType_SENSOR=new xd,f.internal=!1),this==f.ArbiterType_SENSOR?a="SENSOR":(null==f.ArbiterType_FLUID&&(f.internal=!0,f.ArbiterType_FLUID=new xd,f.internal=!1),a=this==f.ArbiterType_FLUID?"FLUID":""));return a},__class__:xd};var tf=function(){this.zpp_inner=null};h["nape.dynamics.CollisionArbiter"]=tf;tf.__name__=!0;tf.__super__=Sc;tf.prototype=t(Sc.prototype,{__class__:tf});var tg=
function(){this.zpp_inner=null};h["nape.dynamics.Contact"]=tg;tg.__name__=!0;tg.prototype={toString:function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},__class__:tg};var vc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.dynamics.ContactIterator"]=vc;vc.__name__=!0;vc.get=function(a){var b;null==vc.zpp_pool?(de.internal=!0,b=new vc,de.internal=!1):(b=vc.zpp_pool,vc.zpp_pool=b.zpp_next);b.zpp_i=0;
b.zpp_inner=a;b.zpp_critical=!1;return b};vc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=vc.zpp_pool;vc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:vc};var Vg=function(){this.zpp_inner=null};h["nape.dynamics.ContactList"]=Vg;Vg.__name__=!0;Vg.prototype={get_length:function(){this.zpp_inner.valmod();
if(this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1;this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.next;null!=a;){var b=a;b.active&&b.arbiter.active&&this.zpp_inner.user_length++;a=a.next}}return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite){this.zpp_inner.at_index=0;for(this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var b=this.zpp_inner.at_ite;
if(b.active&&b.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}}for(;this.zpp_inner.at_index!=a;){this.zpp_inner.at_index++;for(this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){b=this.zpp_inner.at_ite;if(b.active&&b.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}}return this.zpp_inner.at_ite.wrapper()},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=vc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||
(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Vg};var uf=function(){this.zpp_inner=null};h["nape.dynamics.FluidArbiter"]=uf;uf.__name__=!0;uf.__super__=Sc;uf.prototype=t(Sc.prototype,{__class__:uf});var ug=function(a,b,c,d,e,f){null==f&&(f=-1);null==e&&(e=1);null==d&&(d=-1);null==c&&(c=1);null==b&&(b=-1);null==a&&(a=1);this.zpp_inner=null;null==Ha.zpp_pool?this.zpp_inner=new Ha:(this.zpp_inner=Ha.zpp_pool,Ha.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);null;this.zpp_inner.outer=
this;this.zpp_inner.collisionGroup!=a&&(this.zpp_inner.collisionGroup=a,this.zpp_inner.invalidate());this.zpp_inner.collisionGroup;this.zpp_inner.collisionMask!=b&&(this.zpp_inner.collisionMask=b,this.zpp_inner.invalidate());this.zpp_inner.collisionMask;this.zpp_inner.sensorGroup!=c&&(this.zpp_inner.sensorGroup=c,this.zpp_inner.invalidate());this.zpp_inner.sensorGroup;this.zpp_inner.sensorMask!=d&&(this.zpp_inner.sensorMask=d,this.zpp_inner.invalidate());this.zpp_inner.sensorMask;this.zpp_inner.fluidGroup!=
e&&(this.zpp_inner.fluidGroup=e,this.zpp_inner.invalidate());this.zpp_inner.fluidGroup;this.zpp_inner.fluidMask!=f&&(this.zpp_inner.fluidMask=f,this.zpp_inner.invalidate());this.zpp_inner.fluidMask};h["nape.dynamics.InteractionFilter"]=ug;ug.__name__=!0;ug.prototype={set_collisionMask:function(a){this.zpp_inner.collisionMask!=a&&(this.zpp_inner.collisionMask=a,this.zpp_inner.invalidate());return this.zpp_inner.collisionMask},__class__:ug};var Wg=function(){this.zpp_inner=null};h["nape.dynamics.InteractionGroup"]=
Wg;Wg.__name__=!0;Wg.prototype={toString:function(){var a="InteractionGroup";this.zpp_inner.ignore&&(a+=":ignore");return a},__class__:Wg};var dc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.dynamics.InteractionGroupIterator"]=dc;dc.__name__=!0;dc.get=function(a){var b;null==dc.zpp_pool?(Kd.internal=!0,b=new dc,Kd.internal=!1):(b=dc.zpp_pool,dc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};dc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();
var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=dc.zpp_pool;dc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:dc};var Xg=function(){this.zpp_inner=null};h["nape.dynamics.InteractionGroupList"]=Xg;Xg.__name__=!0;Xg.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);
return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=dc.get(this);c.hasNext();){var d;
c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Xg};var Yg=function(){this.zpp_inner=null};h["nape.geom.AABB"]=Yg;Yg.__name__=!0;Yg.prototype={toString:function(){this.zpp_inner.validate();return this.zpp_inner.toString()},__class__:Yg};var Zg=function(){this.zpp_inner=null};h["nape.geom.ConvexResult"]=Zg;Zg.__name__=!0;Zg.prototype={toString:function(){return"{ shape: "+y.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+
" }"},__class__:Zg};var ec=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.ConvexResultIterator"]=ec;ec.__name__=!0;ec.get=function(a){var b;null==ec.zpp_pool?(yd.internal=!0,b=new ec,yd.internal=!1):(b=ec.zpp_pool,ec.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};ec.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=
ec.zpp_pool;ec.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:ec};var $g=function(){this.zpp_inner=null};h["nape.geom.ConvexResultList"]=$g;$g.__name__=!0;$g.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&
(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=ec.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();
b=!1}return a+"]"},__class__:$g};var vg=function(){this.zpp_inner=null};h["nape.geom.GeomPoly"]=vg;vg.__name__=!0;vg.prototype={toString:function(){var a="GeomPoly[",b=this.zpp_inner.vertices,c=this.zpp_inner.vertices;if(null!=b){do{var d=b;d!=this.zpp_inner.vertices&&(a+=",");a+="{"+d.x+","+d.y+"}";b=b.next}while(b!=c)}return a+"]"},__class__:vg};var wc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.GeomPolyIterator"]=wc;wc.__name__=!0;wc.get=function(a){var b;
null==wc.zpp_pool?(ee.internal=!0,b=new wc,ee.internal=!1):(b=wc.zpp_pool,wc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};wc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=wc.zpp_pool;wc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:wc};var ah=function(){this.zpp_inner=null};h["nape.geom.GeomPolyList"]=
ah;ah.__name__=!0;ah.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,
this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=wc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:ah};var bh=function(){this.zpp_inner=null};h["nape.geom.Mat23"]=bh;bh.__name__=!0;bh.prototype={toString:function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+
" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},__class__:bh};var ch=function(){this.zpp_inner=null};h["nape.geom.MatMN"]=ch;ch.__name__=!0;ch.prototype={toString:function(){for(var a="{ ",b=!0,c=0,d=this.zpp_inner.m;c<d;){var e=c++;b||(a+="; ");for(var b=!1,f=0,g=this.zpp_inner.n;f<g;)var j=f++,a=a+(this.zpp_inner.x[e*this.zpp_inner.n+j]+" ")}return a+"}"},__class__:ch};var dh=function(){this.zpp_inner=null};h["nape.geom.RayResult"]=dh;dh.__name__=!0;dh.prototype=
{toString:function(){return"{ shape: "+y.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+y.string(this.zpp_inner.inner)+" }"},__class__:dh};var Ob=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.RayResultIterator"]=Ob;Ob.__name__=!0;Ob.get=function(a){var b;null==Ob.zpp_pool?(zd.internal=!0,b=new Ob,zd.internal=!1):(b=Ob.zpp_pool,Ob.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Ob.prototype=
{hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Ob.zpp_pool;Ob.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Ob};var eh=function(){this.zpp_inner=null};h["nape.geom.RayResultList"]=eh;eh.__name__=!0;eh.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,
this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},toString:function(){var a="[",
b=!0,c;this.zpp_inner.valmod();for(c=Ob.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:eh};var x=function(a,b){null==b&&(b=0);null==a&&(a=0);this.zpp_inner=this.zpp_pool=null;this.zpp_inner=K.get(a,b,null);this.zpp_inner.outer=this};h["nape.geom.Vec2"]=x;x.__name__=!0;x.get=function(a,b,c){null==c&&(c=!1);null==b&&(b=0);null==a&&(a=0);var d;null==Ld.poolVec2?d=new x:(d=Ld.poolVec2,Ld.poolVec2=d.zpp_pool,
d.zpp_pool=null);if(null==d.zpp_inner)d.zpp_inner=K.get(a,b,null),d.zpp_inner.outer=d;else{var e;d.zpp_inner.validate();if(e=d.zpp_inner.x==a)d.zpp_inner.validate(),e=d.zpp_inner.y==b;e||(d.zpp_inner.x=a,d.zpp_inner.y=b,d.zpp_inner.invalidate());d}d.zpp_inner.weak=c;return d};x.prototype={dispose:function(){var a=this.zpp_inner;this.zpp_inner=this.zpp_inner.outer=null;this.zpp_pool=Ld.poolVec2;Ld.poolVec2=this;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;
a._invalidate=null;a.next=K.zpp_pool;K.zpp_pool=a},get_x:function(){this.zpp_inner.validate();return this.zpp_inner.x},set_x:function(a){this.zpp_inner.validate();this.zpp_inner.x!=a&&(this.zpp_inner.x=a,this.zpp_inner.invalidate());this.zpp_inner.validate();return this.zpp_inner.x},get_y:function(){this.zpp_inner.validate();return this.zpp_inner.y},set_y:function(a){this.zpp_inner.validate();this.zpp_inner.y!=a&&(this.zpp_inner.y=a,this.zpp_inner.invalidate());this.zpp_inner.validate();return this.zpp_inner.y},
set_length:function(a){var a=a/Math.sqrt(function(a){a.zpp_inner.validate();return a.zpp_inner.x}(this)*function(a){a.zpp_inner.validate();return a.zpp_inner.x}(this)+function(a){a.zpp_inner.validate();return a.zpp_inner.y}(this)*function(a){a.zpp_inner.validate();return a.zpp_inner.y}(this)),b=this;b.set_x(function(){b.zpp_inner.validate();return b.zpp_inner.x}(this)*a);var c=this;c.set_y(function(){c.zpp_inner.validate();return c.zpp_inner.y}(this)*a);this.zpp_inner.invalidate();return Math.sqrt(function(a){a.zpp_inner.validate();
return a.zpp_inner.x}(this)*function(a){a.zpp_inner.validate();return a.zpp_inner.x}(this)+function(a){a.zpp_inner.validate();return a.zpp_inner.y}(this)*function(a){a.zpp_inner.validate();return a.zpp_inner.y}(this))},lsq:function(){var a;this.zpp_inner.validate();a=this.zpp_inner.x;this.zpp_inner.validate();a*=this.zpp_inner.x;var b;this.zpp_inner.validate();b=this.zpp_inner.y;this.zpp_inner.validate();return a+b*this.zpp_inner.y},set:function(a){var b=this.setxy(function(){a.zpp_inner.validate();
return a.zpp_inner.x}(this),function(){a.zpp_inner.validate();return a.zpp_inner.y}(this));a.zpp_inner.weak?(a.dispose(),!0):!1;return b},setxy:function(a,b){var c;this.zpp_inner.validate();if(c=this.zpp_inner.x==a)this.zpp_inner.validate(),c=this.zpp_inner.y==b;c||(this.zpp_inner.x=a,this.zpp_inner.y=b,this.zpp_inner.invalidate());return this},sub:function(a,b){null==b&&(b=!1);var c=x.get(function(a){a.zpp_inner.validate();return a.zpp_inner.x}(this)-function(){a.zpp_inner.validate();return a.zpp_inner.x}(this),
function(a){a.zpp_inner.validate();return a.zpp_inner.y}(this)-function(){a.zpp_inner.validate();return a.zpp_inner.y}(this),b);a.zpp_inner.weak?(a.dispose(),!0):!1;return c},subeq:function(a){this.setxy(function(a){a.zpp_inner.validate();return a.zpp_inner.x}(this)-function(){a.zpp_inner.validate();return a.zpp_inner.x}(this),function(a){a.zpp_inner.validate();return a.zpp_inner.y}(this)-function(){a.zpp_inner.validate();return a.zpp_inner.y}(this));a.zpp_inner.weak?(a.dispose(),!0):!1;return this},
muleq:function(a){return this.setxy(function(a){a.zpp_inner.validate();return a.zpp_inner.x}(this)*a,function(a){a.zpp_inner.validate();return a.zpp_inner.y}(this)*a)},toString:function(){this.zpp_inner.validate();return this.zpp_inner.toString()},__class__:x};var Da=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.Vec2Iterator"]=Da;Da.__name__=!0;Da.get=function(a){var b;null==Da.zpp_pool?(fc.internal=!0,b=new Da,fc.internal=!1):(b=Da.zpp_pool,Da.zpp_pool=
b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Da.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.zpp_gl();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Da.zpp_pool;Da.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Da};var Tc=function(){this.zpp_inner=null;this.zpp_inner=new fc;this.zpp_inner.outer=this};h["nape.geom.Vec2List"]=Tc;Tc.__name__=!0;Tc.prototype=
{zpp_gl:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},at:function(a){this.zpp_vm();this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,
this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},push:function(a){this.zpp_inner.modify_test();this.zpp_vm();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),
null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},empty:function(){return 0==this.zpp_gl()},iterator:function(){this.zpp_vm();return Da.get(this)},toString:function(){for(var a="[",b=!0,c=this.iterator();c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Tc};var fh=function(){this.zpp_inner=null};h["nape.geom.Vec3"]=fh;fh.__name__=!0;fh.prototype={toString:function(){this.zpp_inner.validate();
var a="{ x: "+this.zpp_inner.x+" y: ";this.zpp_inner.validate();a=a+this.zpp_inner.y+" z: ";this.zpp_inner.validate();return a+this.zpp_inner.z+" }"},__class__:fh};var Md=function(){};h["nape.geom.Winding"]=Md;Md.__name__=!0;Md.prototype={toString:function(){var a;null==f.Winding_UNDEFINED&&(f.internal=!0,f.Winding_UNDEFINED=new Md,f.internal=!1);this==f.Winding_UNDEFINED?a="UNDEFINED":(null==f.Winding_CLOCKWISE&&(f.internal=!0,f.Winding_CLOCKWISE=new Md,f.internal=!1),this==f.Winding_CLOCKWISE?a=
"CLOCKWISE":(null==f.Winding_ANTICLOCKWISE&&(f.internal=!0,f.Winding_ANTICLOCKWISE=new Md,f.internal=!1),a=this==f.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""));return a},__class__:Md};var fd=function(){this.zpp_inner_i=null};h["nape.phys.Interactor"]=fd;fd.__name__=!0;fd.prototype={get_userData:function(){null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={});return this.zpp_inner_i.userData},get_castBody:function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},get_cbTypes:function(){null==
this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes();return this.zpp_inner_i.wrap_cbTypes},toString:function(){return""},__class__:fd};var qb=function(a,b){this.zpp_inner_i=this.zpp_inner=null;this.zpp_inner=new Uc;this.zpp_inner.outer=this;this.zpp_inner.outer_i=this;this.zpp_inner_i=this.zpp_inner;null!=b?(b.zpp_inner.validate(),this.zpp_inner.posx=b.zpp_inner.x,b.zpp_inner.validate(),this.zpp_inner.posy=b.zpp_inner.y):(this.zpp_inner.posx=0,this.zpp_inner.posy=0);this.set_type(null==
a?function(){null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new da,f.internal=!1);return f.BodyType_DYNAMIC}(this):a);null!=b&&(b.zpp_inner.weak?(b.dispose(),!0):!1);this.zpp_inner_i.insert_cbtype(ga.ANY_BODY.zpp_inner)};h["nape.phys.Body"]=qb;qb.__name__=!0;qb.__super__=fd;qb.prototype=t(fd.prototype,{set_type:function(a){this.zpp_inner.immutable_midstep("Body::type");Uc.types[this.zpp_inner.type]!=a&&(null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new da,f.internal=!1),
a==f.BodyType_DYNAMIC?a=f.id_BodyType_DYNAMIC:(null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new da,f.internal=!1),a=a==f.BodyType_KINEMATIC?f.id_BodyType_KINEMATIC:f.id_BodyType_STATIC),a==f.id_BodyType_STATIC&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,a):this.zpp_inner.type=a);return Uc.types[this.zpp_inner.type]},
get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(a){this.zpp_inner.immutable_midstep("Body::space");if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=a){if(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer))this.zpp_inner.component.woken=!1;if(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer))(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this);null!=
a&&a.zpp_inner.wrap_bodies.add(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},get_position:function(){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();return this.zpp_inner.wrap_pos},get_velocity:function(){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();return this.zpp_inner.wrap_vel},set_rotation:function(a){this.zpp_inner.immutable_midstep("Body::rotation");this.zpp_inner.rot!=a&&(this.zpp_inner.rot=a,this.zpp_inner.invalidate_rot(),this.zpp_inner.wake());
return this.zpp_inner.rot},worldPointToLocal:function(a,b){null==b&&(b=!1);this.zpp_inner.validate_axis();var c=0,d=0,e=d=0;a.zpp_inner.validate();d=a.zpp_inner.x-this.zpp_inner.posx;a.zpp_inner.validate();e=a.zpp_inner.y-this.zpp_inner.posy;c=d*this.zpp_inner.axisy+e*this.zpp_inner.axisx;d=e*this.zpp_inner.axisy-d*this.zpp_inner.axisx;a.zpp_inner.weak?(a.dispose(),!0):!1;return x.get(c,d,b)},localVectorToWorld:function(a,b){null==b&&(b=!1);this.zpp_inner.validate_axis();var c=0,d=0,c=this.zpp_inner.axisy;
a.zpp_inner.validate();c*=a.zpp_inner.x;d=this.zpp_inner.axisx;a.zpp_inner.validate();c-=d*a.zpp_inner.y;a.zpp_inner.validate();d=a.zpp_inner.x*this.zpp_inner.axisx;a.zpp_inner.validate();d+=a.zpp_inner.y*this.zpp_inner.axisy;a.zpp_inner.weak?(a.dispose(),!0):!1;return x.get(c,d,b)},applyImpulse:function(a,b,c){null==c&&(c=!1);if(c&&this.zpp_inner.component.sleeping)return a.zpp_inner.weak?(a.dispose(),!0):!1,null!=b&&(b.zpp_inner.weak?(b.dispose(),!0):!1),this;this.zpp_inner.validate_mass();var d=
this.zpp_inner.imass,e=this.zpp_inner,v=this.zpp_inner.velx;a.zpp_inner.validate();e.velx=v+a.zpp_inner.x*d;e=this.zpp_inner;v=this.zpp_inner.vely;a.zpp_inner.validate();e.vely=v+a.zpp_inner.y*d;if(null!=b){var g=0,d=0;b.zpp_inner.validate();g=b.zpp_inner.x-this.zpp_inner.posx;b.zpp_inner.validate();d=b.zpp_inner.y-this.zpp_inner.posy;this.zpp_inner.validate_inertia();e=this.zpp_inner;v=this.zpp_inner.angvel;a.zpp_inner.validate();g*=a.zpp_inner.y;a.zpp_inner.validate();e.angvel=v+(g-a.zpp_inner.x*
d)*this.zpp_inner.iinertia;b.zpp_inner.weak?(b.dispose(),!0):!1}c||this.zpp_inner.type==f.id_BodyType_DYNAMIC&&this.zpp_inner.wake();a.zpp_inner.weak?(a.dispose(),!0):!1;return this},translateShapes:function(a){this.zpp_inner.immutable_midstep("Body::translateShapes()");var b=a.zpp_inner.weak;a.zpp_inner.weak=!1;for(var c=this.zpp_inner.shapes.head;null!=c;)c.elt.outer.translate(a),c=c.next;a.zpp_inner.weak=b;a.zpp_inner.weak?(a.dispose(),!0):!1;return this},scaleShapes:function(a,b){this.zpp_inner.immutable_midstep("Body::scaleShapes()");
for(var c=this.zpp_inner.shapes.head;null!=c;)c.elt.outer.scale(a,b),c=c.next;return this},align:function(){this.zpp_inner.immutable_midstep("Body::align()");this.zpp_inner.validate_localCOM();var a=x.get(-this.zpp_inner.localCOMx,-this.zpp_inner.localCOMy,null);this.translateShapes(a);var b=this.localVectorToWorld(a);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();this.zpp_inner.wrap_pos.subeq(b);if(this.zpp_inner.pre_posx<Math.POSITIVE_INFINITY){var c=this.zpp_inner,d=this.zpp_inner.pre_posx;
b.zpp_inner.validate();c.pre_posx=d-1*b.zpp_inner.x;c=this.zpp_inner;d=this.zpp_inner.pre_posy;b.zpp_inner.validate();c.pre_posy=d-1*b.zpp_inner.y}a.dispose();b.dispose();return this},setShapeMaterials:function(a){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var b=this.zpp_inner.shapes.head;null!=b;)b.elt.outer.set_material(a),b=b.next;return this},get_localCOM:function(){null==this.zpp_inner.wrap_localCOM&&(this.zpp_inner.wrap_localCOM=x.get(this.zpp_inner.localCOMx,this.zpp_inner.localCOMy,
null),this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=(Xe=this.zpp_inner,n(Xe,Xe.getlocalCOM)));return this.zpp_inner.wrap_localCOM},toString:function(){return(this.zpp_inner.world?"(space::world":"("+(this.zpp_inner.type==f.id_BodyType_DYNAMIC?"dynamic":this.zpp_inner.type==f.id_BodyType_STATIC?"static":"kinematic"))+")#"+this.zpp_inner_i.id},__class__:qb});var ib=function(){this.zpp_next=null;
this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.phys.BodyIterator"]=ib;ib.__name__=!0;ib.get=function(a){var b;null==ib.zpp_pool?(ka.internal=!0,b=new ib,ka.internal=!1):(b=ib.zpp_pool,ib.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};ib.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=ib.zpp_pool;ib.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=
!1;return this.zpp_inner.at(this.zpp_i++)},__class__:ib};var fe=function(){this.zpp_inner=null;this.zpp_inner=new ka;this.zpp_inner.outer=this};h["nape.phys.BodyList"]=fe;fe.__name__=!0;fe.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},has:function(a){this.zpp_inner.valmod();return this.zpp_inner.inner.has(a.zpp_inner)},at:function(a){this.zpp_inner.valmod();
this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?
this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):
!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();
this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},iterator:function(){this.zpp_inner.valmod();return ib.get(this)},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=ib.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||
(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:fe};var da=function(){};h["nape.phys.BodyType"]=da;da.__name__=!0;da.prototype={toString:function(){var a;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);this==f.BodyType_STATIC?a="STATIC":(null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new da,f.internal=!1),this==f.BodyType_DYNAMIC?a="DYNAMIC":(null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new da,f.internal=!1),a=
this==f.BodyType_KINEMATIC?"KINEMATIC":""));return a},__class__:da};var Ee=function(){this.zpp_inner_i=this.zpp_inner=null;this.zpp_inner=new vf;this.zpp_inner.outer=this;this.zpp_inner.outer_i=this;this.zpp_inner_i=this.zpp_inner;this.zpp_inner.insert_cbtype(ga.ANY_COMPOUND.zpp_inner)};h["nape.phys.Compound"]=Ee;Ee.__name__=!0;Ee.__super__=fd;Ee.prototype=t(fd.prototype,{set_space:function(a){this.zpp_inner.immutable_midstep("Compound::space");if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=
a){if(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer))(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this);null!=a&&a.zpp_inner.wrap_compounds.add(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},toString:function(){return"Compound"+this.zpp_inner_i.id},__class__:Ee});var Pb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.phys.CompoundIterator"]=Pb;Pb.__name__=!0;Pb.get=
function(a){var b;null==Pb.zpp_pool?(Vc.internal=!0,b=new Pb,Vc.internal=!1):(b=Pb.zpp_pool,Pb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Pb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Pb.zpp_pool;Pb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Pb};var wg=function(){this.zpp_inner=
null;this.zpp_inner=new Vc;this.zpp_inner.outer=this};h["nape.phys.CompoundList"]=wg;wg.__name__=!0;wg.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=
this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-
1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-
1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&
this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Pb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:wg};var gh=function(){this.zpp_inner=null};h["nape.phys.FluidProperties"]=gh;gh.__name__=!0;gh.prototype={toString:function(){return"{ density: "+1E3*
this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+y.string(this.zpp_inner.wrap_gravity)+" }"},__class__:gh};var Nd=function(){};h["nape.phys.GravMassMode"]=Nd;Nd.__name__=!0;Nd.prototype={toString:function(){var a;null==f.GravMassMode_DEFAULT&&(f.internal=!0,f.GravMassMode_DEFAULT=new Nd,f.internal=!1);this==f.GravMassMode_DEFAULT?a="DEFAULT":(null==f.GravMassMode_FIXED&&(f.internal=!0,f.GravMassMode_FIXED=new Nd,f.internal=!1),this==f.GravMassMode_FIXED?a="FIXED":(null==
f.GravMassMode_SCALED&&(f.internal=!0,f.GravMassMode_SCALED=new Nd,f.internal=!1),a=this==f.GravMassMode_SCALED?"SCALED":""));return a},__class__:Nd};var wf=function(){};h["nape.phys.InertiaMode"]=wf;wf.__name__=!0;wf.prototype={toString:function(){var a;null==f.InertiaMode_DEFAULT&&(f.internal=!0,f.InertiaMode_DEFAULT=new wf,f.internal=!1);this==f.InertiaMode_DEFAULT?a="DEFAULT":(null==f.InertiaMode_FIXED&&(f.internal=!0,f.InertiaMode_FIXED=new wf,f.internal=!1),a=this==f.InertiaMode_FIXED?"FIXED":
"");return a},__class__:wf};var Qb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.phys.InteractorIterator"]=Qb;Qb.__name__=!0;Qb.get=function(a){var b;null==Qb.zpp_pool?(ge.internal=!0,b=new Qb,ge.internal=!1):(b=Qb.zpp_pool,Qb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Qb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=
Qb.zpp_pool;Qb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Qb};var hh=function(){this.zpp_inner=null};h["nape.phys.InteractorList"]=hh;hh.__name__=!0;hh.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&
(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Qb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+
d.toString();b=!1}return a+"]"},__class__:hh};var xf=function(){};h["nape.phys.MassMode"]=xf;xf.__name__=!0;xf.prototype={toString:function(){var a;null==f.MassMode_DEFAULT&&(f.internal=!0,f.MassMode_DEFAULT=new xf,f.internal=!1);this==f.MassMode_DEFAULT?a="DEFAULT":(null==f.MassMode_FIXED&&(f.internal=!0,f.MassMode_FIXED=new xf,f.internal=!1),a=this==f.MassMode_FIXED?"FIXED":"");return a},__class__:xf};var pa=function(a,b,c,d,e){null==e&&(e=0.0010);null==d&&(d=1);null==c&&(c=2);null==b&&(b=1);null==
a&&(a=0);this.zpp_inner=null;null==I.zpp_pool?this.zpp_inner=new I:(this.zpp_inner=I.zpp_pool,I.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);null;this.zpp_inner.outer=this;a!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=a/1,this.zpp_inner.invalidate(I.WAKE|I.ARBITERS));this.zpp_inner.elasticity;b!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=b/1,this.zpp_inner.invalidate(I.WAKE|I.ANGDRAG|I.ARBITERS));this.zpp_inner.dynamicFriction;c!=this.zpp_inner.staticFriction&&
(this.zpp_inner.staticFriction=c/1,this.zpp_inner.invalidate(I.WAKE|I.ARBITERS));this.zpp_inner.staticFriction;d!=1E3*this.zpp_inner.density&&(this.zpp_inner.density=d/1E3,this.zpp_inner.invalidate(I.WAKE|I.PROPS));1E3*this.zpp_inner.density;e!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=e/1,this.zpp_inner.invalidate(I.WAKE|I.ARBITERS));this.zpp_inner.rollingFriction};h["nape.phys.Material"]=pa;pa.__name__=!0;pa.wood=function(){return new pa(0.4,0.2,0.38,0.7,0.0050)};pa.steel=
function(){return new pa(0.2,0.57,0.74,7.8,0.0010)};pa.rubber=function(){return new pa(0.8,1,1.4,1.5,0.01)};pa.prototype={toString:function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1E3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},__class__:pa};var gc=function(){this.zpp_inner_i=this.zpp_inner=null};h["nape.shape.Shape"]=gc;gc.__name__=!0;
gc.__super__=fd;gc.prototype=t(fd.prototype,{set_material:function(a){this.zpp_inner.immutable_midstep("Shape::material");this.zpp_inner.setMaterial(a.zpp_inner);return this.zpp_inner.material.wrapper()},translate:function(a){this.zpp_inner.immutable_midstep("Shape::translate()");0<a.lsq()&&(this.zpp_inner.type==f.id_ShapeType_CIRCLE?this.zpp_inner.circle.__translate(function(){a.zpp_inner.validate();return a.zpp_inner.x}(this),function(){a.zpp_inner.validate();return a.zpp_inner.y}(this)):this.zpp_inner.polygon.__translate(function(){a.zpp_inner.validate();
return a.zpp_inner.x}(this),function(){a.zpp_inner.validate();return a.zpp_inner.y}(this)));a.zpp_inner.weak?(a.dispose(),!0):!1;return this},scale:function(a,b){this.zpp_inner.immutable_midstep("Shape::scale()");if(this.zpp_inner.type==f.id_ShapeType_CIRCLE){var c=a*a-b*b;c*c<m.epsilon*m.epsilon&&this.zpp_inner.circle.__scale(a,b)}else this.zpp_inner.polygon.__scale(a,b);return this},toString:function(){return(this.zpp_inner.type==f.id_ShapeType_CIRCLE?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},
__class__:gc});var Oc=function(a,b,c,d){this.zpp_inner_zn=null;gc.call(this);this.zpp_inner_zn=new yf;this.zpp_inner_zn.outer=this;this.zpp_inner_zn.outer_zn=this;this.zpp_inner_i=this.zpp_inner=this.zpp_inner_zn;this.zpp_inner_i.outer_i=this;this.zpp_inner.immutable_midstep("Circle::radius");a!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=a,this.zpp_inner_zn.invalidate_radius());this.zpp_inner_zn.radius;null==b?(this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0):(b.zpp_inner.validate(),
this.zpp_inner.localCOMx=b.zpp_inner.x,b.zpp_inner.validate(),this.zpp_inner.localCOMy=b.zpp_inner.y,b.zpp_inner.weak?(b.dispose(),!0):!1);null==c?(null==I.zpp_pool?this.zpp_inner.material=new I:(this.zpp_inner.material=I.zpp_pool,I.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null),null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(c.zpp_inner),this.zpp_inner.material.wrapper());null==d?(null==Ha.zpp_pool?this.zpp_inner.filter=new Ha:(this.zpp_inner.filter=
Ha.zpp_pool,Ha.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null),null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(d.zpp_inner),this.zpp_inner.filter.wrapper());this.zpp_inner_i.insert_cbtype(ga.ANY_SHAPE.zpp_inner)};h["nape.shape.Circle"]=Oc;Oc.__name__=!0;Oc.__super__=gc;Oc.prototype=t(gc.prototype,{__class__:Oc});var xg=function(){this.zpp_inner=null};h["nape.shape.Edge"]=xg;xg.__name__=!0;xg.prototype={toString:function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";
if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : "+("{ x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" }")+" }";this.zpp_inner.polygon.validate_gaxi();return"{ localNormal : "+("{ x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" }")+" worldNormal : "+("{ x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" }")+" }"},__class__:xg};var Rb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.shape.EdgeIterator"]=
Rb;Rb.__name__=!0;Rb.get=function(a){var b;null==Rb.zpp_pool?(Ad.internal=!0,b=new Rb,Ad.internal=!1):(b=Rb.zpp_pool,Rb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Rb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Rb.zpp_pool;Rb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Rb};
var ih=function(){this.zpp_inner=null};h["nape.shape.EdgeList"]=ih;ih.__name__=!0;ih.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&a!=this.get_length()-1&&(a=this.get_length()-2-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=
this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Rb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:ih};var Qa=function(a,b,c){this.zpp_inner_zn=null;gc.call(this);this.zpp_inner_zn=new zf;
this.zpp_inner_zn.outer=this;this.zpp_inner_zn.outer_zn=this;this.zpp_inner_i=this.zpp_inner=this.zpp_inner_zn;this.zpp_inner_i.outer_i=this;if(a instanceof Array&&null==a.__enum__)for(var d=0;d<a.length;){var e=a[d];++d;var f=e;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(x.get(function(){f.zpp_inner.validate();return f.zpp_inner.x}(this),function(){f.zpp_inner.validate();return f.zpp_inner.y}(this),!1))}else if(O.__instanceof(a,Tc))for(d=
a.iterator();d.hasNext();){var g;d.zpp_critical=!1;g=d.zpp_inner.at(d.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(x.get(function(){g.zpp_inner.validate();return g.zpp_inner.x}(this),function(){g.zpp_inner.validate();return g.zpp_inner.y}(this),!1))}else if(O.__instanceof(a,vg)&&(d=a.zpp_inner.vertices,null!=d)){e=d;do{var j=x.get(e.x,e.y,null),e=e.next;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(x.get(function(){j.zpp_inner.validate();
return j.zpp_inner.x}(this),function(){j.zpp_inner.validate();return j.zpp_inner.y}(this),!1));j.dispose()}while(e!=d)}if(a instanceof Array&&null==a.__enum__)for(d=0;d<a.length;){var e=a[d],i;if(i=e.zpp_inner.weak)e.dispose(),i=!0;i?a.splice(d,1):d++}else if(O.__instanceof(a,Tc)){null!=a.zpp_inner._validate&&a.zpp_inner._validate();a=a.zpp_inner.inner;d=null;for(e=a.head;null!=e;)i=e.elt,i.outer.zpp_inner.weak?(e=a.erase(d),i.outer.zpp_inner.weak?(i.outer.dispose(),!0):!1):(d=e,e=e.next)}null==b?
(null==I.zpp_pool?this.zpp_inner.material=new I:(this.zpp_inner.material=I.zpp_pool,I.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null),null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(b.zpp_inner),this.zpp_inner.material.wrapper());null==c?(null==Ha.zpp_pool?this.zpp_inner.filter=new Ha:(this.zpp_inner.filter=Ha.zpp_pool,Ha.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null),null):(this.zpp_inner.immutable_midstep("Shape::filter"),
this.zpp_inner.setFilter(c.zpp_inner),this.zpp_inner.filter.wrapper());this.zpp_inner_i.insert_cbtype(ga.ANY_SHAPE.zpp_inner)};h["nape.shape.Polygon"]=Qa;Qa.__name__=!0;Qa.rect=function(a,b,c,d,e){null==e&&(e=!1);return[x.get(a,b,e),x.get(a+c,b,e),x.get(a+c,b+d,e),x.get(a,b+d,e)]};Qa.box=function(a,b,c){null==c&&(c=!1);return Qa.rect(-a/2,-b/2,a,b,c)};Qa.__super__=gc;Qa.prototype=t(gc.prototype,{__class__:Qa});var Sb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};
h["nape.shape.ShapeIterator"]=Sb;Sb.__name__=!0;Sb.get=function(a){var b;null==Sb.zpp_pool?(gd.internal=!0,b=new Sb,gd.internal=!1):(b=Sb.zpp_pool,Sb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Sb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Sb.zpp_pool;Sb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},
__class__:Sb};var yg=function(){this.zpp_inner=null;this.zpp_inner=new gd;this.zpp_inner.outer=this};h["nape.shape.ShapeList"]=yg;yg.__name__=!0;yg.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=
a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?
null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?
null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==
a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},iterator:function(){this.zpp_inner.valmod();return Sb.get(this)},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Sb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:yg};var Af=function(){};
h["nape.shape.ShapeType"]=Af;Af.__name__=!0;Af.prototype={toString:function(){var a;null==f.ShapeType_CIRCLE&&(f.internal=!0,f.ShapeType_CIRCLE=new Af,f.internal=!1);this==f.ShapeType_CIRCLE?a="CIRCLE":(null==f.ShapeType_POLYGON&&(f.internal=!0,f.ShapeType_POLYGON=new Af,f.internal=!1),a=this==f.ShapeType_POLYGON?"POLYGON":"");return a},__class__:Af};var xc=function(){};h["nape.shape.ValidationResult"]=xc;xc.__name__=!0;xc.prototype={toString:function(){var a;null==f.ValidationResult_VALID&&(f.internal=
!0,f.ValidationResult_VALID=new xc,f.internal=!1);this==f.ValidationResult_VALID?a="VALID":(null==f.ValidationResult_DEGENERATE&&(f.internal=!0,f.ValidationResult_DEGENERATE=new xc,f.internal=!1),this==f.ValidationResult_DEGENERATE?a="DEGENERATE":(null==f.ValidationResult_CONCAVE&&(f.internal=!0,f.ValidationResult_CONCAVE=new xc,f.internal=!1),this==f.ValidationResult_CONCAVE?a="CONCAVE":(null==f.ValidationResult_SELF_INTERSECTING&&(f.internal=!0,f.ValidationResult_SELF_INTERSECTING=new xc,f.internal=
!1),a=this==f.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")));return a},__class__:xc};var Wc=function(){};h["nape.space.Broadphase"]=Wc;Wc.__name__=!0;Wc.prototype={toString:function(){var a;null==f.Broadphase_DYNAMIC_AABB_TREE&&(f.internal=!0,f.Broadphase_DYNAMIC_AABB_TREE=new Wc,f.internal=!1);this==f.Broadphase_DYNAMIC_AABB_TREE?a="DYNAMIC_AABB_TREE":(null==f.Broadphase_SWEEP_AND_PRUNE&&(f.internal=!0,f.Broadphase_SWEEP_AND_PRUNE=new Wc,f.internal=!1),a=this==f.Broadphase_SWEEP_AND_PRUNE?
"SWEEP_AND_PRUNE":"");return a},__class__:Wc};var ag=function(a,b){this.zpp_inner=null;this.zpp_inner=new zg(null==a?null:a.zpp_inner,b);this.zpp_inner.outer=this;null!=a&&(a.zpp_inner.weak?(a.dispose(),!0):!1)};h["nape.space.Space"]=ag;ag.__name__=!0;ag.prototype={get_gravity:function(){null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();return this.zpp_inner.wrap_gravity},step:function(a,b,c){null==c&&(c=10);null==b&&(b=10);this.zpp_inner.step(a,b,c)},bodiesUnderPoint:function(a,b,c){b=
this.zpp_inner.bodiesUnderPoint(function(){a.zpp_inner.validate();return a.zpp_inner.x}(this),function(){a.zpp_inner.validate();return a.zpp_inner.y}(this),null==b?null:b.zpp_inner,c);a.zpp_inner.weak?(a.dispose(),!0):!1;return b},__class__:ag};var Tb=function(){this.body=this.constraint=null;this.pre_swapped=!1;this.int1=this.int2=this.set=this.wrap_arbiters=this.pre_arbiter=null;this.length=0;this.listener=this.next=this.prev=null;this.event=0;this.outer_body=this.outer_con=this.outer_int=null;
this.length=0};h["zpp_nape.callbacks.ZPP_Callback"]=Tb;Tb.__name__=!0;Tb.prototype={wrapper_body:function(){null==this.outer_body&&(this.outer_body=new kf,this.outer_body.zpp_inner=this);return this.outer_body},wrapper_con:function(){null==this.outer_con&&(this.outer_con=new mf,this.outer_con.zpp_inner=this);return this.outer_con},wrapper_int:function(){null==this.outer_int&&(this.outer_int=new nf,this.outer_int.zpp_inner=this);null==this.wrap_arbiters?this.wrap_arbiters=ed.get(this.set.arbiters,
!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters;this.wrap_arbiters.zpp_inner.zip_length=!0;this.wrap_arbiters.zpp_inner.at_ite=null;return this.outer_int},push:function(a){null!=this.prev?this.prev.next=a:this.next=a;a.prev=this.prev;a.next=null;this.prev=a;this.length++},pop:function(){var a=this.next;this.next=a.next;null==this.next?this.prev=null:this.next.prev=null;this.length--;return a},empty:function(){return null==this.next},__class__:Tb};var B=function(){this.interactors=this.constraints=
null;this.zip_conlisteners=!1;this.conlisteners=null;this.zip_bodylisteners=!1;this.bodylisteners=null;this.zip_listeners=!1;this.manager=this.cbpairs=this.listeners=null;this.id=0;this.next=null;this.count=0;this.cbTypes=null;this.cbTypes=new hc;this.listeners=new Id;this.zip_listeners=!0;this.bodylisteners=new df;this.zip_bodylisteners=!0;this.conlisteners=new ef;this.zip_conlisteners=!0;this.constraints=new tc;this.interactors=new ac;this.id=Ga.CbSet();this.cbpairs=new Ag};h["zpp_nape.callbacks.ZPP_CbSet"]=
B;B.__name__=!0;B.setlt=function(a,b){for(var c=a.cbTypes.head,d=b.cbTypes.head;null!=c&&null!=d;){var e=c.elt,f=d.elt;if(e.id<f.id)return!0;if(f.id<e.id)return!1;c=c.next;d=d.next}return null!=d&&null==c};B.get=function(a){var b;null==B.zpp_pool?b=new B:(b=B.zpp_pool,B.zpp_pool=b.next,b.next=null);null;for(var c=null,a=a.head;null!=a;){var d=a.elt,c=b.cbTypes.insert(c,d);d.cbsets.add(b);a=a.next}return b};B.single_intersection=function(a,b,c){return a.manager.pair(a,b).single_intersection(c)};B.find_all=
function(a,b,c,d){a.manager.pair(a,b).forall(c,d)};B.prototype={invalidate_pairs:function(){for(var a=this.cbpairs.head;null!=a;)a.elt.zip_listeners=!0,a=a.next},realvalidate_listeners:function(){this.listeners.clear();for(var a=this.cbTypes.head;null!=a;){for(var b=null,c=this.listeners.head,d=a.elt.listeners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||rb.setlt(e,c.elt)?(e.space==this.manager.space&&(b=this.listeners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=
a.next}},realvalidate_bodylisteners:function(){this.bodylisteners.clear();for(var a=this.cbTypes.head;null!=a;){for(var b=null,c=this.bodylisteners.head,d=a.elt.bodylisteners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||rb.setlt(e,c.elt)?(!e.options.excluded(this.cbTypes)&&e.space==this.manager.space&&(b=this.bodylisteners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},realvalidate_conlisteners:function(){this.conlisteners.clear();for(var a=this.cbTypes.head;null!=
a;){for(var b=null,c=this.conlisteners.head,d=a.elt.conlisteners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||rb.setlt(e,c.elt)?(!e.options.excluded(this.cbTypes)&&e.space==this.manager.space&&(b=this.conlisteners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners());this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners());this.zip_conlisteners&&
(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},free:function(){this.listeners.clear();this.zip_listeners=!0;this.bodylisteners.clear();this.zip_bodylisteners=!0;this.conlisteners.clear();for(this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},__class__:B};var wa=function(){this.listeners=null;this.zip_listeners=!1;this.a=this.b=this.next=null;this.listeners=new Id};h["zpp_nape.callbacks.ZPP_CbSetPair"]=wa;wa.__name__=!0;wa.get=function(a,
b){var c;null==wa.zpp_pool?c=new wa:(c=wa.zpp_pool,wa.zpp_pool=c.next,c.next=null);c.zip_listeners=!0;B.setlt(a,b)?(c.a=a,c.b=b):(c.a=b,c.b=a);return c};wa.setlt=function(a,b){return B.setlt(a.a,b.a)||a.a==b.a&&B.setlt(a.b,b.b)};wa.prototype={__validate:function(){this.listeners.clear();for(var a=this.a.listeners.head,b=this.b.listeners.head;null!=a&&null!=b;){var c=a.elt,d=b.elt;c==d?((c.options1.compatible(this.a.cbTypes)&&c.options2.compatible(this.b.cbTypes)||c.options2.compatible(this.a.cbTypes)&&
c.options1.compatible(this.b.cbTypes))&&this.listeners.add(c),a=a.next,b=b.next):c.precedence>d.precedence||c.precedence==d.precedence&&c.id>d.id?a=a.next:b=b.next}},empty_intersection:function(){return null==this.listeners.head},single_intersection:function(a){var b=this.listeners.head;return null!=b&&b.elt==a&&null==b.next},forall:function(a,b){for(var c=this.listeners.head;null!=c;){var d=c.elt;d.event==a&&b(d);c=c.next}},__class__:wa};var f=function(){};h["zpp_nape.util.ZPP_Flags"]=f;f.__name__=
!0;var rb=function(){this.body=this.constraint=this.interaction=this.space=null;this.id=this.type=this.event=this.precedence=0;this.outer=null;this.id=Ga.Listener()};h["zpp_nape.callbacks.ZPP_Listener"]=rb;rb.__name__=!0;rb.setlt=function(a,b){return a.precedence>b.precedence||a.precedence==b.precedence&&a.id>b.id};rb.prototype={addedToSpace:function(){},removedFromSpace:function(){},__class__:rb};var Bg=function(){this.outer_zn=this.options=this.handler=null};h["zpp_nape.callbacks.ZPP_BodyListener"]=
Bg;Bg.__name__=!0;Bg.__super__=rb;Bg.prototype=t(rb.prototype,{addedToSpace:function(){this.options.handler=n(this,this.cbtype_change);for(var a=this.options.includes.head;null!=a;)a.elt.addbody(this),a=a.next},removedFromSpace:function(){for(var a=this.options.includes.head;null!=a;){var b=a.elt;b.bodylisteners.remove(this);b.invalidatebody();a=a.next}this.options.handler=null},cbtype_change:function(a,b,c){this.removedFromSpace();this.options.effect_change(a,b,c);this.addedToSpace()},__class__:Bg});
var Cg=function(){this.outer_zn=this.options=this.handler=null};h["zpp_nape.callbacks.ZPP_ConstraintListener"]=Cg;Cg.__name__=!0;Cg.__super__=rb;Cg.prototype=t(rb.prototype,{addedToSpace:function(){this.options.handler=n(this,this.cbtype_change);for(var a=this.options.includes.head;null!=a;)a.elt.addconstraint(this),a=a.next},removedFromSpace:function(){for(var a=this.options.includes.head;null!=a;){var b=a.elt;b.conlisteners.remove(this);b.invalidateconstraint();a=a.next}this.options.handler=null},
cbtype_change:function(a,b,c){this.removedFromSpace();this.options.effect_change(a,b,c);this.addedToSpace()},__class__:Cg});var hc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CbType"]=hc;hc.__name__=!0;hc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ia.zpp_pool?b=new Ia:(b=Ia.zpp_pool,Ia.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},
insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Ia.zpp_pool?c=new Ia:(c=Ia.zpp_pool,Ia.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ia.zpp_pool;Ia.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ia.zpp_pool;Ia.zpp_pool=a;this.modified=!0;this.length--;
this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},has:function(a){return this.inlined_has(a)},inlined_has:function(a){var b;b=!1;for(var c=this.head;null!=c;){if(c.elt==a){b=!0;break}c=c.next}return b},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:hc};var R=function(a,b,c,d){this.handlerp=null;this.allowSleepingCallbacks=this.pure=!1;this.options1=this.options2=this.handleri=null;this.itype=0;this.outer_zni=
this.outer_znp=null;rb.call(this);this.type=d;this.interaction=this;this.event=c;this.options1=a.zpp_inner;this.options2=b.zpp_inner;this.allowSleepingCallbacks=!1};h["zpp_nape.callbacks.ZPP_InteractionListener"]=R;R.__name__=!0;R.__super__=rb;R.prototype=t(rb.prototype,{CbSetset:function(a,b,c){for(var d=R.UCbSet,e=R.VCbSet,f=R.WCbSet,a=a.head,g=b.head;null!=a&&null!=g;){var j=a.elt,i=g.elt;j==i?(f.inlined_add(j),a=a.next,g=g.next):B.setlt(j,i)?(d.inlined_add(j),a=a.next):(e.inlined_add(i),g=g.next)}for(;null!=
a;)d.inlined_add(a.elt),a=a.next;for(;null!=g;)e.inlined_add(g.elt),g=g.next;for(;null!=d.head;){a=d.pop_unsafe();for(g=b.head;null!=g;)c(a,g.elt),g=g.next}for(;null!=e.head;){b=e.pop_unsafe();for(d=f.head;null!=d;)c(b,d.elt),d=d.next}for(;null!=f.head;){e=f.pop_unsafe();c(e,e);for(b=f.head;null!=b;)c(e,b.elt),b=b.next}},CbTypeset:function(a,b,c){for(var d=R.UCbType,e=R.VCbType,f=R.WCbType,a=a.head,g=b.head;null!=a&&null!=g;){var j=a.elt,i=g.elt;j==i?(f.inlined_add(j),a=a.next,g=g.next):j.id<i.id?
(d.inlined_add(j),a=a.next):(e.inlined_add(i),g=g.next)}for(;null!=a;)d.inlined_add(a.elt),a=a.next;for(;null!=g;)e.inlined_add(g.elt),g=g.next;for(;null!=d.head;){a=d.pop_unsafe();for(g=b.head;null!=g;)c(a,g.elt),g=g.next}for(;null!=e.head;){b=e.pop_unsafe();for(d=f.head;null!=d;)c(b,d.elt),d=d.next}for(;null!=f.head;){e=f.pop_unsafe();c(e,e);for(b=f.head;null!=b;)c(e,b.elt),b=b.next}},with_uniquesets:function(a){var b=this,c;null==fa.zpp_pool?c=new fa:(c=fa.zpp_pool,fa.zpp_pool=c.next,c.next=null);
null;c.lt=wa.setlt;this.CbTypeset(this.options1.includes,this.options2.includes,function(a,d){b.CbSetset(a.cbsets,d.cbsets,function(a,d){a.validate();d.validate();B.single_intersection(a,d,b)&&c.try_insert(wa.get(a,d))})});c.clear_with(function(c){a?b.space.freshListenerType(c.a,c.b):b.space.nullListenerType(c.a,c.b);c.a=c.b=null;c.listeners.clear();c.next=wa.zpp_pool;wa.zpp_pool=c});var d=c;d.data=null;d.lt=null;d.swapped=null;d.next=fa.zpp_pool;fa.zpp_pool=d},with_union:function(a){for(var b=this.options1.includes.head,
c=this.options2.includes.head;null!=b&&null!=c;){var d=b.elt,e=c.elt;d==e?(a(d),b=b.next,c=c.next):d.id<e.id?(a(d),b=b.next):(a(e),c=c.next)}for(;null!=b;)a(b.elt),b=b.next;for(;null!=c;)a(c.elt),c=c.next},addedToSpace:function(){var a=this,b=this.type==f.id_ListenerType_PRE;this.with_union(function(c){c.addint(a);if(b)for(c=c.interactors.head;null!=c;)c.elt.wake(),c=c.next});this.options1.handler=n(this,this.cbtype_change1);this.options2.handler=n(this,this.cbtype_change2);this.with_uniquesets(!0)},
removedFromSpace:function(){var a=this;this.with_uniquesets(!1);var b=this.type==f.id_ListenerType_PRE;this.with_union(function(c){c.listeners.remove(a);c.invalidateint();if(b)for(c=c.interactors.head;null!=c;)c.elt.wake(),c=c.next});this.options1.handler=null;this.options2.handler=null},cbtype_change1:function(a,b,c){this.cbtype_change(this.options1,a,b,c)},cbtype_change2:function(a,b,c){this.cbtype_change(this.options2,a,b,c)},cbtype_change:function(a,b,c,d){this.removedFromSpace();a.effect_change(b,
c,d);this.addedToSpace();null},__class__:R});var Qc=function(){this.outer=this.handler=this.includes=this.excludes=this.wrap_includes=this.wrap_excludes=null;this.includes=new hc;this.excludes=new hc};h["zpp_nape.callbacks.ZPP_OptionType"]=Qc;Qc.__name__=!0;Qc.argument=function(a){return null==a?new wd:O.__instanceof(a,wd)?a:(new wd).including(a)};Qc.prototype={setup_includes:function(){this.wrap_includes=Lb.get(this.includes,!0)},setup_excludes:function(){this.wrap_excludes=Lb.get(this.excludes,
!0)},excluded:function(a){return this.nonemptyintersection(a,this.excludes)},compatible:function(a){return this.nonemptyintersection(a,this.includes)&&!this.nonemptyintersection(a,this.excludes)},nonemptyintersection:function(a,b){for(var c=!1,d=a.head,e=b.head;null!=e&&null!=d;){var f=e.elt,g=d.elt;if(f==g){c=!0;break}else f.id<g.id?e=e.next:d=d.next}return c},effect_change:function(a,b,c){if(b)if(c){b=null;for(c=this.includes.head;null!=c&&!(a.id<c.elt.id);){b=c;c=c.next}this.includes.inlined_insert(b,
a)}else this.includes.remove(a);else if(c){b=null;for(c=this.excludes.head;null!=c&&!(a.id<c.elt.id);){b=c;c=c.next}this.excludes.inlined_insert(b,a)}else this.excludes.remove(a)},append_type:function(a,b){a==this.includes?this.includes.has(b)||(this.excludes.has(b)?null!=this.handler?this.handler(b,!1,!1):this.effect_change(b,!1,!1):null!=this.handler?this.handler(b,!0,!0):this.effect_change(b,!0,!0)):this.excludes.has(b)||(this.includes.has(b)?null!=this.handler?this.handler(b,!0,!1):this.effect_change(b,
!0,!1):null!=this.handler?this.handler(b,!1,!0):this.effect_change(b,!1,!0))},append:function(a,b){if(O.__instanceof(b,gb))this.append_type(a,b.zpp_inner);else if(O.__instanceof(b,lf)){var c;b.zpp_inner.valmod();for(c=bc.get(b);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);this.append_type(a,d.zpp_inner)}}else if(b instanceof Array&&null==b.__enum__)for(c=0;c<b.length;)d=b[c],++c,this.append_type(a,d.zpp_inner)},__class__:Qc};var Na=function(){this.pre_dt=0;this.cbTypes=this.cbSet=
null;this.ignore=this.__velocity=!1;this.component=null;this.breakUnderForce=this.breakUnderError=this.removeOnBreak=!1;this.frequency=this.damping=this.maxForce=this.maxError=0;this.active=this.stiff=!1;this.compound=this.space=null;this.id=0;this.outer=null;this.__velocity=!1;this.id=Ga.Constraint();this.active=this.stiff=!0;this.ignore=!1;this.frequency=10;this.damping=1;this.maxError=this.maxForce=Math.POSITIVE_INFINITY;this.breakUnderForce=!1;this.removeOnBreak=!0;this.pre_dt=-1;this.cbTypes=
new hc};h["zpp_nape.constraint.ZPP_Constraint"]=Na;Na.__name__=!0;Na.prototype={immutable_midstep:function(){},insert_cbtype:function(a){if(!this.cbTypes.has(a)){null!=this.space&&(this.dealloc_cbSet(),a.constraints.add(this));for(var b=null,c=this.cbTypes.head;null!=c&&!(a.id<c.elt.id);){b=c;c=c.next}this.cbTypes.inlined_insert(b,a);null!=this.space&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){if(null!=(this.cbSet=this.space.cbsets.get(this.cbTypes)))this.cbSet.count++,this.cbSet.constraints.add(this)},
dealloc_cbSet:function(){if(null!=this.cbSet){this.cbSet.constraints.remove(this);if(0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var a=this.cbSet;a.free();a.next=B.zpp_pool;B.zpp_pool=a}this.cbSet=null}},activate:function(){null!=this.space&&this.activeInSpace()},deactivate:function(){null!=this.space&&this.inactiveOrOutSpace()},addedToSpace:function(){this.active&&this.activeInSpace();this.activeBodies();for(var a=this.cbTypes.head;null!=a;)a.elt.constraints.add(this),a=a.next},removedFromSpace:function(){this.active&&
this.inactiveOrOutSpace();this.inactiveBodies();for(var a=this.cbTypes.head;null!=a;)a.elt.constraints.remove(this),a=a.next},activeInSpace:function(){this.alloc_cbSet();null==hb.zpp_pool?this.component=new hb:(this.component=hb.zpp_pool,hb.zpp_pool=this.component.next,this.component.next=null);null;this.component.isBody=!1;this.component.constraint=this},inactiveOrOutSpace:function(){this.dealloc_cbSet();var a=this.component;a.body=null;a.constraint=null;null;a.next=hb.zpp_pool;hb.zpp_pool=a;this.component=
null},activeBodies:function(){},inactiveBodies:function(){},clearcache:function(){},wake_connected:function(){},forest:function(){},pair_exists:function(){return!1},broken:function(){},warmStart:function(){},preStep:function(){return!1},applyImpulseVel:function(){return!1},applyImpulsePos:function(){return!1},wake:function(){null!=this.space&&this.space.wake_constraint(this)},__class__:Na};var pf=function(){this.stepped=!1;this.kMass=this.jAcc=this.jMax=this.gamma=this.bias=0;this.b1=this.b2=null;
this.scale=0;this.slack=this.equal=!1;this.ratio=this.jointMin=this.jointMax=0;this.outer_zn=null;Na.call(this);this.ratio=1;this.jAcc=0;this.slack=!1;this.jMax=Math.POSITIVE_INFINITY;this.stepped=!1};h["zpp_nape.constraint.ZPP_AngleJoint"]=pf;pf.__name__=!0;pf.__super__=Na;pf.prototype=t(Na.prototype,{activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this);
this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},wake_connected:function(){null!=this.b1&&this.b1.type==f.id_BodyType_DYNAMIC&&this.b1.wake();null!=this.b2&&this.b2.type==f.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==f.id_BodyType_DYNAMIC){var a;if(this.b1.component==this.b1.component.parent)a=this.b1.component;else{a=this.b1.component;for(var b=null;a!=a.parent;){var c=a.parent;a.parent=b;b=a;a=c}for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==
this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;){var d=b.parent;b.parent=c;c=b;b=d}for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}if(this.b2.type==f.id_BodyType_DYNAMIC){if(this.b2.component==this.b2.component.parent)a=this.b2.component;else{a=this.b2.component;for(b=null;a!=a.parent;)c=a.parent,a.parent=b,b=a,a=c;for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=
this.component;else{b=this.component;for(c=null;b!=b.parent;)d=b.parent,b.parent=c,c=b,b=d;for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}},pair_exists:function(a,b){return this.b1.id==a&&this.b2.id==b||this.b1.id==b&&this.b2.id==a},clearcache:function(){this.jAcc=0;this.pre_dt=-1;this.slack=!1},preStep:function(a){-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;this.stepped=!0;this.equal=this.jointMin==this.jointMax;
var c;c=this.ratio*this.b2.rot-this.b1.rot;this.equal?(c-=this.jointMax,this.slack=!1,this.scale=1):c<this.jointMin?(c=this.jointMin-c,this.scale=-1,this.slack=!1):c>this.jointMax?(c-=this.jointMax,this.scale=1,this.slack=!1):(c=this.scale=0,this.slack=!0);if(!this.slack){this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia;0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0;if(this.stiff)this.gamma=this.bias=0;else{if(this.breakUnderError&&c*c>this.maxError*this.maxError)return!0;var d;
d=2*Math.PI*this.frequency;this.gamma=1/(a*d*(2*this.damping+d*a));var e=1/(1+this.gamma);d=a*d*d*this.gamma;this.gamma*=e;this.kMass*=e;this.bias=-c*d;this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=b;this.jMax=this.maxForce*a}return!1},warmStart:function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},applyImpulseVel:function(){if(this.slack)return!1;
var a=this.kMass*(this.bias-this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel))-this.jAcc*this.gamma,b=this.jAcc;this.jAcc+=a;!this.equal&&0<this.jAcc&&(this.jAcc=0);if(this.breakUnderForce&&(this.jAcc>this.jMax||this.jAcc<-this.jMax))return!0;this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:this.jAcc<-this.jMax&&(this.jAcc=-this.jMax));a=this.jAcc-b;this.b1.angvel-=this.scale*this.b1.iinertia*a;this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*a;
return!1},applyImpulsePos:function(){var a,b;a=this.ratio*this.b2.rot-this.b1.rot;this.equal?(a-=this.jointMax,b=!1,this.scale=1):a<this.jointMin?(a=this.jointMin-a,this.scale=-1,b=!1):a>this.jointMax?(a-=this.jointMax,this.scale=1,b=!1):(a=this.scale=0,b=!0);if(!b){if(this.breakUnderError&&a*a>this.maxError*this.maxError)return!0;b=-(0.5*a)*this.kMass;if(this.equal||0>b)this.b1.delta_rot(-this.scale*b*this.b1.iinertia),this.b2.delta_rot(this.ratio*this.scale*b*this.b2.iinertia)}return!1},__class__:pf});
var qf=function(){this.kMassa=this.kMassb=this.kMassc=this.jAccx=this.jAccy=this.biasx=this.biasy=0;this.wrap_n=null;this.nlocalx=this.nlocaly=this.nrelx=this.nrely=0;this.wrap_a2=null;this.a2localx=this.a2localy=this.a2relx=this.a2rely=0;this.wrap_a1=null;this.dot1=this.dot2=this.cx1=this.cx2=this.a1localx=this.a1localy=this.a1relx=this.a1rely=0;this.equal=!1;this.scale=this.jointMin=this.jointMax=0;this.outer_zn=null;Na.call(this);this.jAccy=this.jAccx=this.nrely=this.nrelx=this.nlocaly=this.nlocalx=
this.a2rely=this.a2relx=this.a2localy=this.a2localx=this.a1rely=this.a1relx=this.a1localy=this.a1localx=0;this.jMax=Math.POSITIVE_INFINITY;this.jointMin=Math.NEGATIVE_INFINITY;this.jointMax=Math.POSITIVE_INFINITY;this.stepped=!1};h["zpp_nape.constraint.ZPP_LineJoint"]=qf;qf.__name__=!0;qf.__super__=Na;qf.prototype=t(Na.prototype,{activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&
this.b1.constraints.remove(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx;this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(a){this.immutable_midstep("Constraint::a1");this.a1localx=a.x;this.a1localy=a.y;this.wake()},setup_a1:function(){this.wrap_a1=x.get(this.a1localx,this.a1localy,null);this.wrap_a1.zpp_inner._inuse=!0;this.wrap_a1.zpp_inner._validate=n(this,this.validate_a1);this.wrap_a1.zpp_inner._invalidate=
n(this,this.invalidate_a1)},validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx;this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(a){this.immutable_midstep("Constraint::a2");this.a2localx=a.x;this.a2localy=a.y;this.wake()},setup_a2:function(){this.wrap_a2=x.get(this.a2localx,this.a2localy,null);this.wrap_a2.zpp_inner._inuse=!0;this.wrap_a2.zpp_inner._validate=n(this,this.validate_a2);this.wrap_a2.zpp_inner._invalidate=n(this,this.invalidate_a2)},validate_n:function(){this.wrap_n.zpp_inner.x=
this.nlocalx;this.wrap_n.zpp_inner.y=this.nlocaly},invalidate_n:function(a){this.immutable_midstep("Constraint::n");this.nlocalx=a.x;this.nlocaly=a.y;this.zip_n=!0;this.wake()},setup_n:function(){this.wrap_n=x.get(this.nlocalx,this.nlocaly,null);this.wrap_n.zpp_inner._inuse=!0;this.wrap_n.zpp_inner._validate=n(this,this.validate_n);this.wrap_n.zpp_inner._invalidate=n(this,this.invalidate_n)},validate_norm:function(){if(this.zip_n){this.zip_n=!1;var a=1/Math.sqrt(this.nlocalx*this.nlocalx+this.nlocaly*
this.nlocaly);this.nlocalx*=a;this.nlocaly*=a}},wake_connected:function(){null!=this.b1&&this.b1.type==f.id_BodyType_DYNAMIC&&this.b1.wake();null!=this.b2&&this.b2.type==f.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==f.id_BodyType_DYNAMIC){var a;if(this.b1.component==this.b1.component.parent)a=this.b1.component;else{a=this.b1.component;for(var b=null;a!=a.parent;){var c=a.parent;a.parent=b;b=a;a=c}for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=
this.component;else{b=this.component;for(c=null;b!=b.parent;){var d=b.parent;b.parent=c;c=b;b=d}for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}if(this.b2.type==f.id_BodyType_DYNAMIC){if(this.b2.component==this.b2.component.parent)a=this.b2.component;else{a=this.b2.component;for(b=null;a!=a.parent;)c=a.parent,a.parent=b,b=a,a=c;for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=this.component;else{b=
this.component;for(c=null;b!=b.parent;)d=b.parent,b.parent=c,c=b,b=d;for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}},pair_exists:function(a,b){return this.b1.id==a&&this.b2.id==b||this.b1.id==b&&this.b2.id==a},clearcache:function(){this.jAccy=this.jAccx=0;this.pre_dt=-1},preStep:function(a){-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;this.equal=this.jointMin==this.jointMax;this.stepped=!0;this.validate_norm();
this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy;this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly;this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy;this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy;this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var c=0,d=0,e=0,f=0,c=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,d=this.b2.posy+this.a2rely-
this.b1.posy-this.a1rely,e=d*this.nrelx-c*this.nrely,f=this.nrelx*c+this.nrely*d;this.equal?(f-=this.jointMin,this.scale=1):f>this.jointMax?(f-=this.jointMax,this.scale=1):f<this.jointMin?(f=this.jointMin-f,this.scale=-1):this.scale=f=0;var g=0,j=0,g=c+this.a1relx,j=d+this.a1rely;this.dot1=this.nrelx*g+this.nrely*j;this.cx1=j*this.nrelx-g*this.nrely;this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely;this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely;this.kMassa=this.b1.smass+this.b2.smass+
this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia;this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia);this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);c=this.kMassa*this.kMassc-this.kMassb*this.kMassb;c!=c?(this.kMassa=this.kMassb=this.kMassc=0,c=3):0==c?(c=0,0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,c|=1),0!=this.kMassc?this.kMassc=
1/this.kMassc:(this.kMassc=0,c|=2),this.kMassb=0):(c=1/c,d=this.kMassc*c,this.kMassc=this.kMassa*c,this.kMassa=d,this.kMassb*=-c,c=0);0!=(c&1)&&(this.jAccx=0);0!=(c&2)&&(this.jAccy=0);if(this.stiff)this.biasy=this.biasx=this.gamma=0;else{if(this.breakUnderError&&e*e+f*f>this.maxError*this.maxError)return!0;d=2*Math.PI*this.frequency;this.gamma=1/(a*d*(2*this.damping+d*a));c=1/(1+this.gamma);d=a*d*d*this.gamma;this.gamma*=c;this.kMassa*=c;this.kMassb*=c;this.kMassc*=c;this.biasx=e;this.biasy=f;e=-d;
this.biasx*=e;this.biasy*=e;e=this.maxError;f=this.biasx*this.biasx+this.biasy*this.biasy;f>e*e&&(e*=1/Math.sqrt(f),this.biasx*=e,this.biasy*=e)}this.jAccx*=b;this.jAccy*=b;this.jMax=this.maxForce*a;return!1},warmStart:function(){var a=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,b=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,c=this.b1.imass;this.b1.velx-=a*c;this.b1.vely-=b*c;c=this.b2.imass;this.b2.velx+=a*c;this.b2.vely+=b*c;this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*
this.jAccx)*this.b1.iinertia;this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},applyImpulseVel:function(){var a=0,b=0,c=0,d=0,c=this.b2.velx-this.b1.velx,d=this.b2.vely-this.b1.vely,c=c+(this.b2.kinvelx-this.b1.kinvelx),d=d+(this.b2.kinvely-this.b1.kinvely),a=d*this.nrelx-c*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,b=this.scale*(this.nrelx*c+this.nrely*d-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+
this.b1.kinangvel)*this.cx1),d=c=0,c=this.biasx-a,d=this.biasy-b,a=this.kMassa*c+this.kMassb*d,d=this.kMassb*c+this.kMassc*d,b=this.gamma,c=a-this.jAccx*b,d=d-this.jAccy*b,b=a=0,a=this.jAccx,b=this.jAccy;this.jAccx+=1*c;this.jAccy+=1*d;0<this.jAccy&&(this.jAccy=0);if(this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(c=this.jMax,d=this.jAccx*this.jAccx+this.jAccy*this.jAccy,d>c*c&&(c*=1/Math.sqrt(d),this.jAccx*=c,this.jAccy*=c));var c=
this.jAccx-a,d=this.jAccy-b,a=this.scale*this.nrelx*d-this.nrely*c,b=this.nrelx*c+this.scale*this.nrely*d,e=this.b1.imass;this.b1.velx-=a*e;this.b1.vely-=b*e;e=this.b2.imass;this.b2.velx+=a*e;this.b2.vely+=b*e;this.b1.angvel+=(this.scale*this.cx1*d-this.dot1*c)*this.b1.iinertia;this.b2.angvel+=(this.dot2*c-this.scale*this.cx2*d)*this.b2.iinertia;return!1},applyImpulsePos:function(){var a=0,b=0,a=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,b=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,
c=0,d=0,c=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,d=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=0,f=0,e=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,f=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,g=0,j=0,i,h=0,k=0,g=this.b2.posx+e-this.b1.posx-c,j=this.b2.posy+f-this.b1.posy-d,h=j*a-g*b,k=a*g+b*j;this.equal?(k-=this.jointMin,i=1):k>this.jointMax?(k-=this.jointMax,i=1):k<this.jointMin?(k=this.jointMin-k,i=-1):i=k=0;if(this.breakUnderError&&h*h+k*
k>this.maxError*this.maxError)return!0;if(h*h+k*k<m.constraintLinearSlop*m.constraintLinearSlop)return!1;var o=0,sb=0,h=0.5*h,k=0.5*k;6<h*h+k*k&&(o=this.b1.smass+this.b2.smass,o>m.epsilon&&(o=0.8/o,sb=o*(b*h-i*a*k),i=o*(a*h*i-b*h),o=this.b1.imass,this.b1.posx-=sb*o,this.b1.posy-=i*o,o=this.b2.imass,this.b2.posx+=sb*o,this.b2.posy+=i*o,g=this.b2.posx+e-this.b1.posx-c,j=this.b2.posy+f-this.b1.posy-d,k=a*g+b*j,this.equal?(k-=this.jointMin,i=1):k>this.jointMax?(k-=this.jointMax,i=1):k<this.jointMin?(k=
this.jointMin-k,i=-1):i=k=0,h=0.5*(j*a-g*b),k*=0.5));var l=0,n=0,p=0,sb=o=0,o=g+c,sb=j+d,c=a*o+b*sb,g=sb*a-o*b,d=a*e+b*f,e=f*a-e*b,l=this.b1.smass+this.b2.smass+c*c*this.b1.sinertia+d*d*this.b2.sinertia,n=-i*(c*g*this.b1.sinertia+d*e*this.b2.sinertia),p=i*i*(this.b1.smass+this.b2.smass+g*g*this.b1.sinertia+e*e*this.b2.sinertia),o=-h,sb=-k,f=l*p-n*n;f!=f?o=sb=0:0==f?(o=0!=l?o/l:0,sb=0!=p?sb/p:0):(f=1/f,h=f*(p*o-n*sb),sb=f*(l*sb-n*o),o=h);0<sb&&(sb=0);f=i*a*sb-b*o;a=a*o+i*b*sb;b=this.b1.imass;this.b1.posx-=
f*b;this.b1.posy-=a*b;b=this.b2.imass;this.b2.posx+=f*b;this.b2.posy+=a*b;this.b1.delta_rot((i*g*sb-c*o)*this.b1.iinertia);this.b2.delta_rot((d*o-i*e*sb)*this.b2.iinertia);return!1},__class__:qf});var rf=function(){this.stepped=!1;this.kMass=this.jAcc=this.jMax=0;this.b1=this.b2=null;this.ratio=this.rate=0;this.outer_zn=null;Na.call(this);this.jAcc=0;this.stepped=!1;this.__velocity=!0};h["zpp_nape.constraint.ZPP_MotorJoint"]=rf;rf.__name__=!0;rf.__super__=Na;rf.prototype=t(Na.prototype,{activeBodies:function(){null!=
this.b1&&this.b1.constraints.add(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},wake_connected:function(){null!=this.b1&&this.b1.type==f.id_BodyType_DYNAMIC&&this.b1.wake();null!=this.b2&&this.b2.type==f.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==f.id_BodyType_DYNAMIC){var a;if(this.b1.component==this.b1.component.parent)a=
this.b1.component;else{a=this.b1.component;for(var b=null;a!=a.parent;){var c=a.parent;a.parent=b;b=a;a=c}for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;){var d=b.parent;b.parent=c;c=b;b=d}for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}if(this.b2.type==f.id_BodyType_DYNAMIC){if(this.b2.component==this.b2.component.parent)a=this.b2.component;
else{a=this.b2.component;for(b=null;a!=a.parent;)c=a.parent,a.parent=b,b=a,a=c;for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;)d=b.parent,b.parent=c,c=b,b=d;for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}},pair_exists:function(a,b){return this.b1.id==a&&this.b2.id==b||this.b1.id==b&&this.b2.id==a},clearcache:function(){this.jAcc=0;
this.pre_dt=-1},preStep:function(a){-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;this.stepped=!0;this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia;this.kMass=1/this.kMass;this.jAcc*=b;this.jMax=this.maxForce*a;return!1},warmStart:function(){this.b1.angvel-=this.b1.iinertia*this.jAcc;this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},applyImpulseVel:function(){var a=-this.kMass*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-
this.rate),b=this.jAcc;this.jAcc+=a;if(this.breakUnderForce){if(this.jAcc>this.jMax||this.jAcc<-this.jMax)return!0}else this.jAcc<-this.jMax?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);a=this.jAcc-b;this.b1.angvel-=this.b1.iinertia*a;this.b2.angvel+=this.ratio*this.b2.iinertia*a;return!1},applyImpulsePos:function(){return!1},__class__:rf});var sf=function(){this.stepped=!1;this.kMassa=this.kMassb=this.kMassc=this.jAccx=this.jAccy=this.jMax=this.gamma=this.biasx=this.biasy=0;this.wrap_a2=
null;this.a2localx=this.a2localy=this.a2relx=this.a2rely=0;this.wrap_a1=this.b2=null;this.a1localx=this.a1localy=this.a1relx=this.a1rely=0;this.outer_zn=this.b1=null;Na.call(this);this.stepped=!1;this.jAccy=this.jAccx=0;this.jMax=Math.POSITIVE_INFINITY;this.a2rely=this.a2relx=this.a2localy=this.a2localx=this.a1rely=this.a1relx=this.a1localy=this.a1localx=0};h["zpp_nape.constraint.ZPP_PivotJoint"]=sf;sf.__name__=!0;sf.__super__=Na;sf.prototype=t(Na.prototype,{activeBodies:function(){null!=this.b1&&
this.b1.constraints.add(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx;this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(a){this.immutable_midstep("Constraint::a1");this.a1localx=a.x;this.a1localy=a.y;this.wake()},setup_a1:function(){this.wrap_a1=x.get(this.a1localx,
this.a1localy,null);this.wrap_a1.zpp_inner._inuse=!0;this.wrap_a1.zpp_inner._validate=n(this,this.validate_a1);this.wrap_a1.zpp_inner._invalidate=n(this,this.invalidate_a1)},validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx;this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(a){this.immutable_midstep("Constraint::a2");this.a2localx=a.x;this.a2localy=a.y;this.wake()},setup_a2:function(){this.wrap_a2=x.get(this.a2localx,this.a2localy,null);this.wrap_a2.zpp_inner._inuse=!0;this.wrap_a2.zpp_inner._validate=
n(this,this.validate_a2);this.wrap_a2.zpp_inner._invalidate=n(this,this.invalidate_a2)},wake_connected:function(){null!=this.b1&&this.b1.type==f.id_BodyType_DYNAMIC&&this.b1.wake();null!=this.b2&&this.b2.type==f.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==f.id_BodyType_DYNAMIC){var a;if(this.b1.component==this.b1.component.parent)a=this.b1.component;else{a=this.b1.component;for(var b=null;a!=a.parent;){var c=a.parent;a.parent=b;b=a;a=c}for(;null!=b;)c=b.parent,b.parent=
a,b=c}if(this.component==this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;){var d=b.parent;b.parent=c;c=b;b=d}for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}if(this.b2.type==f.id_BodyType_DYNAMIC){if(this.b2.component==this.b2.component.parent)a=this.b2.component;else{a=this.b2.component;for(b=null;a!=a.parent;)c=a.parent,a.parent=b,b=a,a=c;for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==
this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;)d=b.parent,b.parent=c,c=b,b=d;for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}},pair_exists:function(a,b){return this.b1.id==a&&this.b2.id==b||this.b1.id==b&&this.b2.id==a},clearcache:function(){this.jAccy=this.jAccx=0;this.pre_dt=-1},preStep:function(a){-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;this.stepped=!0;this.a1relx=
this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy;this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy;this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var c=this.b1.smass+this.b2.smass;this.kMassa=c;this.kMassb=0;this.kMassc=c;if(0!=this.b1.sinertia){var c=this.a1relx*this.b1.sinertia,d=this.a1rely*this.b1.sinertia;this.kMassa+=d*this.a1rely;this.kMassb+=-d*this.a1relx;this.kMassc+=c*this.a1relx}0!=
this.b2.sinertia&&(c=this.a2relx*this.b2.sinertia,d=this.a2rely*this.b2.sinertia,this.kMassa+=d*this.a2rely,this.kMassb+=-d*this.a2relx,this.kMassc+=c*this.a2relx);c=this.kMassa*this.kMassc-this.kMassb*this.kMassb;c!=c?(this.kMassa=this.kMassb=this.kMassc=0,c=3):0==c?(c=0,0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,c|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,c|=2),this.kMassb=0):(c=1/c,d=this.kMassc*c,this.kMassc=this.kMassa*c,this.kMassa=d,this.kMassb*=-c,c=0);0!=(c&
1)&&(this.jAccx=0);0!=(c&2)&&(this.jAccy=0);if(this.stiff)this.gamma=this.biasy=this.biasx=0;else{d=2*Math.PI*this.frequency;this.gamma=1/(a*d*(2*this.damping+d*a));c=1/(1+this.gamma);d=a*d*d*this.gamma;this.gamma*=c;this.kMassa*=c;this.kMassb*=c;this.kMassc*=c;this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx);this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);if(this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;c=-d;this.biasx*=
c;this.biasy*=c;c=this.maxError;d=this.biasx*this.biasx+this.biasy*this.biasy;d>c*c&&(c*=1/Math.sqrt(d),this.biasx*=c,this.biasy*=c)}this.jAccx*=b;this.jAccy*=b;this.jMax=this.maxForce*a;return!1},warmStart:function(){var a=this.b1.imass;this.b1.velx-=this.jAccx*a;this.b1.vely-=this.jAccy*a;a=this.b2.imass;this.b2.velx+=this.jAccx*a;this.b2.vely+=this.jAccy*a;this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia;this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*
this.b2.iinertia},applyImpulseVel:function(){var a=0,b=0,a=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),b=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),c=0,d=0,c=this.biasx-a,d=this.biasy-b,a=this.kMassa*c+this.kMassb*d,d=this.kMassb*c+this.kMassc*d,b=this.gamma,c=a-this.jAccx*b,d=d-
this.jAccy*b,b=a=0,a=this.jAccx,b=this.jAccy;this.jAccx+=1*c;this.jAccy+=1*d;if(this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(c=this.jMax,d=this.jAccx*this.jAccx+this.jAccy*this.jAccy,d>c*c&&(c*=1/Math.sqrt(d),this.jAccx*=c,this.jAccy*=c));c=this.jAccx-a;d=this.jAccy-b;a=this.b1.imass;this.b1.velx-=c*a;this.b1.vely-=d*a;a=this.b2.imass;this.b2.velx+=c*a;this.b2.vely+=d*a;this.b1.angvel-=(d*this.a1relx-c*this.a1rely)*this.b1.iinertia;
this.b2.angvel+=(d*this.a2relx-c*this.a2rely)*this.b2.iinertia;return!1},applyImpulsePos:function(){var a=0,b=0,a=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,b=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,c=0,d=0,c=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,d=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,e=0,f=0,e=this.b2.posx+c-(this.b1.posx+a),f=this.b2.posy+d-(this.b1.posy+b);if(this.breakUnderError&&e*e+f*f>this.maxError*this.maxError)return!0;if(e*
e+f*f<m.constraintLinearSlop*m.constraintLinearSlop)return!1;var e=0.5*e,f=0.5*f,g=0,j=0;if(6<e*e+f*f&&(j=this.b1.smass+this.b2.smass,j>m.epsilon)){var j=0.75/j,g=-e*j,j=-f*j,i=g*g+j*j;400<i&&(i=20*(1/Math.sqrt(i)),g*=i,j*=i);i=this.b1.imass;this.b1.posx-=g*i;this.b1.posy-=j*i;i=this.b2.imass;this.b2.posx+=g*i;this.b2.posy+=j*i;e=this.b2.posx+c-(this.b1.posx+a);f=this.b2.posy+d-(this.b1.posy+b);e*=0.5;f*=0.5}var h=i=0,k=0,i=g=this.b1.smass+this.b2.smass,h=0,k=g;0!=this.b1.sinertia&&(g=a*this.b1.sinertia,
j=b*this.b1.sinertia,i+=j*b,h+=-j*a,k+=g*a);0!=this.b2.sinertia&&(g=c*this.b2.sinertia,j=d*this.b2.sinertia,i+=j*d,h+=-j*c,k+=g*c);g=-e;j=-f;e=g*g+j*j;36<e&&(e=6*(1/Math.sqrt(e)),g*=e,j*=e);e=i*k-h*h;e!=e?g=j=0:0==e?(g=0!=i?g/i:0,j=0!=k?j/k:0):(e=1/e,k=e*(k*g-h*j),j=e*(i*j-h*g),g=k);i=this.b1.imass;this.b1.posx-=g*i;this.b1.posy-=j*i;i=this.b2.imass;this.b2.posx+=g*i;this.b2.posy+=j*i;this.b1.delta_rot(-(j*a-g*b)*this.b1.iinertia);this.b2.delta_rot((j*c-g*d)*this.b2.iinertia);return!1},__class__:sf});
var C=function(){this.colarb=this.fluidarb=this.sensorarb=null;this.type=0;this.b1=this.b2=this.ws1=this.ws2=this.pair=null;this.invalidated=!1;this.immState=0;this.intchange=this.presentable=this.continuous=this.fresh=!1;this.present=0;this.active=this.cleared=this.sleeping=!1;this.id=this.di=this.stamp=this.up_stamp=this.sleep_stamp=this.endGenerated=0;this.outer=null};h["zpp_nape.dynamics.ZPP_Arbiter"]=C;C.__name__=!0;C.prototype={wrapper:function(){null==this.outer&&(C.internal=!0,this.type==
C.COL?(this.colarb.outer_zn=new tf,this.outer=this.colarb.outer_zn):this.type==C.FLUID?(this.fluidarb.outer_zn=new uf,this.outer=this.fluidarb.outer_zn):this.outer=new Sc,this.outer.zpp_inner=this,C.internal=!1);return this.outer},__class__:C};var Ea=function(){this.next=null;C.call(this);this.type=C.SENSOR;this.sensorarb=this};h["zpp_nape.dynamics.ZPP_SensorArbiter"]=Ea;Ea.__name__=!0;Ea.__super__=C;Ea.prototype=t(C.prototype,{retire:function(){this.cleared||(this.b1.arbiters.inlined_try_remove(this),
this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;this.intchange=this.active=!1;this.next=Ea.zpp_pool;Ea.zpp_pool=this},__class__:Ea});var jb=function(){this.wMass=this.adamp=this.agamma=this.vMassa=this.vMassb=this.vMassc=this.dampx=this.dampy=this.lgamma=this.nx=this.ny=this.buoyx=this.buoyy=this.pre_dt=0;this.nodrag=!1;this.centroidx=this.centroidy=this.overlap=this.r1x=this.r1y=this.r2x=this.r2y=0;this.outer_zn=this.next=null;C.call(this);
this.type=C.FLUID;this.fluidarb=this;this.buoyy=this.buoyx=0;this.pre_dt=-1};h["zpp_nape.dynamics.ZPP_FluidArbiter"]=jb;jb.__name__=!0;jb.__super__=C;jb.prototype=t(C.prototype,{retire:function(){this.cleared||(this.b1.arbiters.inlined_try_remove(this),this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;this.intchange=this.active=!1;this.next=jb.zpp_pool;jb.zpp_pool=this;this.pre_dt=-1},preStep:function(a,b){-1==this.pre_dt&&(this.pre_dt=
b);var c=b/this.pre_dt;this.pre_dt=b;this.r1x=this.centroidx-this.b1.posx;this.r1y=this.centroidy-this.b1.posy;this.r2x=this.centroidx-this.b2.posx;this.r2y=this.centroidy-this.b2.posy;var d=0,e=0;this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(d=this.ws1.fluidProperties.gravityx,e=this.ws1.fluidProperties.gravityy):(d=a.gravityx,e=a.gravityy);var g=0,q=0;this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(g=this.ws2.fluidProperties.gravityx,q=this.ws2.fluidProperties.gravityy):
(g=a.gravityx,q=a.gravityy);var j=0,i=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled){var h=this.overlap*this.ws1.fluidProperties.density,k=this.overlap*this.ws2.fluidProperties.density;if(h>k)g=h+k,j-=d*g,i-=e*g;else if(h<k)d=h+k,j+=g*d,i+=q*d;else{var o=0,l=0,o=0.5*(d+g),l=0.5*(e+q);this.ws1.worldCOMx*o+this.ws1.worldCOMy*l>this.ws2.worldCOMx*o+this.ws2.worldCOMy*l?(d=h+k,j-=o*d,i-=l*d):(d=h+k,j+=o*d,i+=l*d)}}else this.ws1.fluidEnabled?(g=this.overlap*this.ws1.fluidProperties.density,j-=d*g,
i-=e*g):this.ws2.fluidEnabled&&(d=this.overlap*this.ws2.fluidProperties.density,j+=g*d,i+=q*d);j*=b;i*=b;this.buoyx=j;this.buoyy=i;this.b1.type==f.id_BodyType_DYNAMIC&&(d=this.b1.imass,this.b1.velx-=j*d,this.b1.vely-=i*d,this.b1.angvel-=(i*this.r1x-j*this.r1y)*this.b1.iinertia);this.b2.type==f.id_BodyType_DYNAMIC&&(d=this.b2.imass,this.b2.velx+=j*d,this.b2.vely+=i*d,this.b2.angvel+=(i*this.r2x-j*this.r2y)*this.b2.iinertia);if((!this.ws1.fluidEnabled||0==this.ws1.fluidProperties.viscosity)&&(!this.ws2.fluidEnabled||
0==this.ws2.fluidProperties.viscosity))this.nodrag=!0,this.adamp=this.dampy=this.dampx=0;else{this.nodrag=!1;j=0;this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),j+=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area);this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),j+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area);0!=j?(i=this.b1.sinertia+this.b2.sinertia,this.wMass=0!=i?1/i:0,j=2*Math.PI*4.0E-4*j,this.agamma=1/(b*j*(2+j*b)),j=1/(1+
this.agamma),this.agamma*=j,this.wMass*=j):this.agamma=this.wMass=0;j=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel));i=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));j*j+i*i<m.epsilon*m.epsilon||(d=1/Math.sqrt(j*j+i*i),this.nx=j*d,this.ny=i*d);j=0;if(this.ws1.fluidEnabled)if(i=-this.ws1.fluidProperties.viscosity*
this.overlap/this.ws2.area,this.ws2.type==f.id_ShapeType_CIRCLE)j-=i*this.ws2.circle.radius*m.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{e=d=0;for(g=this.ws2.polygon.edges.head;null!=g;)q=g.elt,d+=q.length,q=i*q.length*(q.gnormx*this.nx+q.gnormy*this.ny),0<q&&(q=q*=-m.fluidVacuumDrag),e-=0.5*q*m.fluidLinearDrag,g=g.next;j+=e/d}if(this.ws2.fluidEnabled)if(i=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area,this.ws1.type==f.id_ShapeType_CIRCLE)j-=i*this.ws1.circle.radius*m.fluidLinearDrag/
(2*this.ws1.circle.radius*Math.PI);else{e=d=0;for(g=this.ws1.polygon.edges.head;null!=g;)q=g.elt,d+=q.length,q=i*q.length*(q.gnormx*this.nx+q.gnormy*this.ny),0<q&&(q=q*=-m.fluidVacuumDrag),e-=0.5*q*m.fluidLinearDrag,g=g.next;j+=e/d}0!=j?(g=this.b1.smass+this.b2.smass,e=d=i=0,i=g,d=0,e=g,0!=this.b1.sinertia&&(g=this.r1x*this.b1.sinertia,q=this.r1y*this.b1.sinertia,i+=q*this.r1y,d+=-q*this.r1x,e+=g*this.r1x),0!=this.b2.sinertia&&(g=this.r2x*this.b2.sinertia,q=this.r2y*this.b2.sinertia,i+=q*this.r2y,
d+=-q*this.r2x,e+=g*this.r2x),g=i*e-d*d,g!=g?(i=d=e=0,3):0==g?(g=0,0!=i?i=1/i:(i=0,g|=1),0!=e?e=1/e:(e=0,g|=2),d=0,g):(g=1/g,q=e*g,e=i*g,i=q,d*=-g,0),this.vMassa=i,this.vMassb=d,this.vMassc=e,j*=2*Math.PI,this.lgamma=1/(b*j*(2+j*b)),j=1/(1+this.lgamma),this.lgamma*=j,this.vMassa*=j,this.vMassb*=j,this.vMassc*=j):this.lgamma=this.vMassc=this.vMassb=this.vMassa=0}this.dampx*=c;this.dampy*=c;this.adamp*=c},warmStart:function(){var a=this.b1.imass;this.b1.velx-=this.dampx*a;this.b1.vely-=this.dampy*a;
a=this.b2.imass;this.b2.velx+=this.dampx*a;this.b2.vely+=this.dampy*a;this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y);this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y);this.b1.angvel-=this.adamp*this.b1.iinertia;this.b2.angvel+=this.adamp*this.b2.iinertia},applyImpulseVel:function(){if(!this.nodrag){var a=this.b1.angvel+this.b1.kinangvel,b=this.b2.angvel+this.b2.kinangvel,c=this.b1.velx+this.b1.kinvelx-this.r1y*a-(this.b2.velx+this.b2.kinvelx-this.r2y*
b),d=this.b1.vely+this.b1.kinvely+this.r1x*a-(this.b2.vely+this.b2.kinvely+this.r2x*b),e=this.vMassa*c+this.vMassb*d,d=this.vMassb*c+this.vMassc*d,f=this.lgamma,c=e-this.dampx*f,d=d-this.dampy*f;this.dampx+=1*c;this.dampy+=1*d;e=this.b1.imass;this.b1.velx-=c*e;this.b1.vely-=d*e;e=this.b2.imass;this.b2.velx+=c*e;this.b2.vely+=d*e;this.b1.angvel-=this.b1.iinertia*(d*this.r1x-c*this.r1y);this.b2.angvel+=this.b2.iinertia*(d*this.r2x-c*this.r2y);a=(a-b)*this.wMass-this.adamp*this.agamma;this.adamp+=a;
this.b1.angvel-=a*this.b1.iinertia;this.b2.angvel+=a*this.b2.iinertia}},__class__:jb});var mb=function(){this.pre_dt=0;this.stat=!1;this.next=null;this.hc2=this.hpc2=!1;this.c1=this.oc1=this.c2=this.oc2=null;this.__ref_vertex=0;this.__ref_edge1=this.__ref_edge2=null;this.biasCoef=0;this.rev=!1;this.kMassa=this.kMassb=this.kMassc=this.Ka=this.Kb=this.Kc=this.rMass=this.jrAcc=this.rn1a=this.rt1a=this.rn1b=this.rt1b=this.rn2a=this.rt2a=this.rn2b=this.rt2b=this.k1x=this.k1y=this.k2x=this.k2y=this.surfacex=
this.surfacey=this.lnormx=this.lnormy=this.lproj=this.radius=0;this.wrap_normal=null;this.nx=this.ny=0;this.s1=this.s2=this.contacts=this.innards=null;this.userdef_dyn_fric=this.userdef_stat_fric=this.userdef_restitution=this.userdef_rfric=!1;this.dyn_fric=this.stat_fric=this.restitution=this.rfric=0;this.outer_zn=null;C.call(this);this.pre_dt=-1;this.contacts=new $a;this.innards=new Bf;this.type=C.COL;this.colarb=this};h["zpp_nape.dynamics.ZPP_ColArbiter"]=mb;mb.__name__=!0;mb.__super__=C;mb.prototype=
t(C.prototype,{normal_validate:function(){if(this.cleared)throw"Error: Arbiter not currently in use";this.wrap_normal.zpp_inner.x=this.nx;this.wrap_normal.zpp_inner.y=this.ny;this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},getnormal:function(){this.wrap_normal=x.get(0,0,null);this.wrap_normal.zpp_inner._immutable=!0;this.wrap_normal.zpp_inner._inuse=!0;this.wrap_normal.zpp_inner._validate=n(this,this.normal_validate)},
injectContact:function(a,b,c,d,e,f,g){null==g&&(g=!1);for(var j=null,i=this.contacts.next;null!=i;){var h=i;if(f==h.hash){j=h;break}i=i.next}null==j?(null==$a.zpp_pool?j=new $a:(j=$a.zpp_pool,$a.zpp_pool=j.next,j.next=null),null,i=j.inner,i.jnAcc=i.jtAcc=0,j.hash=f,j.fresh=!0,j.arbiter=this,this.jrAcc=0,this.contacts.inlined_add(j),this.innards.add(i)):j.fresh=!1;j.px=a;j.py=b;this.nx=c;this.ny=d;j.dist=e;j.stamp=this.stamp;j.posOnly=g;return j},retire:function(){this.cleared||(this.b1.arbiters.inlined_try_remove(this),
this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;for(this.intchange=this.active=!1;null!=this.contacts.next;){var a=this.contacts.inlined_pop_unsafe();a.arbiter=null;a.next=$a.zpp_pool;$a.zpp_pool=a;this.innards.inlined_pop()}this.userdef_rfric=this.userdef_restitution=this.userdef_stat_fric=this.userdef_dyn_fric=!1;this.__ref_edge1=this.__ref_edge2=null;this.next=mb.zpp_pool;mb.zpp_pool=this;this.pre_dt=-1},cleanupContacts:function(){var a=
!0,b=null,c=null,d=this.innards.next;this.hc2=!1;for(var e=this.contacts.next;null!=e;){var f=e;f.stamp+m.arbiterExpirationDelay<this.stamp?(e=this.contacts.inlined_erase(b),d=this.innards.inlined_erase(c),f.arbiter=null,f.next=$a.zpp_pool,$a.zpp_pool=f):(b=f.inner,c=f.active,f.active=f.stamp==this.stamp,f.active&&(a?(a=!1,this.c1=b,this.oc1=f):(this.hc2=!0,this.c2=b,this.oc2=f)),c!=f.active&&(this.contacts.modified=!0),b=e,c=d,d=d.next,e=e.next)}this.hc2?(this.hpc2=!0,this.oc1.posOnly?(d=this.c1,
this.c1=this.c2,this.c2=d,d=this.oc1,this.oc1=this.oc2,this.oc2=d,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(a=!0)):this.hpc2=!1;return a},preStep:function(a){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.restitution=this.s1.material.elasticity<=Math.NEGATIVE_INFINITY||this.s2.material.elasticity<=Math.NEGATIVE_INFINITY?0:this.s1.material.elasticity>=Math.POSITIVE_INFINITY||this.s2.material.elasticity>=Math.POSITIVE_INFINITY?1:(this.s1.material.elasticity+
this.s2.material.elasticity)/2,0>this.restitution&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)));-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;
this.pre_dt=a;var c=this.b1.smass+this.b2.smass;this.hc2=!1;a=!0;this.biasCoef=this.b1.type!=f.id_BodyType_DYNAMIC||this.b2.type!=f.id_BodyType_DYNAMIC?this.continuous?m.contactContinuousStaticBiasCoef:m.contactStaticBiasCoef:this.continuous?m.contactContinuousBiasCoef:m.contactBiasCoef;this.continuous=!1;for(var d=null,e=null,g=this.innards.next,q=this.contacts.next;null!=q;){var j=q;if(j.stamp+m.arbiterExpirationDelay<this.stamp)q=this.contacts.inlined_erase(d),g=this.innards.inlined_erase(e),j.arbiter=
null,j.next=$a.zpp_pool,$a.zpp_pool=j;else{d=j.inner;e=j.active;j.active=j.stamp==this.stamp;if(j.active){a?(a=!1,this.c1=d,this.oc1=j):(this.hc2=!0,this.c2=d,this.oc2=j);d.r2x=j.px-this.b2.posx;d.r2y=j.py-this.b2.posy;d.r1x=j.px-this.b1.posx;d.r1y=j.py-this.b1.posy;var i=c+this.b2.sinertia*hd.sqr(d.r2x*this.nx+d.r2y*this.ny),i=i+this.b1.sinertia*hd.sqr(d.r1x*this.nx+d.r1y*this.ny);d.tMass=i<m.epsilon*m.epsilon?0:1/i;i=c+this.b2.sinertia*hd.sqr(this.ny*d.r2x-this.nx*d.r2y);i+=this.b1.sinertia*hd.sqr(this.ny*
d.r1x-this.nx*d.r1y);d.nMass=i<m.epsilon*m.epsilon?0:1/i;var h=i=0,k=this.b2.angvel+this.b2.kinangvel,i=this.b2.velx+this.b2.kinvelx-d.r2y*k,h=this.b2.vely+this.b2.kinvely+d.r2x*k,k=this.b1.angvel+this.b1.kinangvel,i=i-(this.b1.velx+this.b1.kinvelx-d.r1y*k),h=h-(this.b1.vely+this.b1.kinvely+d.r1x*k),k=this.nx*i+this.ny*h;j.elasticity=this.restitution;d.bounce=k*j.elasticity;d.bounce>-m.elasticThreshold&&(d.bounce=0);k=h*this.nx-i*this.ny;i=m.staticFrictionThreshold;d.friction=k*k>i*i?this.dyn_fric:
this.stat_fric;d.jnAcc*=b;d.jtAcc*=b}e!=j.active&&(this.contacts.modified=!0);d=q;e=g;g=g.next;q=q.next}}this.hc2?(this.hpc2=!0,this.oc1.posOnly?(g=this.c1,this.c1=this.c2,this.c2=g,g=this.oc1,this.oc1=this.oc2,this.oc2=g,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(a=!0)):this.hpc2=!1;this.jrAcc*=b;a||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+
this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel));this.hc2&&(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-
this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=c+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=c+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=c+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<m.illConditionedThreshold*(this.kMassa*
this.kMassc-this.kMassb*this.kMassb)?(this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc,b=this.kMassa*this.kMassc-this.kMassb*this.kMassb,b!=b?(this.kMassa=this.kMassb=this.kMassc=0,3):0==b?(b=0,0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,b|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,b|=2),this.kMassb=0,b):(b=1/b,c=this.kMassc*b,this.kMassc=this.kMassa*b,this.kMassa=c,this.kMassb*=-b,0)):(this.hc2=!1,this.oc2.dist<this.oc1.dist&&(b=this.c1,this.c1=this.c2,this.c2=
b),this.oc2.active=!1,this.contacts.modified=!0));this.surfacex=this.b2.svelx;this.surfacey=this.b2.svely;this.surfacex+=1*this.b1.svelx;this.surfacey+=1*this.b1.svely;this.surfacex=-this.surfacex;this.surfacey=-this.surfacey;this.rMass=this.b1.sinertia+this.b2.sinertia;0!=this.rMass&&(this.rMass=1/this.rMass);return a},warmStart:function(){var a=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,b=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,c=this.b1.imass;this.b1.velx-=a*c;this.b1.vely-=b*c;this.b1.angvel-=
this.b1.iinertia*(b*this.c1.r1x-a*this.c1.r1y);c=this.b2.imass;this.b2.velx+=a*c;this.b2.vely+=b*c;this.b2.angvel+=this.b2.iinertia*(b*this.c1.r2x-a*this.c1.r2y);this.hc2&&(a=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,b=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,c=this.b1.imass,this.b1.velx-=a*c,this.b1.vely-=b*c,this.b1.angvel-=this.b1.iinertia*(b*this.c2.r1x-a*this.c2.r1y),c=this.b2.imass,this.b2.velx+=a*c,this.b2.vely+=b*c,this.b2.angvel+=this.b2.iinertia*(b*this.c2.r2x-a*this.c2.r2y));this.b2.angvel+=
this.jrAcc*this.b2.iinertia;this.b1.angvel-=this.jrAcc*this.b1.iinertia},applyImpulseVel:function(){var a,b,c,d,e;d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel);var f=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);c=(f*this.nx-d*this.ny+this.surfacex)*this.c1.tMass;d=this.c1.friction*this.c1.jnAcc;a=this.c1.jtAcc;e=a-c;e>d?e=d:e<-d&&(e=-d);c=e-a;this.c1.jtAcc=e;a=-this.ny*c;b=this.nx*c;this.b2.velx+=a*this.b2.imass;
this.b2.vely+=b*this.b2.imass;this.b1.velx-=a*this.b1.imass;this.b1.vely-=b*this.b1.imass;this.b2.angvel+=this.rt1b*c*this.b2.iinertia;this.b1.angvel-=this.rt1a*c*this.b1.iinertia;this.hc2?(e=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),b=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),c=(b*this.nx-e*this.ny+this.surfacex)*this.c2.tMass,d=this.c2.friction*this.c2.jnAcc,a=this.c2.jtAcc,e=a-c,e>d?e=d:e<-d&&(e=-d),
c=e-a,this.c2.jtAcc=e,a=-this.ny*c,b=this.nx*c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=this.rt2b*c*this.b2.iinertia,this.b1.angvel-=this.rt2a*c*this.b1.iinertia,d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),f=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),e=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-
this.c2.r1y*this.b1.angvel),b=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),c=this.c1.jnAcc,a=this.c2.jnAcc,d=d*this.nx+f*this.ny+this.surfacey+this.c1.bounce-(this.Ka*c+this.Kb*a),e=e*this.nx+b*this.ny+this.surfacey+this.c2.bounce-(this.Kb*c+this.Kc*a),b=-(this.kMassa*d+this.kMassb*e),f=-(this.kMassb*d+this.kMassc*e),0<=b&&0<=f?(d=b-c,e=f-a,this.c1.jnAcc=b,this.c2.jnAcc=f):(b=-this.c1.nMass*d,0<=b&&0<=this.Kb*b+e?(d=b-c,e=-a,this.c1.jnAcc=b,this.c2.jnAcc=
0):(f=-this.c2.nMass*e,0<=f&&0<=this.Kb*f+d?(d=-c,e=f-a,this.c1.jnAcc=0,this.c2.jnAcc=f):0<=d&&0<=e?(d=-c,e=-a,this.c1.jnAcc=this.c2.jnAcc=0):e=d=0)),c=d+e,a=this.nx*c,b=this.ny*c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=(this.rn1b*d+this.rn2b*e)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*d+this.rn2a*e)*this.b1.iinertia):(0!=this.radius&&(c=(this.b2.angvel-this.b1.angvel)*this.rMass,d=this.rfric*this.c1.jnAcc,
a=this.jrAcc,this.jrAcc-=c,this.jrAcc>d?this.jrAcc=d:this.jrAcc<-d&&(this.jrAcc=-d),c=this.jrAcc-a,this.b2.angvel+=c*this.b2.iinertia,this.b1.angvel-=c*this.b1.iinertia),d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),f=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),c=(this.c1.bounce+(this.nx*d+this.ny*f)+this.surfacey)*this.c1.nMass,a=this.c1.jnAcc,e=a-c,0>e&&(e=0),c=e-a,this.c1.jnAcc=e,a=this.nx*c,b=this.ny*
c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=this.rn1b*c*this.b2.iinertia,this.b1.angvel-=this.rn1a*c*this.b1.iinertia)},applyImpulsePos:function(){if(2==this.ptype){var a=this.c1,b=0,c=0,b=this.b2.axisy*a.lr2x-this.b2.axisx*a.lr2y,c=a.lr2x*this.b2.axisx+a.lr2y*this.b2.axisy,b=b+1*this.b2.posx,c=c+1*this.b2.posy,d=0,e=0,d=this.b1.axisy*a.lr1x-this.b1.axisx*a.lr1y,e=a.lr1x*this.b1.axisx+a.lr1y*this.b1.axisy,
d=d+1*this.b1.posx,e=e+1*this.b1.posy,f=a=0,a=b-d,f=c-e,g=Math.sqrt(a*a+f*f),j=this.radius-m.collisionSlop,i=g-j;0>a*this.nx+f*this.ny&&(a=-a,f=-f,i-=this.radius);0>i&&(g<m.epsilon?0!=this.b1.smass?this.b1.posx+=10*m.epsilon:this.b2.posx+=10*m.epsilon:(i=1/g,a*=i,f*=i,b=0.5*(d+b),c=0.5*(e+c),d=b-this.b1.posx,e=c-this.b1.posy,b-=this.b2.posx,c-=this.b2.posy,d=f*d-a*e,b=f*b-a*c,c=this.b2.smass+b*b*this.b2.sinertia+this.b1.smass+d*d*this.b1.sinertia,0!=c&&(g=-this.biasCoef*(g-j)/c,c=j=0,j=a*g,c=f*g,
a=this.b1.imass,this.b1.posx-=j*a,this.b1.posy-=c*a,this.b1.delta_rot(-d*this.b1.iinertia*g),a=this.b2.imass,this.b2.posx+=j*a,this.b2.posy+=c*a,this.b2.delta_rot(b*this.b2.iinertia*g))))}else{var h=i=f=a=0,e=b=0;0==this.ptype?(a=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,f=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,j=this.lproj+(a*this.b1.posx+f*this.b1.posy),i=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,h=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy,i+=1*this.b2.posx,
h+=1*this.b2.posy,this.hpc2&&(b=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,e=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,b+=1*this.b2.posx,e+=1*this.b2.posy)):(a=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,f=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,j=this.lproj+(a*this.b2.posx+f*this.b2.posy),i=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,h=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,i+=1*this.b1.posx,h+=1*this.b1.posy,this.hpc2&&(b=this.b1.axisy*
this.c2.lr1x-this.b1.axisx*this.c2.lr1y,e=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,b+=1*this.b1.posx,e+=1*this.b1.posy));g=i*a+h*f-j-this.radius;g+=m.collisionSlop;c=0;this.hpc2&&(c=b*a+e*f-j-this.radius,c+=m.collisionSlop);if(0>g||0>c){this.rev&&(a=-a,f=-f);var k=0,o=0,k=i-this.b1.posx,o=h-this.b1.posy,d=j=0,j=i-this.b2.posx,d=h-this.b2.posy,l=0,n=0,h=i=0;if(this.hpc2){l=b-this.b1.posx;n=e-this.b1.posy;i=b-this.b2.posx;h=e-this.b2.posy;b=f*k-a*o;j=f*j-a*d;e=f*l-a*n;d=f*i-a*h;i=this.b1.smass+
this.b2.smass;this.kMassa=i+this.b1.sinertia*b*b+this.b2.sinertia*j*j;this.kMassb=i+this.b1.sinertia*b*e+this.b2.sinertia*j*d;this.kMassc=i+this.b1.sinertia*e*e+this.b2.sinertia*d*d;k=h=i=0;i=this.kMassa;h=this.kMassb;k=this.kMassc;o=g*this.biasCoef;l=c*this.biasCoef;c=g=0;g=-o;c=-l;n=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(n!=n)g=c=0;else if(0==n)g=0!=this.kMassa?g/this.kMassa:0,c=0!=this.kMassc?c/this.kMassc:0;else var n=1/n,p=n*(this.kMassc*g-this.kMassb*c),c=n*(this.kMassa*c-this.kMassb*
g),g=p;0<=g&&0<=c?(i=(g+c)*this.b1.imass,this.b1.posx-=a*i,this.b1.posy-=f*i,this.b1.delta_rot(-this.b1.iinertia*(b*g+e*c)),b=(g+c)*this.b2.imass,this.b2.posx+=a*b,this.b2.posy+=f*b,this.b2.delta_rot(this.b2.iinertia*(j*g+d*c))):(g=-o/i,c=0,0<=g&&0<=h*g+l?(i=(g+c)*this.b1.imass,this.b1.posx-=a*i,this.b1.posy-=f*i,this.b1.delta_rot(-this.b1.iinertia*(b*g+e*c)),b=(g+c)*this.b2.imass,this.b2.posx+=a*b,this.b2.posy+=f*b,this.b2.delta_rot(this.b2.iinertia*(j*g+d*c))):(g=0,c=-l/k,0<=c&&0<=h*c+o&&(i=(g+
c)*this.b1.imass,this.b1.posx-=a*i,this.b1.posy-=f*i,this.b1.delta_rot(-this.b1.iinertia*(b*g+e*c)),b=(g+c)*this.b2.imass,this.b2.posx+=a*b,this.b2.posy+=f*b,this.b2.delta_rot(this.b2.iinertia*(j*g+d*c)))))}else b=f*k-a*o,j=f*j-a*d,c=this.b2.smass+j*j*this.b2.sinertia+this.b1.smass+b*b*this.b1.sinertia,0!=c&&(g=-this.biasCoef*g/c,d=c=0,c=a*g,d=f*g,a=this.b1.imass,this.b1.posx-=c*a,this.b1.posy-=d*a,this.b1.delta_rot(-b*this.b1.iinertia*g),a=this.b2.imass,this.b2.posx+=c*a,this.b2.posy+=d*a,this.b2.delta_rot(j*
this.b2.iinertia*g))}}},__class__:mb});var $a=function(){this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.dist=this.elasticity=0;this.fresh=!1;this.stamp=this.hash=0;this.active=this.posOnly=!1;this.arbiter=this.inner=null;this.px=this.py=0;this.outer=null;this.inner=new Bf};h["zpp_nape.dynamics.ZPP_Contact"]=$a;$a.__name__=!0;$a.prototype={wrapper:function(){null==this.outer&&($a.internal=!0,this.outer=new tg,$a.internal=!1,this.outer.zpp_inner=this);return this.outer},
inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.next;this.pop();return a},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=
!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:$a};var Bf=function(){this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.r1x=this.r1y=this.r2x=this.r2y=this.nMass=this.tMass=this.bounce=this.friction=this.jnAcc=this.jtAcc=this.lr1x=this.lr1y=this.lr2x=this.lr2y=0};h["zpp_nape.dynamics.ZPP_IContact"]=Bf;Bf.__name__=!0;Bf.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=
a;this.modified=!0;this.length++;return a},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Bf};var Ha=function(){this.collisionGroup=this.collisionMask=this.sensorGroup=
this.sensorMask=this.fluidGroup=this.fluidMask=0;this.next=this.outer=this.shapes=null;this.shapes=new yc;this.collisionGroup=this.sensorGroup=this.fluidGroup=1;this.collisionMask=this.sensorMask=this.fluidMask=-1};h["zpp_nape.dynamics.ZPP_InteractionFilter"]=Ha;Ha.__name__=!0;Ha.prototype={wrapper:function(){if(null==this.outer){this.outer=new ug;var a=this.outer.zpp_inner;a.outer=null;a.next=Ha.zpp_pool;Ha.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},shouldCollide:function(a){return 0!=
(this.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&this.collisionGroup)},shouldSense:function(a){return 0!=(this.sensorMask&a.sensorGroup)&&0!=(a.sensorMask&this.sensorGroup)},shouldFlow:function(a){return 0!=(this.fluidMask&a.fluidGroup)&&0!=(a.fluidMask&this.fluidGroup)},invalidate:function(){for(var a=this.shapes.head;null!=a;)a.elt.invalidate_filter(),a=a.next},__class__:Ha};var jh=function(){this.depth=0;this.group=this.interactors=null;this.ignore=!1;this.outer=null};h["zpp_nape.dynamics.ZPP_InteractionGroup"]=
jh;jh.__name__=!0;jh.prototype={__class__:jh};var $=function(){this.wrap_max=null;this.maxx=this.maxy=0;this.wrap_min=null;this.minx=this.miny=0;this.outer=this.next=null;this._immutable=!1;this._invalidate=this._validate=null};h["zpp_nape.geom.ZPP_AABB"]=$;$.__name__=!0;$.get=function(a,b,c,d){var e;null==$.zpp_pool?e=new $:(e=$.zpp_pool,$.zpp_pool=e.next,e.next=null);null;e.minx=a;e.miny=b;e.maxx=c;e.maxy=d;return e};$.prototype={validate:function(){null!=this._validate&&this._validate()},perimeter:function(){return 2*
(this.maxx-this.minx+(this.maxy-this.miny))},getmin:function(){null==this.wrap_min&&(this.wrap_min=x.get(this.minx,this.miny,null),this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=n(this,this.mod_min),this.wrap_min.zpp_inner._validate=n(this,this.dom_min));return this.wrap_min},dom_min:function(){null!=this._validate&&this._validate();this.wrap_min.zpp_inner.x=this.minx;this.wrap_min.zpp_inner.y=this.miny},mod_min:function(a){if(a.x!=
this.minx||a.y!=this.miny)this.minx=a.x,this.miny=a.y,null!=this._invalidate&&this._invalidate(this)},getmax:function(){null==this.wrap_max&&(this.wrap_max=x.get(this.maxx,this.maxy,null),this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=n(this,this.mod_max),this.wrap_max.zpp_inner._validate=n(this,this.dom_max));return this.wrap_max},dom_max:function(){null!=this._validate&&this._validate();this.wrap_max.zpp_inner.x=this.maxx;
this.wrap_max.zpp_inner.y=this.maxy},mod_max:function(a){if(a.x!=this.maxx||a.y!=this.maxy)this.maxx=a.x,this.maxy=a.y,null!=this._invalidate&&this._invalidate(this)},intersectY:function(a){return!(a.miny>this.maxy||this.miny>a.maxy)},intersect:function(a){return a.miny<=this.maxy&&this.miny<=a.maxy&&a.minx<=this.maxx&&this.minx<=a.maxx},combine:function(a){a.minx<this.minx&&(this.minx=a.minx);a.maxx>this.maxx&&(this.maxx=a.maxx);a.miny<this.miny&&(this.miny=a.miny);a.maxy>this.maxy&&(this.maxy=a.maxy)},
contains:function(a){return a.minx>=this.minx&&a.miny>=this.miny&&a.maxx<=this.maxx&&a.maxy<=this.maxy},containsPoint:function(a){return a.x>=this.minx&&a.x<=this.maxx&&a.y>=this.miny&&a.y<=this.maxy},setCombine:function(a,b){this.minx=a.minx<b.minx?a.minx:b.minx;this.miny=a.miny<b.miny?a.miny:b.miny;this.maxx=a.maxx>b.maxx?a.maxx:b.maxx;this.maxy=a.maxy>b.maxy?a.maxy:b.maxy},setExpand:function(a,b){this.minx=a.minx-b;this.miny=a.miny-b;this.maxx=a.maxx+b;this.maxy=a.maxy+b},toString:function(){return"{ x: "+
this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},__class__:$};var he=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Vec2"]=he;he.__name__=!0;he.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==ab.zpp_pool?b=new ab:(b=ab.zpp_pool,ab.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,
b)},inlined_insert:function(a,b){var c;null==ab.zpp_pool?c=new ab:(c=ab.zpp_pool,ab.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=ab.zpp_pool;ab.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=ab.zpp_pool;ab.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},iterator_at:function(a){for(var b=this.head;0<
a--&&null!=b;)b=b.next;return b},__class__:he};var w=function(){};h["zpp_nape.geom.ZPP_Collide"]=w;w.__name__=!0;w.circleContains=function(a,b){var c=0,d=0,c=b.x-a.worldCOMx,d=b.y-a.worldCOMy;return c*c+d*d<a.radius*a.radius};w.polyContains=function(a,b){var c;c=!0;for(var d=a.edges.head;null!=d;){var e=d.elt;if(e.gnormx*b.x+e.gnormy*b.y<=e.gprojection)d=d.next;else{c=!1;break}}return c};w.contactCollide=function(a,b,c,d){if(b.type==f.id_ShapeType_POLYGON)if(a.type==f.id_ShapeType_POLYGON){for(var e=
!0,g=-1.0E100,q=-1,j=null,i=null,h=a.polygon.edges.head;null!=h;){for(var k=h.elt,o=1.0E100,l=b.polygon.gverts.next;null!=l;){var n=l,n=k.gnormx*n.x+k.gnormy*n.y;n<o&&(o=n);if(o-k.gprojection<=g)break;l=l.next}o-=k.gprojection;if(0<=o){e=!1;break}o>g&&(g=o,j=k,q=1);h=h.next}if(e){for(h=b.polygon.edges.head;null!=h;){k=h.elt;o=1.0E100;for(l=a.polygon.gverts.next;null!=l;){n=l;n=k.gnormx*n.x+k.gnormy*n.y;n<o&&(o=n);if(o-k.gprojection<=g)break;l=l.next}o-=k.gprojection;if(0<=o){e=!1;break}o>g&&(g=o,
i=k,q=2);h=h.next}if(e){1==q?(a=b.polygon,b=j,i=1):(a=a.polygon,b=i,i=-1);j=null;e=1.0E100;for(g=a.edges.head;null!=g;)h=g.elt,k=b.gnormx*h.gnormx+b.gnormy*h.gnormy,k<e&&(e=k,j=h),g=g.next;var g=e=0,e=j.gp0.x,g=j.gp0.y,k=h=0,h=j.gp1.x,k=j.gp1.y,l=o=0,o=h-e,l=k-g,p=b.gnormy*e-b.gnormx*g,n=b.gnormy*h-b.gnormx*k,t=1/(n-p),p=(-b.tp1-p)*t;p>m.epsilon&&(e+=o*p,g+=l*p);n=(-b.tp0-n)*t;n<-m.epsilon&&(h+=o*n,k+=l*n);l=o=0;l=i;o=b.gnormx*l;l*=b.gnormy;c.lnormx=b.lnormx;c.lnormy=b.lnormy;c.lproj=b.lprojection;
c.radius=0;c.rev=d!=(-1==i);c.ptype=c.rev?1:0;n=e*b.gnormx+g*b.gnormy-b.gprojection;i=h*b.gnormx+k*b.gnormy-b.gprojection;if(0<n&&0<i)return!1;d&&(o=-o,l=-l);d=c.injectContact(e-0.5*b.gnormx*n,g-0.5*b.gnormy*n,o,l,n,c.rev?1:0,0<n);e-=1*a.body.posx;g-=1*a.body.posy;d.inner.lr1x=e*a.body.axisy+g*a.body.axisx;d.inner.lr1y=g*a.body.axisy-e*a.body.axisx;d=c.injectContact(h-0.5*b.gnormx*i,k-0.5*b.gnormy*i,o,l,i,c.rev?0:1,0<i);h-=1*a.body.posx;k-=1*a.body.posy;d.inner.lr1x=h*a.body.axisy+k*a.body.axisx;
d.inner.lr1y=k*a.body.axisy-h*a.body.axisx;1==q?(c.__ref_edge1=b,c.__ref_edge2=j):(c.__ref_edge2=b,c.__ref_edge1=j);return!0}}}else{i=-1.0E100;j=!0;e=q=null;g=b.polygon.gverts.next;for(h=b.polygon.edges.head;null!=h;){k=h.elt;o=k.gnormx*a.circle.worldCOMx+k.gnormy*a.circle.worldCOMy-k.gprojection-a.circle.radius;if(0<o){j=!1;break}o>i&&(i=o,q=k,e=g);g=g.next;h=h.next}if(j){j=e;e=null==e.next?b.polygon.gverts.next:e.next;g=a.circle.worldCOMy*q.gnormx-a.circle.worldCOMx*q.gnormy;if(g<=j.y*q.gnormx-
j.x*q.gnormy)return i=a.circle.radius,g=e=0,e=j.x-a.circle.worldCOMx,g=j.y-a.circle.worldCOMy,h=e*e+g*g,h>i*i?i=null:h<m.epsilon*m.epsilon?i=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-i,0,null):(h=1/Math.sqrt(h),k=h<m.epsilon?1.0E100:1/h,o=0.5+(a.circle.radius-0.5*i)*h,i=d?c.injectContact(a.circle.worldCOMx+e*o,a.circle.worldCOMy+g*o,-e*h,-g*h,k-i,0,null):c.injectContact(a.circle.worldCOMx+e*o,a.circle.worldCOMy+g*o,e*h,g*h,k-i,0,null)),null!=i&&(e=i.inner,c.ptype=2,h=g=0,g=j.x-b.polygon.body.posx,
h=j.y-b.polygon.body.posy,c.__ref_edge1=q,c.__ref_vertex=-1,d?(e.lr1x=g*b.polygon.body.axisy+h*b.polygon.body.axisx,e.lr1y=h*b.polygon.body.axisy-g*b.polygon.body.axisx,e.lr2x=a.circle.localCOMx,e.lr2y=a.circle.localCOMy):(e.lr2x=g*b.polygon.body.axisy+h*b.polygon.body.axisx,e.lr2y=h*b.polygon.body.axisy-g*b.polygon.body.axisx,e.lr1x=a.circle.localCOMx,e.lr1y=a.circle.localCOMy),c.radius=a.circle.radius),null!=i;if(g>=e.y*q.gnormx-e.x*q.gnormy)return j=a.circle.radius,g=i=0,i=e.x-a.circle.worldCOMx,
g=e.y-a.circle.worldCOMy,h=i*i+g*g,h>j*j?j=null:h<m.epsilon*m.epsilon?j=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-j,0,null):(h=1/Math.sqrt(h),k=h<m.epsilon?1.0E100:1/h,o=0.5+(a.circle.radius-0.5*j)*h,j=d?c.injectContact(a.circle.worldCOMx+i*o,a.circle.worldCOMy+g*o,-i*h,-g*h,k-j,0,null):c.injectContact(a.circle.worldCOMx+i*o,a.circle.worldCOMy+g*o,i*h,g*h,k-j,0,null)),null!=j&&(i=j.inner,c.ptype=2,h=g=0,g=e.x-b.polygon.body.posx,h=e.y-b.polygon.body.posy,c.__ref_edge1=q,c.__ref_vertex=
1,d?(i.lr1x=g*b.polygon.body.axisy+h*b.polygon.body.axisx,i.lr1y=h*b.polygon.body.axisy-g*b.polygon.body.axisx,i.lr2x=a.circle.localCOMx,i.lr2y=a.circle.localCOMy):(i.lr2x=g*b.polygon.body.axisy+h*b.polygon.body.axisx,i.lr2y=h*b.polygon.body.axisy-g*b.polygon.body.axisx,i.lr1x=a.circle.localCOMx,i.lr1y=a.circle.localCOMy),c.radius=a.circle.radius),null!=j;j=b=0;j=a.circle.radius+0.5*i;b=q.gnormx*j;j*=q.gnormy;g=e=0;e=a.circle.worldCOMx-b;g=a.circle.worldCOMy-j;b=d?c.injectContact(e,g,q.gnormx,q.gnormy,
i,0,null):c.injectContact(e,g,-q.gnormx,-q.gnormy,i,0,null);c.ptype=d?0:1;c.lnormx=q.lnormx;c.lnormy=q.lnormy;c.rev=!d;c.lproj=q.lprojection;c.radius=a.circle.radius;b.inner.lr1x=a.circle.localCOMx;b.inner.lr1y=a.circle.localCOMy;c.__ref_edge1=q;c.__ref_vertex=0;return!0}}else if(q=a.circle.radius+b.circle.radius,i=j=0,j=b.circle.worldCOMx-a.circle.worldCOMx,i=b.circle.worldCOMy-a.circle.worldCOMy,e=j*j+i*i,e>q*q?q=null:e<m.epsilon*m.epsilon?q=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,
1,0,-q,0,null):(e=1/Math.sqrt(e),g=e<m.epsilon?1.0E100:1/e,h=0.5+(a.circle.radius-0.5*q)*e,q=d?c.injectContact(a.circle.worldCOMx+j*h,a.circle.worldCOMy+i*h,-j*e,-i*e,g-q,0,null):c.injectContact(a.circle.worldCOMx+j*h,a.circle.worldCOMy+i*h,j*e,i*e,g-q,0,null)),null!=q)return q=q.inner,d?(q.lr1x=b.circle.localCOMx,q.lr1y=b.circle.localCOMy,q.lr2x=a.circle.localCOMx,q.lr2y=a.circle.localCOMy):(q.lr1x=a.circle.localCOMx,q.lr1y=a.circle.localCOMy,q.lr2x=b.circle.localCOMx,q.lr2y=b.circle.localCOMy),
c.radius=a.circle.radius+b.circle.radius,c.ptype=2,!0;return!1};w.testCollide_safe=function(a,b){if(b.type==f.id_ShapeType_CIRCLE)var c=a,a=b,b=c;return w.testCollide(a,b)};w.testCollide=function(a,b){if(b.type==f.id_ShapeType_POLYGON){if(a.type==f.id_ShapeType_POLYGON){for(var c=!0,d=a.polygon.edges.head;null!=d;){for(var e=d.elt,g=1.0E100,h=b.polygon.gverts.next;null!=h;){var j=h,j=e.gnormx*j.x+e.gnormy*j.y;j<g&&(g=j);h=h.next}g-=e.gprojection;if(0<g){c=!1;break}d=d.next}if(c){for(d=b.polygon.edges.head;null!=
d;){e=d.elt;g=1.0E100;for(h=a.polygon.gverts.next;null!=h;)j=h,j=e.gnormx*j.x+e.gnormy*j.y,j<g&&(g=j),h=h.next;g-=e.gprojection;if(0<g){c=!1;break}d=d.next}return c}}else{d=c=null;e=!0;g=-1.0E100;h=b.polygon.gverts.next;for(j=b.polygon.edges.head;null!=j;){var i=j.elt,m=i.gnormx*a.circle.worldCOMx+i.gnormy*a.circle.worldCOMy-i.gprojection-a.circle.radius;if(0<m){e=!1;break}m>g&&(g=m,c=i,d=h);h=h.next;j=j.next}if(e){e=d;d=null==d.next?b.polygon.gverts.next:d.next;g=a.circle.worldCOMy*c.gnormx-a.circle.worldCOMx*
c.gnormy;if(g<=e.y*c.gnormx-e.x*c.gnormy)return c=a.circle.radius,g=d=0,d=e.x-a.circle.worldCOMx,g=e.y-a.circle.worldCOMy,d*d+g*g<=c*c;return g>=d.y*c.gnormx-d.x*c.gnormy?(c=a.circle.radius,g=e=0,e=d.x-a.circle.worldCOMx,g=d.y-a.circle.worldCOMy,e*e+g*g<=c*c):!0}}return!1}c=a.circle.radius+b.circle.radius;e=d=0;d=b.circle.worldCOMx-a.circle.worldCOMx;e=b.circle.worldCOMy-a.circle.worldCOMy;return d*d+e*e<=c*c};w.flowCollide=function(a,b,c){if(b.type==f.id_ShapeType_POLYGON){if(a.type==f.id_ShapeType_POLYGON){for(var d=
[],e=[],g=!0,h=!0,j=a.polygon.edges.head;null!=j;){for(var i=j.elt,l=1.0E100,k=0,o=b.polygon.gverts.next;null!=o;){var n=o,p=i.gnormx*n.x+i.gnormy*n.y;p<l&&(l=p);p>=i.gprojection+m.epsilon&&(e[k]=!0,h=!1);k++;o=o.next}l-=i.gprojection;if(0<l){g=!1;break}j=j.next}if(h)return b.polygon.validate_worldCOM(),c.overlap=b.polygon.area,c.centroidx=b.polygon.worldCOMx,c.centroidy=b.polygon.worldCOMy,null,!0;if(g){for(var h=!0,t=b.polygon.edges.head;null!=t;){for(var s=t.elt,x=1.0E100,z=0,u=a.polygon.gverts.next;null!=
u;){var D=u,E=s.gnormx*D.x+s.gnormy*D.y;E<x&&(x=E);E>=s.gprojection+m.epsilon&&(d[z]=!0,h=!1);z++;u=u.next}x-=s.gprojection;if(0<x){g=!1;break}t=t.next}if(h)return a.polygon.validate_worldCOM(),c.overlap=a.polygon.area,c.centroidx=a.polygon.worldCOMx,c.centroidy=a.polygon.worldCOMy,null,!0;if(g){for(;null!=w.flowpoly.head;){var G=w.flowpoly.pop_unsafe();if(!G._inuse){var J=G;null!=J.outer&&(J.outer.zpp_inner=null,J.outer=null);J._isimmutable=null;J._validate=null;J._invalidate=null;J.next=K.zpp_pool;
K.zpp_pool=J}}for(var y=null,H=!1,C=a.polygon.gverts.next,I=0,F=b.polygon.gverts.next,id=0,N=0,Q=b.polygon.edgeCnt;N<Q;){var P=N++;if(e[P])F=F.next;else{id=P;break}}if(null==F){for(var F=b.polygon.gverts.next,H=!0,ba=0,W=a.polygon.edgeCnt;ba<W;){var ea=ba++;if(d[ea])C=C.next;else{I=ea;break}}null==C?C=a.polygon.gverts.next:(w.flowpoly.add(C),y=w.flowpoly.head.elt)}else w.flowpoly.add(F),y=w.flowpoly.head.elt;var S=1;if(null==w.flowpoly.head){for(var B=!0,Z=a.polygon.gverts.next,kb=Z,da=Z.next;null!=
da;){for(var ca=da,Cf=2,T=b.polygon.gverts.next,L=T,U=T.next;null!=U;){var Y=U,fa=0;(function(){var a=0,b=0,a=kb.x-L.x,b=kb.y-L.y,c=0,d=0,c=ca.x-kb.x,d=ca.y-kb.y,e=0,f=0,e=Y.x-L.x,f=Y.y-L.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(fa=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&fa<Cf&&(Cf=fa,F=T);T=U;L=Y;U=U.next}var O=U=b.polygon.gverts.next,Ca=0;(function(){var a=0,b=0,a=kb.x-L.x,b=kb.y-L.y,c=0,d=0,c=ca.x-kb.x,d=ca.y-
kb.y,e=0,f=0,e=O.x-L.x,f=O.y-L.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(Ca=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&Ca<Cf&&(Cf=Ca,F=T);if(2!=Cf){var ra=0,ua=0,Ga=Cf,ra=kb.x+(ca.x-kb.x)*Ga,ua=kb.y+(ca.y-kb.y)*Ga,y=K.get(ra,ua,null);w.flowpoly.add(y);H=!0;C=Z;B=!1;break}Z=da;kb=ca;da=da.next}if(B){for(var $=da=a.polygon.gverts.next,r=2,pa=b.polygon.gverts.next,X=pa,Ba=pa.next;null!=Ba;){var Qa=Ba,la=0;(function(){var a=
0,b=0,a=kb.x-X.x,b=kb.y-X.y,c=0,d=0,c=$.x-kb.x,d=$.y-kb.y,e=0,f=0,e=Qa.x-X.x,f=Qa.y-X.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(la=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&la<r&&(r=la,F=pa);pa=Ba;X=Qa;Ba=Ba.next}var ga=Ba=b.polygon.gverts.next,ja=0;(function(){var a=0,b=0,a=kb.x-X.x,b=kb.y-X.y,c=0,d=0,c=$.x-kb.x,d=$.y-kb.y,e=0,f=0,e=ga.x-X.x,f=ga.y-X.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&
e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(ja=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&ja<r&&(r=ja,F=pa);if(2!=r){var Fa=0,Ma=0,Df=r,Fa=kb.x+($.x-kb.x)*Df,Ma=kb.y+($.y-kb.y)*Df,y=K.get(Fa,Ma,null);w.flowpoly.add(y);H=!0;C=Z}}S=2}for(;;)if(H)if(C=C.next,I++,null==C&&(C=a.polygon.gverts.next,I=0),d[I]){var R=w.flowpoly.head.elt,wb=C,ie=F,xb=F.next;null==xb&&(xb=b.polygon.gverts.next);var ue=-1,Ef=null,za=0,Ra=0,Ha=xb,zc=xb;do{var $a=zc,qa=0;if(function(){var a=0,b=0,a=ie.x-R.x,b=ie.y-
R.y,c=0,d=0,c=$a.x-ie.x,d=$a.y-ie.y,e=0,f=0,e=wb.x-R.x,f=wb.y-R.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(qa=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&qa>=ue)if(Ef=F,za=id,++Ra==S){ue=qa;zc=Ha;break}else ue=qa;ie=$a;F=zc;id++;id>=b.polygon.edgeCnt&&(id=0);zc=zc.next;null==zc&&(zc=b.polygon.gverts.next)}while(0);for(;zc!=Ha;){var xa=zc,Ja=0;if(function(){var a=0,b=0,a=ie.x-R.x,b=ie.y-R.y,c=0,d=0,c=xa.x-ie.x,d=xa.y-
ie.y,e=0,f=0,e=wb.x-R.x,f=wb.y-R.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(Ja=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&Ja>=ue)if(Ef=F,za=id,++Ra==S){ue=Ja;zc=Ha;break}else ue=Ja;ie=xa;F=zc;id++;id>=b.polygon.edgeCnt&&(id=0);zc=zc.next;null==zc&&(zc=b.polygon.gverts.next)}if(null==Ef)break;var ya=Ef,Aa=Ef.next;null==Aa&&(Aa=b.polygon.gverts.next);var fb=Aa,na=0,Ah=0,aa=ue,na=ya.x+(fb.x-ya.x)*aa,Ah=ya.y+(fb.y-ya.y)*
aa;if(null!=y&&nb.vec_dsq(na,Ah,y.x,y.y)<m.epsilon)break;w.flowpoly.add(K.get(na,Ah,null));null==y&&(y=w.flowpoly.head.elt);F=Ef;id=za;H=!H;S=2}else{var Xa=C;if(null!=y&&nb.vec_dsq(Xa.x,Xa.y,y.x,y.y)<m.epsilon)break;w.flowpoly.add(Xa);null==y&&(y=w.flowpoly.head.elt);S=1}else if(F=F.next,id++,null==F&&(F=b.polygon.gverts.next,id=0),e[id]){var oa=w.flowpoly.head.elt,ta=F,A=C,va=C.next;null==va&&(va=a.polygon.gverts.next);var wa=-1,Ea=null,jb=0,mb=0,sa=va,Cb=va;do{var La=Cb,Ya=0;if(function(){var a=
0,b=0,a=A.x-oa.x,b=A.y-oa.y,c=0,d=0,c=La.x-A.x,d=La.y-A.y,e=0,f=0,e=ta.x-oa.x,f=ta.y-oa.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(Ya=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&Ya>=wa)if(Ea=C,jb=I,++mb==S){wa=Ya;Cb=sa;break}else wa=Ya;A=La;C=Cb;I++;I>=a.polygon.edgeCnt&&(I=0);Cb=Cb.next;null==Cb&&(Cb=a.polygon.gverts.next)}while(0);for(;Cb!=sa;){var Ua=Cb,Za=0;if(function(){var a=0,b=0,a=A.x-oa.x,b=A.y-oa.y,c=0,d=0,
c=Ua.x-A.x,d=Ua.y-A.y,e=0,f=0,e=ta.x-oa.x,f=ta.y-oa.y,g=d*e-c*f;g*g>m.epsilon*m.epsilon?(g=1/g,e=(f*a-e*b)*g,e>m.epsilon&&e<1-m.epsilon?(a=(d*a-c*b)*g,a>m.epsilon&&a<1-m.epsilon?(Za=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&Za>=wa)if(Ea=C,jb=I,++mb==S){wa=Za;Cb=sa;break}else wa=Za;A=Ua;C=Cb;I++;I>=a.polygon.edgeCnt&&(I=0);Cb=Cb.next;null==Cb&&(Cb=a.polygon.gverts.next)}if(null==Ea)break;var Ia=Ea,Na=Ea.next;null==Na&&(Na=a.polygon.gverts.next);var hb=Na,ab=0,lb=0,eb=wa,ab=Ia.x+(hb.x-Ia.x)*eb,lb=Ia.y+
(hb.y-Ia.y)*eb;if(null!=y&&nb.vec_dsq(ab,lb,y.x,y.y)<m.epsilon)break;w.flowpoly.add(K.get(ab,lb,null));null==y&&(y=w.flowpoly.head.elt);C=Ea;I=jb;H=!H;S=2}else{var db=F;if(null!=y&&nb.vec_dsq(db.x,db.y,y.x,y.y)<m.epsilon)break;w.flowpoly.add(db);null==y&&(y=w.flowpoly.head.elt);S=1}if(null!=w.flowpoly.head&&null!=w.flowpoly.head.next&&null!=w.flowpoly.head.next.next){for(var Od=0,je=0,ha=0,Od=ha=je=0,Ac=w.flowpoly.head,Va=Ac.elt,Ac=Ac.next,Oa=Ac.elt,Ac=Ac.next;null!=Ac;)var Ff=Ac.elt,Od=Od+Oa.x*(Ff.y-
Va.y),qb=Ff.y*Oa.x-Ff.x*Oa.y,je=je+(Oa.x+Ff.x)*qb,ha=ha+(Oa.y+Ff.y)*qb,Va=Oa,Oa=Ff,Ac=Ac.next;var Ac=w.flowpoly.head,Gf=Ac.elt,Od=Od+Oa.x*(Gf.y-Va.y),Fh=Gf.y*Oa.x-Gf.x*Oa.y,je=je+(Oa.x+Gf.x)*Fh,ha=ha+(Oa.y+Gf.y)*Fh,Va=Oa,Oa=Gf,Ac=Ac.next,Ka=Ac.elt,Od=Od+Oa.x*(Ka.y-Va.y),rb=Ka.y*Oa.x-Ka.x*Oa.y,je=je+(Oa.x+Ka.x)*rb,ha=ha+(Oa.y+Ka.y)*rb,Od=0.5*Od,Db=1/(6*Od),je=je*Db,ha=ha*Db;c.overlap=-Od;c.centroidx=je;c.centroidy=ha;null;return!0}}}return!1}for(var tb=[],Gb=!0,M=null,cb=null,Vb=-1.0E100,Yb=!0,Fb=
b.polygon.gverts.next,Zb=0,ob=b.polygon.edges.head;null!=ob;){var Pa=ob.elt,Wa=Pa.gnormx*a.circle.worldCOMx+Pa.gnormy*a.circle.worldCOMy;if(Wa>Pa.gprojection+a.circle.radius){Yb=!1;break}else Wa+a.circle.radius>Pa.gprojection+m.epsilon&&(Gb=!1,tb[Zb]=!0);Wa-=Pa.gprojection+a.circle.radius;Wa>Vb&&(Vb=Wa,M=Pa,cb=Fb);Fb=Fb.next;Zb++;ob=ob.next}if(Yb){if(Gb)return c.overlap=a.circle.area,c.centroidx=a.circle.worldCOMx,c.centroidy=a.circle.worldCOMy,null,!0;var ub=cb,gb;gb=null==cb.next?b.polygon.gverts.next:
cb.next;var bc=a.circle.worldCOMy*M.gnormx-a.circle.worldCOMx*M.gnormy;if(bc<=ub.y*M.gnormx-ub.x*M.gnormy?function(){var b=a.circle.radius,c=0,d=0,c=ub.x-a.circle.worldCOMx,d=ub.y-a.circle.worldCOMy;return c*c+d*d<=b*b}(this):bc>=gb.y*M.gnormx-gb.x*M.gnormy?function(){var b=a.circle.radius,c=0,d=0,c=gb.x-a.circle.worldCOMx,d=gb.y-a.circle.worldCOMy;return c*c+d*d<=b*b}(this):1){for(var ib=[],Sb=0,hc=!0,ic=null,ma=0,bb=b.polygon.gverts.next;null!=bb;){var lc=bb,Nc=nb.vec_dsq(lc.x,lc.y,a.circle.worldCOMx,
a.circle.worldCOMy);(ib[Sb]=Nc<=a.circle.radius*a.circle.radius)?(ma=Sb,ic=bb):hc=!1;Sb++;bb=bb.next}if(hc)return b.polygon.validate_worldCOM(),c.overlap=b.polygon.area,c.centroidx=b.polygon.worldCOMx,c.centroidy=b.polygon.worldCOMy,null,!0;for(;null!=w.flowpoly.head;){var sc=w.flowpoly.pop_unsafe();if(!sc._inuse){var Sa=sc;null!=Sa.outer&&(Sa.outer.zpp_inner=null,Sa.outer=null);Sa._isimmutable=null;Sa._validate=null;Sa._invalidate=null;Sa.next=K.zpp_pool;K.zpp_pool=Sa}}w.flowsegs.clear();var yb=
null,ia=1;null==ic?(ic=b.polygon.gverts.next,ia=2):w.flowpoly.add(yb=ic);for(;0!=ia;)if(1==ia)if(ic=ic.next,null==ic&&(ic=b.polygon.gverts.next),ma++,ma>=b.polygon.edgeCnt&&(ma=0),ib[ma]){if(nb.vec_dsq(yb.x,yb.y,ic.x,ic.y)<m.epsilon)break;w.flowpoly.add(ic)}else{var Ta=w.flowpoly.head.elt,Ib=ic,Jb=0,Kb=0,Jb=Ib.x-Ta.x,Kb=Ib.y-Ta.y,Lb=0,Mb=0,Lb=Ta.x-a.circle.worldCOMx,Mb=Ta.y-a.circle.worldCOMy,pb=Jb*Jb+Kb*Kb,Nb=2*(Lb*Jb+Mb*Kb),uc=Math.sqrt(Nb*Nb-4*pb*(Lb*Lb+Mb*Mb-a.circle.radius*a.circle.radius)),
pb=1/(2*pb),vc=(-Nb-uc)*pb,dc=0,ec=0,wc=vc<m.epsilon?(-Nb+uc)*pb:vc,dc=Ta.x+(Ib.x-Ta.x)*wc,ec=Ta.y+(Ib.y-Ta.y)*wc;if(nb.vec_dsq(yb.x,yb.y,dc,ec)<m.epsilon)break;w.flowpoly.add(K.get(dc,ec,null));ia=2}else if(2==ia){var Ob=ic.next;null==Ob&&(Ob=b.polygon.gverts.next);var V=ic,ia=0,Da=Ob,zb=Ob;do{var ka=zb,Pb=ma+1;Pb==b.polygon.edgeCnt&&(Pb=0);if(tb[ma])if(ib[Pb]){var Qb=0,Rb=0,Qb=ka.x-V.x,Rb=ka.y-V.y,Tb=0,Wb=0,Tb=V.x-a.circle.worldCOMx,Wb=V.y-a.circle.worldCOMy,Eb=Qb*Qb+Rb*Rb,Xb=2*(Tb*Qb+Wb*Rb),Jc=
Math.sqrt(Xb*Xb-4*Eb*(Tb*Tb+Wb*Wb-a.circle.radius*a.circle.radius)),Eb=1/(2*Eb),Mc=(-Xb-Jc)*Eb,rc=0,tc=0,Uc=Mc<m.epsilon?(-Xb+Jc)*Eb:Mc,rc=V.x+(ka.x-V.x)*Uc,tc=V.y+(ka.y-V.y)*Uc;if(nb.vec_dsq(yb.x,yb.y,rc,tc)<m.epsilon){ia=0;zb=Da;break}var Vc=K.get(rc,tc,null);w.flowsegs.add(w.flowpoly.head.elt);w.flowsegs.add(Vc);w.flowpoly.add(Vc);ia=1;zb=Da;break}else{var gc=0,jc=0,Kc,nc=0,oc=0,nc=ka.x-V.x,oc=ka.y-V.y,pc=0,qc=0,pc=V.x-a.circle.worldCOMx,qc=V.y-a.circle.worldCOMy,Hb=nc*nc+oc*oc,ac=2*(pc*nc+qc*
oc),vb=ac*ac-4*Hb*(pc*pc+qc*qc-a.circle.radius*a.circle.radius);vb*vb<m.epsilon?(gc=0>vb?10:jc=-ac/(2*Hb),Kc=!1):(vb=Math.sqrt(vb),Hb=1/(2*Hb),gc=(-ac-vb)*Hb,jc=(-ac+vb)*Hb,Kc=!0);if(gc<1-m.epsilon&&jc>m.epsilon){var Qc=0,Rc=0,ed=gc,Qc=V.x+(ka.x-V.x)*ed,Rc=V.y+(ka.y-V.y)*ed;if(null!=yb&&nb.vec_dsq(yb.x,yb.y,Qc,Rc)<m.epsilon){ia=0;zb=Da;break}var fd=K.get(Qc,Rc,null);null!=w.flowpoly.head&&(w.flowsegs.add(w.flowpoly.head.elt),w.flowsegs.add(fd));w.flowpoly.add(fd);null==yb&&(yb=w.flowpoly.head.elt);
if(Kc){var gd=0,jd=0,kd=jc,gd=V.x+(ka.x-V.x)*kd,jd=V.y+(ka.y-V.y)*kd;w.flowpoly.add(K.get(gd,jd,null))}}}V=ka;ic=zb;ma=Pb;zb=zb.next;null==zb&&(zb=b.polygon.gverts.next)}while(0);for(;zb!=Da;){var Pd=zb,Dc=ma+1;Dc==b.polygon.edgeCnt&&(Dc=0);if(tb[ma])if(ib[Dc]){var Ec=0,Fc=0,Ec=Pd.x-V.x,Fc=Pd.y-V.y,Gc=0,Hc=0,Gc=V.x-a.circle.worldCOMx,Hc=V.y-a.circle.worldCOMy,kc=Ec*Ec+Fc*Fc,Ic=2*(Gc*Ec+Hc*Fc),od=Math.sqrt(Ic*Ic-4*kc*(Gc*Gc+Hc*Hc-a.circle.radius*a.circle.radius)),kc=1/(2*kc),pd=(-Ic-od)*kc,$c=0,ad=
0,td=pd<m.epsilon?(-Ic+od)*kc:pd,$c=V.x+(Pd.x-V.x)*td,ad=V.y+(Pd.y-V.y)*td;if(nb.vec_dsq(yb.x,yb.y,$c,ad)<m.epsilon){ia=0;zb=Da;break}var ud=K.get($c,ad,null);w.flowsegs.add(w.flowpoly.head.elt);w.flowsegs.add(ud);w.flowpoly.add(ud);ia=1;zb=Da;break}else{var Oc=0,Pc=0,dd,Sc=0,Tc=0,Sc=Pd.x-V.x,Tc=Pd.y-V.y,Xc=0,Yc=0,Xc=V.x-a.circle.worldCOMx,Yc=V.y-a.circle.worldCOMy,mc=Sc*Sc+Tc*Tc,Lc=2*(Xc*Sc+Yc*Tc),$b=Lc*Lc-4*mc*(Xc*Xc+Yc*Yc-a.circle.radius*a.circle.radius);$b*$b<m.epsilon?(Oc=0>$b?10:Pc=-Lc/(2*mc),
dd=!1):($b=Math.sqrt($b),mc=1/(2*mc),Oc=(-Lc-$b)*mc,Pc=(-Lc+$b)*mc,dd=!0);if(Oc<1-m.epsilon&&Pc>m.epsilon){var md=0,nd=0,Dd=Oc,md=V.x+(Pd.x-V.x)*Dd,nd=V.y+(Pd.y-V.y)*Dd;if(null!=yb&&nb.vec_dsq(yb.x,yb.y,md,nd)<m.epsilon){ia=0;zb=Da;break}var Ed=K.get(md,nd,null);null!=w.flowpoly.head&&(w.flowsegs.add(w.flowpoly.head.elt),w.flowsegs.add(Ed));w.flowpoly.add(Ed);null==yb&&(yb=w.flowpoly.head.elt);if(dd){var Fd=0,Hd=0,Id=Pc,Fd=V.x+(Pd.x-V.x)*Id,Hd=V.y+(Pd.y-V.y)*Id;w.flowpoly.add(K.get(Fd,Hd,null))}}}V=
Pd;ic=zb;ma=Dc;zb=zb.next;null==zb&&(zb=b.polygon.gverts.next)}}if(null==w.flowpoly.head)return!1;if(null==w.flowpoly.head.next){for(var Jd=!0,cd=b.polygon.edges.head;null!=cd;){var vd=cd.elt;if(vd.gnormx*a.circle.worldCOMx+vd.gnormy*a.circle.worldCOMy>vd.gprojection){Jd=!1;break}cd=cd.next}return Jd?(c.overlap=a.circle.area,c.centroidx=a.circle.worldCOMx,c.centroidy=a.circle.worldCOMy,null,!0):!1}var cc=0,fc=0,xc=0;if(null!=w.flowpoly.head.next.next){for(var Bd=0,ke=0,le=0,Bd=le=ke=0,Bc=w.flowpoly.head,
Wc=Bc.elt,Bc=Bc.next,Ab=Bc.elt,Bc=Bc.next;null!=Bc;)var yc=Bc.elt,Bd=Bd+Ab.x*(yc.y-Wc.y),Qd=yc.y*Ab.x-yc.x*Ab.y,ke=ke+(Ab.x+yc.x)*Qd,le=le+(Ab.y+yc.y)*Qd,Wc=Ab,Ab=yc,Bc=Bc.next;var Bc=w.flowpoly.head,Cc=Bc.elt,Bd=Bd+Ab.x*(Cc.y-Wc.y),Rd=Cc.y*Ab.x-Cc.x*Ab.y,ke=ke+(Ab.x+Cc.x)*Rd,le=le+(Ab.y+Cc.y)*Rd,Wc=Ab,Ab=Cc,Bc=Bc.next,Zc=Bc.elt,Bd=Bd+Ab.x*(Zc.y-Wc.y),Sd=Zc.y*Ab.x-Zc.x*Ab.y,ke=ke+(Ab.x+Zc.x)*Sd,le=le+(Ab.y+Zc.y)*Sd,Bd=0.5*Bd,Td=1/(6*Bd),ke=ke*Td,le=le*Td,Ud=-Bd,cc=cc+ke*Ud,fc=fc+le*Ud,xc=xc-Bd}else w.flowsegs.add(w.flowpoly.head.elt),
w.flowsegs.add(w.flowpoly.head.next.elt);for(;null!=w.flowsegs.head;)var qd=w.flowsegs.pop_unsafe(),rd=w.flowsegs.pop_unsafe(),Vd=0,Wd=0,Vd=rd.x-qd.x,Wd=rd.y-qd.y,se=0,te=0,se=Vd,te=Wd,Xd=1/Math.sqrt(se*se+te*te),se=se*Xd,te=te*Xd,re=se,se=-te,te=re,me=0,ne=0,me=qd.x+rd.x,ne=qd.y+rd.y,me=0.5*me,ne=0.5*ne,me=me-1*a.circle.worldCOMx,ne=ne-1*a.circle.worldCOMy,Gd=0,Yd=0,Zd=se*me+te*ne,sd=Zd/a.circle.radius,bd=Math.sqrt(1-sd*sd),$d=Math.acos(sd),Gd=a.circle.radius*(a.circle.radius*$d-Zd*bd),Yd=0.6666666666666666*
a.circle.radius*bd*bd*bd/($d-sd*bd),me=a.circle.worldCOMx,ne=a.circle.worldCOMy,ae=Yd,me=me+se*ae,ne=ne+te*ae,be=Gd,cc=cc+me*be,fc=fc+ne*be,xc=xc+Gd;var ce=1/xc,cc=cc*ce,fc=fc*ce;c.overlap=xc;c.centroidx=cc;c.centroidy=fc;null;return!0}}return!1}var Bb=a.circle,Ub=b.circle,wd=0,xd=0,wd=Ub.worldCOMx-Bb.worldCOMx,xd=Ub.worldCOMy-Bb.worldCOMy,de=Bb.radius+Ub.radius,Kd=wd*wd+xd*xd;if(Kd>de*de)return!1;if(Kd<m.epsilon*m.epsilon)Bb.radius<Ub.radius?(c.overlap=Bb.area,c.centroidx=Bb.worldCOMx,c.centroidy=
Bb.worldCOMy):(c.overlap=Ub.area,c.centroidx=Ub.worldCOMx,c.centroidy=Ub.worldCOMy);else{var yd=Math.sqrt(Kd),ee=1/yd,zd=0.5*(yd-(Ub.radius*Ub.radius-Bb.radius*Bb.radius)*ee);if(zd<=-Bb.radius)c.overlap=Bb.area,c.centroidx=Bb.worldCOMx,c.centroidy=Bb.worldCOMy;else{var Ld=yd-zd;if(Ld<=-Ub.radius)c.overlap=Ub.area,c.centroidx=Ub.worldCOMx,c.centroidy=Ub.worldCOMy;else{var Md=0,fe=0,Nd=0,ge=0,Ad=zd/Bb.radius,hd=Math.sqrt(1-Ad*Ad),he=Math.acos(Ad),Md=Bb.radius*(Bb.radius*he-zd*hd),fe=0.6666666666666666*
Bb.radius*hd*hd*hd/(he-Ad*hd),Cd=Ld/Ub.radius,ld=Math.sqrt(1-Cd*Cd),oe=Math.acos(Cd),Nd=Ub.radius*(Ub.radius*oe-Ld*ld),ge=0.6666666666666666*Ub.radius*ld*ld*ld/(oe-Cd*ld),pe=Md+Nd,qe=(fe*Md+(yd-ge)*Nd)/pe*ee;c.overlap=pe;c.centroidx=Bb.worldCOMx+wd*qe;c.centroidy=Bb.worldCOMy+xd*qe}}}null;return!0};var kh=function(){this.toiDistance=0;this.inner=!1;this.shape=null};h["zpp_nape.geom.ZPP_ConvexRayResult"]=kh;kh.__name__=!0;kh.prototype={__class__:kh};var lh=function(){this.next=null;this.x=this.y=0};
h["zpp_nape.geom.ZPP_GeomVert"]=lh;lh.__name__=!0;lh.prototype={__class__:lh};var mh=function(){this.outer=this.vertices=null};h["zpp_nape.geom.ZPP_GeomPoly"]=mh;mh.__name__=!0;mh.prototype={__class__:mh};var nh=function(){this.a=this.b=this.c=this.d=this.tx=this.ty=0};h["zpp_nape.geom.ZPP_Mat23"]=nh;nh.__name__=!0;nh.prototype={__class__:nh};var oh=function(){this.x=null;this.m=this.n=0};h["zpp_nape.geom.ZPP_MatMN"]=oh;oh.__name__=!0;oh.prototype={__class__:oh};var qa=function(){this.slipped=this.failed=
this.kinematic=!1;this.c1=this.c2=this.axis=null;this.frozen1=this.frozen2=!1;this.s1=this.s2=this.arbiter=null;this.toi=0;this.next=null;this.c1=new K;this.c2=new K;this.axis=new K};h["zpp_nape.geom.ZPP_ToiEvent"]=qa;qa.__name__=!0;qa.prototype={__class__:qa};var ma=function(){};h["zpp_nape.geom.ZPP_SweepDistance"]=ma;ma.__name__=!0;ma.dynamicSweep=function(a,b,c,d,e){null==e&&(e=!1);var f=a.s1,g=a.s2,h=f.body,i=g.body,l=0,k=0,l=i.velx-h.velx,k=i.vely-h.vely,o=h.angvel;0>o&&(o=-o);var n=i.angvel;
0>n&&(n=-n);var p=f.sweepCoef*o+g.sweepCoef*n;if(!e&&!a.kinematic&&l*l+k*k<m.dynamicSweepLinearThreshold*m.dynamicSweepLinearThreshold&&p<m.dynamicSweepAngularThreshold)a.toi=-1,a.failed=!0;else{for(var t=a.c1,o=a.c2,n=a.axis,s=0;;){h.sweepIntegrate(c*b);h.sweepValidate(f);i.sweepIntegrate(c*b);i.sweepValidate(g);var w=ma.distance(f,g,t,o,n,null)+d,x=l*n.x+k*n.y;if(w<m.distanceThresholdCCD){if(e)break;var u=0,y=0,u=t.x-h.posx,y=t.y-h.posy,z=0,F=0,z=o.x-i.posx,F=o.y-i.posy,u=x-h.sweep_angvel*(n.y*
u-n.x*y)+i.sweep_angvel*(n.y*z-n.x*F);0<u&&(a.slipped=!0);if(0>=u||w<0.5*m.distanceThresholdCCD)break}x=(p-x)*b;if(0>=x){c=-1;break}x=w/x;1.0E-6>x&&(x=1.0E-6);c+=x;if(1<=c){c=1;h.sweepIntegrate(c*b);h.sweepValidate(f);i.sweepIntegrate(c*b);i.sweepValidate(g);b=ma.distance(f,g,t,o,n,null)+d;l=l*n.x+k*n.y;if(b<m.distanceThresholdCCD){if(e)break;k=e=0;e=t.x-h.posx;k=t.y-h.posy;d=t=0;t=o.x-i.posx;d=o.y-i.posy;h=l-h.sweep_angvel*(n.y*e-n.x*k)+i.sweep_angvel*(n.y*t-n.x*d);0<h&&(a.slipped=!0);if(0>=h||b<
0.5*m.distanceThresholdCCD)break}c=-1;break}if(40<=++s){w>d&&(a.failed=!0);break}}a.toi=c}};ma.staticSweep=function(a,b,c,d){var e=a.s1,f=a.s2,g=e.body,h=0,i=0,h=-g.velx,i=-g.vely,l=g.sweep_angvel;0>l&&(l=-l);for(var k=e.sweepCoef*l,l=a.c1,o=a.c2,n=a.axis,p=0;;){g.sweepIntegrate(c*b);g.sweepValidate(e);var t=ma.distance(e,f,l,o,n,null)+d,s=h*n.x+i*n.y;if(t<m.distanceThresholdCCD){var w=0,x=0,w=l.x-g.posx,x=l.y-g.posy,w=s-g.sweep_angvel*(n.y*w-n.x*x);0<w&&(a.slipped=!0);if(0>=w||t<0.5*m.distanceThresholdCCD)break}s=
(k-s)*b;if(0>=s){c=-1;break}s=t/s;1.0E-6>s&&(s=1.0E-6);c+=s;if(1<=c){c=1;g.sweepIntegrate(c*b);g.sweepValidate(e);b=ma.distance(e,f,l,o,n,null)+d;h=h*n.x+i*n.y;if(b<m.distanceThresholdCCD&&(d=i=0,i=l.x-g.posx,d=l.y-g.posy,g=h-g.sweep_angvel*(n.y*i-n.x*d),0<g&&(a.slipped=!0),0>=g||b<0.5*m.distanceThresholdCCD))break;c=-1;break}if(40<=++p){t>d&&(a.failed=!0);break}}a.toi=c};ma.distance=function(a,b,c,d,e,g){null==g&&(g=1.0E100);if(a.type==f.id_ShapeType_CIRCLE&&b.type==f.id_ShapeType_CIRCLE){var h=
a.circle,j=b.circle,i,l=0,k=0,l=j.worldCOMx-h.worldCOMx,k=j.worldCOMy-h.worldCOMy,o=Math.sqrt(l*l+k*k);i=o-(h.radius+j.radius);if(i<g){if(0==o)l=1,k=0;else var n=1/o,l=l*n,k=k*n;var p=h.radius;c.x=h.worldCOMx+l*p;c.y=h.worldCOMy+k*p;var t=-j.radius;d.x=j.worldCOMx+l*t;d.y=j.worldCOMy+k*t;e.x=l;e.y=k}return i}var s=!1;if(a.type==f.id_ShapeType_CIRCLE&&b.type==f.id_ShapeType_POLYGON)var w=a,a=b,b=w,x=c,c=d,d=x,s=!0;if(a.type==f.id_ShapeType_POLYGON&&b.type==f.id_ShapeType_CIRCLE){for(var u=b.circle,
y=-1.0E100,z=null,F=a.polygon.edges.head;null!=F;){var E=F.elt,C=E.gnormx*u.worldCOMx+E.gnormy*u.worldCOMy-E.gprojection-u.radius;if(C>g){y=C;break}0<C?C>y&&(y=C,z=E):0>y&&C>y&&(y=C,z=E);F=F.next}if(y<g){var D=z.gp0,G=z.gp1,J=u.worldCOMy*z.gnormx-u.worldCOMx*z.gnormy;if(J<=D.y*z.gnormx-D.x*z.gnormy){var I=0,H=0,I=u.worldCOMx-D.x,H=u.worldCOMy-D.y,K=Math.sqrt(I*I+H*H),y=K-u.radius;if(y<g){if(0==K)I=1,H=0;else var S=1/K,I=I*S,H=H*S;c.x=D.x+0*I;c.y=D.y+0*H;var N=-u.radius;d.x=u.worldCOMx+I*N;d.y=u.worldCOMy+
H*N;e.x=I;e.y=H}}else if(J>=G.y*z.gnormx-G.x*z.gnormy){var L=0,P=0,L=u.worldCOMx-G.x,P=u.worldCOMy-G.y,Q=Math.sqrt(L*L+P*P),y=Q-u.radius;if(y<g){if(0==Q)L=1,P=0;else var ba=1/Q,L=L*ba,P=P*ba;c.x=G.x+0*L;c.y=G.y+0*P;var ca=-u.radius;d.x=u.worldCOMx+L*ca;d.y=u.worldCOMy+P*ca;e.x=L;e.y=P}}else{var da=-u.radius;d.x=u.worldCOMx+z.gnormx*da;d.y=u.worldCOMy+z.gnormy*da;var ea=-y;c.x=d.x+z.gnormx*ea;c.y=d.y+z.gnormy*ea;e.x=z.gnormx;e.y=z.gnormy}}s&&(e.x=-e.x,e.y=-e.y);return y}for(var W=a.polygon,Z=b.polygon,
B=-1.0E100,T=null,U=null,X=0,$=W.edges.head;null!=$;){for(var Y=$.elt,R=1.0E100,fa=Z.gverts.next;null!=fa;){var Ba=fa,pa=Y.gnormx*Ba.x+Y.gnormy*Ba.y;pa<R&&(R=pa);fa=fa.next}R-=Y.gprojection;if(R>g){B=R;break}0<R?R>B&&(B=R,T=Y,X=1):0>B&&R>B&&(B=R,T=Y,X=1);$=$.next}if(B<g){for(var Ca=Z.edges.head;null!=Ca;){for(var O=Ca.elt,r=1.0E100,ha=W.gverts.next;null!=ha;){var oa=ha,ra=O.gnormx*oa.x+O.gnormy*oa.y;ra<r&&(r=ra);ha=ha.next}r-=O.gprojection;if(r>g){B=r;break}0<r?r>B&&(B=r,U=O,X=2):0>B&&r>B&&(B=r,U=
O,X=2);Ca=Ca.next}if(B<g){var ua,la;if(1==X)ua=Z,la=T;else{ua=W;la=U;var Ga=c,c=d,d=Ga,s=!s}for(var ia=null,wa=1.0E100,ma=ua.edges.head;null!=ma;){var Df=ma.elt,Qa=la.gnormx*Df.gnormx+la.gnormy*Df.gnormy;Qa<wa&&(wa=Qa,ia=Df);ma=ma.next}s?(e.x=-la.gnormx,e.y=-la.gnormy):(e.x=la.gnormx,e.y=la.gnormy);if(0<=B){var wb=la.gp0,ka=la.gp1,xb=ia.gp0,Ea=ia.gp1,ja=0,ga=0,qa=0,Ja=0,ja=ka.x-wb.x,ga=ka.y-wb.y,qa=Ea.x-xb.x,Ja=Ea.y-xb.y,ya=1/(ja*ja+ga*ga),za=1/(qa*qa+Ja*Ja),Fa=-(ja*(wb.x-xb.x)+ga*(wb.y-xb.y))*ya,
M=-(ja*(wb.x-Ea.x)+ga*(wb.y-Ea.y))*ya,ta=-(qa*(xb.x-wb.x)+Ja*(xb.y-wb.y))*za,va=-(qa*(xb.x-ka.x)+Ja*(xb.y-ka.y))*za;0>Fa?Fa=0:1<Fa&&(Fa=1);0>M?M=0:1<M&&(M=1);0>ta?ta=0:1<ta&&(ta=1);0>va?va=0:1<va&&(va=1);var Ma=0,Ha=0,$a=Fa,Ma=wb.x+ja*$a,Ha=wb.y+ga*$a,xa=0,Aa=0,Va=M,xa=wb.x+ja*Va,Aa=wb.y+ga*Va,na=0,Xa=0,A=ta,na=xb.x+qa*A,Xa=xb.y+Ja*A,Ka=0,Ra=0,Sa=va,Ka=xb.x+qa*Sa,Ra=xb.y+Ja*Sa,Ya=nb.vec_dsq(Ma,Ha,xb.x,xb.y),Ta=nb.vec_dsq(xa,Aa,Ea.x,Ea.y),Za=nb.vec_dsq(na,Xa,wb.x,wb.y),Cb=nb.vec_dsq(Ka,Ra,ka.x,ka.y),
Ia=0,jb=0,Ua=null;Ya<Ta?(Ia=Ma,jb=Ha,Ua=xb):(Ia=xa,jb=Aa,Ua=Ea,Ya=Ta);var fb=0,Pa=0,aa=null;Za<Cb?(fb=na,Pa=Xa,aa=wb):(fb=Ka,Pa=Ra,aa=ka,Za=Cb);Ya<Za?(c.x=Ia,c.y=jb,d.x=Ua.x,d.y=Ua.y,B=Math.sqrt(Ya)):(d.x=fb,d.y=Pa,c.x=aa.x,c.y=aa.y,B=Math.sqrt(Za));if(0!=B){e.x=d.x-c.x;e.y=d.y-c.y;var Wa=1/B;e.x*=Wa;e.y*=Wa;s&&(e.x=-e.x,e.y=-e.y)}return B}var sa=0,La=0,sa=ia.gp0.x,La=ia.gp0.y,Da=0,Na=0,Da=ia.gp1.x,Na=ia.gp1.y,mb=0,ab=0,mb=Da-sa,ab=Na-La,lb=la.gnormy*sa-la.gnormx*La,db=la.gnormy*Da-la.gnormx*Na,gb=
1/(db-lb),Oa=(-la.tp1-lb)*gb;Oa>m.epsilon&&(sa+=mb*Oa,La+=ab*Oa);var hb=(-la.tp0-db)*gb;hb<-m.epsilon&&(Da+=mb*hb,Na+=ab*hb);var bb=sa*la.gnormx+La*la.gnormy-la.gprojection,cb=Da*la.gnormx+Na*la.gnormy-la.gprojection;if(bb<cb){d.x=sa;d.y=La;var eb=-bb;c.x=d.x+la.gnormx*eb;c.y=d.y+la.gnormy*eb;return bb}d.x=Da;d.y=Na;var ob=-cb;c.x=d.x+la.gnormx*ob;c.y=d.y+la.gnormy*ob;return cb}}return g};var K=function(){this.length=this.x=this.y=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.weak=
!1;this._isimmutable=this.outer=null;this._immutable=!1;this._invalidate=this._validate=null};h["zpp_nape.geom.ZPP_Vec2"]=K;K.__name__=!0;K.get=function(a,b,c){null==c&&(c=!1);var d;null==K.zpp_pool?d=new K:(d=K.zpp_pool,K.zpp_pool=d.next,d.next=null);d.weak=!1;d._immutable=c;d.x=a;d.y=b;return d};K.prototype={validate:function(){null!=this._validate&&this._validate()},invalidate:function(){null!=this._invalidate&&this._invalidate(this)},wrapper:function(){if(null==this.outer){this.outer=new x;var a=
this.outer.zpp_inner;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=K.zpp_pool;K.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},add:function(a){return this.inlined_add(a)},inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){b._inuse=!0;null==a?(b.next=this.next,this.next=b):(b.next=a.next,
a.next=b);this.pushmod=this.modified=!0;this.length++;return b},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},reverse:function(){for(var a=this.next,b=null;null!=a;){var c=a.next;a.next=b;b=this.next=a;a=c}this.pushmod=this.modified=!0},iterator_at:function(a){for(var b=
this.next;0<a--&&null!=b;)b=b.next;return b},toString:function(){return"{ x: "+this.x+" y: "+this.y+" }"},__class__:K};var ph=function(){this._validate=null;this.x=this.y=this.z=0};h["zpp_nape.geom.ZPP_Vec3"]=ph;ph.__name__=!0;ph.prototype={validate:function(){null!=this._validate&&this._validate()},__class__:ph};var nb=function(){};h["zpp_nape.geom.ZPP_VecMath"]=nb;nb.__name__=!0;nb.vec_dsq=function(a,b,c,d){var e=0,f=0,e=a-c,f=b-d;return e*e+f*f};var S=function(){this.userData=this.ishape=this.ibody=
this.icompound=this.cbsets=this.group=this.cbTypes=this.cbSet=this.wrap_cbTypes=null;this.id=0;this.outer_i=null;this.id=Ga.Interactor();this.cbsets=new Dg;this.cbTypes=new hc};h["zpp_nape.phys.ZPP_Interactor"]=S;S.__name__=!0;S.get=function(a,b){var c;c=a.id<b.id?a.id:b.id;var d;d=a.id<b.id?b.id:a.id;for(var e=null,f=(a.cbsets.length<b.cbsets.length?a.cbsets:b.cbsets).head;null!=f;){var g=f.elt;if(g.id==c&&g.di==d){e=g;break}f=f.next}return e};S.int_callback=function(a,b,c){var d=a.int1,a=a.int2;
b.options1.compatible(d.cbTypes)&&b.options2.compatible(a.cbTypes)?(c.int1=d,c.int2=a):(c.int1=a,c.int2=d)};S.prototype={__iaddedToSpace:function(){null!=this.group&&this.group.interactors.add(this);for(var a=this.cbTypes.head;null!=a;)a.elt.interactors.add(this),a=a.next;this.alloc_cbSet()},__iremovedFromSpace:function(){null!=this.group&&this.group.interactors.remove(this);for(var a=this.cbTypes.head;null!=a;)a.elt.interactors.remove(this),a=a.next;this.dealloc_cbSet()},wake:function(){if(null!=
this.ishape){var a=this.ishape.body;null!=a&&null!=a.space&&a.space.non_inlined_wake(a);!0}else null!=this.ibody?null!=this.ibody.space?this.ibody.space.non_inlined_wake(this.ibody):!1:(null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound),!0)},setupcbTypes:function(){this.wrap_cbTypes=Lb.get(this.cbTypes);this.wrap_cbTypes.zpp_inner.adder=n(this,this.wrap_cbTypes_adder);this.wrap_cbTypes.zpp_inner.subber=n(this,this.wrap_cbTypes_subber);this.wrap_cbTypes.zpp_inner.dontremove=
!0},wrap_cbTypes_subber:function(a){a=a.zpp_inner;if(this.cbTypes.has(a)){var b;b=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=b&&(this.dealloc_cbSet(),a.interactors.remove(this));this.cbTypes.remove(a);null!=b&&(this.alloc_cbSet(),this.wake())}},wrap_cbTypes_adder:function(a){this.insert_cbtype(a.zpp_inner);return!1},insert_cbtype:function(a){if(!this.cbTypes.has(a)){var b;b=null!=this.ishape?null==this.ishape.body?
null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=b&&(this.dealloc_cbSet(),a.interactors.add(this));for(var c=null,d=this.cbTypes.head;null!=d&&!(a.id<d.elt.id);){c=d;d=d.next}this.cbTypes.inlined_insert(c,a);null!=b&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){var a;a=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=(this.cbSet=a.cbsets.get(this.cbTypes)))this.cbSet.count++,
this.cbSet.interactors.add(this),this.cbSet.validate(),a.freshInteractorType(this)},dealloc_cbSet:function(){var a;a=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=this.cbSet&&(this.cbSet.interactors.remove(this),a.nullInteractorType(this),0==--this.cbSet.count&&(a.cbsets.remove(this.cbSet),a=this.cbSet,a.free(),a.next=B.zpp_pool,B.zpp_pool=a),this.cbSet=null)},immutable_midstep:function(a){null!=this.ibody?null:null!=
this.ishape?this.ishape.__immutable_midstep(a):this.icompound.__imutable_midstep(a)},lookup_group:function(){for(var a=this;null!=a&&null==a.group;)a=null!=a.ishape?a.ishape.body:null!=a.icompound?a.icompound.compound:a.ibody.compound;return null==a?null:a.group},__class__:S};var Uc=function(){this.wrap_localCOM=this.wrap_worldCOM=null;this.zip_worldCOM=!1;this.worldCOMx=this.worldCOMy=0;this.zip_localCOM=!1;this.localCOMx=this.localCOMy=0;this.zip_aabb=!1;this.aabb=null;this.norotate=!1;this.cinertia=
this.iinertia=this.sinertia=0;this.zip_inertia=!1;this.inertiaMode=this.inertia=0;this.zip_gravMassScale=!1;this.gravMassMode=this.gravMassScale=0;this.zip_gravMass=!1;this.gravMass=0;this.nomove=!1;this.massMode=this.imass=this.smass=this.cmass=0;this.zip_mass=!1;this.mass=0;this.zip_axis=!1;this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=this.axisx=this.axisy=0;this.wrap_svel=null;this.forcex=this.forcey=this.kinvelx=this.kinvely=this.svelx=this.svely=0;this.wrap_vel=null;this.velx=
this.vely=0;this.wrap_pos=null;this.pre_posx=this.pre_posy=this.posx=this.posy=0;this.bullet=this.bulletEnabled=this.disableCCD=!1;this.sweepRadius=0;this.sweepFrozen=!1;this.sweepTime=this.sweep_angvel=0;this.compound=this.shapes=this.wrap_shapes=this.space=this.arbiters=this.constraints=this.component=null;this.type=0;this.world=!1;this.outer=null;S.call(this);this.ibody=this;this.bulletEnabled=this.world=!1;this.sweep_angvel=this.sweepTime=0;this.disableCCD=this.norotate=this.nomove=!1;this.axisx=
this.rot=this.posy=this.posx=0;this.axisy=1;this.torque=this.angvel=this.kinangvel=this.forcey=this.forcex=this.kinvely=this.kinvelx=this.vely=this.velx=this.svely=this.svelx=0;this.pre_rot=this.pre_posy=this.pre_posx=Math.POSITIVE_INFINITY;this.worldCOMy=this.worldCOMx=this.localCOMy=this.localCOMx=0;this.zip_aabb=!0;this.aabb=$.get(0,0,0,0);this.aabb._immutable=!0;this.aabb._validate=n(this,this.aabb_validate);this.massMode=f.id_MassMode_DEFAULT;this.gravMassMode=f.id_GravMassMode_DEFAULT;this.gravMassScale=
1;this.inertiaMode=f.id_InertiaMode_DEFAULT;this.arbiters=new Cd;this.constraints=new tc;this.shapes=new yc;this.wrap_shapes=gd.get(this.shapes);this.wrap_shapes.zpp_inner.adder=n(this,this.shapes_adder);this.wrap_shapes.zpp_inner.subber=n(this,this.shapes_subber);this.wrap_shapes.zpp_inner._invalidate=n(this,this.shapes_invalidate);this.kinematicDelaySleep=!1};h["zpp_nape.phys.ZPP_Body"]=Uc;Uc.__name__=!0;Uc.__static=function(){var a=qb;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,
f.internal=!1);var a=new a(f.BodyType_STATIC),b=a.zpp_inner;b.world=!0;b.wrap_shapes.zpp_inner.immutable=!0;b.smass=b.imass=b.cmass=b.mass=b.gravMass=0;b.sinertia=b.iinertia=b.cinertia=b.inertia=0;b.cbTypes.clear();return a};Uc.__super__=S;Uc.prototype=t(S.prototype,{invalidate_type:function(){this.invalidate_mass();this.invalidate_inertia()},invalidate_shapes:function(){this.zip_worldCOM=this.zip_localCOM=this.zip_aabb=!0;this.invalidate_mass();this.invalidate_inertia()},atRest:function(a){if(this.type!=
f.id_BodyType_DYNAMIC)return this.component.sleeping;var b=m.linearSleepThreshold,b=b*b;if(this.velx*this.velx+this.vely*this.vely>b)a=!1;else if(nb.vec_dsq(this.posx,this.posy,this.pre_posx,this.pre_posy)>0.25*b*a*a)a=!1;else{var c=b=0,b=this.aabb.maxx-this.aabb.minx,c=this.aabb.maxy-this.aabb.miny,b=b*b+c*c,c=m.angularSleepThreshold,c=c*c;if(4*this.angvel*this.angvel*b>c)a=!1;else var d=this.rot-this.pre_rot,a=d*d*b>c*a*a?!1:!0}a||(this.component.waket=this.space.stamp);return this.component.waket+
m.sleepDelay<this.space.stamp},refreshArbiters:function(){for(var a=this.arbiters.head;null!=a;)a.elt.invalidated=!0,a=a.next},sweepIntegrate:function(a){var b=a-this.sweepTime;0!=b&&(this.sweepTime=a,this.posx+=this.velx*b,this.posy+=this.vely*b,0!=this.angvel&&this.delta_rot(this.sweep_angvel*b))},sweepValidate:function(a){if(a.type==f.id_ShapeType_CIRCLE)a.worldCOMx=this.posx+(this.axisy*a.localCOMx-this.axisx*a.localCOMy),a.worldCOMy=this.posy+(a.localCOMx*this.axisx+a.localCOMy*this.axisy);else{for(var a=
a.polygon,b=a.lverts.next,c=a.gverts.next;null!=c;){var d=c,e=b,b=b.next;d.x=this.posx+(this.axisy*e.x-this.axisx*e.y);d.y=this.posy+(e.x*this.axisx+e.y*this.axisy);c=c.next}c=a.edges.head;b=d=a.gverts.next;for(d=d.next;null!=d;){var e=d,g=c.elt,c=c.next;g.gnormx=this.axisy*g.lnormx-this.axisx*g.lnormy;g.gnormy=g.lnormx*this.axisx+g.lnormy*this.axisy;g.gprojection=this.posx*g.gnormx+this.posy*g.gnormy+g.lprojection;g.tp0=b.y*g.gnormx-b.x*g.gnormy;g.tp1=e.y*g.gnormx-e.x*g.gnormy;b=e;d=d.next}a=a.gverts.next;
c=c.elt;c.gnormx=this.axisy*c.lnormx-this.axisx*c.lnormy;c.gnormy=c.lnormx*this.axisx+c.lnormy*this.axisy;c.gprojection=this.posx*c.gnormx+this.posy*c.gnormy+c.lprojection;c.tp0=b.y*c.gnormx-b.x*c.gnormy;c.tp1=a.y*c.gnormx-a.x*c.gnormy}},invalidate_pos:function(){for(var a=this.shapes.head;null!=a;){var b=a.elt;b.type==f.id_ShapeType_POLYGON&&(b.polygon.invalidate_gverts(),b.polygon.invalidate_gaxi());b.invalidate_worldCOM();a=a.next}this.zip_worldCOM=!0},pos_invalidate:function(a){this.immutable_midstep("Body::position");
this.posx==a.x&&this.posy==a.y||(this.posx=a.x,this.posy=a.y,this.invalidate_pos(),this.wake())},pos_validate:function(){this.wrap_pos.zpp_inner.x=this.posx;this.wrap_pos.zpp_inner.y=this.posy},vel_invalidate:function(a){this.velx=a.x;this.vely=a.y;this.wake()},vel_validate:function(){this.wrap_vel.zpp_inner.x=this.velx;this.wrap_vel.zpp_inner.y=this.vely},svel_invalidate:function(a){this.svelx=a.x;this.svely=a.y;this.wake()},svel_validate:function(){this.wrap_svel.zpp_inner.x=this.svelx;this.wrap_svel.zpp_inner.y=
this.svely},setupPosition:function(){this.wrap_pos=x.get(this.posx,this.posy,null);this.wrap_pos.zpp_inner._inuse=!0;this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=n(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=n(this,this.pos_validate))},setupVelocity:function(){this.wrap_vel=x.get(this.velx,this.vely,null);this.wrap_vel.zpp_inner._inuse=!0;this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=n(this,this.vel_invalidate),
this.wrap_vel.zpp_inner._validate=n(this,this.vel_validate))},setupsvel:function(){this.wrap_svel=x.get(this.svelx,this.svely,null);this.wrap_svel.zpp_inner._inuse=!0;this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=n(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=n(this,this.svel_validate))},invalidate_rot:function(){this.zip_axis=!0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.type==f.id_ShapeType_POLYGON&&(b.polygon.invalidate_gverts(),
b.polygon.invalidate_gaxi());b.invalidate_worldCOM();a=a.next}this.zip_worldCOM=!0},validate_axis:function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null)},delta_rot:function(a){this.rot+=a;if(1.0E-4<a*a)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null;else{var b=a*a,c=1-0.5*b,b=1-b*b/8,d=(c*this.axisx+a*this.axisy)*b;this.axisy=(c*this.axisy-a*this.axisx)*b;this.axisx=d}},invalidate_mass:function(){this.zip_mass=!0;this.invalidate_gravMass()},
validate_mass:function(){if(this.zip_mass){this.zip_mass=!1;if(this.massMode==f.id_MassMode_DEFAULT){this.cmass=0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.refmaterial.density=b.material.density;b.validate_area_inertia();this.cmass+=b.area*b.material.density;a=a.next}}this.type==f.id_BodyType_DYNAMIC&&!this.nomove?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=Math.POSITIVE_INFINITY,this.imass=this.smass=0)}},invalidate_gravMass:function(){this.gravMassMode!=f.id_GravMassMode_FIXED&&
(this.zip_gravMass=!0);this.gravMassMode!=f.id_GravMassMode_SCALED&&(this.zip_gravMassScale=!0);this.wake()},validate_gravMass:function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),this.gravMassMode==f.id_GravMassMode_DEFAULT?(this.validate_mass(),this.gravMass=this.cmass):this.gravMassMode==f.id_GravMassMode_SCALED&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},invalidate_inertia:function(){this.zip_inertia=!0;this.wake()},validate_inertia:function(){if(this.zip_inertia){this.zip_inertia=
!1;if(this.inertiaMode==f.id_InertiaMode_DEFAULT){this.cinertia=0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.refmaterial.density=b.material.density;b.validate_area_inertia();this.cinertia+=b.inertia*b.area*b.material.density;a=a.next}}this.type==f.id_BodyType_DYNAMIC&&!this.norotate?(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia):(this.inertia=Math.POSITIVE_INFINITY,this.sinertia=this.iinertia=0)}},validate_aabb:function(){if(this.zip_aabb){this.zip_aabb=!1;this.aabb.minx=
Math.POSITIVE_INFINITY;this.aabb.miny=Math.POSITIVE_INFINITY;this.aabb.maxx=Math.NEGATIVE_INFINITY;this.aabb.maxy=Math.NEGATIVE_INFINITY;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.zip_aabb&&null!=b.body&&(b.zip_aabb=!1,b.type==f.id_ShapeType_CIRCLE?b.circle.__validate_aabb():b.polygon.__validate_aabb());this.aabb.combine(b.aabb);a=a.next}}},invalidate_localCOM:function(){this.zip_worldCOM=this.zip_localCOM=!0},validate_localCOM:function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var a=
0,b=0,c=0,d=this.shapes.head;null!=d;){var e=d.elt;e.zip_localCOM&&(e.zip_localCOM=!1,e.type==f.id_ShapeType_POLYGON&&e.polygon.__validate_localCOM(),null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy));e.validate_area_inertia();var g=e.area*e.material.density,a=a+e.localCOMx*g,b=b+e.localCOMy*g,c=c+e.area*e.material.density,d=d.next}0!=c&&(d=1/c,this.localCOMx=a*d,this.localCOMy=b*d);null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,
this.wrap_localCOM.zpp_inner.y=this.localCOMy);this.zip_mass&&this.massMode==f.id_MassMode_DEFAULT&&(this.zip_mass=!1,this.cmass=c,this.type==f.id_BodyType_DYNAMIC?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=Math.POSITIVE_INFINITY,this.imass=this.smass=0))}},validate_worldCOM:function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null),this.worldCOMx=this.posx+
(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},getlocalCOM:function(){this.validate_localCOM()},aabb_validate:function(){this.validate_aabb()},shapes_adder:function(a){return a.zpp_inner.body!=this?(null!=a.zpp_inner.body&&a.zpp_inner.body.wrap_shapes.remove(a),a.zpp_inner.body=this,a.zpp_inner.addedToBody(),
null!=this.space&&this.space.added_shape(a.zpp_inner,null),a.zpp_inner.type==f.id_ShapeType_POLYGON&&(a.zpp_inner.polygon.invalidate_gaxi(),a.zpp_inner.polygon.invalidate_gverts()),!0):!1},shapes_subber:function(a){null!=this.space&&this.space.removed_shape(a.zpp_inner);a.zpp_inner.body=null;a.zpp_inner.removedFromBody()},shapes_invalidate:function(){this.invalidate_shapes()},addedToSpace:function(){null==hb.zpp_pool?this.component=new hb:(this.component=hb.zpp_pool,hb.zpp_pool=this.component.next,
this.component.next=null);null;this.component.isBody=!0;this.component.body=this;this.__iaddedToSpace()},removedFromSpace:function(){for(;null!=this.arbiters.head;){var a=this.arbiters.pop_unsafe();a.cleared=!0;a.b2==this&&a.b1.arbiters.inlined_try_remove(a);a.b1==this&&a.b2.arbiters.inlined_try_remove(a);null!=a.pair&&(a.pair.arb=null,a.pair=null);a.active=!1;this.space.f_arbiters.modified=!0}a=this.component;a.body=null;a.constraint=null;null;a.next=hb.zpp_pool;hb.zpp_pool=a;this.component=null;
this.__iremovedFromSpace()},__class__:Uc});var vf=function(){this.compound=this.space=null;this.depth=0;this.outer=this.bodies=this.constraints=this.compounds=this.wrap_bodies=this.wrap_constraints=this.wrap_compounds=null;S.call(this);this.icompound=this;this.depth=1;this.bodies=new jd;this.wrap_bodies=ka.get(this.bodies);this.wrap_bodies.zpp_inner.adder=n(this,this.bodies_adder);this.wrap_bodies.zpp_inner.subber=n(this,this.bodies_subber);this.constraints=new tc;this.wrap_constraints=Nb.get(this.constraints);
this.wrap_constraints.zpp_inner.adder=n(this,this.constraints_adder);this.wrap_constraints.zpp_inner.subber=n(this,this.constraints_subber);this.compounds=new Qd;this.wrap_compounds=Vc.get(this.compounds);this.wrap_compounds.zpp_inner.adder=n(this,this.compounds_adder);this.wrap_compounds.zpp_inner.subber=n(this,this.compounds_subber)};h["zpp_nape.phys.ZPP_Compound"]=vf;vf.__name__=!0;vf.__super__=S;vf.prototype=t(S.prototype,{__imutable_midstep:function(){},addedToSpace:function(){this.__iaddedToSpace()},
removedFromSpace:function(){this.__iremovedFromSpace()},bodies_adder:function(a){return a.zpp_inner.compound!=this?(null!=a.zpp_inner.compound?a.zpp_inner.compound.wrap_bodies.remove(a):null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_bodies.remove(a),a.zpp_inner.compound=this,null!=this.space&&this.space.addBody(a.zpp_inner),!0):!1},bodies_subber:function(a){a.zpp_inner.compound=null;null!=this.space&&this.space.remBody(a.zpp_inner)},constraints_adder:function(a){return a.zpp_inner.compound!=this?
(null!=a.zpp_inner.compound?a.zpp_inner.compound.wrap_constraints.remove(a):null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_constraints.remove(a),a.zpp_inner.compound=this,null!=this.space&&this.space.addConstraint(a.zpp_inner),!0):!1},constraints_subber:function(a){a.zpp_inner.compound=null;null!=this.space&&this.space.remConstraint(a.zpp_inner)},compounds_adder:function(a){return a.zpp_inner.compound!=this?(null!=a.zpp_inner.compound?a.zpp_inner.compound.wrap_compounds.remove(a):null!=a.zpp_inner.space&&
a.zpp_inner.space.wrap_compounds.remove(a),a.zpp_inner.compound=this,a.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(a.zpp_inner),!0):!1},compounds_subber:function(a){a.zpp_inner.compound=null;a.zpp_inner.depth=1;null!=this.space&&this.space.remCompound(a.zpp_inner)},__class__:vf});var qh=function(){this.wrap_gravity=null;this.viscosity=this.density=this.gravityx=this.gravityy=0;this.shapes=null};h["zpp_nape.phys.ZPP_FluidProperties"]=qh;qh.__name__=!0;qh.prototype={__class__:qh};
var I=function(){this.dynamicFriction=this.staticFriction=this.density=this.elasticity=this.rollingFriction=0;this.next=this.outer=this.shapes=null;this.shapes=new yc;this.elasticity=0;this.dynamicFriction=1;this.staticFriction=2;this.density=0.0010;this.rollingFriction=0.01};h["zpp_nape.phys.ZPP_Material"]=I;I.__name__=!0;I.prototype={wrapper:function(){if(null==this.outer){this.outer=new pa;var a=this.outer.zpp_inner;a.outer=null;a.next=I.zpp_pool;I.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},
set:function(a){this.dynamicFriction=a.dynamicFriction;this.staticFriction=a.staticFriction;this.density=a.density;this.elasticity=a.elasticity;this.rollingFriction=a.rollingFriction},invalidate:function(a){for(var b=this.shapes.head;null!=b;)b.elt.invalidate_material(a),b=b.next},__class__:I};var jc=function(a){this.zip_aabb=!1;this.sweep=this.node=this.pairs=this.aabb=null;this.fluidEnabled=this.sensorEnabled=!1;this.circle=this.polygon=this.refmaterial=this.material=this.filter=this.fluidProperties=
null;this.sweepCoef=0;this.zip_sweepRadius=!1;this.sweepRadius=0;this.wrap_localCOM=null;this.zip_worldCOM=!1;this.worldCOMx=this.worldCOMy=0;this.zip_localCOM=!1;this.localCOMx=this.localCOMy=0;this.zip_angDrag=!1;this.inertia=this.angDrag=0;this.zip_area_inertia=!1;this.type=this.area=0;this.outer=this.body=null;S.call(this);this.pairs=new Eg;this.ishape=this;this.type=a;this.aabb=$.get(0,0,0,0);this.aabb._immutable=!0;this.aabb._validate=n(this,this.aabb_validate);this.zip_area_inertia=this.zip_angDrag=
this.zip_localCOM=this.zip_sweepRadius=!0;this.worldCOMy=this.worldCOMx=this.localCOMy=this.localCOMx=0;this.sensorEnabled=this.fluidEnabled=!1;this.body=this.fluidProperties=null;this.refmaterial=new I;this.sweepRadius=this.sweepCoef=0};h["zpp_nape.shape.ZPP_Shape"]=jc;jc.__name__=!0;jc.__super__=S;jc.prototype=t(S.prototype,{validate_sweepRadius:function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},
validate_area_inertia:function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},validate_angDrag:function(){if(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_angDrag():this.polygon.__validate_angDrag()},validate_worldCOM:function(){this.zip_worldCOM&&
null!=this.body&&(this.zip_worldCOM=!1,this.zip_localCOM&&(this.zip_localCOM=!1,this.type==f.id_ShapeType_POLYGON&&this.polygon.__validate_localCOM(),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)),this.body.validate_axis(),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy))},invalidate_area_inertia:function(){this.zip_area_inertia=
!0;null!=this.body&&(this.body.invalidate_localCOM(),this.body.invalidate_mass(),this.body.invalidate_inertia())},invalidate_angDrag:function(){this.zip_angDrag=!0},invalidate_localCOM:function(){this.zip_localCOM=!0;this.invalidate_area_inertia();this.type==f.id_ShapeType_CIRCLE&&(this.zip_sweepRadius=!0);this.invalidate_angDrag();this.invalidate_worldCOM();null!=this.body&&this.body.invalidate_localCOM()},invalidate_worldCOM:function(){this.zip_aabb=this.zip_worldCOM=!0;null!=this.body&&(this.body.zip_aabb=
!0)},invalidate_material:function(a){0!=(a&I.WAKE)&&this.wake();0!=(a&I.ARBITERS)&&null!=this.body&&this.body.refreshArbiters();0!=(a&I.PROPS)&&null!=this.body&&(this.body.invalidate_localCOM(),this.body.invalidate_mass(),this.body.invalidate_inertia());0!=(a&I.ANGDRAG)&&this.invalidate_angDrag();this.refmaterial.set(this.material)},invalidate_filter:function(){this.wake()},aabb_validate:function(){this.zip_aabb&&null!=this.body&&(this.zip_aabb=!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_aabb():
this.polygon.__validate_aabb())},setMaterial:function(a){this.material!=a&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=a,null!=this.body&&null!=this.body.space&&a.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},setFilter:function(a){this.filter!=a&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=a,null!=this.body&&null!=this.body.space&&a.shapes.add(this),
this.wake())},__immutable_midstep:function(){},addedToBody:function(){this.invalidate_worldCOM();this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0)},removedFromBody:function(){},addedToSpace:function(){this.__iaddedToSpace();this.material.shapes.add(this);this.filter.shapes.add(this);null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},removedFromSpace:function(){this.__iremovedFromSpace();this.material.shapes.remove(this);this.filter.shapes.remove(this);null!=this.fluidProperties&&
this.fluidProperties.shapes.remove(this)},__class__:jc});var yf=function(){this.radius=0;this.outer_zn=null;jc.call(this,f.id_ShapeType_CIRCLE);this.circle=this;this.zip_localCOM=!1};h["zpp_nape.shape.ZPP_Circle"]=yf;yf.__name__=!0;yf.__super__=jc;yf.prototype=t(jc.prototype,{invalidate_radius:function(){this.invalidate_area_inertia();this.invalidate_angDrag();this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0);null!=this.body&&this.body.wake()},__validate_aabb:function(){this.zip_worldCOM&&
null!=this.body&&(this.zip_worldCOM=!1,this.zip_localCOM&&(this.zip_localCOM=!1,this.type==f.id_ShapeType_POLYGON&&this.polygon.__validate_localCOM(),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)),this.body.validate_axis(),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy));var a=this.radius,
b=this.radius;this.aabb.minx=this.worldCOMx-a;this.aabb.miny=this.worldCOMy-b;this.aabb.maxx=this.worldCOMx+a;this.aabb.maxy=this.worldCOMy+b},_force_validate_aabb:function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy);this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy);this.aabb.minx=this.worldCOMx-this.radius;this.aabb.miny=this.worldCOMy-this.radius;this.aabb.maxx=this.worldCOMx+this.radius;this.aabb.maxy=
this.worldCOMy+this.radius},__validate_sweepRadius:function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy);this.sweepRadius=this.sweepCoef+this.radius},__validate_area_inertia:function(){var a=this.radius*this.radius;this.area=a*Math.PI;this.inertia=0.5*a+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},__validate_angDrag:function(){var a=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,b=this.radius*this.radius;this.angDrag=(a+2*b)*
this.material.dynamicFriction*m.fluidAngularDragFriction+0.5*m.fluidAngularDrag*(1+m.fluidVacuumDrag)*a;this.angDrag/=2*(a+0.5*b)},__scale:function(a,b){var c;c=((0>a?-a:a)+(0>b?-b:b))/2;this.radius=0>c?this.radius*-c:this.radius*c;this.invalidate_radius();0<this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy&&(this.localCOMx*=a,this.localCOMy*=b,this.invalidate_localCOM())},__translate:function(a,b){this.localCOMx+=1*a;this.localCOMy+=1*b;this.invalidate_localCOM()},__class__:yf});var U=
function(){this.tp0=this.tp1=0;this.lp0=this.gp0=this.lp1=this.gp1=null;this.length=this.lprojection=this.gprojection=0;this.wrap_gnorm=null;this.gnormx=this.gnormy=0;this.wrap_lnorm=null;this.lnormx=this.lnormy=0;this.next=this.polygon=this.outer=null;this.gprojection=this.lprojection=this.length=this.gnormy=this.gnormx=this.lnormy=this.lnormx=0};h["zpp_nape.shape.ZPP_Edge"]=U;U.__name__=!0;U.prototype={wrapper:function(){null==this.outer&&(U.internal=!0,this.outer=new xg,U.internal=!1,this.outer.zpp_inner=
this);return this.outer},__class__:U};var zf=function(){this.reverse_flag=this.zip_lverts=this.zip_laxi=this.zip_gverts=this.zip_gaxi=this.zip_valid=this.zip_sanitation=!1;this.edgeCnt=0;this.outer_zn=this.lverts=this.wrap_lverts=this.gverts=this.wrap_gverts=this.edges=this.wrap_edges=null;jc.call(this,f.id_ShapeType_POLYGON);this.polygon=this;this.lverts=new K;this.gverts=new K;this.edges=new Fg;this.edgeCnt=0};h["zpp_nape.shape.ZPP_Polygon"]=zf;zf.__name__=!0;zf.__super__=jc;zf.prototype=t(jc.prototype,
{lverts_pa_invalidate:function(){this.invalidate_lverts()},gverts_pa_validate:function(){this.validate_gverts()},lverts_post_adder:function(a){a.zpp_inner._invalidate=n(this,this.lverts_pa_invalidate);for(var b=null,c=null,d=this.lverts.next;null!=d&&!(d==a.zpp_inner);){b=null==b?this.gverts.next:b.next,c=null==c?this.edges.head:c.next;d=d.next}a=K.get(0,0,!0);this.gverts.insert(b,a);null!=this.lverts.next.next&&(null==this.lverts.next.next.next?(null==U.zpp_pool?c=new U:(c=U.zpp_pool,U.zpp_pool=
c.next,c.next=null),null,c.polygon=this,this.edges.add(c),null==U.zpp_pool?c=new U:(c=U.zpp_pool,U.zpp_pool=c.next,c.next=null),null,c.polygon=this,this.edges.add(c),this.edgeCnt+=2):(null==U.zpp_pool?b=new U:(b=U.zpp_pool,U.zpp_pool=b.next,b.next=null),null,b.polygon=this,this.edges.insert(c,b),this.edgeCnt++));a._validate=n(this,this.gverts_pa_validate)},lverts_subber:function(a){this.cleanup_lvert(a.zpp_inner)},lverts_invalidate:function(){this.invalidate_lverts()},lverts_validate:function(){this.validate_lverts()},
getlverts:function(){this.wrap_lverts=Cc.get(this.lverts);this.wrap_lverts.zpp_inner.post_adder=n(this,this.lverts_post_adder);this.wrap_lverts.zpp_inner.subber=n(this,this.lverts_subber);this.wrap_lverts.zpp_inner._invalidate=n(this,this.lverts_invalidate);this.wrap_lverts.zpp_inner._validate=n(this,this.lverts_validate);this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},invalidate_lverts:function(){this.invalidate_laxi();this.invalidate_area_inertia();this.invalidate_angDrag();this.invalidate_localCOM();
this.invalidate_gverts();this.zip_sanitation=this.zip_valid=this.zip_lverts=!0;null!=this.body&&this.body.wake()},invalidate_laxi:function(){this.invalidate_gaxi();this.zip_laxi=this.zip_sweepRadius=!0},invalidate_gverts:function(){this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0);this.zip_gverts=!0},invalidate_gaxi:function(){this.zip_gaxi=!0},validate_lverts:function(){this.zip_lverts&&(this.zip_lverts=!1,2<this.lverts.length&&(this.validate_area_inertia(),0>this.area&&(this.reverse_vertices(),
this.area=-this.area)))},cleanup_lvert:function(a){for(var b=null,c=null,d=this.lverts.next;null!=d&&!(d==a);){b=null==b?this.gverts.next:b.next,c=null==c?this.edges.head:c.next;d=d.next}a=null==b?this.gverts.next:b.next;this.gverts.erase(b);null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=K.zpp_pool;K.zpp_pool=a;2==this.edgeCnt?(c=this.edges.pop_unsafe(),c.polygon=null,c.next=U.zpp_pool,U.zpp_pool=c,c=this.edges.pop_unsafe(),c.polygon=
null,c.next=U.zpp_pool,U.zpp_pool=c,this.edgeCnt=0):0!=this.edgeCnt&&(b=null==c?this.edges.head.elt:c.next.elt,this.edges.erase(c),b.polygon=null,b.next=U.zpp_pool,U.zpp_pool=b,this.edgeCnt--)},splice_collinear:function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},splice_collinear_real:function(){if(!(null==this.lverts.next||null==this.lverts.next.next)&&null!=this.lverts.next.next.next){for(var a=null,b=this.lverts.next;null!=b;){var c=b,d=null==b.next?this.lverts.next:
b.next;nb.vec_dsq(c.x,c.y,d.x,d.y)<m.epsilon*m.epsilon?(this.cleanup_lvert(b),b=this.lverts.erase(a)):(a=b,b=b.next)}if(null!=this.lverts.next){do{a=!1;for(b=this.lverts.next;null!=b;){var c=null==b.next?this.lverts.next:b.next,e=b,d=c,f=null==c.next?this.lverts.next:c.next,g=0,h=0,g=d.x-e.x,h=d.y-e.y,i=e=0,e=f.x-d.x,i=f.y-d.y,d=i*g-e*h;d*d>=m.epsilon*m.epsilon||(this.cleanup_lvert(c),this.lverts.erase(null==b.next?null:b),a=!0);b=b.next}}while(a)}}},reverse_vertices:function(){this.lverts.reverse();
this.gverts.reverse();this.edges.reverse();var a=this.edges.iterator_at(this.edgeCnt-1),b=this.edges.pop_unsafe();this.edges.insert(a,b);this.reverse_flag=!this.reverse_flag;null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag);null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag);null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},validate_laxi:function(){if(this.zip_laxi){this.zip_laxi=!1;this.validate_lverts();
for(var a=this.edges.head,b=this.lverts.next,c=b,b=b.next;null!=b;){var d=b,e=a.elt,a=a.next;e.lp0=c;e.lp1=d;var f=0,g=0,f=c.x-d.x,g=c.y-d.y,h=Math.sqrt(f*f+g*g);e.length=h;h=1/h;f*=h;g*=h;h=f;f=-g;g=h;e.lprojection=f*c.x+g*c.y;e.lnormx=f;e.lnormy=g;null!=e.wrap_lnorm&&(e.wrap_lnorm.zpp_inner.x=f,e.wrap_lnorm.zpp_inner.y=g);c=d;b=b.next}e=this.lverts.next;a=a.elt;a.lp0=c;a.lp1=e;d=b=0;b=c.x-e.x;d=c.y-e.y;e=Math.sqrt(b*b+d*d);a.length=e;e=1/e;f=b*e;b=-(d*e);d=f;a.lprojection=b*c.x+d*c.y;a.lnormx=b;
a.lnormy=d;null!=a.wrap_lnorm&&(a.wrap_lnorm.zpp_inner.x=b,a.wrap_lnorm.zpp_inner.y=d)}},validate_gverts:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1;this.validate_lverts();this.body.validate_axis();for(var a=this.lverts.next,b=this.gverts.next;null!=b;){var c=b,d=a,a=a.next;c.x=this.body.posx+(this.body.axisy*d.x-this.body.axisx*d.y);c.y=this.body.posy+(d.x*this.body.axisx+d.y*this.body.axisy);b=b.next}}},validate_gaxi:function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=
!1;this.validate_laxi();this.body.validate_axis();this.validate_gverts();for(var a=this.edges.head,b=this.gverts.next,c=b,b=b.next;null!=b;){var d=b,e=a.elt,a=a.next;e.gp0=c;e.gp1=d;e.gnormx=this.body.axisy*e.lnormx-this.body.axisx*e.lnormy;e.gnormy=e.lnormx*this.body.axisx+e.lnormy*this.body.axisy;e.gprojection=this.body.posx*e.gnormx+this.body.posy*e.gnormy+e.lprojection;null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy);e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy;
e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy;c=d;b=b.next}b=this.gverts.next;a=a.elt;a.gp0=c;a.gp1=b;a.gnormx=this.body.axisy*a.lnormx-this.body.axisx*a.lnormy;a.gnormy=a.lnormx*this.body.axisx+a.lnormy*this.body.axisy;a.gprojection=this.body.posx*a.gnormx+this.body.posy*a.gnormy+a.lprojection;null!=a.wrap_gnorm&&(a.wrap_gnorm.zpp_inner.x=a.gnormx,a.wrap_gnorm.zpp_inner.y=a.gnormy);a.tp0=a.gp0.y*a.gnormx-a.gp0.x*a.gnormy;a.tp1=a.gp1.y*a.gnormx-a.gp1.x*a.gnormy}},__validate_aabb:function(){this.validate_gverts();
var a=this.gverts.next;this.aabb.minx=a.x;this.aabb.miny=a.y;this.aabb.maxx=a.x;this.aabb.maxy=a.y;for(a=this.gverts.next.next;null!=a;){var b=a;b.x<this.aabb.minx&&(this.aabb.minx=b.x);b.x>this.aabb.maxx&&(this.aabb.maxx=b.x);b.y<this.aabb.miny&&(this.aabb.miny=b.y);b.y>this.aabb.maxy&&(this.aabb.maxy=b.y);a=a.next}},_force_validate_aabb:function(){var a=this.lverts.next,b=this.gverts.next,c=a,a=a.next;b.x=this.body.posx+(this.body.axisy*c.x-this.body.axisx*c.y);b.y=this.body.posy+(c.x*this.body.axisx+
c.y*this.body.axisy);this.aabb.minx=b.x;this.aabb.miny=b.y;this.aabb.maxx=b.x;this.aabb.maxy=b.y;for(b=this.gverts.next.next;null!=b;){var c=b,d=a,a=a.next;c.x=this.body.posx+(this.body.axisy*d.x-this.body.axisx*d.y);c.y=this.body.posy+(d.x*this.body.axisx+d.y*this.body.axisy);c.x<this.aabb.minx&&(this.aabb.minx=c.x);c.x>this.aabb.maxx&&(this.aabb.maxx=c.x);c.y<this.aabb.miny&&(this.aabb.miny=c.y);c.y>this.aabb.maxy&&(this.aabb.maxy=c.y);b=b.next}},__validate_sweepRadius:function(){var a=0,b=0;this.validate_laxi();
for(var c=this.lverts.next;null!=c;){var d=c,d=d.x*d.x+d.y*d.y;d>a&&(a=d);c=c.next}for(c=this.edges.head;null!=c;){d=c.elt;if(d.lprojection<b&&(b=d.lprojection,0>b))break;c=c.next}0>b&&(b=0);this.sweepRadius=Math.sqrt(a);this.sweepCoef=this.sweepRadius-b},__validate_area_inertia:function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.inertia=this.area=0;else{for(var a=this.area=0,b=0,c=this.lverts.next,d=c,e=c=c.next,c=c.next;null!=c;){var f=c,g=e.y*
d.x-e.x*d.y,a=a+g*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y)),b=b+g;this.area+=e.x*(f.y-d.y);d=e;e=f;c=c.next}g=c=this.lverts.next;f=e.y*d.x-e.x*d.y;a+=f*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y));this.area+=e.x*(g.y-d.y);d=e;e=g;c=c.next;g=e.y*d.x-e.x*d.y;a+=g*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y));this.area+=e.x*(c.y-d.y);this.inertia=a/(6*(b+f+g));this.area*=0.5;0>this.area&&(this.area=-this.area,this.reverse_vertices())}},__validate_angDrag:function(){this.validate_area_inertia();
this.validate_laxi();for(var a=0,b=this.edges.head,c=0,d=this.lverts.next,e=d,d=d.next;null!=d;){var f=d,g=b.elt,b=b.next,c=c+g.length,h=0,i=0,h=f.x-e.x,i=f.y-e.y,a=a+g.length*m.fluidAngularDragFriction*this.material.dynamicFriction*g.lprojection*g.lprojection,l=-(e.y*g.lnormx-e.x*g.lnormy)/(i*g.lnormx-h*g.lnormy);if(0<l){var k;k=1<l?1:l;var o=0,n=0,o=e.x,n=e.y,p=k,o=o+h*p,n=n+i*p,p=g.lnormy*e.x-g.lnormx*e.y,o=g.lnormy*o-g.lnormx*n,a=a+(o*o*o-p*p*p)/(3*(o-p))*k*g.length*m.fluidAngularDrag}1>l&&(l=
0>l?0:l,o=k=0,k=e.x,o=e.y,e=l,k+=h*e,o+=i*e,e=g.lnormy*k-g.lnormx*o,h=g.lnormy*f.x-g.lnormx*f.y,a+=(h*h*h-e*e*e)/(3*(h-e))*m.fluidVacuumDrag*(1-l)*g.length*m.fluidAngularDrag);e=f;d=d.next}d=this.lverts.next;b=b.elt;c+=b.length;g=f=0;f=d.x-e.x;g=d.y-e.y;a+=b.length*m.fluidAngularDragFriction*this.material.dynamicFriction*b.lprojection*b.lprojection;h=-(e.y*b.lnormx-e.x*b.lnormy)/(g*b.lnormx-f*b.lnormy);0<h&&(i=1<h?1:h,o=k=0,k=e.x,o=e.y,l=b.lnormy*e.x-b.lnormx*e.y,k=b.lnormy*(k+f*i)-b.lnormx*(o+g*
i),a+=(k*k*k-l*l*l)/(3*(k-l))*i*b.length*m.fluidAngularDrag);1>h&&(h=0>h?0:h,l=i=0,i=e.x,l=e.y,e=b.lnormy*(i+f*h)-b.lnormx*(l+g*h),d=b.lnormy*d.x-b.lnormx*d.y,a+=(d*d*d-e*e*e)/(3*(d-e))*m.fluidVacuumDrag*(1-h)*b.length*m.fluidAngularDrag);this.angDrag=a/(this.inertia*c)},__validate_localCOM:function(){if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,
this.localCOMx+=1*this.lverts.next.next.x,this.localCOMy+=1*this.lverts.next.next.y,this.localCOMx*=0.5,this.localCOMy*=0.5;else{for(var a=this.localCOMy=this.localCOMx=0,b=this.lverts.next,c=b,d=b=b.next,b=b.next;null!=b;){var e=b,a=a+d.x*(e.y-c.y),c=e.y*d.x-e.x*d.y;this.localCOMx+=(d.x+e.x)*c;this.localCOMy+=(d.y+e.y)*c;c=d;d=e;b=b.next}e=b=this.lverts.next;a+=d.x*(e.y-c.y);c=e.y*d.x-e.x*d.y;this.localCOMx+=(d.x+e.x)*c;this.localCOMy+=(d.y+e.y)*c;c=d;d=e;b=b.next;a+=d.x*(b.y-c.y);c=b.y*d.x-b.x*
d.y;this.localCOMx+=(d.x+b.x)*c;this.localCOMy+=(d.y+b.y)*c;a=1/(3*a);this.localCOMx*=a;this.localCOMy*=a}},__translate:function(a,b){for(var c=this.lverts.next;null!=c;){var d=c;d.x+=1*a;d.y+=1*b;c=c.next}this.invalidate_lverts()},__scale:function(a,b){for(var c=this.lverts.next;null!=c;){var d=c;d.x*=a;d.y*=b;c=c.next}this.invalidate_lverts()},__class__:zf});var kd=function(){this.sweep=this.dynab=null;this.is_sweep=!1;this.space=null};h["zpp_nape.space.ZPP_Broadphase"]=kd;kd.__name__=!0;kd.prototype=
{insert:function(a){this.is_sweep?this.sweep.__insert(a):this.dynab.__insert(a)},remove:function(a){this.is_sweep?this.sweep.__remove(a):this.dynab.__remove(a)},sync:function(a){this.is_sweep?!this.sweep.space.continuous&&a.zip_aabb&&null!=a.body&&(a.zip_aabb=!1,a.type==f.id_ShapeType_CIRCLE?a.circle.__validate_aabb():a.polygon.__validate_aabb()):this.dynab.__sync(a)},broadphase:function(){},bodiesUnderPoint:function(){return null},__class__:kd};var xa=function(){this.synced=this.first_sync=!1;this.snext=
null;this.moved=!1;this.next=this.mnext=null;this.height=0;this.parent=this.child1=this.child2=null;this.dyn=!1;this.aabb=this.shape=null;this.height=-1};h["zpp_nape.space.ZPP_AABBNode"]=xa;xa.__name__=!0;xa.prototype={free:function(){this.height=-1;var a=this.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a.wrap_min=a.wrap_max=null;a._invalidate=null;a._validate=null;a.next=$.zpp_pool;$.zpp_pool=a;this.mnext=this.snext=this.next=this.child1=this.child2=this.parent=null},__class__:xa};
var L=function(){this.arb=this.next=null;this.id=this.di=0;this.first=this.sleeping=!1;this.n1=this.n2=null};h["zpp_nape.space.ZPP_AABBPair"]=L;L.__name__=!0;L.prototype={__class__:L};var Db=function(){this.root=null};h["zpp_nape.space.ZPP_AABBTree"]=Db;Db.__name__=!0;Db.prototype={inlined_insertLeaf:function(a){if(null==this.root)this.root=a,this.root.parent=null;else{for(var b=a.aabb,c=this.root;null!=c.child1;){var d=c.child1,e=c.child2,f=c.aabb.perimeter();Db.tmpaabb.setCombine(c.aabb,b);var g=
Db.tmpaabb.perimeter(),h=2*g,f=2*(g-f);Db.tmpaabb.setCombine(b,d.aabb);null==d.child1?g=Db.tmpaabb.perimeter()+f:(g=d.aabb.perimeter(),g=Db.tmpaabb.perimeter()-g+f);Db.tmpaabb.setCombine(b,e.aabb);if(null==e.child1)f=Db.tmpaabb.perimeter()+f;else var i=e.aabb.perimeter(),f=Db.tmpaabb.perimeter()-i+f;if(h<g&&h<f)break;else c=g<f?d:e}d=c.parent;null==xa.zpp_pool?e=new xa:(e=xa.zpp_pool,xa.zpp_pool=e.next,e.next=null);null==$.zpp_pool?e.aabb=new $:(e.aabb=$.zpp_pool,$.zpp_pool=e.aabb.next,e.aabb.next=
null);null;e.moved=!1;e.synced=!1;e.first_sync=!1;e.parent=d;e.aabb.setCombine(b,c.aabb);e.height=c.height+1;null!=d?(d.child1==c?d.child1=e:d.child2=e,e.child1=c,e.child2=a,c.parent=e,a.parent=e):(e.child1=c,e.child2=a,c.parent=e,this.root=a.parent=e);for(c=a.parent;null!=c;)c=this.balance(c),a=c.child1,b=c.child2,d=a.height,e=b.height,c.height=1+(d>e?d:e),c.aabb.setCombine(a.aabb,b.aabb),c=c.parent}},removeLeaf:function(a){this.inlined_removeLeaf(a)},inlined_removeLeaf:function(a){if(a==this.root)this.root=
null;else{var b=a.parent,c=b.parent,a=b.child1==a?b.child2:b.child1;if(null!=c){c.child1==b?c.child1=a:c.child2=a;a.parent=c;b.free();b.next=xa.zpp_pool;xa.zpp_pool=b;for(b=c;null!=b;)b=this.balance(b),a=b.child1,c=b.child2,b.aabb.setCombine(a.aabb,c.aabb),a=a.height,c=c.height,b.height=1+(a>c?a:c),b=b.parent}else this.root=a,a.parent=null,b.free(),b.next=xa.zpp_pool,xa.zpp_pool=b}},balance:function(a){if(null==a.child1||2>a.height)return a;var b=a.child1,c=a.child2,d=c.height-b.height;if(1<d){var e=
c.child1,f=c.child2;c.child1=a;c.parent=a.parent;a.parent=c;null!=c.parent?c.parent.child1==a?c.parent.child1=c:c.parent.child2=c:this.root=c;e.height>f.height?(c.child2=e,a.child2=f,f.parent=a,a.aabb.setCombine(b.aabb,f.aabb),c.aabb.setCombine(a.aabb,e.aabb),a.height=1+function(){var a=b.height,c=f.height;return a>c?a:c}(this),c.height=1+function(){var b=a.height,c=e.height;return b>c?b:c}(this)):(c.child2=f,a.child2=e,e.parent=a,a.aabb.setCombine(b.aabb,e.aabb),c.aabb.setCombine(a.aabb,f.aabb),
a.height=1+function(){var a=b.height,c=e.height;return a>c?a:c}(this),c.height=1+function(){var b=a.height,c=f.height;return b>c?b:c}(this));return c}if(-1>d){var g=b.child1,h=b.child2;b.child1=a;b.parent=a.parent;a.parent=b;null!=b.parent?b.parent.child1==a?b.parent.child1=b:b.parent.child2=b:this.root=b;g.height>h.height?(b.child2=g,a.child1=h,h.parent=a,a.aabb.setCombine(c.aabb,h.aabb),b.aabb.setCombine(a.aabb,g.aabb),a.height=1+function(){var a=c.height,b=h.height;return a>b?a:b}(this),b.height=
1+function(){var b=a.height,c=g.height;return b>c?b:c}(this)):(b.child2=h,a.child1=g,g.parent=a,a.aabb.setCombine(c.aabb,g.aabb),b.aabb.setCombine(a.aabb,h.aabb),a.height=1+function(){var a=c.height,b=g.height;return a>b?a:b}(this),b.height=1+function(){var b=a.height,c=h.height;return b>c?b:c}(this));return b}return a},__class__:Db};var Hf=function(a){this.stree=this.dtree=this.pairs=this.syncs=this.moves=this.treeStack=null;kd.call(this);this.space=a;this.is_sweep=!1;this.dynab=this;this.stree=
new Db;this.dtree=new Db};h["zpp_nape.space.ZPP_DynAABBPhase"]=Hf;Hf.__name__=!0;Hf.__super__=kd;Hf.prototype=t(kd.prototype,{__insert:function(a){var b;null==xa.zpp_pool?b=new xa:(b=xa.zpp_pool,xa.zpp_pool=b.next,b.next=null);null==$.zpp_pool?b.aabb=new $:(b.aabb=$.zpp_pool,$.zpp_pool=b.aabb.next,b.aabb.next=null);null;b.moved=!1;b.synced=!1;b.first_sync=!1;b.shape=a;a.node=b;b.synced=!0;b.first_sync=!0;b.snext=this.syncs;this.syncs=b},__remove:function(a){var b=a.node;b.first_sync||(b.dyn?this.dtree.removeLeaf(b):
this.stree.removeLeaf(b));a.node=null;if(b.synced){for(var c=null,d=this.syncs;null!=d&&!(d==b);){c=d;d=d.snext}null==c?this.syncs=d.snext:c.snext=d.snext;d.snext=null;b.synced=!1}if(b.moved){c=null;for(d=this.moves;null!=d&&!(d==b);){c=d;d=d.mnext}null==c?this.moves=d.mnext:c.mnext=d.mnext;d.mnext=null;b.moved=!1}for(var c=null,e=this.pairs;null!=e;)d=e.next,e.n1==b||e.n2==b?(null==c?this.pairs=d:c.next=d,null!=e.arb&&(e.arb.pair=null),e.arb=null,e.n1.shape.pairs.remove(e),e.n2.shape.pairs.remove(e),
e.n1=e.n2=null,e.sleeping=!1,e.next=L.zpp_pool,L.zpp_pool=e):c=e,e=d;for(;null!=a.pairs.head;)c=a.pairs.pop_unsafe(),c.n1==b?c.n2.shape.pairs.remove(c):c.n1.shape.pairs.remove(c),null!=c.arb&&(c.arb.pair=null),c.arb=null,c.n1=c.n2=null,c.sleeping=!1,c.next=L.zpp_pool,L.zpp_pool=c;b.free();b.next=xa.zpp_pool;xa.zpp_pool=b},__sync:function(a){var b=a.node;if(!b.synced&&(!this.space.continuous&&a.zip_aabb&&null!=a.body&&(a.zip_aabb=!1,a.type==f.id_ShapeType_CIRCLE?a.circle.__validate_aabb():a.polygon.__validate_aabb()),
b.dyn!=(a.body.type==f.id_BodyType_STATIC?!1:!a.body.component.sleeping)||!b.aabb.contains(a.aabb)))b.synced=!0,b.snext=this.syncs,this.syncs=b},sync_broadphase:function(){this.space.validation();if(null!=this.syncs)if(null==this.moves){for(var a=this.syncs;null!=a;){var b=a.shape;a.first_sync?a.first_sync=!1:(a.dyn?this.dtree:this.stree).inlined_removeLeaf(a);var c=a.aabb;!this.space.continuous&&b.zip_aabb&&null!=b.body&&(b.zip_aabb=!1,b.type==f.id_ShapeType_CIRCLE?b.circle.__validate_aabb():b.polygon.__validate_aabb());
c.setExpand(b.aabb,3);((b.body.type==f.id_BodyType_STATIC?a.dyn=!1:a.dyn=!b.body.component.sleeping)?this.dtree:this.stree).inlined_insertLeaf(a);a.synced=!1;a.moved=!0;a.mnext=a.snext;a.snext=null;a=a.mnext}a=this.syncs;this.syncs=this.moves;this.moves=a}else for(;null!=this.syncs;)a=this.syncs,this.syncs=a.snext,a.snext=null,b=a.shape,a.first_sync?a.first_sync=!1:(a.dyn?this.dtree:this.stree).inlined_removeLeaf(a),c=a.aabb,!this.space.continuous&&b.zip_aabb&&null!=b.body&&(b.zip_aabb=!1,b.type==
f.id_ShapeType_CIRCLE?b.circle.__validate_aabb():b.polygon.__validate_aabb()),c.setExpand(b.aabb,3),((b.body.type==f.id_BodyType_STATIC?a.dyn=!1:a.dyn=!b.body.component.sleeping)?this.dtree:this.stree).inlined_insertLeaf(a),a.synced=!1,a.moved||(a.moved=!0,a.mnext=this.moves,this.moves=a)},broadphase:function(a,b){for(var c=this.syncs;null!=c;){var d=c.shape;c.first_sync?c.first_sync=!1:(c.dyn?this.dtree:this.stree).inlined_removeLeaf(c);var e=c.aabb;!a.continuous&&d.zip_aabb&&null!=d.body&&(d.zip_aabb=
!1,d.type==f.id_ShapeType_CIRCLE?d.circle.__validate_aabb():d.polygon.__validate_aabb());e.setExpand(d.aabb,3);((d.body.type==f.id_BodyType_STATIC?c.dyn=!1:c.dyn=!d.body.component.sleeping)?this.dtree:this.stree).inlined_insertLeaf(c);c.synced=!1;c=c.snext}for(;null!=this.syncs;)if(c=this.syncs,this.syncs=c.snext,c.snext=null,!c.moved&&(c.moved=!1,d=c.shape,!d.body.component.sleeping)){var e=c.aabb,g=null;null!=this.dtree.root&&(this.dtree.root.next=g,g=this.dtree.root);for(;null!=g;){var h;h=g;g=
h.next;h.next=null;if(h!=c)if(null==h.child1){var j=h.shape;if(j.body!=d.body&&!(j.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(h.aabb)){var i,l;d.id<j.id?(i=d.id,l=j.id):(i=j.id,l=d.id);for(var k=null,o=(d.pairs.length<j.pairs.length?d:j).pairs.head;null!=o;){var m=o.elt;if(m.id==i&&m.di==l){k=m;break}o=o.next}null!=k?k.sleeping&&(k.sleeping=!1,k.next=this.pairs,this.pairs=k,k.first=!0):(null==L.zpp_pool?k=new L:(k=L.zpp_pool,L.zpp_pool=k.next,k.next=null),null,
k.n1=c,k.n2=h,k.id=i,k.di=l,k.next=this.pairs,this.pairs=k,k.first=!0,d.pairs.inlined_add(k),j.pairs.inlined_add(k))}}else e.intersect(h.aabb)&&(null!=h.child1&&(h.child1.next=g,g=h.child1),null!=h.child2&&(h.child2.next=g,g=h.child2))}null!=this.stree.root&&(this.stree.root.next=g,g=this.stree.root);for(;null!=g;)if(h=g,g=h.next,h.next=null,h!=c)if(null==h.child1){if(j=h.shape,j.body!=d.body&&!(j.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(h.aabb)){d.id<j.id?
(i=d.id,l=j.id):(i=j.id,l=d.id);k=null;for(o=(d.pairs.length<j.pairs.length?d:j).pairs.head;null!=o;){m=o.elt;if(m.id==i&&m.di==l){k=m;break}o=o.next}null!=k?k.sleeping&&(k.sleeping=!1,k.next=this.pairs,this.pairs=k,k.first=!0):(null==L.zpp_pool?k=new L:(k=L.zpp_pool,L.zpp_pool=k.next,k.next=null),null,k.n1=c,k.n2=h,k.id=i,k.di=l,k.next=this.pairs,this.pairs=k,k.first=!0,d.pairs.inlined_add(k),j.pairs.inlined_add(k))}}else e.intersect(h.aabb)&&(null!=h.child1&&(h.child1.next=g,g=h.child1),null!=h.child2&&
(h.child2.next=g,g=h.child2))}for(;null!=this.moves;)if(c=this.moves,this.moves=c.mnext,c.mnext=null,c.moved=!1,d=c.shape,!d.body.component.sleeping){e=c.aabb;g=null;null!=this.dtree.root&&(this.dtree.root.next=g,g=this.dtree.root);for(;null!=g;)if(h=g,g=h.next,h.next=null,h!=c)if(null==h.child1){if(j=h.shape,j.body!=d.body&&!(j.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(h.aabb)){d.id<j.id?(i=d.id,l=j.id):(i=j.id,l=d.id);k=null;for(o=(d.pairs.length<j.pairs.length?
d:j).pairs.head;null!=o;){m=o.elt;if(m.id==i&&m.di==l){k=m;break}o=o.next}null!=k?k.sleeping&&(k.sleeping=!1,k.next=this.pairs,this.pairs=k,k.first=!0):(null==L.zpp_pool?k=new L:(k=L.zpp_pool,L.zpp_pool=k.next,k.next=null),null,k.n1=c,k.n2=h,k.id=i,k.di=l,k.next=this.pairs,this.pairs=k,k.first=!0,d.pairs.inlined_add(k),j.pairs.inlined_add(k))}}else e.intersect(h.aabb)&&(null!=h.child1&&(h.child1.next=g,g=h.child1),null!=h.child2&&(h.child2.next=g,g=h.child2));null!=this.stree.root&&(this.stree.root.next=
g,g=this.stree.root);for(;null!=g;)if(h=g,g=h.next,h.next=null,h!=c)if(null==h.child1){if(j=h.shape,j.body!=d.body&&!(j.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(h.aabb)){d.id<j.id?(i=d.id,l=j.id):(i=j.id,l=d.id);k=null;for(o=(d.pairs.length<j.pairs.length?d:j).pairs.head;null!=o;){m=o.elt;if(m.id==i&&m.di==l){k=m;break}o=o.next}null!=k?k.sleeping&&(k.sleeping=!1,k.next=this.pairs,this.pairs=k,k.first=!0):(null==L.zpp_pool?k=new L:(k=L.zpp_pool,L.zpp_pool=k.next,
k.next=null),null,k.n1=c,k.n2=h,k.id=i,k.di=l,k.next=this.pairs,this.pairs=k,k.first=!0,d.pairs.inlined_add(k),j.pairs.inlined_add(k))}}else e.intersect(h.aabb)&&(null!=h.child1&&(h.child1.next=g,g=h.child1),null!=h.child2&&(h.child2.next=g,g=h.child2))}c=null;for(d=this.pairs;null!=d;)!d.first&&!d.n1.aabb.intersect(d.n2.aabb)?(null==c?this.pairs=d.next:c.next=d.next,d.n1.shape.pairs.inlined_try_remove(d),d.n2.shape.pairs.inlined_try_remove(d),e=d.next,null!=d.arb&&(d.arb.pair=null),d.arb=null,d.n1=
d.n2=null,d.sleeping=!1,d.next=L.zpp_pool,L.zpp_pool=d,d=e):(e=d.n1.shape,g=e.body,h=d.n2.shape,j=h.body,!d.first&&(g.component.sleeping||g.type==f.id_BodyType_STATIC)&&(j.component.sleeping||j.type==f.id_BodyType_STATIC)?(d.sleeping=!0,null==c?this.pairs=d.next:c.next=d.next):(d.first=!1,e.aabb.intersect(h.aabb)&&(c=d.arb,d.arb=b?a.narrowPhase(e,h,g.type!=f.id_BodyType_DYNAMIC||j.type!=f.id_BodyType_DYNAMIC,d.arb,!1):a.continuousEvent(e,h,g.type!=f.id_BodyType_DYNAMIC||j.type!=f.id_BodyType_DYNAMIC,
d.arb,!1),null==d.arb?null!=c&&(c.pair=null):d.arb.pair=d),c=d),d=d.next)},bodiesUnderPoint:function(a,b,c,d){this.sync_broadphase();a=K.get(a,b,null);d=null==d?new fe:d;if(null!=this.stree.root){null==this.treeStack&&(this.treeStack=new If);for(this.treeStack.add(this.stree.root);null!=this.treeStack.head;)if(b=this.treeStack.pop_unsafe(),b.aabb.containsPoint(a))if(null==b.child1){var e=b.shape.body.outer;if(!d.has(e)&&(null==c||b.shape.filter.shouldCollide(c)))b.shape.type==f.id_ShapeType_CIRCLE?
w.circleContains(b.shape.circle,a)&&d.push(e):w.polyContains(b.shape.polygon,a)&&d.push(e)}else null!=b.child1&&this.treeStack.add(b.child1),null!=b.child2&&this.treeStack.add(b.child2)}if(null!=this.dtree.root){null==this.treeStack&&(this.treeStack=new If);for(this.treeStack.add(this.dtree.root);null!=this.treeStack.head;)if(b=this.treeStack.pop_unsafe(),b.aabb.containsPoint(a))if(null==b.child1){if(e=b.shape.body.outer,!d.has(e)&&(null==c||b.shape.filter.shouldCollide(c)))b.shape.type==f.id_ShapeType_CIRCLE?
w.circleContains(b.shape.circle,a)&&d.push(e):w.polyContains(b.shape.polygon,a)&&d.push(e)}else null!=b.child1&&this.treeStack.add(b.child1),null!=b.child2&&this.treeStack.add(b.child2)}null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=K.zpp_pool;K.zpp_pool=a;return d},__class__:Hf});var bb=function(){this.waket=0;this.sleep=!1;this.comps=null;this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.comps=new Gg};
h["zpp_nape.space.ZPP_Island"]=bb;bb.__name__=!0;bb.prototype={inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.next;this.pop();return a},__class__:bb};var hb=function(){this.woken=!1;this.waket=0;this.sleeping=!1;this.body=this.constraint=
this.island=null;this.isBody=!1;this.rank=0;this.next=this.parent=null;this.sleeping=!1;this.island=null;this.parent=this;this.rank=0;this.woken=!1};h["zpp_nape.space.ZPP_Component"]=hb;hb.__name__=!0;hb.prototype={__class__:hb};var Ja=function(){this.freed=this.lazydel=!1;this.length=0;this._inuse=this.modified=this.pushmod=!1;this.int1=this.int2=this.next=null;this.id=this.di=0;this.arbiters=new Cd};h["zpp_nape.space.ZPP_CallbackSet"]=Ja;Ja.__name__=!0;Ja.get=function(a,b){var c;null==Ja.zpp_pool?
c=new Ja:(c=Ja.zpp_pool,Ja.zpp_pool=c.next,c.next=null);c.freed=!1;c.lazydel=!1;c.COLLISIONstate=f.id_PreFlag_ACCEPT;c.COLLISIONstamp=0;c.SENSORstate=f.id_PreFlag_ACCEPT;c.SENSORstamp=0;c.FLUIDstate=f.id_PreFlag_ACCEPT;c.FLUIDstamp=0;a.id<b.id?(c.int1=a,c.int2=b):(c.int1=b,c.int2=a);c.id=c.int1.id;c.di=c.int2.id;return c};Ja.prototype={inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=
c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},remove_arb:function(a){this.arbiters.inlined_try_remove(a)},empty_arb:function(a){var b;b=!0;for(var c=this.arbiters.head;null!=c;)if(0==(c.elt.type&a))c=c.next;else{b=!1;break}return b},sleeping:function(){var a;a=!0;for(var b=this.arbiters.head;null!=b;)if(b.elt.sleeping)b=b.next;else{a=!1;break}return a},__class__:Ja};var Hg=function(a){this.cbsets=
this.space=null;null==cb.zpp_pool?this.cbsets=new cb:(this.cbsets=cb.zpp_pool,cb.zpp_pool=this.cbsets.next,this.cbsets.next=null);null;this.cbsets.lt=B.setlt;this.space=a};h["zpp_nape.space.ZPP_CbSetManager"]=Hg;Hg.__name__=!0;Hg.prototype={get:function(a){if(null==a.head)return null;var b;null==B.zpp_pool?b=new B:(b=B.zpp_pool,B.zpp_pool=b.next,b.next=null);null;var c=b.cbTypes;b.cbTypes=a;var d=this.cbsets.find_weak(b);null!=d?a=d.data:(a=B.get(a),this.cbsets.insert(a),a.manager=this);b.cbTypes=
c;b.free();b.next=B.zpp_pool;B.zpp_pool=b;return a},remove:function(a){for(this.cbsets.remove(a);null!=a.cbpairs.head;){var b=a.cbpairs.pop_unsafe();b.a!=b.b&&(a==b.a?b.b.cbpairs.remove(b):b.a.cbpairs.remove(b));b.a=b.b=null;b.listeners.clear();b.next=wa.zpp_pool;wa.zpp_pool=b}a.manager=null},validate:function(){if(!this.cbsets.empty()){for(var a=this.cbsets.parent;null!=a.prev;)a=a.prev;for(;null!=a;)if(a.data.validate(),null!=a.next)for(a=a.next;null!=a.prev;)a=a.prev;else{for(;null!=a.parent&&
a==a.parent.next;)a=a.parent;a=a.parent}}},pair:function(a,b){for(var c=null,d=(a.cbpairs.length<b.cbpairs.length?a.cbpairs:b.cbpairs).head;null!=d;){var e=d.elt;if(e.a==a&&e.b==b||e.a==b&&e.b==a){c=e;break}d=d.next}null==c&&(c=wa.get(a,b),a.cbpairs.add(c),b!=a&&b.cbpairs.add(c));c.zip_listeners&&(c.zip_listeners=!1,c.__validate());return c},__class__:Hg};var zg=function(a,b){this.precb=this.prelisteners=null;this.continuous=!1;this.toiEvents=null;this.pre_dt=0;this.c_arbiters_true=this.c_arbiters_false=
this.f_arbiters=this.s_arbiters=this.live=this.wrap_live=this.live_constraints=this.wrap_livecon=this.staticsleep=this.islands=this.listeners=this.wrap_listeners=this.callbacks=this.callbackset_list=this.cbsets=null;this.sortcontacts=!1;this.time=0;this.midstep=!1;this.global_lin_drag=this.global_ang_drag=this.stamp=0;this.wrap_gravity=this.bodies=this.wrap_bodies=this.compounds=this.wrap_compounds=this.constraints=this.wrap_constraints=this.kinematics=this.bphase=this.__static=null;this.gravityx=
this.gravityy=0;this.outer=null;this.toiEvents=new Ig;this.global_ang_drag=this.global_lin_drag=0.015;this.precb=new of;this.precb.zpp_inner=new Tb;this.sortcontacts=!0;this.pre_dt=0;var c;if(!(c=null==b))null==f.Broadphase_DYNAMIC_AABB_TREE&&(f.internal=!0,f.Broadphase_DYNAMIC_AABB_TREE=new Wc,f.internal=!1),c=b==f.Broadphase_DYNAMIC_AABB_TREE;c?this.bphase=new Hf(this):(null==f.Broadphase_SWEEP_AND_PRUNE&&(f.internal=!0,f.Broadphase_SWEEP_AND_PRUNE=new Wc,f.internal=!1),b==f.Broadphase_SWEEP_AND_PRUNE&&
(this.bphase=new Jf(this)));this.time=0;null!=a?(this.gravityx=a.x,this.gravityy=a.y):this.gravityy=this.gravityx=0;this.bodies=new jd;this.wrap_bodies=ka.get(this.bodies);this.wrap_bodies.zpp_inner.adder=n(this,this.bodies_adder);this.wrap_bodies.zpp_inner.subber=n(this,this.bodies_subber);this.compounds=new Qd;this.wrap_compounds=Vc.get(this.compounds);this.wrap_compounds.zpp_inner.adder=n(this,this.compounds_adder);this.wrap_compounds.zpp_inner.subber=n(this,this.compounds_subber);this.kinematics=
new jd;this.c_arbiters_true=new Kf;this.c_arbiters_false=new Kf;this.f_arbiters=new Jg;this.s_arbiters=new Kg;this.islands=new bb;this.live=new jd;this.wrap_live=ka.get(this.live,!0);this.staticsleep=new jd;this.constraints=new tc;this.wrap_constraints=Nb.get(this.constraints);this.wrap_constraints.zpp_inner.adder=n(this,this.constraints_adder);this.wrap_constraints.zpp_inner.subber=n(this,this.constraints_subber);this.live_constraints=new tc;this.wrap_livecon=Nb.get(this.live_constraints,!0);this.__static=
Uc.__static();this.__static.zpp_inner.space=this;this.callbacks=new Tb;this.midstep=!1;this.listeners=new Lf;this.wrap_listeners=Rc.get(this.listeners);this.wrap_listeners.zpp_inner.adder=n(this,this.listeners_adder);this.wrap_listeners.zpp_inner.subber=n(this,this.listeners_subber);this.callbackset_list=new Ja;this.mrca1=new ac;this.mrca2=new ac;this.prelisteners=new Id;this.cbsets=new Hg(this)};h["zpp_nape.space.ZPP_Space"]=zg;zg.__name__=!0;zg.prototype={getgravity:function(){this.wrap_gravity=
x.get(this.gravityx,this.gravityy,null);this.wrap_gravity.zpp_inner._inuse=!0;this.wrap_gravity.zpp_inner._invalidate=n(this,this.gravity_invalidate);this.wrap_gravity.zpp_inner._validate=n(this,this.gravity_validate)},gravity_invalidate:function(a){this.gravityx=a.x;this.gravityy=a.y;for(var a=new Qd,b=this.bodies.head;null!=b;){var c=b.elt;c.world||(c.component.waket=this.stamp+(this.midstep?0:1),c.type==f.id_BodyType_KINEMATIC&&(c.kinematicDelaySleep=!0),c.component.sleeping&&this.really_wake(c,
!1));b=b.next}for(b=this.compounds.head;null!=b;)a.add(b.elt),b=b.next;for(;null!=a.head;){b=a.pop_unsafe();for(c=b.bodies.head;null!=c;){var d=c.elt;d.world||(d.component.waket=this.stamp+(this.midstep?0:1),d.type==f.id_BodyType_KINEMATIC&&(d.kinematicDelaySleep=!0),d.component.sleeping&&this.really_wake(d,!1));c=c.next}for(b=b.compounds.head;null!=b;)a.add(b.elt),b=b.next}},gravity_validate:function(){this.wrap_gravity.zpp_inner.x=this.gravityx;this.wrap_gravity.zpp_inner.y=this.gravityy},bodies_adder:function(a){return a.zpp_inner.space!=
this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(a),this.addBody(a.zpp_inner),!0):!1},bodies_subber:function(a){this.remBody(a.zpp_inner)},compounds_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_compounds.remove(a),this.addCompound(a.zpp_inner),!0):!1},compounds_subber:function(a){this.remCompound(a.zpp_inner)},constraints_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(a),
this.addConstraint(a.zpp_inner),!0):!1},constraints_subber:function(a){this.remConstraint(a.zpp_inner)},listeners_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(a),this.addListener(a.zpp_inner),!0):!1},listeners_subber:function(a){this.remListener(a.zpp_inner)},addListener:function(a){a.space=this;a.addedToSpace();null!=a.interaction&&null},remListener:function(a){null!=a.interaction&&null;a.removedFromSpace();a.space=
null},add_callbackset:function(a){a.int1.cbsets.inlined_add(a);a.int2.cbsets.inlined_add(a);this.callbackset_list.inlined_add(a)},remove_callbackset:function(a){a.lazydel=!0;a.int1.cbsets.inlined_try_remove(a);a.int2.cbsets.inlined_try_remove(a)},transmitType:function(a,b){a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!1));a.type==f.id_BodyType_DYNAMIC?this.live.remove(a):a.type==f.id_BodyType_KINEMATIC?
(this.kinematics.remove(a),this.staticsleep.remove(a)):a.type==f.id_BodyType_STATIC&&this.staticsleep.remove(a);a.type=b;a.type==f.id_BodyType_KINEMATIC&&this.kinematics.add(a);a.type==f.id_BodyType_STATIC&&this.static_validation(a);a.component.sleeping=!0;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0))},added_shape:function(a,b){null==b&&(b=!1);if(!b){var c=a.body;c.world||(c.component.waket=
this.stamp+(this.midstep?0:1),c.type==f.id_BodyType_KINEMATIC&&(c.kinematicDelaySleep=!0),c.component.sleeping&&this.really_wake(c,!1))}this.bphase.insert(a);a.addedToSpace()},removed_shape:function(a,b){null==b&&(b=!1);var c=this,d=a.body;b||d.wake();for(var e=null,g=d.arbiters.head;null!=g;){var h=[g.elt];if(h[0].ws1==a||h[0].ws2==a){if(0!=h[0].present){this.MRCA_chains(h[0].ws1,h[0].ws2);for(g=this.mrca1.head;null!=g;){for(var j=g.elt,i=this.mrca2.head;null!=i;){var l=i.elt,k=j.cbSet,m=l.cbSet;
k.validate();m.validate();k.manager.pair(k,m).empty_intersection()||(l=[S.get(j,l)],l[0].remove_arb(h[0]),h[0].present--,k.manager.pair(k,m).forall(f.id_CbEvent_END,function(a,b){return function(d){if(0!=(d.itype&b[0].type)&&a[0].empty_arb(d.itype)){var e=c.push_callback(d);e.event=f.id_CbEvent_END;S.int_callback(a[0],d,e);e.set=a[0]}}}(l,h)),null==l[0].arbiters.head&&this.remove_callbackset(l[0]));i=i.next}g=g.next}}h[0].b1!=d&&h[0].b1.type==f.id_BodyType_DYNAMIC&&(g=h[0].b1,g.world||(g.component.waket=
this.stamp+(this.midstep?0:1),g.type==f.id_BodyType_KINEMATIC&&(g.kinematicDelaySleep=!0),g.component.sleeping&&this.really_wake(g,!1)));h[0].b2!=d&&h[0].b2.type==f.id_BodyType_DYNAMIC&&(g=h[0].b2,g.world||(g.component.waket=this.stamp+(this.midstep?0:1),g.type==f.id_BodyType_KINEMATIC&&(g.kinematicDelaySleep=!0),g.component.sleeping&&this.really_wake(g,!1)));h[0].cleared=!0;(null==d||h[0].b2==d)&&h[0].b1.arbiters.inlined_try_remove(h[0]);(null==d||h[0].b1==d)&&h[0].b2.arbiters.inlined_try_remove(h[0]);
null!=h[0].pair&&(h[0].pair.arb=null,h[0].pair=null);h[0].active=!1;this.f_arbiters.modified=!0;g=d.arbiters.erase(e)}else e=g,g=g.next}this.bphase.remove(a);a.removedFromSpace()},addConstraint:function(a){a.space=this;a.addedToSpace();a.active&&(a.component.sleeping=!0,this.wake_constraint(a,!0))},remConstraint:function(a){a.active&&(this.wake_constraint(a,!0),this.live_constraints.remove(a));a.removedFromSpace();a.space=null},addCompound:function(a){a.space=this;a.addedToSpace();for(var b=a.bodies.head;null!=
b;)this.addBody(b.elt),b=b.next;for(b=a.constraints.head;null!=b;)this.addConstraint(b.elt),b=b.next;for(a=a.compounds.head;null!=a;)this.addCompound(a.elt),a=a.next},remCompound:function(a){for(var b=a.bodies.head;null!=b;)this.remBody(b.elt),b=b.next;for(b=a.constraints.head;null!=b;)this.remConstraint(b.elt),b=b.next;for(b=a.compounds.head;null!=b;)this.remCompound(b.elt),b=b.next;a.removedFromSpace();a.space=null},addBody:function(a,b){null==b&&(b=-1);a.space=this;a.addedToSpace();a.component.sleeping=
!0;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0));for(var c=a.shapes.head;null!=c;)this.added_shape(c.elt,!0),c=c.next;a.type==f.id_BodyType_STATIC?this.static_validation(a):a.type!=f.id_BodyType_DYNAMIC&&b!=f.id_BodyType_KINEMATIC&&this.kinematics.add(a)},remBody:function(a,b){null==b&&(b=-1);a.type==f.id_BodyType_STATIC?(a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==
f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.staticsleep.remove(a)):a.type==f.id_BodyType_DYNAMIC?(a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.live.remove(a)):(b!=f.id_BodyType_KINEMATIC&&this.kinematics.remove(a),a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=
!0),a.component.sleeping&&this.really_wake(a,!0)),this.staticsleep.remove(a));for(var c=a.shapes.head;null!=c;)this.removed_shape(c.elt,!0),c=c.next;a.removedFromSpace();a.space=null},bodiesUnderPoint:function(a,b,c,d){return this.bphase.bodiesUnderPoint(a,b,c,d)},push_callback:function(a){var b;null==Tb.zpp_pool?b=new Tb:(b=Tb.zpp_pool,Tb.zpp_pool=b.next,b.next=null);null;this.callbacks.push(b);b.listener=a;return b},step:function(a,b,c){var d=this;this.time+=a;this.pre_dt=a;this.midstep=!0;this.stamp++;
this.validation();this.bphase.broadphase(this,!0);this.prestep(a);if(this.sortcontacts){var e=this.c_arbiters_false;if(null!=e.head&&null!=e.head.next){var g=e.head,h=null,j=null,i=null,l=null,k=1,m,n,p;do{m=0;j=g;for(h=g=null;null!=j;){m++;i=j;n=0;for(p=k;null!=i&&n<k;)n++,i=i.next;for(;0<n||0<p&&null!=i;)0==n?(l=i,i=i.next,p--):0==p||null==i?(l=j,j=j.next,n--):(j.elt.active&&i.elt.active?j.elt.oc1.dist<i.elt.oc1.dist:1)?(l=j,j=j.next,n--):(l=i,i=i.next,p--),null!=h?h.next=l:g=l,h=l;j=i}h.next=null;
k<<=1}while(1<m);e.head=g;e.modified=!0;e.pushmod=!0}}this.updateVel(a);this.warmStart();this.iterateVel(b);for(b=this.kinematics.head;null!=b;)e=b.elt,e.pre_posx=e.posx,e.pre_posy=e.posy,e.pre_rot=e.rot,b=b.next;for(b=this.live.head;null!=b;)e=b.elt,e.pre_posx=e.posx,e.pre_posy=e.posy,e.pre_rot=e.rot,b=b.next;this.updatePos(a);this.continuous=!0;this.continuousCollisions(a);this.continuous=!1;this.iteratePos(c);for(c=this.kinematics.head;null!=c;)b=c.elt,e=b.pre_rot!=b.rot,!(b.posx==b.pre_posx&&
b.posy==b.pre_posy)&&b.invalidate_pos(),e&&b.invalidate_rot(),c=c.next;for(c=this.live.head;null!=c;)b=c.elt,e=b.pre_rot!=b.rot,!(b.posx==b.pre_posx&&b.posy==b.pre_posy)&&b.invalidate_pos(),e&&b.invalidate_rot(),c=c.next;c=null;for(b=this.staticsleep.head;null!=b;)e=b.elt,e.type!=f.id_BodyType_KINEMATIC||0==e.velx&&0==e.vely&&0==e.angvel?e.kinematicDelaySleep?(e.kinematicDelaySleep=!1,b=b.next):(e.component.sleeping=!0,b=this.staticsleep.inlined_erase(c)):(c=b,b=b.next);this.doForests(a);this.sleepArbiters();
this.midstep=!1;c=null;for(a=this.callbackset_list.next;null!=a;)b=[a],null==b[0].arbiters.head?(a=this.callbackset_list.inlined_erase(c),b=b[0],b.int1=b.int2=null,b.id=b.di=-1,b.freed=!0,null,b.next=Ja.zpp_pool,Ja.zpp_pool=b):(c=[b[0].sleeping()],B.find_all(b[0].int1.cbSet,b[0].int2.cbSet,f.id_CbEvent_ONGOING,function(a,b){return function(c){if((!a[0]||c.allowSleepingCallbacks)&&!b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_ONGOING;S.int_callback(b[0],c,e);e.set=b[0]}}}(c,
b)),c=a,a=a.next);for(;!this.callbacks.empty();)a=this.callbacks.pop(),a.listener.type==f.id_ListenerType_BODY?a.listener.body.handler(a.wrapper_body()):a.listener.type==f.id_ListenerType_CONSTRAINT?a.listener.constraint.handler(a.wrapper_con()):a.listener.type==f.id_ListenerType_INTERACTION&&a.listener.interaction.handleri(a.wrapper_int()),a.int1=a.int2=null,a.body=null,a.constraint=null,a.listener=null,null!=a.wrap_arbiters&&(a.wrap_arbiters.zpp_inner.inner=null),a.set=null,a.next=Tb.zpp_pool,Tb.zpp_pool=
a},continuousCollisions:function(a){var b=2*Math.PI/a;this.bphase.broadphase(this,!1);for(var c=0;1>c&&null!=this.toiEvents.head;){for(var d=null,c=2,e=!1,g=null,h=null,j=this.toiEvents.head;null!=j;){var i=j.elt,l=i.s1.body,k=i.s2.body;if(l.sweepFrozen&&k.sweepFrozen)if(0!=i.toi&&w.testCollide_safe(i.s1,i.s2))i.toi=0;else{j=this.toiEvents.erase(h);i.next=qa.zpp_pool;qa.zpp_pool=i;continue}if(i.frozen1!=l.sweepFrozen||i.frozen2!=k.sweepFrozen)if(i.kinematic){j=this.toiEvents.erase(h);i.next=qa.zpp_pool;
qa.zpp_pool=i;continue}else if(i.frozen1=l.sweepFrozen,i.frozen2=k.sweepFrozen,i.frozen1&&(l=i.s1,i.s1=i.s2,i.s2=l,i.frozen1=!1,i.frozen2=!0),ma.staticSweep(i,a,0,m.collisionSlopCCD),0>i.toi){j=this.toiEvents.erase(h);i.next=qa.zpp_pool;qa.zpp_pool=i;continue}if(0<=i.toi&&(i.toi<c||!e&&i.kinematic))d=i,c=i.toi,e=i.kinematic,g=h;h=j;j=j.next}if(null==d)break;this.toiEvents.erase(g);c=d.toi;e=d.s1.body;g=d.s2.body;e.sweepFrozen||(e.sweepIntegrate(c*a),e.sweepValidate(d.s1));g.sweepFrozen||(g.sweepIntegrate(c*
a),g.sweepValidate(d.s2));h=this.narrowPhase(d.s1,d.s2,!0,d.arbiter,!0);null==h?null!=d.arbiter&&null!=d.arbiter.pair&&(d.arbiter.pair.arb=null,d.arbiter.pair=null):!this.presteparb(h,a,!0)&&h.type==C.COL&&h.active&&0!=(h.immState&f.id_ImmState_ACCEPT)&&(h.colarb.warmStart(),h.colarb.applyImpulseVel(),h.colarb.applyImpulseVel(),h.colarb.applyImpulseVel(),h.colarb.applyImpulseVel(),e.sweep_angvel=e.angvel%b,g.sweep_angvel=g.angvel%b);null!=h&&h.active&&0!=(h.immState&f.id_ImmState_ACCEPT)&&h.type==
C.COL&&(!e.sweepFrozen&&e.type!=f.id_BodyType_KINEMATIC&&(e.sweepFrozen=!0,e.angvel=d.failed?e.sweep_angvel=0:d.slipped?e.sweep_angvel*=m.angularCCDSlipScale:e.sweep_angvel),!g.sweepFrozen&&g.type!=f.id_BodyType_KINEMATIC&&(g.sweepFrozen=!0,g.angvel=d.failed?g.sweep_angvel=0:d.slipped?g.sweep_angvel*=m.angularCCDSlipScale:g.sweep_angvel))}for(;null!=this.toiEvents.head;)b=this.toiEvents.pop_unsafe(),b.next=qa.zpp_pool,qa.zpp_pool=b;for(b=this.kinematics.head;null!=b;)d=b.elt,d.sweepIntegrate(a),d.sweepTime=
0,b=b.next;for(b=this.live.head;null!=b;)d=b.elt,d.sweepFrozen||d.sweepIntegrate(a),d.sweepTime=0,b=b.next},continuousEvent:function(a,b,c,d){if(a.body.sweepFrozen&&b.body.sweepFrozen||a.body.disableCCD||b.body.disableCCD||null!=d&&null==d.colarb||0>=this.interactionType(a,b,a.body,b.body))return d;var e=a.body,g=b.body;if(c||e.bullet||g.bullet){var h;null==qa.zpp_pool?h=new qa:(h=qa.zpp_pool,qa.zpp_pool=h.next,h.next=null);h.failed=!1;h.s1=h.s2=null;h.arbiter=null;e=e.type==f.id_BodyType_KINEMATIC||
g.type==f.id_BodyType_KINEMATIC;c&&!e?(a.body.type!=f.id_BodyType_DYNAMIC?(h.s2=a,h.s1=b):(h.s1=a,h.s2=b),h.kinematic=!1,ma.staticSweep(h,this.pre_dt,0,m.collisionSlopCCD)):(h.s1=a,h.s2=b,h.kinematic=e,h.s1.body.sweepFrozen||h.s2.body.sweepFrozen?(h.s1.body.sweepFrozen&&(a=h.s1,h.s1=h.s2,h.s2=a,h.frozen1=!1,h.frozen2=!0),ma.staticSweep(h,this.pre_dt,0,m.collisionSlopCCD)):ma.dynamicSweep(h,this.pre_dt,0,m.collisionSlopCCD));c&&0>h.toi||h.failed?(c=h,c.next=qa.zpp_pool,qa.zpp_pool=c):(this.toiEvents.add(h),
h.frozen1=h.s1.body.sweepFrozen,h.frozen2=h.s2.body.sweepFrozen,h.arbiter=null!=d?d.colarb:null)}return d},bodyCbWake:function(a){if(a.type==f.id_BodyType_DYNAMIC&&null!=a.cbSet)if(this.midstep)for(var b=a.cbSet.bodylisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_WAKE&&(c=this.push_callback(c),c.event=f.id_CbEvent_WAKE,c.body=a);b=b.next}else a.component.woken=!0},bodyCbSleep:function(a){if(a.type==f.id_BodyType_DYNAMIC&&null!=a.cbSet)for(var b=a.cbSet.bodylisteners.head;null!=b;){var c=
b.elt;c.event==f.id_CbEvent_SLEEP&&(c=this.push_callback(c),c.event=f.id_CbEvent_SLEEP,c.body=a);b=b.next}},constraintCbWake:function(a){if(null!=a.cbSet)if(this.midstep)for(var b=a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_WAKE&&(c=this.push_callback(c),c.event=f.id_CbEvent_WAKE,c.constraint=a);b=b.next}else a.component.woken=!0},constraintCbSleep:function(a){if(null!=a.cbSet)for(var b=a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_SLEEP&&(c=this.push_callback(c),
c.event=f.id_CbEvent_SLEEP,c.constraint=a);b=b.next}},constraintCbBreak:function(a){if(null!=a.cbSet)for(var b=a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_BREAK&&(c=this.push_callback(c),c.event=f.id_CbEvent_BREAK,c.constraint=a);b=b.next}},nullListenerType:function(a,b){for(var c=new ac,d=a.interactors.head;null!=d;)c.add(d.elt),d=d.next;if(a!=b)for(d=b.interactors.head;null!=d;)c.add(d.elt),d=d.next;for(;null!=c.head;)if(d=c.pop_unsafe(),null!=d.icompound){for(var d=d.icompound,
e=d.bodies.head;null!=e;)c.add(e.elt),e=e.next;for(d=d.compounds.head;null!=d;)c.add(d.elt),d=d.next}else{e=null!=d.ibody?d.ibody:d.ishape.body;d=null!=d.ishape?d.ishape:null;for(e=e.arbiters.head;null!=e;){var f=e.elt;if(0!=f.present&&(null==d||f.ws1==d||f.ws2==d)){this.MRCA_chains(f.ws1,f.ws2);for(f=this.mrca1.head;null!=f;){var g=f.elt;if(!(g.cbSet!=a&&g.cbSet!=b))for(var h=this.mrca2.head;null!=h;){var i=h.elt;if(!(g.cbSet==a&&i.cbSet!=b||g.cbSet==b&&i.cbSet!=a))if(i=S.get(g,i),null!=i){for(;null!=
i.arbiters.head;)i.arbiters.pop_unsafe().present--;this.remove_callbackset(i)}h=h.next}f=f.next}}e=e.next}}},nullInteractorType:function(a,b){null==b&&(b=a);if(null!=a.icompound){for(var c=a.icompound,d=c.bodies.head;null!=d;)this.nullInteractorType(d.elt,b),d=d.next;for(c=c.compounds.head;null!=c;)this.nullInteractorType(c.elt,b),c=c.next}else{d=null!=a.ibody?a.ibody:a.ishape.body;c=null!=a.ishape?a.ishape:null;for(d=d.arbiters.head;null!=d;){var e=d.elt;if(0!=e.present&&(null==c||e.ws1==c||e.ws2==
c)){this.MRCA_chains(e.ws1,e.ws2);for(var f=this.mrca1.head;null!=f;){for(var g=f.elt,h=this.mrca2.head;null!=h;){var i=h.elt;g!=b&&i!=b||(i=S.get(g,i),null!=i&&(e.present--,i.remove_arb(e),null==i.arbiters.head&&this.remove_callbackset(i)));h=h.next}f=f.next}}d=d.next}}},freshListenerType:function(a,b){for(var c=new ac,d=a.interactors.head;null!=d;)c.add(d.elt),d=d.next;if(a!=b)for(d=b.interactors.head;null!=d;)c.add(d.elt),d=d.next;for(;null!=c.head;)if(d=c.pop_unsafe(),null!=d.icompound){for(var d=
d.icompound,e=d.bodies.head;null!=e;)c.add(e.elt),e=e.next;for(d=d.compounds.head;null!=d;)c.add(d.elt),d=d.next}else{e=null!=d.ibody?d.ibody:d.ishape.body;d=null!=d.ishape?d.ishape:null;for(e=e.arbiters.head;null!=e;){var f=e.elt;if(f.presentable&&(null==d||f.ws1==d||f.ws2==d)){this.MRCA_chains(f.ws1,f.ws2);for(var g=this.mrca1.head;null!=g;){var h=g.elt;if(!(h.cbSet!=a&&h.cbSet!=b))for(var i=this.mrca2.head;null!=i;){var l=i.elt;if(!(h.cbSet==a&&l.cbSet!=b||h.cbSet==b&&l.cbSet!=a)){var k=S.get(h,
l);null==k&&(k=Ja.get(h,l),this.add_callbackset(k));if(l=!k.arbiters.inlined_has(f))k.arbiters.inlined_add(f),l=!0;l&&f.present++}i=i.next}g=g.next}}e=e.next}}},freshInteractorType:function(a,b){null==b&&(b=a);if(null!=a.icompound){for(var c=a.icompound,d=c.bodies.head;null!=d;)this.freshInteractorType(d.elt,b),d=d.next;for(c=c.compounds.head;null!=c;)this.freshInteractorType(c.elt,b),c=c.next}else{d=null!=a.ibody?a.ibody:a.ishape.body;c=null!=a.ishape?a.ishape:null;for(d=d.arbiters.head;null!=d;){var e=
d.elt;if(e.presentable&&(null==c||e.ws1==c||e.ws2==c)){this.MRCA_chains(e.ws1,e.ws2);for(var f=this.mrca1.head;null!=f;){for(var g=f.elt,h=this.mrca2.head;null!=h;){var i=h.elt;if(!(g!=b&&i!=b)){var l=g.cbSet,k=i.cbSet;l.validate();k.validate();if(!l.manager.pair(l,k).empty_intersection()){l=S.get(g,i);null==l&&(l=Ja.get(g,i),this.add_callbackset(l));if(i=!l.arbiters.inlined_has(e))l.arbiters.inlined_add(e),i=!0;i&&e.present++}}h=h.next}f=f.next}}d=d.next}}},wakeCompound:function(a){for(var b=a.bodies.head;null!=
b;){var c=b.elt;c.world||(c.component.waket=this.stamp+(this.midstep?0:1),c.type==f.id_BodyType_KINEMATIC&&(c.kinematicDelaySleep=!0),c.component.sleeping&&this.really_wake(c,!1));b=b.next}for(b=a.constraints.head;null!=b;)this.wake_constraint(b.elt),b=b.next;for(a=a.compounds.head;null!=a;)this.wakeCompound(a.elt),a=a.next},wakeIsland:function(a){for(;null!=a.comps.head;){var b=a.comps.pop_unsafe();b.waket=this.stamp+(this.midstep?0:1);if(b.isBody){var c=b.body;this.live.add(c);for(var d=c.arbiters.head;null!=
d;){var e=d.elt;e.sleeping&&(e.sleeping=!1,e.up_stamp+=this.stamp-e.sleep_stamp,e.type==C.COL?(e=e.colarb,e.stat?this.c_arbiters_true.inlined_add(e):this.c_arbiters_false.inlined_add(e)):e.type==C.FLUID?this.f_arbiters.inlined_add(e.fluidarb):this.s_arbiters.inlined_add(e.sensorarb));d=d.next}this.bodyCbWake(c);b.sleeping=!1;b.island=null;b.parent=b;b.rank=0;if(c.type!=f.id_BodyType_STATIC)for(b=c.shapes.head;null!=b;)c=b.elt,null!=c.node&&this.bphase.sync(c),b=b.next}else c=b.constraint,this.live_constraints.inlined_add(c),
this.constraintCbWake(c),b.sleeping=!1,b.island=null,b.parent=b,b.rank=0}a.next=bb.zpp_pool;bb.zpp_pool=a},non_inlined_wake:function(a,b){null==b&&(b=!1);a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,b))},really_wake:function(a,b){null==b&&(b=!1);if(null==a.component.island){a.component.sleeping=!1;a.type==f.id_BodyType_KINEMATIC||a.type==f.id_BodyType_STATIC?this.staticsleep.inlined_add(a):
this.live.inlined_add(a);for(var c=a.constraints.head;null!=c;){var d=c.elt;d.space==this&&this.wake_constraint(d);c=c.next}for(c=a.arbiters.head;null!=c;){d=c.elt;if(d.sleeping)if(d.sleeping=!1,d.up_stamp+=this.stamp+(this.midstep?0:1)-d.sleep_stamp,d.type==C.COL){var e=d.colarb;e.stat?this.c_arbiters_true.inlined_add(e):this.c_arbiters_false.inlined_add(e)}else d.type==C.FLUID?this.f_arbiters.inlined_add(d.fluidarb):this.s_arbiters.inlined_add(d.sensorarb);d.type!=C.SENSOR&&!d.cleared&&d.up_stamp>=
this.stamp&&0!=(d.immState&f.id_ImmState_ACCEPT)&&(d.b1.type==f.id_BodyType_DYNAMIC&&d.b1.component.sleeping&&(e=d.b1,e.world||(e.component.waket=this.stamp+(this.midstep?0:1),e.type==f.id_BodyType_KINEMATIC&&(e.kinematicDelaySleep=!0),e.component.sleeping&&this.really_wake(e,!1))),d.b2.type==f.id_BodyType_DYNAMIC&&d.b2.component.sleeping&&(d=d.b2,d.world||(d.component.waket=this.stamp+(this.midstep?0:1),d.type==f.id_BodyType_KINEMATIC&&(d.kinematicDelaySleep=!0),d.component.sleeping&&this.really_wake(d,
!1))));c=c.next}!b&&a.type==f.id_BodyType_DYNAMIC&&this.bodyCbWake(a);if(!b&&!this.bphase.is_sweep&&a.type!=f.id_BodyType_STATIC)for(c=a.shapes.head;null!=c;)d=c.elt,null!=d.node&&this.bphase.sync(d),c=c.next}else this.wakeIsland(a.component.island)},wake_constraint:function(a,b){null==b&&(b=!1);return a.active&&(a.component.waket=this.stamp+(this.midstep?0:1),a.component.sleeping)?(null==a.component.island?(a.component.sleeping=!1,this.live_constraints.inlined_add(a),a.wake_connected(),b||this.constraintCbWake(a)):
this.wakeIsland(a.component.island),!0):!1},doForests:function(a){for(var b=this.c_arbiters_false.head;null!=b;){var c=b.elt;if(!c.cleared&&c.up_stamp==this.stamp&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.b1.type==f.id_BodyType_DYNAMIC&&c.b2.type==f.id_BodyType_DYNAMIC){var d;if(c.b1.component==c.b1.component.parent)d=c.b1.component;else{d=c.b1.component;for(var e=null;d!=d.parent;){var g=d.parent;d.parent=e;e=d;d=g}for(;null!=e;)g=e.parent,e.parent=d,e=g}if(c.b2.component==c.b2.component.parent)c=
c.b2.component;else{c=c.b2.component;for(e=null;c!=c.parent;)g=c.parent,c.parent=e,e=c,c=g;for(;null!=e;)g=e.parent,e.parent=c,e=g}d!=c&&(d.rank<c.rank?d.parent=c:d.rank>c.rank?c.parent=d:(c.parent=d,d.rank++))}b=b.next}for(b=this.f_arbiters.head;null!=b;){c=b.elt;if(!c.cleared&&c.up_stamp==this.stamp&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.b1.type==f.id_BodyType_DYNAMIC&&c.b2.type==f.id_BodyType_DYNAMIC){if(c.b1.component==c.b1.component.parent)d=c.b1.component;else{d=c.b1.component;for(e=null;d!=
d.parent;)g=d.parent,d.parent=e,e=d,d=g;for(;null!=e;)g=e.parent,e.parent=d,e=g}if(c.b2.component==c.b2.component.parent)c=c.b2.component;else{c=c.b2.component;for(e=null;c!=c.parent;)g=c.parent,c.parent=e,e=c,c=g;for(;null!=e;)g=e.parent,e.parent=c,e=g}d!=c&&(d.rank<c.rank?d.parent=c:d.rank>c.rank?c.parent=d:(c.parent=d,d.rank++))}b=b.next}for(b=this.live_constraints.head;null!=b;)b.elt.forest(),b=b.next;for(;null!=this.live.head;){d=this.live.inlined_pop_unsafe();b=d.component;if(b==b.parent)c=
b;else{c=b;for(e=null;c!=c.parent;)g=c.parent,c.parent=e,e=c,c=g;for(;null!=e;)g=e.parent,e.parent=c,e=g}null==c.island&&(null==bb.zpp_pool?c.island=new bb:(c.island=bb.zpp_pool,bb.zpp_pool=c.island.next,c.island.next=null),c.island.waket=0,this.islands.inlined_add(c.island),c.island.sleep=!0);b.island=c.island;b.island.comps.inlined_add(b);d=d.atRest(a);b.island.sleep=b.island.sleep&&d;b.waket>b.island.waket&&(b.island.waket=b.waket)}for(;null!=this.live_constraints.head;){a=this.live_constraints.inlined_pop_unsafe().component;
if(a==a.parent)b=a;else{b=a;for(d=null;b!=b.parent;)c=b.parent,b.parent=d,d=b,b=c;for(;null!=d;)c=d.parent,d.parent=b,d=c}a.island=b.island;a.island.comps.inlined_add(a);a.waket>a.island.waket&&(a.island.waket=a.waket)}for(;null!=this.islands.next;)if(a=this.islands.inlined_pop_unsafe(),a.sleep)for(a=a.comps.head;null!=a;){d=a.elt;if(d.isBody){b=d.body;b.velx=0;b.vely=0;b.angvel=0;d.sleeping=!0;for(d=b.shapes.head;null!=d;)this.bphase.sync(d.elt),d=d.next;this.bodyCbSleep(b)}else this.constraintCbSleep(d.constraint),
d.sleeping=!0;a=a.next}else{for(;null!=a.comps.head;)b=a.comps.inlined_pop_unsafe(),b.waket=a.waket,b.isBody?this.live.inlined_add(b.body):this.live_constraints.inlined_add(b.constraint),b.sleeping=!1,b.island=null,b.parent=b,b.rank=0;a.next=bb.zpp_pool;bb.zpp_pool=a}},sleepArbiters:function(){var a=null,b=this.c_arbiters_true,c=b.head,d=null!=this.c_arbiters_false;d&&null==c&&(d=!1,c=this.c_arbiters_false.head,b=this.c_arbiters_false,a=null);for(;null!=c;){var e=c.elt;e.b1.component.sleeping&&e.b2.component.sleeping?
(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next);d&&null==c&&(d=!1,c=this.c_arbiters_false.head,b=this.c_arbiters_false,a=null)}a=null;b=this.f_arbiters;c=b.head;d=!1;for(;null!=c;)e=c.elt,e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next),d&&null==c&&(d=!1,c=null.begin(),a=b=null);a=null;b=this.s_arbiters;c=b.head;d=!1;for(;null!=c;)e=c.elt,e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=
this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next),d&&null==c&&(d=!1,c=null.begin(),a=b=null)},static_validation:function(a){null!=a.shapes.head&&a.validate_aabb();a.validate_mass();a.validate_inertia();for(var b=a.shapes.head;null!=b;){var c=b.elt;c.type==f.id_ShapeType_POLYGON&&(c.polygon.splice_collinear(),c.polygon.validate_gaxi());b=b.next}a.sweepFrozen=!0},validation:function(){this.cbsets.validate();for(var a=this.live.head;null!=a;){var b=a.elt;b.sweepRadius=0;for(var c=b.shapes.head;null!=
c;){var d=c.elt;d.type==f.id_ShapeType_POLYGON&&(d.polygon.splice_collinear(),d.polygon.validate_gaxi());d.validate_sweepRadius();d.sweepRadius>b.sweepRadius&&(b.sweepRadius=d.sweepRadius);c=c.next}b.validate_mass();b.validate_inertia();null!=b.shapes.head&&(b.validate_aabb(),b.validate_worldCOM());b.validate_gravMass();b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot),null);if(b.component.woken&&null!=b.cbSet)for(c=b.cbSet.bodylisteners.head;null!=c;)d=c.elt,d.event==f.id_CbEvent_WAKE&&
(d=this.push_callback(d),d.event=f.id_CbEvent_WAKE,d.body=b),c=c.next;b.component.woken=!1;for(b=b.shapes.head;null!=b;)this.bphase.sync(b.elt),b=b.next;a=a.next}for(a=this.kinematics.head;null!=a;){b=a.elt;b.sweepRadius=0;for(c=b.shapes.head;null!=c;)d=c.elt,d.type==f.id_ShapeType_POLYGON&&(d.polygon.splice_collinear(),d.polygon.validate_gaxi()),d.validate_sweepRadius(),d.sweepRadius>b.sweepRadius&&(b.sweepRadius=d.sweepRadius),c=c.next;b.validate_mass();b.validate_inertia();null!=b.shapes.head&&
(b.validate_aabb(),b.validate_worldCOM());b.validate_gravMass();b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot),null);for(b=b.shapes.head;null!=b;)this.bphase.sync(b.elt),b=b.next;a=a.next}for(a=this.live_constraints.head;null!=a;){b=a.elt;if(b.active){if(b.component.woken&&null!=b.cbSet)for(c=b.cbSet.conlisteners.head;null!=c;)d=c.elt,d.event==f.id_CbEvent_WAKE&&(d=this.push_callback(d),d.event=f.id_CbEvent_WAKE,d.constraint=b),c=c.next;b.component.woken=!1}a=a.next}},
updateVel:function(a){for(var b=1-a*this.global_lin_drag,c=1-a*this.global_ang_drag,d=this.live.head;null!=d;){var e=d.elt;if(0!=e.smass){var f=a*e.imass;e.velx=b*e.velx+(e.forcex+this.gravityx*e.gravMass)*f;e.vely=b*e.vely+(e.forcey+this.gravityy*e.gravMass)*f}if(0!=e.sinertia){var g=f=0,f=e.worldCOMx-e.posx,g=e.worldCOMy-e.posy;e.angvel=c*e.angvel+(e.torque+(this.gravityy*f-this.gravityx*g)*e.gravMass)*a*e.iinertia}d=d.next}},updatePos:function(a){for(var b=2*Math.PI/a,c=this.live.head;null!=c;){var d=
c.elt;d.pre_posx=d.posx;d.pre_posy=d.posy;d.pre_rot=d.rot;d.sweepTime=0;d.sweep_angvel=d.angvel%b;d.sweepIntegrate(a);if(d.disableCCD)d.sweepFrozen=!0,d.bullet=!1;else{var e=m.staticCCDLinearThreshold*d.sweepRadius,g=m.staticCCDAngularThreshold;if((d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>g*g||d.type==f.id_BodyType_KINEMATIC){e=d.sweep_angvel;0>e&&(e=-e);for(var g=1/e,h=d.shapes.head;null!=h;){var j=h.elt,i=j.aabb,l=i.minx,k=i.miny,o=i.maxx,n=i.maxy,p=0.008333333333333333*e*a*j.sweepCoef|
0;8<p&&(p=8);var t=e*a/p;d.sweepIntegrate(a);j.type==f.id_ShapeType_CIRCLE?j.circle._force_validate_aabb():j.polygon._force_validate_aabb();l<i.minx?i.minx=l:l=i.minx;k<i.miny?i.miny=k:k=i.miny;o>i.maxx?i.maxx=o:o=i.maxx;n>i.maxy?i.maxy=n:n=i.maxy;for(var s=1;s<p;){var w=s++;d.sweepIntegrate(t*w*g);j.type==f.id_ShapeType_CIRCLE?j.circle._force_validate_aabb():j.polygon._force_validate_aabb();l<i.minx?i.minx=l:l=i.minx;k<i.miny?i.miny=k:k=i.miny;o>i.maxx?i.maxx=o:o=i.maxx;n>i.maxy?i.maxy=n:n=i.maxy}this.bphase.sync(j);
h=h.next}d.sweepFrozen=!1;if(d.type==f.id_BodyType_DYNAMIC&&d.bulletEnabled&&(e=m.bulletCCDLinearThreshold*d.sweepRadius,g=m.bulletCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>g*g))d.bullet=!0}else d.sweepFrozen=!0,d.bullet=!1}c=c.next}for(c=this.kinematics.head;null!=c;){d=c.elt;d.pre_posx=d.posx;d.pre_posy=d.posy;d.pre_rot=d.rot;d.sweepTime=0;d.sweep_angvel=d.angvel%b;d.sweepIntegrate(a);if(d.disableCCD)d.sweepFrozen=!0,d.bullet=!1;else if(e=m.staticCCDLinearThreshold*
d.sweepRadius,g=m.staticCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>g*g||d.type==f.id_BodyType_KINEMATIC){e=d.sweep_angvel;0>e&&(e=-e);g=1/e;for(h=d.shapes.head;null!=h;){j=h.elt;i=j.aabb;l=i.minx;k=i.miny;o=i.maxx;n=i.maxy;p=0.008333333333333333*e*a*j.sweepCoef|0;8<p&&(p=8);t=e*a/p;d.sweepIntegrate(a);j.type==f.id_ShapeType_CIRCLE?j.circle._force_validate_aabb():j.polygon._force_validate_aabb();l<i.minx?i.minx=l:l=i.minx;k<i.miny?i.miny=k:k=i.miny;o>i.maxx?i.maxx=
o:o=i.maxx;n>i.maxy?i.maxy=n:n=i.maxy;for(s=1;s<p;)w=s++,d.sweepIntegrate(t*w*g),j.type==f.id_ShapeType_CIRCLE?j.circle._force_validate_aabb():j.polygon._force_validate_aabb(),l<i.minx?i.minx=l:l=i.minx,k<i.miny?i.miny=k:k=i.miny,o>i.maxx?i.maxx=o:o=i.maxx,n>i.maxy?i.maxy=n:n=i.maxy;this.bphase.sync(j);h=h.next}d.sweepFrozen=!1;if(d.type==f.id_BodyType_DYNAMIC&&d.bulletEnabled&&(e=m.bulletCCDLinearThreshold*d.sweepRadius,g=m.bulletCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*
d.angvel*a*a>g*g))d.bullet=!0}else d.sweepFrozen=!0,d.bullet=!1;c=c.next}},presteparb:function(a,b,c){null==c&&(c=!1);var d=this;if(!a.cleared&&a.b1.component.sleeping&&a.b2.component.sleeping)return a.sleep_stamp=this.stamp,a.sleeping=!0;if(!a.cleared||0!=a.present||a.intchange){var e=!c&&a.up_stamp==this.stamp-1&&!a.cleared&&!a.intchange,c=a.fresh&&!a.cleared&&!a.intchange;e&&(a.endGenerated=this.stamp);if(c||e||a.cleared||a.intchange){this.inlined_MRCA_chains(a.ws1,a.ws2);for(e=this.mrca1.head;null!=
e;){for(var g=e.elt,h=this.mrca2.head;null!=h;){var j=h.elt,i=g.cbSet,l=j.cbSet;if(!i.manager.pair(i,l).empty_intersection()){var k=[S.get(g,j)];if(c||a.intchange){null==k[0]&&(k[0]=Ja.get(g,j),this.add_callbackset(k[0]));i.manager.pair(i,l).forall(f.id_CbEvent_BEGIN,function(b){return function(c){if(0!=(c.itype&a.type)&&b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_BEGIN;S.int_callback(b[0],c,e);e.set=b[0]}}}(k));if(j=!k[0].arbiters.inlined_has(a))k[0].arbiters.inlined_add(a),
j=!0;j&&a.present++}else a.present--,k[0].remove_arb(a),i.manager.pair(i,l).forall(f.id_CbEvent_END,function(b){return function(c){if(0!=(c.itype&a.type)&&b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_END;S.int_callback(b[0],c,e);e.set=b[0]}}}(k)),null==k[0].arbiters.head&&this.remove_callbackset(k[0])}h=h.next}e=e.next}}a.fresh=!1;a.intchange=!1}if(a.cleared||a.up_stamp+(a.type==C.COL?m.arbiterExpirationDelay:0)<this.stamp)return a.type==C.SENSOR?a.sensorarb.retire():a.type==
C.FLUID?a.fluidarb.retire():a.colarb.retire(),!0;c=a.active;a.active=a.presentable=a.up_stamp==this.stamp;0!=(a.immState&f.id_ImmState_ACCEPT)?a.active&&a.type!=C.SENSOR&&(null!=a.colarb?a.colarb.preStep(b)&&(a.active=!1):a.fluidarb.preStep(this,b)):null!=a.colarb&&a.colarb.cleanupContacts()&&(a.active=!1);c!=a.active&&(a.b1.arbiters.modified=!0,a.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0);return!1},
prestep:function(a){for(var b=null,c=this.live_constraints.head;null!=c;){var d=c.elt;d.preStep(a)?(c=this.live_constraints.erase(b),d.broken(),this.constraintCbBreak(d),d.removeOnBreak?(d.component.sleeping=!0,this.midstep=!1,null!=d.compound?d.compound.wrap_constraints.remove(d.outer):this.wrap_constraints.remove(d.outer),this.midstep=!0):d.active=!1,d.clearcache()):(b=c,c=c.next)}var b=null,c=this.c_arbiters_true,d=c.head,e=null!=this.c_arbiters_false;e&&null==d&&(e=!1,d=this.c_arbiters_false.head,
c=this.c_arbiters_false,b=null);for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,d=this.c_arbiters_false.head,c=this.c_arbiters_false,b=null);b=null;c=this.f_arbiters;d=c.head;e=!1;for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,d=null.begin(),b=c=null);b=null;c=this.s_arbiters;d=c.head;e=!1;for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,d=null.begin(),b=c=null)},
warmStart:function(){for(var a=this.f_arbiters.head;null!=a;){var b=a.elt;b.active&&0!=(b.immState&f.id_ImmState_ACCEPT)&&b.warmStart();a=a.next}a=this.c_arbiters_false.head;b=!0;null==a&&(a=this.c_arbiters_true.head,b=!1);for(;null!=a;){var c=a.elt;c.active&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.warmStart();a=a.next;b&&null==a&&(a=this.c_arbiters_true.head,b=!1)}for(a=this.live_constraints.head;null!=a;)a.elt.warmStart(),a=a.next},iterateVel:function(a){for(var b=0;b<a;){b++;for(var c=this.f_arbiters.head;null!=
c;){var d=c.elt;d.active&&0!=(d.immState&f.id_ImmState_ACCEPT)&&d.applyImpulseVel();c=c.next}c=null;for(d=this.live_constraints.head;null!=d;){var e=d.elt;e.applyImpulseVel()?(d=this.live_constraints.erase(c),e.broken(),this.constraintCbBreak(e),e.removeOnBreak?(e.component.sleeping=!0,this.midstep=!1,null!=e.compound?e.compound.wrap_constraints.remove(e.outer):this.wrap_constraints.remove(e.outer),this.midstep=!0):e.active=!1,e.clearcache()):(c=d,d=d.next)}c=this.c_arbiters_false.head;d=!0;null==
c&&(c=this.c_arbiters_true.head,d=!1);for(;null!=c;)e=c.elt,e.active&&0!=(e.immState&f.id_ImmState_ACCEPT)&&e.applyImpulseVel(),c=c.next,d&&null==c&&(c=this.c_arbiters_true.head,d=!1)}},iteratePos:function(a){for(var b=0;b<a;){b++;for(var c=null,d=this.live_constraints.head;null!=d;){var e=d.elt;!e.__velocity&&e.stiff&&e.applyImpulsePos()?(d=this.live_constraints.erase(c),e.broken(),this.constraintCbBreak(e),e.removeOnBreak?(e.component.sleeping=!0,this.midstep=!1,null!=e.compound?e.compound.wrap_constraints.remove(e.outer):
this.wrap_constraints.remove(e.outer),this.midstep=!0):e.active=!1,e.clearcache()):(c=d,d=d.next)}c=this.c_arbiters_false.head;d=!0;null==c&&(c=this.c_arbiters_true.head,d=!1);for(;null!=c;)e=c.elt,e.active&&0!=(e.immState&f.id_ImmState_ACCEPT)&&e.applyImpulsePos(),c=c.next,d&&null==c&&(c=this.c_arbiters_true.head,d=!1)}},group_ignore:function(a,b){var c=a.lookup_group();if(null==c)return!1;var d=b.lookup_group();if(null==d)return!1;for(var e=!1;null!=c&&null!=d;){if(c==d){e=c.ignore;break}c.depth<
d.depth?d=d.group:c=c.group}return e},interactionType:function(a,b,c,d){var e;e=!1;for(var f=c.constraints.head;null!=f;){var g=f.elt;if(g.ignore&&g.pair_exists(c.id,d.id)){e=!0;break}f=f.next}return!e&&!this.group_ignore(a,b)?(a.sensorEnabled||b.sensorEnabled)&&a.filter.shouldSense(b.filter)?2:(a.fluidEnabled||b.fluidEnabled)&&a.filter.shouldFlow(b.filter)&&!(0==c.imass&&0==d.imass&&0==c.iinertia&&0==d.iinertia)?0:a.filter.shouldCollide(b.filter)&&!(0==c.imass&&0==d.imass&&0==c.iinertia&&0==d.iinertia)?
1:-1:-1},narrowPhase:function(a,b,c,d,e){var g=this,h=null,j=a.body,i=b.body,l=this.interactionType(a,b,j,i);if(-1!=l){var k,m;a.type>b.type?(k=b,m=a):a.type==b.type?a.id<b.id?(k=a,m=b):(m=a,k=b):(k=a,m=b);var n=k==b;if(0==l){var p;if(null==d){for(var t=null,s=(j.arbiters.length<i.arbiters.length?j:i).arbiters.head;null!=s;){var x=s.elt;if(x.id==k.id&&x.di==m.id){t=x;break}s=s.next}p=t}else p=d;var y=null==p,u,z=!1;y?(null==jb.zpp_pool?u=new jb:(u=jb.zpp_pool,jb.zpp_pool=u.next,u.next=null),null):
null==p.fluidarb?(p.cleared=!0,p.b1.arbiters.inlined_try_remove(p),p.b2.arbiters.inlined_try_remove(p),null!=p.pair&&(p.pair.arb=null,p.pair=null),p.active=!1,this.f_arbiters.modified=!0,null==jb.zpp_pool?u=new jb:(u=jb.zpp_pool,jb.zpp_pool=u.next,u.next=null),null,z=y=u.intchange=!0):u=p.fluidarb;var F=f.id_InteractionType_FLUID;if(y||u.stamp!=this.stamp||e)if(u.stamp=this.stamp,w.flowCollide(k,m,u)){y?(u.b1=a.body,u.ws1=a,u.b2=b.body,u.ws2=b,u.id=k.id,u.di=m.id,u.b1.arbiters.inlined_add(u),u.b2.arbiters.inlined_add(u),
u.active=!0,u.present=0,u.cleared=!1,u.sleeping=!1,u.fresh=!1,u.presentable=!1,u.nx=0,u.ny=1,u.dampx=0,u.dampy=0,u.adamp=0,this.f_arbiters.inlined_add(u),u.fresh=!z):u.fresh=u.up_stamp<this.stamp-1||u.endGenerated==this.stamp&&e;u.up_stamp=u.stamp;if(u.fresh||0==(u.immState&f.id_ImmState_ALWAYS)){u.immState=f.id_ImmState_ACCEPT;var C=!1;this.inlined_MRCA_chains(u.ws1.id>u.ws2.id?u.ws2:u.ws1,u.ws1.id>u.ws2.id?u.ws1:u.ws2);for(var D=this.mrca1.head;null!=D;){for(var E=D.elt,G=this.mrca2.head;null!=
G;){var I=G.elt,H=E.cbSet,J=I.cbSet;if(!H.manager.pair(H,J).empty_intersection()){var B=null,K=null;this.prelisteners.inlined_clear();H.manager.pair(H,J).forall(f.id_CbEvent_PRE,function(a){return function(b){0!=(b.itype&F)&&(a[0]=g.prelisteners.inlined_insert(a[0],b),C=C||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(B=S.get(E,I),null==B&&(K=Ja.get(E,I),this.add_callbackset(K)),null==B||(B.FLUIDstamp!=this.stamp||e)&&0==(B.FLUIDstate&f.id_ImmState_ALWAYS)){null!=K&&(B=K);if(null!=B)for(var L=
this.prelisteners.head;null!=L;)L.elt.itype==f.id_InteractionType_ANY&&(B.COLLISIONstamp=this.stamp,B.SENSORstamp=this.stamp),B.FLUIDstamp=this.stamp,L=L.next;var P=u.active;u.active=!0;this.precb.zpp_inner.pre_arbiter=u;this.precb.zpp_inner.set=B;for(var N=this.prelisteners.head;null!=N;){var R=N.elt;this.precb.zpp_inner.listener=R;S.int_callback(B,R,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=E!=this.precb.zpp_inner.int1;var Q=R.handlerp(this.precb);if(null!=Q){var ba=u,W,ca=Q;null==
f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);if(ca==f.PreFlag_ACCEPT)W=f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var Z,da=Q;null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1);if(da==f.PreFlag_ACCEPT_ONCE)Z=f.id_ImmState_ACCEPT;else{var ea=Q;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1);Z=ea==f.PreFlag_IGNORE?f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:f.id_ImmState_IGNORE}W=Z}ba.immState=W}N=N.next}u.active=
P;if(null!=B)for(var X=this.prelisteners.head;null!=X;)X.elt.itype==f.id_InteractionType_ANY&&(B.COLLISIONstate=u.immState,B.SENSORstate=u.immState),B.FLUIDstate=u.immState,X=X.next}else null==B?0==(u.immState&f.id_ImmState_ALWAYS)&&(u.immState=f.id_ImmState_ACCEPT):u.immState=B.FLUIDstate}G=G.next}D=D.next}if(C&&0==(u.immState&f.id_ImmState_ALWAYS)){if(u.b1.type==f.id_BodyType_DYNAMIC){var T=u.b1;T.world||(T.component.waket=this.stamp+(this.midstep?0:1),T.type==f.id_BodyType_KINEMATIC&&(T.kinematicDelaySleep=
!0),T.component.sleeping&&this.really_wake(T,!1))}if(u.b1.type==f.id_BodyType_DYNAMIC){var U=u.b2;U.world||(U.component.waket=this.stamp+(this.midstep?0:1),U.type==f.id_BodyType_KINEMATIC&&(U.kinematicDelaySleep=!0),U.component.sleeping&&this.really_wake(U,!1))}}}if(0!=(u.immState&f.id_ImmState_ACCEPT)){if(u.b1.type==f.id_BodyType_DYNAMIC&&u.b1.component.sleeping){var Y=u.b1;Y.world||(Y.component.waket=this.stamp+(this.midstep?0:1),Y.type==f.id_BodyType_KINEMATIC&&(Y.kinematicDelaySleep=!0),Y.component.sleeping&&
this.really_wake(Y,!1))}if(u.b2.type==f.id_BodyType_DYNAMIC&&u.b2.component.sleeping){var $=u.b2;$.world||($.component.waket=this.stamp+(this.midstep?0:1),$.type==f.id_BodyType_KINEMATIC&&($.kinematicDelaySleep=!0),$.component.sleeping&&this.really_wake($,!1))}}u.sleeping&&(u.sleeping=!1,this.f_arbiters.inlined_add(u));h=u}else if(y){var ia=u;ia.next=jb.zpp_pool;jb.zpp_pool=ia;h=null}else h=u;else h=u}else if(1==l){var fa;fa=c?this.c_arbiters_true:this.c_arbiters_false;var O;if(null==d){for(var ka=
null,ha=(j.arbiters.length<i.arbiters.length?j:i).arbiters.head;null!=ha;){var ja=ha.elt;if(ja.id==k.id&&ja.di==m.id){ka=ja;break}ha=ha.next}O=ka}else O=d;var ga=null==O,r,qa=!1;ga?(null==mb.zpp_pool?r=new mb:(r=mb.zpp_pool,mb.zpp_pool=r.next,r.next=null),null,r.stat=c):null==O.colarb?(O.cleared=!0,O.b1.arbiters.inlined_try_remove(O),O.b2.arbiters.inlined_try_remove(O),null!=O.pair&&(O.pair.arb=null,O.pair=null),O.active=!1,this.f_arbiters.modified=!0,null==mb.zpp_pool?r=new mb:(r=mb.zpp_pool,mb.zpp_pool=
r.next,r.next=null),null,r.intchange=!0,r.stat=c,qa=ga=!0):(r=O.colarb,n=k!=r.s1,r.stat!=c&&(r.stat=c,r.sleeping||((c?this.c_arbiters_false:this.c_arbiters_true).remove(r),fa.add(r))));var Ba=f.id_InteractionType_COLLISION;if(ga||r.stamp!=this.stamp||e)if(r.stamp=this.stamp,w.contactCollide(k,m,r,n)){ga?(r.b1=a.body,r.ws1=a,r.b2=b.body,r.ws2=b,r.id=k.id,r.di=m.id,r.b1.arbiters.inlined_add(r),r.b2.arbiters.inlined_add(r),r.active=!0,r.present=0,r.cleared=!1,r.sleeping=!1,r.fresh=!1,r.presentable=!1,
r.s1=a,r.s2=b,r.userdef_restitution||(r.restitution=r.s1.material.elasticity<=Math.NEGATIVE_INFINITY||r.s2.material.elasticity<=Math.NEGATIVE_INFINITY?0:r.s1.material.elasticity>=Math.POSITIVE_INFINITY||r.s2.material.elasticity>=Math.POSITIVE_INFINITY?1:(r.s1.material.elasticity+r.s2.material.elasticity)/2,0>r.restitution&&(r.restitution=0),1<r.restitution&&(r.restitution=1)),r.userdef_dyn_fric||(r.dyn_fric=Math.sqrt(r.s1.material.dynamicFriction*r.s2.material.dynamicFriction)),r.userdef_stat_fric||
(r.stat_fric=Math.sqrt(r.s1.material.staticFriction*r.s2.material.staticFriction)),r.userdef_rfric||(r.rfric=Math.sqrt(r.s1.material.rollingFriction*r.s2.material.rollingFriction)),fa.inlined_add(r),r.fresh=!qa):r.fresh=r.up_stamp<this.stamp-1||r.endGenerated==this.stamp&&e;r.up_stamp=r.stamp;if(r.fresh||0==(r.immState&f.id_ImmState_ALWAYS)){r.immState=f.id_ImmState_ACCEPT;var pa=!1;this.inlined_MRCA_chains(r.ws1.id>r.ws2.id?r.ws2:r.ws1,r.ws1.id>r.ws2.id?r.ws1:r.ws2);for(var ma=this.mrca1.head;null!=
ma;){for(var la=ma.elt,oa=this.mrca2.head;null!=oa;){var ua=oa.elt,ra=la.cbSet,Fa=ua.cbSet;if(!ra.manager.pair(ra,Fa).empty_intersection()){var M=null,sa=null;this.prelisteners.inlined_clear();ra.manager.pair(ra,Fa).forall(f.id_CbEvent_PRE,function(a){return function(b){0!=(b.itype&Ba)&&(a[0]=g.prelisteners.inlined_insert(a[0],b),pa=pa||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(M=S.get(la,ua),null==M&&(sa=Ja.get(la,ua),this.add_callbackset(sa)),null==M||(M.COLLISIONstamp!=this.stamp||
e)&&0==(M.COLLISIONstate&f.id_ImmState_ALWAYS)){null!=sa&&(M=sa);if(null!=M)for(var ta=this.prelisteners.head;null!=ta;)ta.elt.itype==f.id_InteractionType_ANY?(M.COLLISIONstamp=this.stamp,M.SENSORstamp=this.stamp,M.FLUIDstamp=this.stamp):M.COLLISIONstamp=this.stamp,ta=ta.next;var La=r.active;r.active=!0;r.cleanupContacts();this.precb.zpp_inner.pre_arbiter=r;this.precb.zpp_inner.set=M;for(var va=this.prelisteners.head;null!=va;){var Da=va.elt;this.precb.zpp_inner.listener=Da;S.int_callback(M,Da,this.precb.zpp_inner);
this.precb.zpp_inner.pre_swapped=la!=this.precb.zpp_inner.int1;var wa=Da.handlerp(this.precb);if(null!=wa){var Na=r,Qa=wa,Ga;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);if(Qa==f.PreFlag_ACCEPT)Ga=f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var Ya=wa,Ma;null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1);if(Ya==f.PreFlag_ACCEPT_ONCE)Ma=f.id_ImmState_ACCEPT;else{var Za=wa;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=
new Ca,f.internal=!1);Ma=Za==f.PreFlag_IGNORE?f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:f.id_ImmState_IGNORE}Ga=Ma}Na.immState=Ga}va=va.next}r.active=La;if(null!=M)for(var Ha=this.prelisteners.head;null!=Ha;)Ha.elt.itype==f.id_InteractionType_ANY?(M.COLLISIONstate=r.immState,M.SENSORstate=r.immState,M.FLUIDstate=r.immState):M.COLLISIONstate=r.immState,Ha=Ha.next}else null==M?0==(r.immState&f.id_ImmState_ALWAYS)&&(r.immState=f.id_ImmState_ACCEPT):r.immState=M.COLLISIONstate}oa=oa.next}ma=ma.next}if(pa&&
0==(r.immState&f.id_ImmState_ALWAYS)){if(r.b1.type==f.id_BodyType_DYNAMIC){var xa=r.b1;xa.world||(xa.component.waket=this.stamp+(this.midstep?0:1),xa.type==f.id_BodyType_KINEMATIC&&(xa.kinematicDelaySleep=!0),xa.component.sleeping&&this.really_wake(xa,!1))}if(r.b1.type==f.id_BodyType_DYNAMIC){var ya=r.b2;ya.world||(ya.component.waket=this.stamp+(this.midstep?0:1),ya.type==f.id_BodyType_KINEMATIC&&(ya.kinematicDelaySleep=!0),ya.component.sleeping&&this.really_wake(ya,!1))}}}if(0!=(r.immState&f.id_ImmState_ACCEPT)){if(r.b1.type==
f.id_BodyType_DYNAMIC&&r.b1.component.sleeping){var za=r.b1;za.world||(za.component.waket=this.stamp+(this.midstep?0:1),za.type==f.id_BodyType_KINEMATIC&&(za.kinematicDelaySleep=!0),za.component.sleeping&&this.really_wake(za,!1))}if(r.b2.type==f.id_BodyType_DYNAMIC&&r.b2.component.sleeping){var Aa=r.b2;Aa.world||(Aa.component.waket=this.stamp+(this.midstep?0:1),Aa.type==f.id_BodyType_KINEMATIC&&(Aa.kinematicDelaySleep=!0),Aa.component.sleeping&&this.really_wake(Aa,!1))}}r.sleeping&&(r.sleeping=!1,
fa.inlined_add(r));h=r}else if(ga){var na=r;na.userdef_dyn_fric=!1;na.userdef_stat_fric=!1;na.userdef_restitution=!1;na.userdef_rfric=!1;na.__ref_edge1=na.__ref_edge2=null;na.next=mb.zpp_pool;mb.zpp_pool=na;h=null}else h=r;else h=r}else{var aa;if(null==d){for(var Xa=null,Ka=(j.arbiters.length<i.arbiters.length?j:i).arbiters.head;null!=Ka;){var Ra=Ka.elt;if(Ra.id==k.id&&Ra.di==m.id){Xa=Ra;break}Ka=Ka.next}aa=Xa}else aa=d;var Ia=null==aa,A,$a=!1;Ia?(null==Ea.zpp_pool?A=new Ea:(A=Ea.zpp_pool,Ea.zpp_pool=
A.next,A.next=null),null):null==aa.sensorarb?(aa.cleared=!0,aa.b1.arbiters.inlined_try_remove(aa),aa.b2.arbiters.inlined_try_remove(aa),null!=aa.pair&&(aa.pair.arb=null,aa.pair=null),aa.active=!1,this.f_arbiters.modified=!0,null==Ea.zpp_pool?A=new Ea:(A=Ea.zpp_pool,Ea.zpp_pool=A.next,A.next=null),null,$a=Ia=A.intchange=!0):A=aa.sensorarb;var fb=f.id_InteractionType_SENSOR;if(Ia||A.stamp!=this.stamp||e)if(A.stamp=this.stamp,w.testCollide(k,m)){Ia?(A.b1=a.body,A.ws1=a,A.b2=b.body,A.ws2=b,A.id=k.id,
A.di=m.id,A.b1.arbiters.inlined_add(A),A.b2.arbiters.inlined_add(A),A.active=!0,A.present=0,A.cleared=!1,A.sleeping=!1,A.fresh=!1,A.presentable=!1,this.s_arbiters.inlined_add(A),A.fresh=!$a):A.fresh=A.up_stamp<this.stamp-1||A.endGenerated==this.stamp&&e;A.up_stamp=A.stamp;if(A.fresh||0==(A.immState&f.id_ImmState_ALWAYS)){A.immState=f.id_ImmState_ACCEPT;var Va=!1;this.inlined_MRCA_chains(A.ws1.id>A.ws2.id?A.ws2:A.ws1,A.ws1.id>A.ws2.id?A.ws1:A.ws2);for(var Pa=this.mrca1.head;null!=Pa;){for(var Sa=Pa.elt,
Ta=this.mrca2.head;null!=Ta;){var ab=Ta.elt,Wa=Sa.cbSet,hb=ab.cbSet;if(!Wa.manager.pair(Wa,hb).empty_intersection()){var Ua=null,bb=null;this.prelisteners.inlined_clear();Wa.manager.pair(Wa,hb).forall(f.id_CbEvent_PRE,function(a){return function(b){0!=(b.itype&fb)&&(a[0]=g.prelisteners.inlined_insert(a[0],b),Va=Va||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(Ua=S.get(Sa,ab),null==Ua&&(bb=Ja.get(Sa,ab),this.add_callbackset(bb)),null==Ua||(Ua.SENSORstamp!=this.stamp||e)&&0==(Ua.SENSORstate&
f.id_ImmState_ALWAYS)){null!=bb&&(Ua=bb);if(null!=Ua)for(var cb=this.prelisteners.head;null!=cb;)cb.elt.itype==f.id_InteractionType_ANY?(Ua.COLLISIONstamp=this.stamp,Ua.SENSORstamp=this.stamp,Ua.FLUIDstamp=this.stamp):Ua.SENSORstamp=this.stamp,cb=cb.next;var lb=A.active;A.active=!0;this.precb.zpp_inner.pre_arbiter=A;this.precb.zpp_inner.set=Ua;for(var db=this.prelisteners.head;null!=db;){var gb=db.elt;this.precb.zpp_inner.listener=gb;S.int_callback(Ua,gb,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=
Sa!=this.precb.zpp_inner.int1;var eb=gb.handlerp(this.precb);if(null!=eb){var ob=A,nb,tb=eb;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);if(tb==f.PreFlag_ACCEPT)nb=f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var qb,ub=eb;null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1);if(ub==f.PreFlag_ACCEPT_ONCE)qb=f.id_ImmState_ACCEPT;else{var vb=eb;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1);qb=vb==f.PreFlag_IGNORE?
f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:f.id_ImmState_IGNORE}nb=qb}ob.immState=nb}db=db.next}A.active=lb;if(null!=Ua)for(var pb=this.prelisteners.head;null!=pb;)pb.elt.itype==f.id_InteractionType_ANY?(Ua.COLLISIONstate=A.immState,Ua.SENSORstate=A.immState,Ua.FLUIDstate=A.immState):Ua.SENSORstate=A.immState,pb=pb.next}else null==Ua?0==(A.immState&f.id_ImmState_ALWAYS)&&(A.immState=f.id_ImmState_ACCEPT):A.immState=Ua.SENSORstate}Ta=Ta.next}Pa=Pa.next}if(Va&&0==(A.immState&f.id_ImmState_ALWAYS)){if(A.b1.type!=
f.id_BodyType_STATIC){var Oa=A.b1;Oa.world||(Oa.component.waket=this.stamp+(this.midstep?0:1),Oa.type==f.id_BodyType_KINEMATIC&&(Oa.kinematicDelaySleep=!0),Oa.component.sleeping&&this.really_wake(Oa,!1))}if(A.b2.type!=f.id_BodyType_STATIC){var ib=A.b2;ib.world||(ib.component.waket=this.stamp+(this.midstep?0:1),ib.type==f.id_BodyType_KINEMATIC&&(ib.kinematicDelaySleep=!0),ib.component.sleeping&&this.really_wake(ib,!1))}}}A.sleeping&&(A.sleeping=!1,this.s_arbiters.inlined_add(A));h=A}else if(Ia){var rb=
A;rb.next=Ea.zpp_pool;Ea.zpp_pool=rb;h=null}else h=A;else h=A}}return h},MRCA_chains:function(a,b){this.inlined_MRCA_chains(a,b)},inlined_MRCA_chains:function(a,b){this.mrca1.inlined_clear();this.mrca2.inlined_clear();null!=a.cbSet&&this.mrca1.inlined_add(a);null!=a.body.cbSet&&this.mrca1.inlined_add(a.body);null!=b.cbSet&&this.mrca2.inlined_add(b);null!=b.body.cbSet&&this.mrca2.inlined_add(b.body);for(var c=a.body.compound,d=b.body.compound;c!=d;)(null==c?0:c.depth)<(null==d?0:d.depth)?(null!=d.cbSet&&
this.mrca2.inlined_add(d),d=d.compound):(null!=c.cbSet&&this.mrca1.inlined_add(c),c=c.compound)},__class__:zg};var Dc=function(){this.next=this.prev=this.shape=this.aabb=null};h["zpp_nape.space.ZPP_SweepData"]=Dc;Dc.__name__=!0;Dc.prototype={__class__:Dc};var Jf=function(a){this.list=null;kd.call(this);this.space=a;this.is_sweep=!0;this.sweep=this};h["zpp_nape.space.ZPP_SweepPhase"]=Jf;Jf.__name__=!0;Jf.__super__=kd;Jf.prototype=t(kd.prototype,{__insert:function(a){var b;null==Dc.zpp_pool?b=new Dc:
(b=Dc.zpp_pool,Dc.zpp_pool=b.next,b.next=null);null;a.sweep=b;b.shape=a;b.aabb=a.aabb;b.next=this.list;null!=this.list&&(this.list.prev=b);this.list=b},__remove:function(a){var b=a.sweep;null==b.prev?this.list=b.next:b.prev.next=b.next;null!=b.next&&(b.next.prev=b.prev);a.sweep=null;b.prev=null;b.shape=null;b.aabb=null;b.next=Dc.zpp_pool;Dc.zpp_pool=b},sync_broadphase:function(){this.space.validation();null!=this.list&&this.sync_broadphase_fast()},sync_broadphase_fast:function(){for(var a=this.list.next;null!=
a;){var b=a.next,c=a.prev;if(!(a.aabb.minx>c.aabb.minx)){for(;null!=c.prev&&c.prev.aabb.minx>a.aabb.minx;)c=c.prev;var d=a.prev;d.next=a.next;null!=a.next&&(a.next.prev=d);null==c.prev?(a.prev=null,this.list=a,a.next=c,c.prev=a):(a.prev=c.prev,c.prev=a,a.prev.next=a,a.next=c)}a=b}},broadphase:function(a,b){if(null!=this.list){this.sync_broadphase_fast();for(var c=this.list;null!=c;){for(var d=c.next,e=c.shape,g=e.body,h=c.aabb.maxx;null!=d&&!(d.aabb.minx>h);){var j=d.shape,i=j.body;if(i!=g&&!(g.type==
f.id_BodyType_STATIC&&i.type==f.id_BodyType_STATIC)&&(!g.component.sleeping||!i.component.sleeping))e.aabb.intersectY(j.aabb)&&(b?a.narrowPhase(e,j,g.type!=f.id_BodyType_DYNAMIC||i.type!=f.id_BodyType_DYNAMIC,null,!1):a.continuousEvent(e,j,g.type!=f.id_BodyType_DYNAMIC||i.type!=f.id_BodyType_DYNAMIC,null,!1));d=d.next}c=c.next}}},bodiesUnderPoint:function(a,b,c,d){this.sync_broadphase();for(var e=K.get(a,b,null),d=null==d?new fe:d,g=this.list;null!=g&&g.aabb.minx>a;)g=g.next;for(;null!=g&&g.aabb.minx<=
a;){if(g.aabb.maxx>=a&&g.aabb.miny<=b&&g.aabb.maxy>=b){var h=g.shape,j=h.body.outer;if(!d.has(j)&&(null==c||h.filter.shouldCollide(c)))h.type==f.id_ShapeType_CIRCLE?w.circleContains(h.circle,e)&&d.push(j):w.polyContains(h.polygon,e)&&d.push(j)}g=g.next}null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null);e._isimmutable=null;e._validate=null;e._invalidate=null;e.next=K.zpp_pool;K.zpp_pool=e;return d},__class__:Jf});var Dg=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CallbackSet"]=
Dg;Dg.__name__=!0;Dg.prototype={inlined_add:function(a){var b;null==Ec.zpp_pool?b=new Ec:(b=Ec.zpp_pool,Ec.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==
c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ec.zpp_pool;Ec.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Dg};var yc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Shape"]=yc;yc.__name__=!0;yc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Vb.zpp_pool?b=new Vb:(b=Vb.zpp_pool,Vb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;
return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Vb.zpp_pool?c=new Vb:(c=Vb.zpp_pool,Vb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Vb.zpp_pool;Vb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:yc};var jd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Body"]=jd;jd.__name__=!0;jd.prototype={add:function(a){return this.inlined_add(a)},
inlined_add:function(a){var b;null==lb.zpp_pool?b=new lb:(b=lb.zpp_pool,lb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==lb.zpp_pool?c=new lb:(c=lb.zpp_pool,lb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},
inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=lb.zpp_pool;lb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,
null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=lb.zpp_pool;lb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},has:function(a){return this.inlined_has(a)},inlined_has:function(a){var b;b=!1;for(var c=this.head;null!=c;){if(c.elt==a){b=!0;break}c=c.next}return b},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:jd};var Qd=function(){this.length=0;this.modified=this.pushmod=
!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Compound"]=Qd;Qd.__name__=!0;Qd.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==eb.zpp_pool?b=new eb:(b=eb.zpp_pool,eb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==eb.zpp_pool?c=new eb:(c=eb.zpp_pool,eb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==
a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=eb.zpp_pool;eb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=
null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=eb.zpp_pool;eb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Qd};var Cd=function(){this.length=0;this.modified=
this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Arbiter"]=Cd;Cd.__name__=!0;Cd.prototype={inlined_add:function(a){var b;null==Wb.zpp_pool?b=new Wb:(b=Wb.zpp_pool,Wb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Wb.zpp_pool;Wb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Wb.zpp_pool;Wb.zpp_pool=a;this.modified=!0;this.length--;
this.pushmod=!0;return c},inlined_has:function(a){var b;b=!1;for(var c=this.head;null!=c;){if(c.elt==a){b=!0;break}c=c.next}return b},__class__:Cd};var Ag=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CbSetPair"]=Ag;Ag.__name__=!0;Ag.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Eb.zpp_pool?b=new Eb:(b=Eb.zpp_pool,Eb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=
!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Eb.zpp_pool;Eb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);
d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Eb.zpp_pool;Eb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Ag};var Eg=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_AABBPair"]=Eg;Eg.__name__=!0;Eg.prototype={inlined_add:function(a){var b;null==
Xb.zpp_pool?b=new Xb:(b=Xb.zpp_pool,Xb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Xb.zpp_pool;Xb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},
inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Xb.zpp_pool;Xb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Eg};var Fg=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};
h["zpp_nape.util.ZNPList_ZPP_Edge"]=Fg;Fg.__name__=!0;Fg.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==db.zpp_pool?b=new db:(b=db.zpp_pool,db.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==db.zpp_pool?c=new db:(c=db.zpp_pool,db.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,
this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=db.zpp_pool;db.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=db.zpp_pool;db.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},reverse:function(){for(var a=this.head,b=null;null!=a;){var c=a.next;a.next=b;b=this.head=a;a=c}this.pushmod=this.modified=!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Fg};var If=function(){this.length=0;this.modified=
this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_AABBNode"]=If;If.__name__=!0;If.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Fc.zpp_pool?b=new Fc:(b=Fc.zpp_pool,Fc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Fc.zpp_pool;Fc.zpp_pool=a;null==this.head&&(this.pushmod=
!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},__class__:If};var Gg=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Component"]=Gg;Gg.__name__=!0;Gg.prototype={inlined_add:function(a){var b;null==Gc.zpp_pool?b=new Gc:(b=Gc.zpp_pool,Gc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;
return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Gc.zpp_pool;Gc.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},__class__:Gg};var rh=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_InteractionGroup"]=rh;rh.__name__=!0;rh.prototype=
{iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:rh};var Kf=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_ColArbiter"]=Kf;Kf.__name__=!0;Kf.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Hc.zpp_pool?b=new Hc:(b=Hc.zpp_pool,Hc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},remove:function(a){this.inlined_try_remove(a)},
inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Hc.zpp_pool;Hc.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Kf};var Jg=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};
h["zpp_nape.util.ZNPList_ZPP_FluidArbiter"]=Jg;Jg.__name__=!0;Jg.prototype={inlined_add:function(a){var b;null==kc.zpp_pool?b=new kc:(b=kc.zpp_pool,kc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=kc.zpp_pool;kc.zpp_pool=a;this.modified=!0;this.length--;
this.pushmod=!0;return c},__class__:Jg};var Kg=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_SensorArbiter"]=Kg;Kg.__name__=!0;Kg.prototype={inlined_add:function(a){var b;null==Ic.zpp_pool?b=new Ic:(b=Ic.zpp_pool,Ic.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,
c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ic.zpp_pool;Ic.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Kg};var Lf=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Listener"]=Lf;Lf.__name__=!0;Lf.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Yb.zpp_pool?b=new Yb:(b=Yb.zpp_pool,Yb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=
b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Yb.zpp_pool?c=new Yb:(c=Yb.zpp_pool,Yb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=
c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Yb.zpp_pool;Yb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Lf};var Ig=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_ToiEvent"]=
Ig;Ig.__name__=!0;Ig.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Jc.zpp_pool?b=new Jc:(b=Jc.zpp_pool,Jc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Jc.zpp_pool;Jc.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Jc.zpp_pool;Jc.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Ig};var sh=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ConvexResult"]=
sh;sh.__name__=!0;sh.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:sh};var th=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_GeomPoly"]=th;th.__name__=!0;th.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:th};var uh=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_RayResult"]=uh;uh.__name__=!0;
uh.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:uh};var Ia=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CbType"]=Ia;Ia.__name__=!0;Ia.prototype={__class__:Ia};var Ec=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CallbackSet"]=Ec;Ec.__name__=!0;Ec.prototype={__class__:Ec};var Vb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Shape"]=Vb;Vb.__name__=!0;Vb.prototype={__class__:Vb};var lb=function(){this.next=
this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Body"]=lb;lb.__name__=!0;lb.prototype={__class__:lb};var Ya=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Constraint"]=Ya;Ya.__name__=!0;Ya.prototype={__class__:Ya};var eb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Compound"]=eb;eb.__name__=!0;eb.prototype={__class__:eb};var Wb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Arbiter"]=Wb;Wb.__name__=!0;Wb.prototype={__class__:Wb};var La=function(){this.next=
this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_InteractionListener"]=La;La.__name__=!0;La.prototype={__class__:La};var Ib=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CbSet"]=Ib;Ib.__name__=!0;Ib.prototype={__class__:Ib};var Ta=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Interactor"]=Ta;Ta.__name__=!0;Ta.prototype={__class__:Ta};var Sa=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_BodyListener"]=Sa;Sa.__name__=!0;Sa.prototype={__class__:Sa};
var Eb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CbSetPair"]=Eb;Eb.__name__=!0;Eb.prototype={__class__:Eb};var ia=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_ConstraintListener"]=ia;ia.__name__=!0;ia.prototype={__class__:ia};var Xb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_AABBPair"]=Xb;Xb.__name__=!0;Xb.prototype={__class__:Xb};var ab=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Vec2"]=ab;ab.__name__=!0;ab.prototype=
{__class__:ab};var db=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Edge"]=db;db.__name__=!0;db.prototype={__class__:db};var Fc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_AABBNode"]=Fc;Fc.__name__=!0;Fc.prototype={__class__:Fc};var Gc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Component"]=Gc;Gc.__name__=!0;Gc.prototype={__class__:Gc};var vh=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_InteractionGroup"]=vh;vh.__name__=
!0;vh.prototype={__class__:vh};var Hc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_ColArbiter"]=Hc;Hc.__name__=!0;Hc.prototype={__class__:Hc};var kc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_FluidArbiter"]=kc;kc.__name__=!0;kc.prototype={__class__:kc};var Ic=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_SensorArbiter"]=Ic;Ic.__name__=!0;Ic.prototype={__class__:Ic};var Yb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Listener"]=
Yb;Yb.__name__=!0;Yb.prototype={__class__:Yb};var Jc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_ToiEvent"]=Jc;Jc.__name__=!0;Jc.prototype={__class__:Jc};var wh=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ConvexResult"]=wh;wh.__name__=!0;wh.prototype={__class__:wh};var xh=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_GeomPoly"]=xh;xh.__name__=!0;xh.prototype={__class__:xh};var yh=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_RayResult"]=
yh;yh.__name__=!0;yh.prototype={__class__:yh};var Cc=function(){this.at_index=0;this.at_ite=null;this.zip_length=!1;this._length=0;this.inner=null;Tc.call(this);this.at_ite=null;this.at_index=0;this.zip_length=!0;this._length=0};h["zpp_nape.util.ZPP_MixVec2List"]=Cc;Cc.__name__=!0;Cc.get=function(a,b){null==b&&(b=!1);var c=new Cc;c.inner=a;c.zpp_inner.immutable=b;return c};Cc.__super__=Tc;Cc.prototype=t(Tc.prototype,{zpp_gl:function(){this.zpp_vm();if(this.zip_length){this._length=0;for(var a=this.inner.next;null!=
a;)this._length++,a=a.next;this.zip_length=!1}return this._length},zpp_vm:function(){this.zpp_inner.validate();this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},at:function(a){this.zpp_vm();this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.at_index||null==this.at_ite){this.at_index=0;for(this.at_ite=this.inner.next;;)break}for(;this.at_index!=a;){this.at_index++;for(this.at_ite=this.at_ite.next;;)break}return this.at_ite.wrapper()},push:function(a){this.zpp_inner.modify_test();
this.zpp_vm();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.inner.add(a.zpp_inner):this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},__class__:Cc});var Nb=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=
this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new tc;this._invalidated=!0};h["zpp_nape.util.ZPP_ConstraintList"]=Nb;Nb.__name__=!0;Nb.get=function(a,b){null==b&&(b=!1);var c=new rg;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Nb.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,
this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Nb};var ka=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=
!1;this.outer=this.inner=null;this.inner=new jd;this._invalidated=!0};h["zpp_nape.util.ZPP_BodyList"]=ka;ka.__name__=!0;ka.get=function(a,b){null==b&&(b=!1);var c=new fe;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};ka.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&
(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:ka};var ge=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_InteractorList"]=ge;ge.__name__=!0;ge.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=
null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:ge};var Vc=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Qd;
this._invalidated=!0};h["zpp_nape.util.ZPP_CompoundList"]=Vc;Vc.__name__=!0;Vc.get=function(a,b){null==b&&(b=!1);var c=new wg;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Vc.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&
this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Vc};var Rc=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Lf;this._invalidated=!0};h["zpp_nape.util.ZPP_ListenerList"]=Rc;Rc.__name__=!0;Rc.get=
function(a,b){null==b&&(b=!1);var c=new qg;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Rc.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&
this._invalidate(this)},__class__:Rc};var Lb=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new hc;this._invalidated=!0};h["zpp_nape.util.ZPP_CbTypeList"]=Lb;Lb.__name__=!0;Lb.get=function(a,b){null==b&&(b=!1);var c=new lf;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=
!0);c.zpp_inner.zip_length=!0;return c};Lb.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Lb};var fc=function(){this.user_length=
0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new he;this._invalidated=!0};h["zpp_nape.util.ZPP_Vec2List"]=fc;fc.__name__=!0;fc.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=
!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:fc};var ee=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_GeomPolyList"]=ee;ee.__name__=!0;ee.prototype={valmod:function(){this.validate();
this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:ee};var zd=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_RayResultList"]=zd;zd.__name__=!0;zd.prototype=
{valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:zd};var yd=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_ConvexResultList"]=
yd;yd.__name__=!0;yd.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:yd};var Ad=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=
null};h["zpp_nape.util.ZPP_EdgeList"]=Ad;Ad.__name__=!0;Ad.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Ad};var gd=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=
!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new yc;this._invalidated=!0};h["zpp_nape.util.ZPP_ShapeList"]=gd;gd.__name__=!0;gd.get=function(a,b){null==b&&(b=!1);var c=new yg;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};gd.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=
!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:gd};var Kd=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_InteractionGroupList"]=
Kd;Kd.__name__=!0;Kd.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Kd};var ed=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this.immutable=this._invalidated=
!1;this.outer=this.inner=null;this.inner=new Cd;this._invalidated=!0};h["zpp_nape.util.ZPP_ArbiterList"]=ed;ed.__name__=!0;ed.get=function(a,b){null==b&&(b=!1);var c=new sg;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};ed.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=
!1,null!=this._validate&&this._validate())},__class__:ed};var de=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_ContactList"]=de;de.__name__=!0;de.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&
(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:de};var hd=function(){};h["zpp_nape.util.ZPP_Math"]=hd;hd.__name__=!0;hd.sqr=function(a){return a*a};var Ld=function(){};h["zpp_nape.util.ZPP_PubPool"]=Ld;Ld.__name__=!0;var fa=function(){this.colour=0;this.lt=this.swapped=this.data=this.prev=this.next=this.parent=null};h["zpp_nape.util.ZPP_Set_ZPP_CbSetPair"]=fa;fa.__name__=!0;fa.prototype={clear_with:function(a){if(null!=this.parent){for(var b=this.parent;null!=b;)b=null!=
b.prev?b.prev:null!=b.next?b.next:this.clear_node(b,a);this.parent=null}},clear_node:function(a,b){b(a.data);var c=a.parent;null!=c&&(a==c.prev?c.prev=null:c.next=null,a.parent=null);a.data=null;a.lt=null;a.swapped=null;a.next=fa.zpp_pool;fa.zpp_pool=a;return c},__fix_dbl_red:function(a){for(;;){var b=a.parent,c=b.parent;if(null==c){b.colour=1;break}var d,e,f,g,h,i,l;b==c.prev?(f=c,l=c.next,a==b.prev?(d=a,e=b,g=a.prev,h=a.next,i=b.next):(d=b,e=a,g=b.prev,h=a.prev,i=a.next)):(d=c,g=c.prev,a==b.prev?
(e=a,f=b,h=a.prev,i=a.next,l=b.next):(e=b,f=a,h=b.prev,i=a.prev,l=a.next));a=c.parent;null==a?this.parent=e:a.prev==c?a.prev=e:a.next=e;null!=e&&(e.parent=a);d.prev=g;null!=g&&(g.parent=d);d.next=h;null!=h&&(h.parent=d);e.prev=d;null!=d&&(d.parent=e);e.next=f;null!=f&&(f.parent=e);f.prev=i;null!=i&&(i.parent=f);f.next=l;null!=l&&(l.parent=f);e.colour=c.colour-1;d.colour=1;f.colour=1;if(e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){a=e;continue}break}},try_insert:function(a){var b=
null,c=null;if(null==this.parent)null==fa.zpp_pool?b=new fa:(b=fa.zpp_pool,fa.zpp_pool=b.next,b.next=null),null,b.data=a,this.parent=b;else for(c=this.parent;;)if(this.lt(a,c.data))if(null==c.prev){null==fa.zpp_pool?b=new fa:(b=fa.zpp_pool,fa.zpp_pool=b.next,b.next=null);null;b.data=a;c.prev=b;b.parent=c;break}else c=c.prev;else if(this.lt(c.data,a))if(null==c.next){null==fa.zpp_pool?b=new fa:(b=fa.zpp_pool,fa.zpp_pool=b.next,b.next=null);null;b.data=a;c.next=b;b.parent=c;break}else c=c.next;else break;
if(null==b)return c;null==b.parent?b.colour=1:(b.colour=0,0==b.parent.colour&&this.__fix_dbl_red(b));return b},__class__:fa};var cb=function(){this.colour=0;this.lt=this.swapped=this.data=this.prev=this.next=this.parent=null};h["zpp_nape.util.ZPP_Set_ZPP_CbSet"]=cb;cb.__name__=!0;cb.prototype={empty:function(){return null==this.parent},find:function(a){for(var b=this.parent;null!=b&&b.data!=a;)b=this.lt(a,b.data)?b.prev:b.next;return b},find_weak:function(a){for(var b=this.parent;null!=b;)if(this.lt(a,
b.data))b=b.prev;else if(this.lt(b.data,a))b=b.next;else break;return b},remove:function(a){this.remove_node(this.find(a))},remove_node:function(a){if(null!=a.next&&null!=a.prev){for(var b=a.next;null!=b.prev;)b=b.prev;var c=a.data;a.data=b.data;b.data=c;null!=this.swapped&&this.swapped(a.data,b.data);a=b}b=null==a.prev?a.next:a.prev;if(1==a.colour)if(null!=a.prev||null!=a.next)b.colour=1;else if(null!=a.parent)for(c=a.parent;;){c.colour++;c.prev.colour--;c.next.colour--;var d=c.prev;if(-1==d.colour){this.__fix_neg_red(d);
break}else if(0==d.colour){if(null!=d.prev&&0==d.prev.colour){this.__fix_dbl_red(d.prev);break}if(null!=d.next&&0==d.next.colour){this.__fix_dbl_red(d.next);break}}d=c.next;if(-1==d.colour){this.__fix_neg_red(d);break}else if(0==d.colour){if(null!=d.prev&&0==d.prev.colour){this.__fix_dbl_red(d.prev);break}if(null!=d.next&&0==d.next.colour){this.__fix_dbl_red(d.next);break}}if(2==c.colour)if(null==c.parent)c.colour=1;else{c=c.parent;continue}break}c=a.parent;null==c?this.parent=b:c.prev==a?c.prev=
b:c.next=b;null!=b&&(b.parent=c);a.parent=a.prev=a.next=null;a.data=null;a.lt=null;a.swapped=null;a.next=cb.zpp_pool;cb.zpp_pool=a},__fix_neg_red:function(a){var b=a.parent;if(b.prev==a){var c=a.prev,d=a.next,e=d.prev,f=d.next;c.colour=0;a.colour=b.colour=1;a.next=e;null!=e&&(e.parent=a);a=b.data;b.data=d.data;d.data=a;null!=this.swapped&&this.swapped(b.data,d.data);d.prev=f;null!=f&&(f.parent=d);d.next=b.next;null!=b.next&&(b.next.parent=d);b.next=d}else c=a.next,d=a.prev,e=d.next,f=d.prev,c.colour=
0,a.colour=b.colour=1,a.prev=e,null!=e&&(e.parent=a),a=b.data,b.data=d.data,d.data=a,null!=this.swapped&&this.swapped(b.data,d.data),d.next=f,null!=f&&(f.parent=d),d.prev=b.prev,null!=b.prev&&(b.prev.parent=d),b.prev=d;null!=d&&(d.parent=b);b=c;null!=b.prev&&0==b.prev.colour?this.__fix_dbl_red(b.prev):null!=b.next&&0==b.next.colour&&this.__fix_dbl_red(b.next)},__fix_dbl_red:function(a){for(;;){var b=a.parent,c=b.parent;if(null==c){b.colour=1;break}var d,e,f,g,h,i,l;b==c.prev?(f=c,l=c.next,a==b.prev?
(d=a,e=b,g=a.prev,h=a.next,i=b.next):(d=b,e=a,g=b.prev,h=a.prev,i=a.next)):(d=c,g=c.prev,a==b.prev?(e=a,f=b,h=a.prev,i=a.next,l=b.next):(e=b,f=a,h=b.prev,i=a.prev,l=a.next));a=c.parent;null==a?this.parent=e:a.prev==c?a.prev=e:a.next=e;null!=e&&(e.parent=a);d.prev=g;null!=g&&(g.parent=d);d.next=h;null!=h&&(h.parent=d);e.prev=d;null!=d&&(d.parent=e);e.next=f;null!=f&&(f.parent=e);f.prev=i;null!=i&&(i.parent=f);f.next=l;null!=l&&(l.parent=f);e.colour=c.colour-1;d.colour=1;f.colour=1;if(e==this.parent)this.parent.colour=
1;else if(0==e.colour&&0==e.parent.colour){a=e;continue}break}},insert:function(a){var b;null==cb.zpp_pool?b=new cb:(b=cb.zpp_pool,cb.zpp_pool=b.next,b.next=null);null;b.data=a;if(null==this.parent)this.parent=b;else for(a=this.parent;;)if(this.lt(b.data,a.data))if(null==a.prev){a.prev=b;b.parent=a;break}else a=a.prev;else if(null==a.next){a.next=b;b.parent=a;break}else a=a.next;null==b.parent?b.colour=1:(b.colour=0,0==b.parent.colour&&this.__fix_dbl_red(b));return b},__class__:cb};var Xe,Ih=0;Math.NaN=
Number.NaN;Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;h.Math=Math;Math.isFinite=function(a){return isFinite(a)};Math.isNaN=function(a){return isNaN(a)};String.prototype.__class__=h.String=String;String.__name__=!0;h.Array=Array;Array.__name__=!0;Date.prototype.__class__=h.Date=Date;Date.__name__=["Date"];var Jh=h.Int={__name__:["Int"]},Kh=h.Dynamic={__name__:["Dynamic"]},Dh=h.Float=Number;Dh.__name__=["Float"];var Eh=h.Bool=Boolean;Eh.__ename__=
["Bool"];var Lh=h.Class={__name__:["Class"]},Mh={};D.Element="element";D.PCData="pcdata";D.CData="cdata";D.Comment="comment";D.DocType="doctype";D.ProcessingInstruction="processingInstruction";D.Document="document";var Xc=window.navigator.userAgent;ua.isARM=(new ya("ARM","i")).match(Xc);ua.isChrome=(new ya("Chrome","i")).match(Xc);ua.isSafari=(new ya("Safari","i")).match(Xc)&&!ua.isChrome;ua.isiPad=(new ya("iPad","i")).match(Xc);ua.isiPhone=(new ya("iPhone","i")).match(Xc);ua.isiPod=(new ya("iPod",
"i")).match(Xc);ua.isAndroid=(new ya("Android","i")).match(Xc);ua.isFirefox=(new ya("Firefox","i")).match(Xc);ua.isIE=(new ya("MSIE","i")).match(Xc);ua.isiOS=ua.isiPhone||ua.isiPad||ua.isiPod;ua.isMobile=ua.isiOS||ua.isAndroid||ua.isARM;lc.instance=new lc;X.DISPATCHING_SENTINEL=new md(null,null);s.root=new W;s.uncaughtError=new ca;s.hidden=new Aa(!1);s.volume=new z(1);s._platform=lc.instance;s._calledInit=!1;tb.__meta__={obj:{assets:[{bootstrap:[{bytes:17553,md5:"62b42d661ccf57536bb7e803940e30ac",
name:"audio/sfx/blep.mp3"},{bytes:9761,md5:"f37388ce9a91a2a98e0e0c580712e240",name:"audio/sfx/blep.ogg"},{bytes:25912,md5:"ab772ef4251a148071500d0d8afe6871",name:"audio/sfx/blesdfpk.mp3"},{bytes:9358,md5:"954e22f136a7f93caf341a3b6c79ddfd",name:"audio/sfx/blesdfpk.ogg"},{bytes:35943,md5:"c60b89a85f4a68b75d856777d06714de",name:"audio/sfx/blooweep.mp3"},{bytes:7511,md5:"322dcdd7d1930963435d15ce03bcf3e4",name:"audio/sfx/blooweep.ogg"},{bytes:3342,md5:"172ba47ce9667f99233cc13b33fbcf77",name:"audio/sfx/boop.mp3"},
{bytes:5073,md5:"4e382b84ecc10198c8227c95fdf20522",name:"audio/sfx/boop.ogg"},{bytes:25912,md5:"1441217c49a648b15d3a472b4ca7fb66",name:"audio/sfx/dangg.mp3"},{bytes:9953,md5:"7fa52d88b196ada808fce98641c0febd",name:"audio/sfx/dangg.ogg"},{bytes:7577,md5:"fa942293657fa847c4f163bd61ca6cd5",name:"body-shapes.json"},{bytes:1318,md5:"efbb1ad95ad5bf2f3dfe325f4399399d",name:"particle-test/particle.pex"},{bytes:1369,md5:"e40a552922f94958b02d2d03d3e1cc75",name:"particle-test/texture.png"},{bytes:30733,md5:"4caedae992121b5807234795e6f7e98d",
name:"sprites.png"},{bytes:1269,md5:"2a59d4328ae8db3170fee91b38ac8561",name:"sprites.xml"}]}]}};tb._supportsCrossOrigin=function(){var a;a=0<=window.navigator.userAgent.indexOf("Linux; U; Android")?!1:null!=(new XMLHttpRequest).withCredentials;a||null;return a}();N._scratchPoint=new pd;Xa.moveToleSqr=1;pc.NAME="BodyComponent_8";ja.FixedTimeStep=0.016666666666666666;ja.PositionIterationsPerTimeStep=10;ja.VelocityIterationsPerTimeStep=10;ob._sharedEvent=new Xf;Ka._sharedEvent=new Yf;za._sharedEvent=
new Zf;$b.CANVAS_TEXTURES=(new ya("(iPhone|iPod|iPad)","")).match(window.navigator.userAgent);P._mediaRefCount=0;P._detectBlobSupport=!0;J.VENDOR_PREFIXES=["webkit","moz","ms","o","khtml"];J.SHOULD_HIDE_MOBILE_BROWSER=window.top==window&&(new ya("Mobile(/.*)? Safari","")).match(window.navigator.userAgent);ea._detectSupport=!0;ub._scratchMatrix=new Pa;Kc.escapes=function(){var a=new Fb;a.set("lt","<");a.set("gt",">");a.set("amp","&");a.set("quot",'"');a.set("apos","'");a.set("nbsp",String.fromCharCode(160));
return a}(this);ga.ANY_SHAPE=new gb;ga.ANY_BODY=new gb;ga.ANY_COMPOUND=new gb;ga.ANY_CONSTRAINT=new gb;Ga._Constraint=0;Ga._Interactor=0;Ga._CbType=0;Ga._CbSet=0;Ga._Listener=0;sc.NAME="BodyComponent_8";sc.BallType=new gb;m.epsilon=1.0E-8;m.fluidAngularDragFriction=2.5;m.fluidAngularDrag=100;m.fluidVacuumDrag=0.5;m.fluidLinearDrag=0.5;m.collisionSlop=0.2;m.collisionSlopCCD=0.5;m.distanceThresholdCCD=0.05;m.staticCCDLinearThreshold=0.05;m.staticCCDAngularThreshold=0.0050;m.bulletCCDLinearThreshold=
0.125;m.bulletCCDAngularThreshold=0.0125;m.dynamicSweepLinearThreshold=17;m.dynamicSweepAngularThreshold=0.6;m.angularCCDSlipScale=0.75;m.arbiterExpirationDelay=6;m.staticFrictionThreshold=2;m.elasticThreshold=20;m.sleepDelay=60;m.linearSleepThreshold=0.2;m.angularSleepThreshold=0.4;m.contactBiasCoef=0.3;m.contactStaticBiasCoef=0.6;m.contactContinuousBiasCoef=0.4;m.contactContinuousStaticBiasCoef=0.5;m.constraintLinearSlop=0.1;m.illConditionedThreshold=2E8;f.internal=!1;f.id_ImmState_ACCEPT=1;f.id_ImmState_IGNORE=
2;f.id_ImmState_ALWAYS=4;f.id_GravMassMode_DEFAULT=0;f.id_GravMassMode_FIXED=1;f.id_GravMassMode_SCALED=2;f.id_InertiaMode_DEFAULT=0;f.id_MassMode_DEFAULT=0;f.id_BodyType_STATIC=1;f.id_BodyType_DYNAMIC=2;f.id_BodyType_KINEMATIC=3;f.id_ListenerType_BODY=0;f.id_PreFlag_ACCEPT=1;f.id_ListenerType_CONSTRAINT=1;f.id_ListenerType_INTERACTION=2;f.id_ListenerType_PRE=3;f.id_CbEvent_BEGIN=0;f.id_InteractionType_COLLISION=1;f.id_CbEvent_ONGOING=6;f.id_InteractionType_SENSOR=2;f.id_CbEvent_END=1;f.id_InteractionType_FLUID=
4;f.id_CbEvent_WAKE=2;f.id_InteractionType_ANY=7;f.id_CbEvent_SLEEP=3;f.id_CbEvent_BREAK=4;f.id_CbEvent_PRE=5;f.id_ShapeType_CIRCLE=0;f.id_ShapeType_POLYGON=1;R.UCbSet=new Jd;R.VCbSet=new Jd;R.WCbSet=new Jd;R.UCbType=new hc;R.VCbType=new hc;R.WCbType=new hc;C.internal=!1;C.COL=1;C.FLUID=4;C.SENSOR=2;$a.internal=!1;w.flowpoly=new he;w.flowsegs=new he;var Gh;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new da,f.internal=!1);Gh=f.BodyType_STATIC;var Hh;null==f.BodyType_DYNAMIC&&(f.internal=
!0,f.BodyType_DYNAMIC=new da,f.internal=!1);Hh=f.BodyType_DYNAMIC;null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new da,f.internal=!1);Uc.types=[null,Gh,Hh,f.BodyType_KINEMATIC];I.WAKE=1;I.PROPS=2;I.ANGDRAG=4;I.ARBITERS=8;U.internal=!1;Db.tmpaabb=new $;Nb.internal=!1;ka.internal=!1;ge.internal=!1;Vc.internal=!1;Rc.internal=!1;Lb.internal=!1;fc.internal=!1;ee.internal=!1;zd.internal=!1;yd.internal=!1;Ad.internal=!1;gd.internal=!1;Kd.internal=!1;ed.internal=!1;de.internal=!1;rc.main()})();
